<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Create an API Gateway API as an Amazon Kinesis Proxy - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="api-gateway-tutorials.html" title="Samples and Tutorials">
      <link rel="prev" href="api-as-s3-proxy-export-swagger-with-extensions.html" title="Swagger Definitions of
      the
      Sample
      API as an Amazon S3 Proxy">
      <link rel="next" href="api-as-kinesis-proxy-export-swagger-with-extensions.html" title="Swagger Definitions of
            a Sample API as a Kinesis Proxy">
      <meta name="description" content="Learn how to create and configure an API in API Gateway as an AWS proxy for Kinesis.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/integrating-api-with-aws-services-kinesis.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="api-gateway-tutorials.html">Samples and Tutorials</a> &#xBB; <span class="breadcrumb">Create an API Gateway API as an Amazon Kinesis Proxy</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="integrating-api-with-aws-services-kinesis">Create an API Gateway API as an Amazon Kinesis Proxy</h1>
                     <p> This section describes how to create and configure an API Gateway API with an integration
                        of
                        the <code class="code">AWS</code> type to access Kinesis. 
                     </p>
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p> To integrate your API Gateway API with Kinesis, you must choose a region where both
                           the API Gateway
                           and Kinesis services are available. For region availability, see <a href="./general/latest/gr/rande.html#apigateway_region" target="_blank">Regions and
                              Endpoints</a>. 
                        </p>
                     </div>
                     <p> For the purpose of illustration, we create an example API to enable a client to do
                        the
                        following: 
                     </p>
                     <div class="orderedlist">
                        
                        
                        
                        
                        <ol>
                           <li>
                              
                              <p>List the user&apos;s available streams in Kinesis </p>
                              
                           </li>
                           <li>
                              
                              <p>Create, describe, or delete a specified stream</p>
                              
                           </li>
                           <li>
                              
                              <p>Read data records from or write data records into the specified stream</p>
                              
                           </li>
                        </ol>
                     </div>
                     <p> To accomplish the preceding tasks, the API exposes methods on various resources to
                        invoke
                        the following, respectively: 
                     </p>
                     <div class="orderedlist">
                        
                        
                        
                        
                        <ol>
                           <li>
                              
                              <p>The <code class="code">ListStreams</code> action in Kinesis 
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>The <code class="code">CreateStream</code>, <code class="code">DescribeStream</code>, or
                                 <code class="code">DeleteStream</code> action
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>The <code class="code">GetRecords</code> or <code class="code">PutRecords</code> (including
                                 <code class="code">PutRecord</code>) action in Kinesis
                              </p>
                              
                           </li>
                        </ol>
                     </div>
                     <p> Specifically, we build the API as follows: </p>
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p> Expose an HTTP GET method on the API&apos;s <code class="code">/streams</code> resource and
                                 integrate the method with the <a href="./kinesis/latest/APIReference/API_ListStreams.html" target="_blank">ListStreams</a> action in Kinesis to list the streams in the caller&apos;s account.
                                 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose an HTTP POST method on the API&apos;s <code class="code">/streams/{stream-name}</code>
                                 resource and integrate the method with the <a href="./kinesis/latest/APIReference/API_CreateStream.html" target="_blank">CreateStream</a> action in Kinesis to create a named stream in the caller&apos;s
                                 account. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose an HTTP GET method on the API&apos;s <code class="code">/streams/{stream-name}</code>
                                 resource and integrate the method with the <a href="./kinesis/latest/APIReference/API_DescribeStream.html" target="_blank">DescribeStream</a> action in Kinesis to describe a named stream in the
                                 caller&apos;s account. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose an HTTP DELETE method on the API&apos;s <code class="code">/streams/{stream-name}</code>
                                 resource and integrate the method with the <a href="./kinesis/latest/APIReference/API_DeleteStream.html" target="_blank">DeleteStream</a> action in Kinesis to delete a stream in the caller&apos;s account.
                                 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose an HTTP PUT method on the API&apos;s <code class="code">/streams/{stream-name}/record</code>
                                 resource and integrate the method with the <a href="./kinesis/latest/APIReference/API_PutRecord.html" target="_blank">PutRecord</a> action in Kinesis. This enables the client to add a single data
                                 record to the named stream. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose an HTTP PUT method on the API&apos;s
                                 <code class="code">/streams/{stream-name}/records</code> resource and integrate the method
                                 with the <a href="./kinesis/latest/APIReference/API_PutRecords.html" target="_blank">PutRecords</a> action in Kinesis. This enables the client to add a list of
                                 data records to the named stream. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose an HTTP GET method on the API&apos;s
                                 <code class="code">/streams/{stream-name}/records</code> resource and integrate the method
                                 with the <a href="./kinesis/latest/APIReference/API_GetRecords.html" target="_blank">GetRecords</a> action in Kinesis. This enables the client to list data records
                                 in the named stream, with a specified shard iterator. A shard iterator specifies the
                                 shard position from which to start reading data records sequentially.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose an HTTP GET method on the API&apos;s
                                 <code class="code">/streams/{stream-name}/sharditerator</code> resource and integrate the
                                 method with the <a href="./kinesis/latest/APIReference/API_GetShardIterator.html" target="_blank">GetShardIterator</a> action in Kinesis. This helper method must be supplied to
                                 the <code class="code">ListStreams</code> action in Kinesis. 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     <p> You can apply the instructions presented here to other Kinesis actions. For the complete
                        list of the Kinesis actions, see <a href="./kinesis/latest/APIReference/Welcome.html" target="_blank">Amazon Kinesis API
                           Reference</a>. 
                     </p>
                     <p> Instead of using the API Gateway console to create the sample API, you can import
                        the sample
                        API into API Gateway, using either the API Gateway <a href="./apigateway/api-reference/link-relation/restapi-import/" target="_blank">Import
                           API</a> or the <a href="https://github.com/awslabs/aws-apigateway-importer" target="_blank">API Gateway
                           Swagger Importer</a>. For information on how to use the Import API, see <a href="api-gateway-import-api.html">Import an API into API Gateway</a>. For
                        information on how to use the API Gateway Swagger Importer, see <a href="http://swagger.io/getting-started-with-the-amazon-swagger-importer/" target="_blank">Getting
                           Started with the API Gateway Swagger Importer</a>.
                        
                     </p>
                     <p>If you do not have an AWS account, use the following procedure to create one.</p>
                     <p class="title"><b>To sign up for AWS</b></p>
                     <ol>
                        <li>
                           <p>Open <a href="https://aws.amazon.com/" target="_blank">https://aws.amazon.com/</a> and 
                              choose <b>Create an AWS Account</b>.
                           </p>
                        </li>
                        <li>
                           <p>Follow the online instructions.</p>
                        </li>
                     </ol>
                     <h2 id="integrate-with-kinesis-create-iam-role-and-policy">Create an IAM Role and
                        Policy for the API to Access Kinesis
                     </h2>
                     
                     
                     <p> To allow the API to invoke Kinesis actions, you must have appropriate IAM policies
                        attached to an IAM role. This section explains how to verify and to create, if
                        necessary, the required IAM role and policies. 
                     </p>
                     
                     <p> To enable read-only access to Kinesis, you can use the AmazonKinesisReadOnlyAccess
                        policy that allows the <code class="code">Get*</code>, <code class="code">List*</code>, and <code class="code">Describe*</code>
                        actions in Kinesis to be invoked. 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;kinesis:Get*&quot;,
                &quot;kinesis:List*&quot;,
                &quot;kinesis:Describe*&quot;
            ],
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}                        
            </code></pre>
                     <p> This policy is available as an IAM-provisioned managed policy and its ARN is
                        <code class="code">arn:aws:iam::aws:policy/AmazonKinesisReadOnlyAccess</code>. 
                     </p>
                     
                     <p> To enable read-write actions in Kinesis, you can use the AmazonKinesisFullAccess
                        policy. 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;kinesis:*&quot;,
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}                        
            </code></pre>
                     <p> This policy is also available as an IAM-provisioned managed policy. Its ARN is
                        <code class="code">arn:aws:iam::aws:policy/AmazonKinesisFullAccess</code>. 
                     </p>
                     
                     <p> After you decide which IAM policy to use, attach it to a new or existing IAM
                        role. Make sure that the API Gateway control service (<code class="code">apigateway.amazonaws.com</code>)
                        is a trusted entity of the role and is allowed to assume the execution role
                        (<code class="code">sts:AssumeRole</code>). 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;apigateway.amazonaws.com&quot;
      },
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    }
  ]
}                        
            </code></pre>
                     <p>If you create the execution role in the IAM console and choose the
                        <b>Amazon API Gateway</b> role type, this trust policy is automatically
                        attached. 
                     </p>
                     
                     <p> Note the ARN of the execution role. You will need it when creating an API method
                        and
                        setting up its integration request. 
                     </p>
                     
                     <h2 id="api-gateway-create-api-as-kinesis-proxy">Start to Create an API as a Kinesis
                        Proxy
                     </h2>
                     
                     
                     <p>Use the following steps to create the API in the API Gateway console.</p>
                     
                     <p class="title"><b>To create an API as an AWS service proxy for Kinesis</b></p>
                     <ol>
                        <li>
                           
                           <p> In the API Gateway console, choose <b>Create API</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose <b>New API</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> In <b>API name</b>, type <strong class="userinput"><code>KinesisProxy</code></strong>.
                              Leave the
                              default
                              values in the other fields. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Type a description in <b>Description</b>, if you like. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose <b>Create API</b>. 
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p> After the API is created, the API Gateway console displays the
                        <b>Resources</b> page, which contains only the API&apos;s root
                        (<code class="code">/</code>) resource. 
                     </p>
                     
                     <h2 id="api-gateway-list-kinesis-streams">List Streams in Kinesis</h2>
                     
                     
                     <p> Kinesis supports the <code class="code">ListStreams</code> action with the following REST API call: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">POST /?Action=ListStreams HTTP/1.1
Host: kinesis.&lt;region&gt;.&lt;domain&gt;
Content-Length: &lt;PayloadSizeBytes&gt;
User-Agent: &lt;UserAgentString&gt;
Content-Type: application/x-amz-json-1.1
Authorization: &lt;AuthParams&gt;
X-Amz-Date: &lt;Date&gt;
        
{
   ...
}</code></pre>
                     <p>In the above REST API request, the action is specified in the <code class="code">Action</code>
                        query parameter. Alternatively, you can specify the action in a
                        <code class="code">X-Amz-Target</code> header, instead:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">POST / HTTP/1.1
Host: kinesis.&lt;region&gt;.&lt;domain&gt;
Content-Length: &lt;PayloadSizeBytes&gt;
User-Agent: &lt;UserAgentString&gt;
Content-Type: application/x-amz-json-1.1
Authorization: &lt;AuthParams&gt;
X-Amz-Date: &lt;Date&gt;
X-Amz-Target: Kinesis_20131202.ListStreams        
{
   ...
}</code></pre>
                     <p>In this tutorial, we use the query parameter to specify action.</p>
                     
                     <p>To expose a Kinesis action in the API, add a <code class="code">/streams</code> resource to the API&apos;s
                        root. Then set a <code class="code">GET</code> method on the resource and integrate the method with
                        the <code class="code">ListStreams</code> action of Kinesis. 
                     </p>
                     
                     <p>The following procedure describes how to list Kinesis streams by using the API Gateway
                        console. 
                     </p>
                     
                     <p class="title"><b>To list Kinesis streams by using the API Gateway console</b></p>
                     <ol>
                        <li>
                           
                           <p> Select the API root resource. In <b>Actions</b>, choose
                              <b>Create Resource</b>. 
                           </p>
                           
                           <p>In <b>Resource Name</b>, type <code class="code">Streams</code>, leave
                              <b>Resource Path</b> and other fields as the default, and
                              choose <b>Create Resource</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose the <code class="code">/Streams</code> resource. From <b>Actions</b>,
                              choose <b>Create Method</b>, choose <b>GET</b> from
                              the list, and then choose the check mark icon to finish creating the method. 
                           </p>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>The HTTP verb for a method invoked by a client may differ from the HTTP
                                 verb for an integration required by the backend. We chose <code class="code">GET</code>
                                 here, because listing streams is intuitively a READ operation. 
                              </p>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p> In the method&apos;s <b>Setup</b> pane, choose <b>AWS
                                 Service</b>. 
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>For <b>AWS Region</b>, choose a region (e.g.,
                                    <b>us-east-1</b>).
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>AWS Service</b>, choose
                                    <b>Kinesis</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave <b>AWS Subdomain</b> blank.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>HTTP method</b>, choose
                                    <b>POST</b>.
                                 </p>
                                 
                                 <div class="aws-note">
                                    <p class="aws-note">Note</p>
                                    <p>We chose <code class="code">POST</code> here because Kinesis requires that the
                                       <code class="code">ListStreams</code> action be invoked with it. 
                                    </p>
                                 </div>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Action Type</b>, choose <b>Use action
                                       name</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Action</b>, type
                                    <strong class="userinput"><code>ListStreams</code></strong>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Execution role</b>, type the ARN for your
                                    execution role.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave the default of <b>Passthrough</b> for
                                    <b>Content Handling</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Save</b> to finish the initial setup of the
                                    method.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-get-method.png" alt="
                            Set up the Streams:GET method for Kinesis ListStreams
                                action.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p> Still in the <b>Integration Request</b> pane, expand the
                              <b>HTTP Headers</b> section:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Add header</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>In the <b>Name</b> column, type
                                    <code class="code">Content-Type</code>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>In the <b>Mapped from</b> column, type
                                    <code class="code">&apos;application/x-amz-json-1.1&apos;</code>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose the check mark icon to save the setting.</p>
                                 
                              </li>
                           </ol>
                           
                           <p> We used a request parameter mapping to set the <code class="code">Content-Type</code>
                              header to the static value of <code class="code">&apos;application/x-amz-json-1.1&apos;</code> to
                              inform Kinesis that the input is of a specific version of JSON. 
                           </p>
                           
                           
                        </li>
                        <li>
                           
                           <p>Expand the <b>Body Mapping Templates</b> section: 
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Add mapping template</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Content-Type</b>, type
                                    <code class="code">application/json</code>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose the check mark icon to save the
                                    <b>Content-Type</b> setting. Choose <b>Yes,
                                       secure this integration</b> in <b>Change passthrough
                                       behavior</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <strong class="userinput"><code>{}</code></strong> in the template editor.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose the <b>Save</b> button to save the mapping
                                    template.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                           <p> The <a href="./kinesis/latest/APIReference/API_ListStreams.html#API_ListStreams_RequestSyntax" target="_blank">ListStreams</a> request takes a payload of the following JSON format: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;ExclusiveStartStreamName&quot;: &quot;string&quot;,
    &quot;Limit&quot;: number
}
                    </code></pre>
                           <p>However, the properties are optional. To use the default values, we opted for
                              an empty JSON payload here.
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-get-method-data-mapping.png" alt="
                            Set up data mapping for the Streams:GET method for the Kinesis
                                    ListStreams action.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Test the GET method on the Streams resource to invoke the
                              <code class="code">ListStreams</code> action in Kinesis:
                           </p>
                           
                           <p> From the API Gateway console, select the <b>/streams/GET</b> entry
                              from the <b>Resources</b> pane, choose the
                              <b>Test</b> invocation option, and then choose
                              <b>Test</b>. 
                           </p>
                           
                           <p> If you already created two streams named
                              &quot;myStream&quot;
                              and &quot;yourStream&quot; in Kinesis, the successful test returns a 200
                              OK response containing the following payload: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
     &quot;HasMoreStreams&quot;: false,
     &quot;StreamNames&quot;: [
         &quot;myStream&quot;,
         &quot;yourStream&quot;
     ]
}            
                    </code></pre>
                           </li>
                     </ol>
                     
                     <h2 id="api-gateway-create-describe-delete-stream">Create, Describe, and Delete a
                        Stream in Kinesis
                     </h2>
                     
                     
                     
                     <p> Creating, describing, and deleting a stream in Kinesis involves making the following
                        Kinesis REST API requests, respectively: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST /?Action=CreateStream HTTP/1.1
Host: kinesis.<em class="replaceable"><code>region</code></em>.<em class="replaceable"><code>domain</code></em>
...
Content-Type: application/x-amz-json-1.1
Content-Length: <em class="replaceable"><code>PayloadSizeBytes</code></em>

{
    &quot;ShardCount&quot;: number,
    &quot;StreamName&quot;: &quot;string&quot;
}                               
            </code></pre>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST /?Action=DescribeStream HTTP/1.1
Host: kinesis.<em class="replaceable"><code>region</code></em>.<em class="replaceable"><code>domain</code></em>
...
Content-Type: application/x-amz-json-1.1
Content-Length: <em class="replaceable"><code>PayloadSizeBytes</code></em>

{
    &quot;ExclusiveStartShardId&quot;: &quot;string&quot;,
    &quot;Limit&quot;: number,
    &quot;StreamName&quot;: &quot;string&quot;
}                                          
            </code></pre>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST /?Action=DeleteStream HTTP/1.1
Host: kinesis.<em class="replaceable"><code>region</code></em>.<em class="replaceable"><code>domain</code></em>
...
Content-Type: application/x-amz-json-1.1
Content-Length: <em class="replaceable"><code>PayloadSizeBytes</code></em>

{
    &quot;StreamName&quot;:&quot;string&quot;
}                    
            </code></pre>
                     <p> We can build the API to accept the required input as a JSON payload of the method
                        request and pass the payload through to the integration request. However, to provide
                        more examples of data mapping between method and integration requests, and method
                        and
                        integration responses, we create our API somewhat differently. 
                     </p>
                     
                     <p> We expose the <code class="code">GET</code>, <code class="code">POST</code>, and <code class="code">Delete</code> HTTP
                        methods on a to-be-named <code class="code">Stream</code> resource. We use the
                        <code class="code">{stream-name}</code> path variable as the placeholder of the stream resource
                        and integrate these API methods with the Kinesis&apos; <code class="code">DescribeStream</code>,
                        <code class="code">CreateStream</code>, and <code class="code">DeleteStream</code> actions, respectively. We
                        require that the client pass other input data as headers, query parameters, or the
                        payload of a method request. We provide mapping templates to transform the data to
                        the
                        required integration request payload. 
                     </p>
                     
                     
                     <p class="title"><b>To configure and test the GET method on a stream resource</b></p>
                     <ol>
                        <li>
                           
                           <p> Create a child resource with the <code class="code">{stream-name}</code> path variable
                              under the previously created <code class="code">/streams</code> resource. 
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-resource.png" alt="
                            Create {stream-name} resource
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p> Add the <code class="code">POST</code>, <code class="code">GET</code>, and <code class="code">DELETE</code> HTTP
                              verbs to this resource.
                           </p>
                           
                           <p> After the methods are created on the resource, the structure of the API looks
                              like the following: 
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-methods.png" alt="
                            Create POST, GET, and DELETE methods on a stream
                                resource
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Set up the <code class="code">GET /streams/{stream-name}</code> method to call the
                              <code class="code">POST /?Action=DescribeStream</code> action in Kinesis, as shown in the
                              following. 
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-get-method.png" alt="
                            Set up the GET-on-Stream method to invoke the
                                    DescribeStream action in Kinesis
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Add the following <code class="code">Content-Type</code> header mapping to the integration
                              request:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">Content-Type: &apos;x-amz-json-1.1&apos;</code></pre>
                           <p>The task follows the same procedure to set up the request parameter mapping
                              for the <code class="code">GET /streams</code> method.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Add the following body mapping template to map data from the <code class="code">GET
                                 /streams/{stream-name}</code> method request to the <code class="code">POST
                                 /?Action=DescribeStream</code> integration request:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;StreamName&quot;: &quot;$input.params(&apos;stream-name&apos;)&quot;
}</code></pre>
                           <p>This mapping template generates the required integration request payload for
                              the <code class="code">DescribeStream</code> action of Kinesis from the method request&apos;s
                              <code class="code">stream-name</code> path parameter value.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Test the <code class="code">GET /stream/{stream-name}</code> method to invoke the
                              <code class="code">DescribeStream</code> action in Kinesis:
                           </p>
                           
                           <p>From the API Gateway console, select <b>/streams/{stream-name}/GET</b>
                              in the <b>Resources</b> pane, choose <b>Test</b> to
                              start testing, type the name of an existing Kinesis stream in the
                              <b>Path</b> field for <code class="code">stream-name</code>, and choose
                              <b>Test</b>. If the test is successful, a 200 OK response is
                              returned with a payload similar to the following: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;StreamDescription&quot;: {
    &quot;HasMoreShards&quot;: false,
    &quot;RetentionPeriodHours&quot;: 24,
    &quot;Shards&quot;: [
      {
        &quot;HashKeyRange&quot;: {
          &quot;EndingHashKey&quot;: &quot;68056473384187692692674921486353642290&quot;,
          &quot;StartingHashKey&quot;: &quot;0&quot;
        },
        &quot;SequenceNumberRange&quot;: {
          &quot;StartingSequenceNumber&quot;: &quot;49559266461454070523309915164834022007924120923395850242&quot;
        },
        &quot;ShardId&quot;: &quot;shardId-000000000000&quot;
      },
      ...
      {
        &quot;HashKeyRange&quot;: {
          &quot;EndingHashKey&quot;: &quot;340282366920938463463374607431768211455&quot;,
          &quot;StartingHashKey&quot;: &quot;272225893536750770770699685945414569164&quot;
        },
        &quot;SequenceNumberRange&quot;: {
          &quot;StartingSequenceNumber&quot;: &quot;49559266461543273504104037657400164881014714369419771970&quot;
        },
        &quot;ShardId&quot;: &quot;shardId-000000000004&quot;
      }
    ],
    &quot;StreamARN&quot;: &quot;arn:aws:kinesis:us-east-1:12345678901:stream/myStream&quot;,
    &quot;StreamName&quot;: &quot;myStream&quot;,
    &quot;StreamStatus&quot;: &quot;ACTIVE&quot;
  }
}</code></pre>
                           <p> After you deploy the API, you can make a REST request against this API
                              method: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
GET https://<em class="replaceable"><code>your-api-id</code></em>.execute-api.<em class="replaceable"><code>region</code></em>.amazonaws.com/<em class="replaceable"><code>stage</code></em>/streams/<em class="replaceable"><code>myStream</code></em> HTTP/1.1
Host: <em class="replaceable"><code>your-api-id</code></em>.execute-api.<em class="replaceable"><code>region</code></em>.amazonaws.com
Content-Type: application/json
Authorization: ...
X-Amz-Date: 20160323T194451Z

                    </code></pre>
                           </li>
                     </ol>
                     
                     <p class="title"><b>To configure and test the POST method on a stream resource</b></p>
                     <ol>
                        <li>
                           
                           <p>Set up the <code class="code">POST /streams/{stream-name}</code> method to call <code class="code">POST
                                 /?Action=CreateStream</code> action in Kinesis. The task follows the same
                              procedure to set up the <code class="code">GET /streams/{stream-name}</code> method provided
                              that you replace the <code class="code">DescribeStream</code> action by
                              <code class="code">CreateStream</code>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Add the following <code class="code">Content-Type</code> header mapping to the integration
                              request:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">Content-Type: &apos;x-amz-json-1.1&apos;</code></pre>
                           <p>The task follows the same procedure to set up the request parameter mapping
                              for the <code class="code">GET /streams</code> method.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Add the following body mapping template to map data from the <code class="code">POST
                                 /streams/{stream-name}</code> method request to the <code class="code">POST
                                 /?Action=CreateStream</code> integration request: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;ShardCount&quot;: #if($input.path(&apos;$.ShardCount&apos;) == &apos;&apos;) 5 #else $input.path(&apos;$.ShardCount&apos;) #end,
    &quot;StreamName&quot;: &quot;$input.params(&apos;stream-name&apos;)&quot;
}</code></pre>
                           <p> In the preceding mapping template, we set <code class="code">ShardCount</code> to a fixed
                              value of 5 if the client does not specify a value in the method request payload.
                              
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Test the <code class="code">POST /streams/{stream-name}</code> method to create a named
                              stream in Kinesis:
                           </p>
                           
                           <p>From the API Gateway console, select
                              <b>/streams/{stream-name}/POST</b> in the
                              <b>Resources</b> pane, choose <b>Test</b> to
                              start testing, type the name of an existing Kinesis stream in
                              <b>Path</b> for <code class="code">stream-name</code>, and choose
                              <b>Test</b>. If the test is successful, a 200 OK response is
                              returned with no data. 
                           </p>
                           
                           <p> After you deploy the API, you can also make a REST API request against the
                              POST method on a Stream resource to invoke the <code class="code">CreateStream</code> action
                              in Kinesis: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST https://<em class="replaceable"><code>your-api-id</code></em>.execute-api.<em class="replaceable"><code>region</code></em>.amazonaws.com/<em class="replaceable"><code>stage</code></em>/streams/<em class="replaceable"><code>yourStream</code></em> HTTP/1.1
Host: <em class="replaceable"><code>your-api-id</code></em>.execute-api.<em class="replaceable"><code>region</code></em>.amazonaws.com
Content-Type: application/json
Authorization: ...
X-Amz-Date: 20160323T194451Z

{ 
    &quot;ShardCount&quot;: 5
}
                    </code></pre>
                           </li>
                     </ol>
                     
                     <p class="title"><b>Configure and test the DELETE method on a stream resource</b></p>
                     <ol>
                        <li>
                           
                           <p>Set up the <code class="code">DELETE /streams/{stream-name}</code> method to integrate with
                              the <code class="code">POST /?Action=DeleteStream</code> action in Kinesis. The task follows the
                              same procedure to set up the <code class="code">GET /streams/{stream-name}</code> method
                              provided that you replace the <code class="code">DescribeStream</code> action by
                              <code class="code">DeleteStream</code>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Add the following <code class="code">Content-Type</code> header mapping to the integration
                              request:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">Content-Type: &apos;x-amz-json-1.1&apos;</code></pre>
                           <p>The task follows the same procedure to set up the request parameter mapping
                              for the <code class="code">GET /streams</code> method.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Add the following body mapping template to map data from the <code class="code">DELETE
                                 /streams/{stream-name}</code> method request to the corresponding
                              integration request of <code class="code">POST /?Action=DeleteStream</code> : 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;StreamName&quot;: &quot;$input.params(&apos;stream-name&apos;)&quot;
}</code></pre>
                           <p> This mapping template generates the required input for the <code class="code">DELETE
                                 /streams/{stream-name}</code> action from the client-supplied URL path name
                              of <code class="code">stream-name</code>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Test the DELETE method to delete a named stream in Kinesis:</p>
                           
                           <p>From the API Gateway console, select the
                              <b>/streams/{stream-name}/DELETE</b> method node in the
                              <b>Resources</b> pane, choose <b>Test</b> to
                              start testing, type the name of an existing Kinesis stream in
                              <b>Path</b> for <code class="code">stream-name</code>, and choose
                              <b>Test</b>. If the test is successful, a 200 OK response is
                              returned with no data. 
                           </p>
                           
                           <p> After you deploy the API, you can also make the following REST API request
                              against the DELETE method on the Stream resource to call the
                              <code class="code">DeleteStream</code> action in Kinesis: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
DELETE https://<em class="replaceable"><code>your-api-id</code></em>.execute-api.<em class="replaceable"><code>region</code></em>.amazonaws.com/<em class="replaceable"><code>stage</code></em>/streams/<em class="replaceable"><code>yourStream</code></em> HTTP/1.1
Host: <em class="replaceable"><code>your-api-id</code></em>.execute-api.<em class="replaceable"><code>region</code></em>.amazonaws.com
Content-Type: application/json
Authorization: ...
X-Amz-Date: 20160323T194451Z

{}
                    </code></pre>
                           </li>
                     </ol>
                     
                     <h2 id="api-gateway-get-and-add-records-to-stream">Get Records from and Add Records
                        to a Stream in Kinesis
                     </h2>
                     
                     
                     <p> After you create a stream in Kinesis, you can add data records to the stream and
                        read
                        the data from the stream. Adding data records involves calling the <a href="./kinesis/latest/APIReference/API_PutRecords.html#API_PutRecords_Examples" target="_blank">PutRecords</a> or <a href="./kinesis/latest/APIReference/API_PutRecord.html#API_PutRecord_Examples" target="_blank">PutRecord</a> action in Kinesis. The former adds multiple records whereas the
                        latter adds a single record to the stream. 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST /?Action=PutRecords HTTP/1.1
Host: kinesis.<em class="replaceable"><code>region</code></em>.<em class="replaceable"><code>domain</code></em>
Authorization: AWS4-HMAC-SHA256 Credential=..., ...
...
Content-Type: application/x-amz-json-1.1
Content-Length: <em class="replaceable"><code>PayloadSizeBytes</code></em>

{
    &quot;Records&quot;: [
        {
            &quot;Data&quot;: blob,
            &quot;ExplicitHashKey&quot;: &quot;string&quot;,
            &quot;PartitionKey&quot;: &quot;string&quot;
        }
    ],
    &quot;StreamName&quot;: &quot;string&quot;
}                                      
            </code></pre>
                     <p>or</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST /?Action=PutRecord HTTP/1.1
Host: kinesis.<em class="replaceable"><code>region</code></em>.<em class="replaceable"><code>domain</code></em>
Authorization: AWS4-HMAC-SHA256 Credential=..., ...
...
Content-Type: application/x-amz-json-1.1
Content-Length: <em class="replaceable"><code>PayloadSizeBytes</code></em>

{
    &quot;Data&quot;: <em class="replaceable"><code>blob</code></em>,
    &quot;ExplicitHashKey&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>,
    &quot;PartitionKey&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>,
    &quot;SequenceNumberForOrdering&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>,
    &quot;StreamName&quot;: &quot;string&quot;
}                                      
            </code></pre>
                     <p> Here, <code class="code">StreamName</code> identifies the target stream to add records.
                        <code class="code">StreamName</code>, <code class="code">Data</code>, and <code class="code">PartitionKey</code> are
                        required input data. In our example, we use the default values for all of the optional
                        input data and will not explicitly specify values for them in the input to the method
                        request. 
                     </p>
                     
                     <p> Reading data in Kinesis amounts to calling the <a href="./kinesis/latest/APIReference/API_GetRecords.html#API_GetRecords_Examples" target="_blank">GetRecords</a> action: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">POST /?Action=GetRecords HTTP/1.1
Host: kinesis.<em class="replaceable"><code>region</code></em>.<em class="replaceable"><code>domain</code></em>
Authorization: AWS4-HMAC-SHA256 Credential=..., ...
...
Content-Type: application/x-amz-json-1.1
Content-Length: <em class="replaceable"><code>PayloadSizeBytes</code></em>

{
    &quot;ShardIterator&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>,
    &quot;Limit&quot;: <em class="replaceable"><code>number</code></em>
}                                      
</code></pre>
                     <p>Here, the source stream from which we are getting records is specified in the required
                        <code class="code">ShardIterator</code> value, as is shown in the following Kinesis action to obtain
                        a shard iterator:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST /?Action=GetShardIterator HTTP/1.1
Host: kinesis.<em class="replaceable"><code>region</code></em>.<em class="replaceable"><code>domain</code></em>
Authorization: AWS4-HMAC-SHA256 Credential=..., ...
...
Content-Type: application/x-amz-json-1.1
Content-Length: <em class="replaceable"><code>PayloadSizeBytes</code></em>
                
{
    &quot;ShardId&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>,
    &quot;ShardIteratorType&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>,
    &quot;StartingSequenceNumber&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>,
    &quot;StreamName&quot;: <em class="replaceable"><code>&quot;string&quot;</code></em>
}

            </code></pre>
                     <p> For the <code class="code">GetRecords</code> and <code class="code">PutRecords</code> actions, we expose the
                        <code class="code">GET</code> and <code class="code">PUT</code> methods, respectively, on a
                        <code class="code">/records</code> resource that is appended to a named stream resource
                        (<code class="code">/{stream-name}</code>). Similarly, we expose the <code class="code">PutRecord</code>
                        action as a <code class="code">PUT</code> method on a <code class="code">/record</code> resource. 
                     </p>
                     
                     <p> Because the <code class="code">GetRecords</code> action takes as input a
                        <code class="code">ShardIterator</code> value, which is obtained by calling the
                        <code class="code">GetShardIterator</code> helper action, we expose a <code class="code">GET</code> helper
                        method on a <code class="code">ShardIterator</code> resource (<code class="code">/sharditerator</code>). 
                     </p>
                     
                     <p>The following figure shows the API structure of resources after the methods are
                        created:
                     </p>
                     
                     <div class="mediaobject">
                        
                        <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-records-methods.png" alt="
                    Create Records:GET|PUT|PUT|GET method for the API.
                " style="max-width:100%">
                        
                        
                        
                     </div>
                     
                     <p> The following four procedures describe how to set up each of the methods, how to
                        map
                        data from the method requests to the integration requests, and how to test the methods.
                        
                     </p>
                     
                     <p class="title"><b>To
                           set up and test the <code class="code">PUT /streams/{stream-name}/record</code> method to invoke
                           <code class="code">PutRecord</code> in Kinesis:</b></p>
                     <ol>
                        <li>
                           
                           <p>Set up the PUT method, as shown in the following:</p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-record-put-method.png" alt="
                            Set up the PUT method to call the PutRecord action
                                in Kinesis.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Add the following request parameter mapping to set the
                              <code class="code">Content-Type</code> header to an AWS-compliant version of JSON in
                              the integration request:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">Content-Type: &apos;x-amz-json-1.1&apos;</code></pre>
                           <p>The task follows the same procedure to set up the request parameter mapping
                              for the <code class="code">GET /streams</code> method.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Add the following body mapping template to map data from the <code class="code">PUT
                                 /streams/{stream-name}/record</code> method request to the corresponding
                              integration request of <code class="code">POST /?Action=PutRecord</code> : 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;StreamName&quot;: &quot;$input.params(&apos;stream-name&apos;)&quot;,
    &quot;Data&quot;: &quot;$util.base64Encode($input.json(&apos;$.Data&apos;))&quot;,
    &quot;PartitionKey&quot;: &quot;$input.path(&apos;$.PartitionKey&apos;)&quot;
}</code></pre>
                           <p> This mapping template assumes that the method request payload is of the
                              following format: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;Data&quot;: &quot;some data&quot;,
   &quot;PartitionKey&quot;: &quot;some key&quot;
}</code></pre>
                           <p>This data can be modeled by the following JSON schema:</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;,
  &quot;title&quot;: &quot;PutRecord proxy single-record payload&quot;,
  &quot;type&quot;: &quot;object&quot;,
  &quot;properties&quot;: {
      &quot;Data&quot;: { &quot;type&quot;: &quot;string&quot; },
      &quot;PartitionKey&quot;: { &quot;type&quot;: &quot;string&quot; }
  }
}</code></pre>
                           <p> You can create a model to include this schema and use the model to facilitate
                              generating the mapping template. However, you can generate a mapping template
                              without using any model. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> To test the <code class="code">PUT /streams/{stream-name}/record</code> method, set the
                              <code class="code">stream-name</code> path variable to the name of an existing stream,
                              supply a payload of the required format, and then submit the method request. The
                              successful result is a <code class="code">200 OK </code>response with a payload of the
                              following format: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;SequenceNumber&quot;: &quot;49559409944537880850133345460169886593573102115167928386&quot;,
  &quot;ShardId&quot;: &quot;shardId-000000000004&quot;
}
                    </code></pre>
                           </li>
                     </ol>
                     
                     <p class="title"><b>To set up and test the <code class="code">PUT /streams/{stream-name}/records</code> method to
                           invoke <code class="code">PutRecords</code> in Kinesis</b></p>
                     <ol>
                        <li>
                           
                           <p>Set up the <code class="code">PUT /streams/{stream-name}/records</code> method, as shown in
                              the following:
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-records-put-method.png" alt="
                            Set up the PUT /streams/{stream-name}/records method for the
                                Kinesis PutRecords action.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Add the following request parameter mapping to set the
                              <code class="code">Content-Type</code> header to an AWS-compliant version of JSON in
                              the integration request:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">Content-Type: &apos;x-amz-json-1.1&apos;</code></pre>
                           <p>The task follows the same procedure to set up the request parameter mapping
                              for the <code class="code">GET /streams</code> method.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Add the following body mapping template to map data from the <code class="code">PUT
                                 /streams/{stream-name}/records</code> method request to the corresponding
                              integration request of <code class="code">POST /?Action=PutRecords</code> : 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;StreamName&quot;: &quot;$input.params(&apos;stream-name&apos;)&quot;,
    &quot;Records&quot;: [
       #foreach($elem in $input.path(&apos;$.records&apos;))
          {
            &quot;Data&quot;: &quot;$util.base64Encode($elem.data)&quot;,
            &quot;PartitionKey&quot;: &quot;$elem.partition-key&quot;
          }#if($foreach.hasNext),#end
        #end
    ]
}</code></pre>
                           <p>This mapping template assumes that the method request payload can be modelled
                              by the following JSON schema:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;,
  &quot;title&quot;: &quot;PutRecords proxy payload data&quot;,
  &quot;type&quot;: &quot;object&quot;,
  &quot;properties&quot;: {
    &quot;records&quot;: {
      &quot;type&quot;: &quot;array&quot;,
      &quot;items&quot;: {
        &quot;type&quot;: &quot;object&quot;,
        &quot;properties&quot;: {
          &quot;data&quot;: { &quot;type&quot;: &quot;string&quot; },
          &quot;partition-key&quot;: { &quot;type&quot;: &quot;string&quot; }
        }
      }
    }
  }
}</code></pre>
                           <p> You can create a model to include this schema and use the model to facilitate
                              generating the mapping template. However, you can generate a mapping template
                              without using any model. 
                           </p>
                           
                           <p>In this tutorial, we used two slightly different payload formats to illustrate
                              that an API developer can choose to expose the backend data format to the client
                              or hide it from the client. One format is for the <code class="code">PUT
                                 /streams/{stream-name}/records</code> method (above). Another format is used
                              for the <code class="code">PUT /streams/{stream-name}/record</code> method (in the previous
                              procedure). In production environment, you should keep both formats consistent.
                              
                           </p>
                           
                        </li>
                        <li>
                           
                           
                           <p> To test the <code class="code">PUT /streams/{stream-name}/records</code> method, set the
                              <code class="code">stream-name</code> path variable to an existing stream, supply the
                              following payload, and submit the method request. 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;records&quot;: [
        {
            &quot;data&quot;: &quot;some data&quot;,
            &quot;partition-key&quot;: &quot;some key&quot;
        },
        {
            &quot;data&quot;: &quot;some other data&quot;,
            &quot;partition-key&quot;: &quot;some key&quot;
        }
    ]
}
                        </code></pre>
                           <p>The successful result is a 200 OK response with a payload similar to the
                              following output: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;FailedRecordCount&quot;: 0,
  &quot;Records&quot;: [
    {
      &quot;SequenceNumber&quot;: &quot;49559409944537880850133345460167468741933742152373764162&quot;,
      &quot;ShardId&quot;: &quot;shardId-000000000004&quot;
    },
    {
      &quot;SequenceNumber&quot;: &quot;49559409944537880850133345460168677667753356781548470338&quot;,
      &quot;ShardId&quot;: &quot;shardId-000000000004&quot;
    }
  ]
}</code></pre>
                           </li>
                     </ol>
                     
                     <p class="title"><b>To set up and test the <code class="code">GET /streams/{stream-name}/sharditerator</code>
                           method invoke <code class="code">GetShardIterator</code> in Kinesis</b></p>
                     <p>The <code class="code">GET /streams/{stream-name}/sharditerator</code> method is a helper
                        method to acquire a required shard iterator before calling the <code class="code">GET
                           /streams/{stream-name}/records</code> method.
                     </p>
                     <ol>
                        <li>
                           
                           <p>Set up integration for the <code class="code">GET
                                 /streams/{stream-name}/sharditerator</code> method, as shown in the
                              following:
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-sharditerator-get-method.png" alt="
                            Set up the GET /streams/{stream-name}/sharditerator
                                method.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           
                           <p> The <code class="code">GetShardIterator</code> action requires an input of a ShardId
                              value. To pass a client-supplied <code class="code">ShardId</code> value, we add a
                              <code class="code">shard-id</code> query parameter to the method request, as shown in the
                              following: 
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-sharditerator-get-method-shardid-query-string.png" alt="
                            Add the shard-id query parameter to the
                                GET-on-ShardIterator method request.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                           <p> In the following body-mapping template, we set the <code class="code">shard-id</code>
                              query parameter value to the <code class="code">ShardId</code> property value of the JSON
                              payload as the input to the <code class="code">GetShardIterator</code> action in Kinesis.
                              
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Configure the body mapping template to generate the required input
                              (<code class="code">ShardId</code> and <code class="code">StreamName</code>) to the
                              <code class="code">GetShardIterator</code> action from the <code class="code">shard-id</code> and
                              <code class="code">stream-name</code> parameters of the method request. In addition, the
                              mapping template also sets <code class="code">ShardIteratorType</code> to
                              <code class="code">TRIM_HORIZON</code> as a default.
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;ShardId&quot;: &quot;$input.params(&apos;shard-id&apos;)&quot;,
    &quot;ShardIteratorType&quot;: &quot;TRIM_HORIZON&quot;,
    &quot;StreamName&quot;: &quot;$input.params(&apos;stream-name&apos;)&quot;
}</code></pre>
                           </li>
                        <li>
                           
                           <p> Using the <b>Test</b> option in the API Gateway console, enter an
                              existing stream name as the <code class="code">stream-name</code>
                              <b>Path</b> variable value, set the <code class="code">shard-id</code>
                              <b>Query string</b> to an existing <code class="code">ShardId</code> value
                              (e.g., <code class="code">shard-000000000004</code>), and choose <b>Test</b>. 
                           </p>
                           
                           <p> The successful response payload is similar to the following output: </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;ShardIterator&quot;: &quot;AAAAAAAAAAFYVN3VlFy...&quot;
}</code></pre>
                           <p>Make note of the <code class="code">ShardIterator</code> value. You need it to get records
                              from a stream.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p class="title"><b>To configure and test the <code class="code">GET /streams/{stream-name}/records</code> method
                           to invoke the <code class="code">GetRecords</code> action in Kinesis</b></p>
                     <ol>
                        <li>
                           
                           <p>Set up the <code class="code">GET /streams/{stream-name}/records</code> method, as shown in
                              the following:
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-records-get-method.png" alt="
                            Set up the GET /streams/{stream-name}/records method.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           
                           <p> The <code class="code">GetRecords</code> action requires an input of a
                              <code class="code">ShardIterator</code> value. To pass a client-supplied
                              <code class="code">ShardIterator</code> value, we add a <code class="code">Shard-Iterator</code>
                              header parameter to the method request, as shown in the following: 
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/api-gateway-kinesis-proxy-setup-streams-stream-records-get-method-shard-iterator-header.png" alt="
                            Add the Shard-Iterator header parameter to the
                                GET-on-Records method request.
                        " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p> Set up the following mapping template to map the <code class="code">Shard-Iterator</code>
                              header parameter value to the <code class="code">ShardIterator</code> property value of the
                              JSON payload for the <code class="code">GetRecords</code> action in Kinesis. 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;ShardIterator&quot;: &quot;$input.params(&apos;Shard-Iterator&apos;)&quot;
}</code></pre>
                           </li>
                        <li>
                           
                           <p> Using the <b>Test</b> option in the API Gateway console, type an
                              existing stream name as the <code class="code">stream-name</code>
                              <b>Path</b> variable value, set the <code class="code">Shard-Iterator</code>
                              <b>Header</b> to the <code class="code">ShardIterator</code> value obtained
                              from the test run of the <code class="code">GET /streams/{stream-name}/sharditerator</code>
                              method (above), and choose <b>Test</b>. 
                           </p>
                           
                           <p> The successful response payload is similar to the following output: </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;MillisBehindLatest&quot;: 0,
  &quot;NextShardIterator&quot;: &quot;AAAAAAAAAAF...&quot;,
  &quot;Records&quot;: [ ... ]
}</code></pre>
                           </li>
                     </ol>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="api-as-s3-proxy-export-swagger-with-extensions.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="api-as-kinesis-proxy-export-swagger-with-extensions.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Create an IAM Role and
            Policy for the API to Access Kinesis"><a class="pagetoc" href="#integrate-with-kinesis-create-iam-role-and-policy">Create an IAM Role and
                              Policy for the API to Access Kinesis</a></li>
                        <li class="pagetoc" name="Start to Create an API as a Kinesis
            Proxy"><a class="pagetoc" href="#api-gateway-create-api-as-kinesis-proxy">Start to Create an API as a Kinesis
                              Proxy</a></li>
                        <li class="pagetoc" name="List Streams in Kinesis"><a class="pagetoc" href="#api-gateway-list-kinesis-streams">List Streams in Kinesis</a></li>
                        <li class="pagetoc" name="Create, Describe, and Delete a
            Stream in Kinesis"><a class="pagetoc" href="#api-gateway-create-describe-delete-stream">Create, Describe, and Delete a
                              Stream in Kinesis</a></li>
                        <li class="pagetoc" name="Get Records from and Add Records
            to a Stream in Kinesis"><a class="pagetoc" href="#api-gateway-get-and-add-records-to-stream">Get Records from and Add Records
                              to a Stream in Kinesis</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>