<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Sell Your API Gateway API through AWS Marketplace - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="how-to-deploy-api.html" title="Deploying an API in Amazon API Gateway">
      <link rel="prev" href="apigateway-regional-api-custom-domain-migrate.html" title="Migrate a Custom Domain Name
            to a Different API Endpoint">
      <link rel="next" href="how-to-call-api.html" title="Invoking an API in Amazon API Gateway">
      <meta name="description" content="Learn how to sell your API as a Software as a Service (SaaS) product through AWS Marketplace.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/sell-api-as-saas-on-aws-marketplace.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="how-to-deploy-api.html">Deploying an API in Amazon API Gateway</a> &#xBB; <span class="breadcrumb">Sell Your API Gateway API through AWS Marketplace</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="sell-api-as-saas-on-aws-marketplace">Sell Your API Gateway API through AWS Marketplace</h1>
                     <p>After you build, test, and deploy your API, you can package it in an API Gateway <a href="./apigateway/api-reference/resource/usage-plan/" target="_blank">usage plan</a> and sell the plan as a
                        Software as a Service (SaaS) product
                        through
                        AWS Marketplace. API buyers subscribing to your product offering are billed by AWS
                        Marketplace based on the
                        number of requests made to the <a href="api-gateway-api-usage-plans.html">usage
                           plan</a>. 
                     </p>
                     <p>To sell your API on AWS Marketplace, you must set up the sales channel to integrate
                        AWS Marketplace with
                        API Gateway. Generally speaking, this involves listing your product on AWS Marketplace,
                        setting up an IAM
                        role with appropriate policies to allow API Gateway to send usage metrics to AWS Marketplace,
                        associating an
                        AWS Marketplace product with an API Gateway usage plan, and associating an AWS Marketplace
                        buyer with an API Gateway API
                        key. Details are discussed in the following sections.
                     </p>
                     <p>To enable your customers to buy your product on AWS Marketplace, you must register
                        your developer
                        portal (an external application) with AWS Marketplace. The developer portal must handle
                        the
                        subscription requests that are redirected from the AWS Marketplace console. 
                     </p>
                     <p>For more information about selling your API as a SaaS product on AWS Marketplace,
                        see <a href="https://s3.amazonaws.com/awsmp-loadforms/SaaS+Seller+Integration+Guide.pdf" target="_blank">AWS Marketplace
                           SaaS Subscriptions - Seller Integration Guide</a>.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#sell-api-as-saas-on-aws-marketplace-inital-setup">Initialize AWS Marketplace
                                 Integration with API Gateway</a></li>
                           <li><a href="#sell-api-as-saas-on-aws-marketplace-subscripton-unsubscription">Handle Customer
                                 Subscription to Usage Plans </a></li>
                        </ul>
                     </div>
                     <h2 id="sell-api-as-saas-on-aws-marketplace-inital-setup">Initialize AWS Marketplace
                        Integration with API Gateway
                     </h2>
                     
                     
                     <p>The following tasks are for one-time initialization of AWS Marketplace integration
                        with API Gateway,
                        which enables you to sell your API as a SaaS product.
                     </p>
                     
                     
                     <h3 id="sell-api-as-saas-on-aws-marketplace-inital-setup-list-product">List a
                        Product on AWS Marketplace
                     </h3>
                     
                     
                     <p>To list your usage plan as a SaaS product, submit a product load form through
                        <a href="https://aws.amazon.com/marketplace/management/tour/" target="_blank">AWS Marketplace</a>. The
                        product must contain a dimension named <code class="literal">apigateway</code> of the
                        <code class="literal">requests</code> type. This dimension defines the price-per-request
                        and is used by API Gateway to meter requests to your API. 
                     </p>
                     
                     
                     
                     <h3 id="sell-api-as-saas-on-aws-marketplace-inital-setup-create-metering-role">Create the Metering Role</h3>
                     
                     
                     <p>Create an IAM role named <code class="literal">ApiGatewayMarketplaceMeteringRole</code>
                        with the following execution policy and trust policy. This role allows API Gateway
                        to send
                        usage metrics to AWS Marketplace on your behalf. 
                     </p>
                     
                     
                     <h4 id="sell-api-as-saas-on-aws-marketplace-inital-setup-create-metering-role-execution-policy">Execution Policy of the Metering Role</h4>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: [
        &quot;aws-marketplace:BatchMeterUsage&quot;,
        &quot;aws-marketplace:ResolveCustomer&quot;
      ],
      &quot;Resource&quot;: &quot;*&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;
    }
  ]
}</code></pre>
                     
                     
                     <h4 id="sell-api-as-saas-on-aws-marketplace-inital-setup-create-metering-role-trusted-policy">Trusted Relationship Policy of the Metering Role</h4>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;apigateway.amazonaws.com&quot;
      },
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    }
  ]
}</code></pre>
                     
                     
                     
                     
                     <h3 id="sell-api-as-saas-on-aws-marketplace-associate-usage-plan-with-saas-product">Associate Usage Plan with AWS Marketplace Product</h3>
                     
                     
                     <p>When you list a product on AWS Marketplace, you receive an AWS Marketplace product
                        code. To integrate
                        API Gateway with AWS Marketplace, associate your usage plan with the AWS Marketplace
                        product code. You enable
                        the association by setting the API Gateway <code class="literal">UsagePlan</code>&apos;s <a href="./apigateway/api-reference/resource/usage-plan/#productCode" target="_blank">productCode</a> field to
                        your AWS Marketplace product code, using the API Gateway console
                        
                        
                        , the API Gateway REST API, the
                        AWS CLI for API Gateway, or AWS SDK for API Gateway. The following code example uses
                        the API Gateway
                        REST API:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">PATCH /usageplans/<em class="replaceable"><code>USAGE_PLAN_ID</code></em>
Host: apigateway.<em class="replaceable"><code>region</code></em>.amazonaws.com
Authorization: ...

{
    &quot;patchOperations&quot; : [{
        &quot;path&quot; : &quot;/productCode&quot;,
        &quot;value&quot; : &quot;<em class="replaceable"><code>MARKETPLACE_PRODUCT_CODE</code></em>&quot;,
        &quot;op&quot; : &quot;replace&quot;
    }]
}</code></pre>
                     
                     
                     <h2 id="sell-api-as-saas-on-aws-marketplace-subscripton-unsubscription">Handle Customer
                        Subscription to Usage Plans 
                     </h2>
                     
                     
                     <p>The following tasks are handled by your developer portal application.</p>
                     
                     <p> When a
                        customer
                        subscribes to your product through AWS Marketplace, AWS Marketplace forwards a <code class="literal">POST</code>
                        request to the SaaS subscriptions URL 
                        
                        that you
                        registered when listing your product on AWS Marketplace. The <code class="code">POST</code> request comes with
                        an <code class="literal">x-amzn-marketplace-token</code> header parameter containing buyer
                        information. Follow the instructions in the Register Application section of the <a href="https://s3.amazonaws.com/awsmp-loadforms/SaaS+Seller+Integration+Guide.pdf" target="_blank">SaaS Seller Integration Guide</a> to handle this redirect in your developer
                        portal application. 
                     </p>
                     
                     <p>Responding to a customer&apos;s subscribing request, AWS Marketplace sends a
                        <code class="literal">subscribe-success</code> notification to an Amazon SNS topic that you can
                        subscribe to
                        (See
                        Step 6.4 of the <a href="https://s3.amazonaws.com/awsmp-loadforms/SaaS+Seller+Integration+Guide.pdf" target="_blank">SaaS Seller Integration Guide</a>). To accept the customer subscription
                        request, you handle the <code class="literal">subscribe-success</code> notification by creating or
                        retrieving an API Gateway API key for the customer, associating the customer&apos;s
                        AWS Marketplace-provisioned <code class="code">customerId</code> with the API keys, and then adding the API key
                        to your usage plan. 
                     </p>
                     
                     <p>When the customer&apos;s subscription request completes, the developer portal application
                        should present the customer with the associated API key and inform the customer that
                        the
                        API key must be included in the <code class="literal">x-api-key</code> header in requests to the
                        API. 
                     </p>
                     
                     <p>When a customer cancels a subscription to a usage plan, AWS Marketplace sends an
                        <code class="literal">unsubscribe-success</code> notification to the SNS topic. To complete
                        the process of unsubscribing the customer, you handle the
                        <code class="literal">unsubscribe-success</code> notification by removing the customer&apos;s API
                        keys from the usage plan. 
                     </p>
                     
                     
                     <h3 id="sell-api-as-saas-on-aws-marketplace-subscripton-unsubscription-authorize-access-to-usage-plan">Authorize a Customer to Access a Usage Plan</h3>
                     
                     
                     <p> To authorize access to your usage plan for a given customer, use the API Gateway
                        API to
                        fetch or create an API key for the customer and add the API key to the usage plan.
                        
                     </p>
                     
                     <p>The following example shows how to call the API Gateway REST API to create a new API
                        key
                        with a specific AWS Marketplace <code class="code">customerId</code> value
                        (<em class="replaceable"><code>MARKETPLACE_CUSTOMER_ID</code></em>).
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">POST apikeys HTTP/1.1
Host: apigateway.<em class="replaceable"><code>region</code></em>.amazonaws.com
Authorization: ...

{
  &quot;name&quot; : &quot;my_api_key&quot;,
  &quot;description&quot; : &quot;My API key&quot;,
  &quot;enabled&quot; : &quot;false&quot;,
  &quot;stageKeys&quot; : [ {
    &quot;restApiId&quot; : &quot;uycll6xg9a&quot;,
    &quot;stageName&quot; : &quot;prod&quot;
  } ],
  &quot;customerId&quot; : &quot;<em class="replaceable"><code>MARKETPLACE_CUSTOMER_ID</code></em>&quot;
}</code></pre>
                     <p>The following example shows how to get an API key with a specific AWS Marketplace
                        <code class="code">customerId</code> value
                        (<em class="replaceable"><code>MARKETPLACE_CUSTOMER_ID</code></em>).
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">GET apikeys?customerId=<em class="replaceable"><code>MARKETPLACE_CUSTOMER_ID</code></em> HTTP/1.1
Host: apigateway.<em class="replaceable"><code>region</code></em>.amazonaws.com
Authorization: ...</code></pre>
                     <p>To add an API key to a usage plan, create a <a href="./apigateway/api-reference/resource/usage-plan-key/" target="_blank">UsagePlanKey</a> with the API
                        key for the relevant usage plan. The following  example shows how to accomplish this
                        using the API Gateway REST API, where <code class="literal">n371pt</code> is the usage plan ID and
                        <code class="literal">q5ugs7qjjh</code> is an example API <code class="code">keyId</code> returned from
                        the preceding examples.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">POST /usageplans/n371pt/keys HTTP/1.1
Host: apigateway.<em class="replaceable"><code>region</code></em>.amazonaws.com
Authorization: ...

{
    &quot;keyId&quot;: &quot;q5ugs7qjjh&quot;,
    &quot;keyType&quot;: &quot;API_KEY&quot;
}</code></pre>
                     
                     
                     
                     <h3 id="sell-api-as-saas-on-aws-marketplace-subscripton-unsubscription-associate-marketplace">Associate a Customer with an API Key</h3>
                     
                     
                     
                     <p> You must update the <a href="./apigateway/api-reference/resource/api-key/" target="_blank">ApiKey</a>&apos;s
                        <code class="literal">customerId</code> field to the AWS Marketplace customer ID of the customer.
                        This associates the API key with the AWS Marketplace customer, which enables metering
                        and
                        billing for the buyer. The following code example calls the API Gateway REST API to
                        do
                        that.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">PATCH /apikeys/q5ugs7qjjh
Host: apigateway.<em class="replaceable"><code>region</code></em>.amazonaws.com
Authorization: ...
        
{
    &quot;patchOperations&quot; : [{
        &quot;path&quot; : &quot;/customerId&quot;,
        &quot;value&quot; : &quot;<em class="replaceable"><code>MARKETPLACE_CUSTOMER_ID</code></em>&quot;,
        &quot;op&quot; : &quot;replace&quot;
    }]
}</code></pre>
                     
                     
                     
                     
                     </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="apigateway-regional-api-custom-domain-migrate.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="how-to-call-api.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Initialize AWS Marketplace
            Integration with API Gateway"><a class="pagetoc" href="#sell-api-as-saas-on-aws-marketplace-inital-setup">Initialize AWS Marketplace
                              Integration with API Gateway</a></li>
                        <li class="pagetoc" name="Handle Customer
            Subscription to Usage Plans "><a class="pagetoc" href="#sell-api-as-saas-on-aws-marketplace-subscripton-unsubscription">Handle Customer
                              Subscription to Usage Plans </a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>