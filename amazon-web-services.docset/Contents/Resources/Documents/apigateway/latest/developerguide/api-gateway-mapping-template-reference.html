<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>API Gateway Mapping Template Reference - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="mappings.html" title="Set up
            API Gateway
            Request and Response Data Mappings  ">
      <link rel="prev" href="integration-passthrough-behaviors.html" title="Integration Passthrough Behaviors">
      <link rel="next" href="api-gateway-payload-encodings.html" title="Support Binary Payloads in
        API Gateway">
      <meta name="description" content="Learn how mapping templates work in API Gateway">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="how-to-create-api.html">Creating an API in Amazon API Gateway</a> &#xBB; <a href="mappings.html">Set up
                                    API Gateway
                                    Request and Response Data Mappings  </a> &#xBB; <span class="breadcrumb">API Gateway Mapping Template Reference</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="api-gateway-mapping-template-reference">API Gateway Mapping Template Reference</h1>
                     <p>Amazon API Gateway defines a set of variables and functions for working with models
                        and mapping templates. This document describes those functions and provides examples
                        for working with input payloads.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#context-variable-reference">Accessing the $context Variable</a></li>
                           <li><a href="#input-variable-reference">Accessing the $input Variable</a></li>
                           <li><a href="#stagevariables-template-reference">Accessing the $stageVariables Variable</a></li>
                           <li><a href="#util-template-reference">Accessing the $util Variable</a></li>
                        </ul>
                     </div>
                     <h2 id="context-variable-reference">Accessing the $context Variable</h2>
                     
                     
                     <p>The <code class="code">$context</code> variable holds all the contextual information of your API call.
                     </p>
                     
                     
                     <div class="table">
                        <p class="title"><b>$context Variable Reference</b></p>
                        <div class="table-contents">
                           <table id="w1526aac13c27c17b7b4">
                              
                              <tbody><tr>
                                 
                                 <th>Parameter</th>
                                 
                                 <th>Description</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$context.apiId</code></td>
                                 
                                 <td>
                                    
                                    <p>The identifier API Gateway assigns to your API.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.authorizer.claims.<em class="replaceable"><code>property</code></em></code></td>
                                 
                                 <td>
                                    
                                    <p>A property of the claims returned from the Amazon Cognito user pool after
                                       the method caller is successfully authenticated.
                                    </p>
                                    
                                    <div class="aws-note">
                                       <p class="aws-note">Note</p>
                                       <p>Calling <code class="code">$context.authorizer.claims</code> returns
                                          null.
                                       </p>
                                    </div>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.authorizer.principalId</code></td>
                                 
                                 <td>
                                    
                                    <p>The principal user identification associated with the token sent
                                       by the client and returned from an API Gateway Lambda authorizer (formerly
                                       known as a custom authorizer) Lambda function.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.authorizer.<em class="replaceable"><code>property</code></em></code></td>
                                 
                                 <td>
                                    
                                    <p>The stringified value of the specified key-value pair of the <code class="literal">context</code> map returned from an API Gateway
                                       Lambda authorizer Lambda function. For example, if the authorizer
                                       returns the following <code class="code">context</code> map: 
                                    </p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">&quot;context&quot; : {
  &quot;key&quot;: &quot;value&quot;,
  &quot;numKey&quot;: 1,
  &quot;boolKey&quot;: true
}</code></pre>
                                    <p>calling <code class="code">$context.authorizer.key</code> returns the
                                       <code class="code">&quot;value&quot;</code> string, calling
                                       <code class="code">$context.authorizer.numKey</code> returns the
                                       <code class="code">&quot;1&quot;</code> string, and calling
                                       <code class="code">$context.authorizer.boolKey</code> returns the
                                       <code class="code">&quot;true&quot;</code> string.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$context.httpMethod</code></td>
                                 
                                 <td>
                                    
                                    <p>The HTTP method used. Valid values include: <code class="code">DELETE</code>,
                                       <code class="code">GET</code>, <code class="code">HEAD</code>, <code class="code">OPTIONS</code>,
                                       <code class="code">PATCH</code>, <code class="code">POST</code>, and
                                       <code class="code">PUT</code>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.error.message</code></td>
                                 
                                 <td>
                                    
                                    <p>A string of an API Gateway error message. This variable can only be used
                                       for simple variable substitution in a <a href="./apigateway/api-reference/resource/gateway-response/" target="_blank">GatewayResponse</a> body-mapping template, which is not
                                       processed by the Velocity Template Language engine.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.error.messageString</code></td>
                                 
                                 <td>The quoted value of <code class="code">$context.error.message</code>, namely
                                    <code class="code">&quot;$context.error.message&quot;</code>.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.error.responseType</code></td>
                                 
                                 <td>
                                    
                                    <p>A <a href="./apigateway/api-reference/resource/gateway-response/#responseType" target="_blank">type</a> of <a href="./apigateway/api-reference/resource/gateway-response/" target="_blank">GatewayResponse</a>. This variable can only be used for
                                       simple variable substitution in a <a href="./apigateway/api-reference/resource/gateway-response/" target="_blank">GatewayResponse</a> body-mapping template, which is not
                                       processed by the Velocity Template Language engine. 
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.extendedRequestId</code></td>
                                 
                                 <td>An automatically generated ID for the API call, which contains
                                    more useful information for debugging/troubleshooting.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.accountId</code></td>
                                 
                                 <td>
                                    
                                    <p>The AWS account ID associated with the request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.apiKey</code></td>
                                 
                                 <td>
                                    
                                    <p>The API owner key associated with key-enabled API request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.apiKeyId</code></td>
                                 
                                 <td>The API key ID associated with the key-enabled API request</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.caller</code></td>
                                 
                                 <td>
                                    
                                    <p>The principal identifier of the caller making the request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.cognitoAuthenticationProvider</code></td>
                                 
                                 <td>
                                    
                                    <p>The Amazon Cognito authentication provider used by the caller making
                                       the request. Available only if the request was signed with Amazon Cognito
                                       credentials.
                                    </p>
                                    
                                    <p>For information related to this and the other Amazon Cognito
                                       <code class="code">$context</code> variables, see <a href="./cognito/latest/developerguide/cognito-identity.html" target="_blank">Using Federated
                                          Identities</a> in the <em>Amazon Cognito Developer
                                          Guide</em>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.cognitoAuthenticationType</code></td>
                                 
                                 <td>
                                    
                                    <p>The Amazon Cognito authentication type of the caller making the
                                       request. Available only if the request was signed with Amazon Cognito
                                       credentials.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.cognitoIdentityId</code></td>
                                 
                                 <td>
                                    
                                    <p>The Amazon Cognito identity ID of the caller making the request.
                                       Available only if the request was signed with Amazon Cognito
                                       credentials.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.cognitoIdentityPoolId</code></td>
                                 
                                 <td>
                                    
                                    <p>The Amazon Cognito identity pool ID of the caller making the request.
                                       Available only if the request was signed with Amazon Cognito
                                       credentials.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.sourceIp</code></td>
                                 
                                 <td>
                                    
                                    <p>The source IP address of the TCP connection making the request to
                                       API Gateway.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.user</code></td>
                                 
                                 <td>
                                    
                                    <p>The principal identifier of the user making the request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.userAgent</code></td>
                                 
                                 <td>
                                    
                                    <p>The User Agent of the API caller.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.userArn</code></td>
                                 
                                 <td>
                                    
                                    <p>The Amazon Resource Name (ARN) of the effective user identified
                                       after authentication.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.integrationLatency</code></td>
                                 
                                 <td>The integration latency in ms, available for access logging only.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.path</code></td>
                                 
                                 <td>The request path. For example, for the non-proxy request URI of
                                    <code class="code">https://{rest-api-id.execute-api.{region}.amazonaws.com/{stage}/root/child</code>,
                                    The <code class="code">$context.path</code> value is
                                    <code class="code">/{stage}/root/child</code>. 
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.protocol</code></td>
                                 
                                 <td>The request protocol, for example, <code class="code">HTTP/1.1</code>.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.requestId</code></td>
                                 
                                 <td>
                                    
                                    <p>An automatically generated ID for the API call.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.requestTime</code></td>
                                 
                                 <td>The <a href="https://httpd.apache.org/docs/1.3/logs.html#common" target="_blank">CLF</a>-formatted request time (<code class="code">dd/MMM/yyyy:HH:mm:ss
                                       +-hhmm</code>).
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.requestTimeEpoch</code></td>
                                 
                                 <td>The <a href="https://en.wikipedia.org/wiki/Unix_time" target="_blank">Epoch</a>-formatted request time.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.resourceId</code></td>
                                 
                                 <td>
                                    
                                    <p>The identifier API Gateway assigns to your resource.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.resourcePath</code></td>
                                 
                                 <td>
                                    
                                    <p>The path to your resource. For example, for the non-proxy request
                                       URI of
                                       <code class="code">https://{rest-api-id.execute-api.{region}.amazonaws.com/{stage}/root/child</code>,
                                       The <code class="code">$context.resourcePath</code> value is
                                       <code class="code">/root/child</code>. For more information, see <a href="api-gateway-create-api-step-by-step.html">Build an API with HTTP Custom
                                          Integration</a>. 
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.responseLength</code></td>
                                 
                                 <td>The response payload length, available for access logging
                                    only.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.responseLatency</code></td>
                                 
                                 <td>The response latency in ms, available for access logging only.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.status</code></td>
                                 
                                 <td>The response status, available for access logging only.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.stage</code></td>
                                 
                                 <td>
                                    
                                    <p>The deployment stage of the API call (for example, Beta or
                                       Prod).
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                     
                     
                     <h3 id="context-examples-mapping-templates">Example</h3>
                     
                     
                     <p>You may want to use the <code class="code">$context</code> variable if you&apos;re using AWS Lambda as the target backend that the API method calls.
                        For example, you may want to perform two different actions depending on whether the
                        stage is in Beta or in Prod.
                     </p>
                     
                     
                     
                     <h4 id="context-variables-template-example">Context Variables Template
                        Example
                     </h4>
                     
                     <p>The following example shows a mapping template  to map  context variables to
                        an integration request payload:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;stage&quot; : &quot;$context.stage&quot;,
    &quot;request_id&quot; : &quot;$context.requestId&quot;,
    &quot;api_id&quot; : &quot;$context.apiId&quot;,
    &quot;resource_path&quot; : &quot;$context.resourcePath&quot;,
    &quot;resource_id&quot; : &quot;$context.resourceId&quot;,
    &quot;http_method&quot; : &quot;$context.httpMethod&quot;,
    &quot;source_ip&quot; : &quot;$context.identity.sourceIp&quot;,
    &quot;user-agent&quot; : &quot;$context.identity.userAgent&quot;,
    &quot;account_id&quot; : &quot;$context.identity.accountId&quot;,
    &quot;api_key&quot; : &quot;$context.identity.apiKey&quot;,
    &quot;caller&quot; : &quot;$context.identity.caller&quot;,
    &quot;user&quot; : &quot;$context.identity.user&quot;,
    &quot;user_arn&quot; : &quot;$context.identity.userArn&quot;
}</code></pre>
                     <p>In the above example, the method is assumed to have an API key enabled. If API
                        key is not required on the method request, <code class="code">api_key</code> will be null. 
                     </p>
                     
                     <p>For requests of the <code class="code">AWS_IAM</code> authorization type, you can pass the
                        authorized user information to the integration endpoint with
                        <code class="code">$context.identity.*</code> properties. For requests of the
                        <code class="code">COGNITO_USER_POOLS</code> authorization type, the authorized user
                        information will also include <code class="code">$context.identity.cognito*</code> and
                        <code class="code">$context.authorizer.claims.*</code> properties. For requests using a
                        Lambda authorizer, you can pass <code class="code">$context.authorizer.principalId</code> and
                        other applicable <code class="code">$context.authorizer.*</code> properties as additional
                        authorized user context to the integration endpoint.
                     </p>
                     
                     <p>With a proxy integration, API Gateway passes the authorized identity information to
                        the backend in the <code class="code">requestContext.identity</code> object. You do not set
                        up any mapping template and, instead, parse the input to the integration backend
                        explicitly. The following shows an example of <code class="code">requestContext</code> passed
                        to a Lambda proxy integration endpoint when the authorization type is set to
                        <code class="code">AWS_IAM</code>.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    ...,
    &quot;requestContext&quot;: {
        &quot;requestTime&quot;: &quot;20/Feb/2018:22:48:57 +0000&quot;,
        &quot;path&quot;: &quot;/test/&quot;,
        &quot;accountId&quot;: &quot;123456789012&quot;,
        &quot;protocol&quot;: &quot;HTTP/1.1&quot;,
        &quot;resourceId&quot;: &quot;yx5mhem7ye&quot;,
        &quot;stage&quot;: &quot;test&quot;,
        &quot;requestTimeEpoch&quot;: 1519166937665,
        &quot;requestId&quot;: &quot;3c3ecbaa-1690-11e8-ae31-8f39f1d24afd&quot;,
        &quot;identity&quot;: {
            &quot;cognitoIdentityPoolId&quot;: null,
            &quot;accountId&quot;: &quot;123456789012&quot;,
            &quot;cognitoIdentityId&quot;: null,
            &quot;caller&quot;: &quot;AIDAJ........4HCKVJZG&quot;,
            &quot;sourceIp&quot;: &quot;51.240.196.104&quot;,
            &quot;accessKey&quot;: &quot;<em class="replaceable"><code>IAM_user_access_key</code></em>&quot;,
            &quot;cognitoAuthenticationType&quot;: null,
            &quot;cognitoAuthenticationProvider&quot;: null,
            &quot;userArn&quot;: &quot;arn:aws:iam::123456789012:user/alice&quot;,
            &quot;userAgent&quot;: &quot;PostmanRuntime/7.1.1&quot;,
            &quot;user&quot;: &quot;AIDAJ........4HCKVJZG&quot;
        },
        &quot;resourcePath&quot;: &quot;/&quot;,
        &quot;httpMethod&quot;: &quot;GET&quot;,
        &quot;apiId&quot;: &quot;qr2gd9cfmf&quot;
    },
    ...
}</code></pre>
                     
                     
                     <h2 id="input-variable-reference">Accessing the $input Variable</h2>
                     
                     
                     
                     <p>The <code class="code">$input</code> variable represents the input payload and parameters to be processed by your template.
                        It provides four functions:
                     </p>
                     
                     
                     
                     <div class="table">
                        <p class="title"><b>Function Reference</b></p>
                        <div class="table-contents">
                           <table id="w1526aac13c27c17b9b4">
                              
                              <tbody><tr>
                                 
                                 <th>Variable and Function</th>
                                 
                                 <th>Description</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$input.body</code></td>
                                 
                                 <td>
                                    <p>Returns the raw payload as a string.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$input.json(x)</code></td>
                                 
                                 <td>
                                    <p>This function evaluates a JSONPath expression and returns the results as a JSON string.</p>
                                    
                                    <p>For example, <code class="code">$input.json(&apos;$.pets&apos;)</code> will return a JSON string representing the pets structure.
                                    </p>
                                    
                                    <p>For more information about JSONPath, see <a href="http://goessner.net/articles/JsonPath/" target="_blank">JSONPath</a> or <a href="https://github.com/jayway/JsonPath" target="_blank">JSONPath for Java</a>.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$input.params()</code></td>
                                 
                                 <td>
                                    <p>Returns a map of all the request parameters of your API call.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$input.params(x)</code></td>
                                 
                                 <td>
                                    <p>Returns the value of a method request parameter from the path, query string, or header
                                       value (in that order) given a parameter name string x.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$input.path(x)</code></td>
                                 
                                 <td>
                                    <p>Takes a JSONPath expression string (x) and returns an object representation of the
                                       result. This allows you to access and manipulate elements of the payload natively
                                       in <a href="http://velocity.apache.org/engine/devel/vtl-reference-guide.html" target="_blank">Apache Velocity Template Language (VTL)</a>.
                                    </p> 
                                    
                                    <p>For example, <code class="code">$input.path(&apos;$.pets&apos;).size()</code></p>
                                    
                                    <p>For more information about JSONPath, see <a href="http://goessner.net/articles/JsonPath/" target="_blank">JSONPath</a> or <a href="https://github.com/jayway/JsonPath" target="_blank">JSONPath for Java</a>.
                                    </p>
                                 </td>
                                 
                              </tr>          
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                     
                     
                     <h3 id="input-examples-mapping-templates">Examples</h3>
                     
                     
                     <p>You may want to use the <code class="code">$input</code> variable to get query strings and the request body with or without using models.
                        You may also want to get the parameter and the payload, or a subsection of the payload,
                        into your 
                        AWS Lambda function. The examples below show how to do this.
                     </p>
                     
                     
                     <h4 id="input-example-json-mapping-template">Example JSON Mapping Template</h4>
                     
                     
                     
                     <p>The following example shows how to use a mapping to read a name from the query string
                        and then include the 
                        entire POST body in an element:
                     </p>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;name&quot; : &quot;$input.params(&apos;name&apos;)&quot;,
    &quot;body&quot; : $input.json(&apos;$&apos;) 
}</code></pre>
                     <p>
                        If the JSON input contains unescaped characters that cannot be parsed by JavaScript,
                        
                        a 400 response may be returned. Applying <code class="code">$util.escapeJavaScript($input.json(&apos;$&apos;))</code> above 
                        will ensure that the JSON input can be parsed properly.
                        
                     </p>
                     
                     
                     
                     
                     <h4 id="input-example-inputs-mapping-template">Example Inputs Mapping Template</h4>
                     
                     
                     
                     <p>The following example shows how to pass a JSONPath expression to the <code class="code">json()</code> method. You could also read a 
                        specific property of your request body object by using a period <code class="code">(.)</code>, followed by your property name:
                     </p>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;name&quot; : &quot;$input.params(&apos;name&apos;)&quot;,
    &quot;body&quot; : $input.json(&apos;$.mykey&apos;)  
}</code></pre>
                     
                     <p>
                        If a method request payload contains unescaped characters that cannot be parsed by
                        JavaScript, 
                        you may get <code class="code">400</code> response. In this case, you need to call <code class="code">$util.escapeJavaScript()</code> 
                        function in the mapping template, as shown as follows:
                        
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;name&quot; : &quot;$input.params(&apos;name&apos;)&quot;,
    &quot;body&quot; : $util.escapeJavaScript($input.json(&apos;$.mykey&apos;)) 
}</code></pre>
                     
                     
                     <h4 id="context-example-param-map-template">Param Mapping Template Example</h4>
                     
                     
                     
                     <p>
                        The following parameter-mapping example passes all parameters, including path, querystring
                        and header, 
                        through to the integration endpoint via a JSON payload
                        
                     </p>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">#set($allParams = $input.params())
{
  &quot;params&quot; : {
    #foreach($type in $allParams.keySet())
    #set($params = $allParams.get($type))
    &quot;$type&quot; : {
      #foreach($paramName in $params.keySet())
      &quot;$paramName&quot; : &quot;$util.escapeJavaScript($params.get($paramName))&quot;
      #if($foreach.hasNext),#end
      #end
    }
    #if($foreach.hasNext),#end
    #end
  }
}</code></pre>
                     <p>In effect, this mapping template outputs all the request parameters in the payload
                        as outlined as follows:
                     </p>  
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;parameters&quot; : {
     &quot;path&quot; : {    
       &quot;path_name&quot; : &quot;path_value&quot;, 
       ...
     }
     &quot;header&quot; : {  
       &quot;header_name&quot; : &quot;header_value&quot;,
       ...
     }
     &quot;querystring&quot; : {
       &quot;querystring_name&quot; : &quot;querystring_value&quot;,
       ...
     }
   }
}</code></pre>
                     
                     
                     <h4 id="input-example-request-and-response">Example Request and Response</h4>
                     
                     
                     
                     <p>Here&#x2019;s an example that uses all three functions:</p>
                     
                     
                     <p><b>Request Template:</b></p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">Resource: /things/{id}

With input template:
{
    &quot;id&quot; : &quot;$input.params(&apos;id&apos;)&quot;,
    &quot;count&quot; : &quot;$input.path(&apos;$.things&apos;).size()&quot;,
    &quot;things&quot; : $util.escapeJavaScript($input.json(&apos;$.things&apos;))
}

POST /things/abc
{
    &quot;things&quot; : {
        &quot;1&quot; : {},
        &quot;2&quot; : {},
        &quot;3&quot; : {}
    }
}</code></pre>
                     
                     <p><b>Response:</b></p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;id&quot;: &quot;abc&quot;,
  &quot;count&quot;: &quot;3&quot;,
  &quot;things&quot;: {
    &quot;1&quot;: {},
    &quot;2&quot;: {},
    &quot;3&quot;: {}
  }
}</code></pre>
                     
                     <p>
                        For more mapping examples, see <a href="models-mappings.html">Create Models and Mapping Templates for Request and Response Mappings</a>
                        
                     </p>
                     
                     
                     
                     <h2 id="stagevariables-template-reference">Accessing the $stageVariables Variable</h2>
                     
                     
                     <p>The syntax for inserting a stage variable looks like this: <code class="code">$stageVariables</code>.
                     </p>
                     
                     
                     <div class="table">
                        <p class="title"><b>$stageVariables Reference</b></p>
                        <div class="table-contents">
                           <table id="w1526aac13c27c17c11b4">
                              
                              <tbody><tr>
                                 
                                 <th>Syntax</th>
                                 
                                 <th>Description</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$stageVariables.<em class="replaceable"><code>&lt;variable_name&gt;</code></em></code></td>
                                 
                                 <td>
                                    
                                    <p><em class="replaceable"><code>&lt;variable_name&gt;</code></em> represents a stage variable name.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$stageVariables[&apos;<em class="replaceable"><code>&lt;variable_name&gt;</code></em>&apos;]</code></td>
                                 
                                 <td>
                                    
                                    <p><em class="replaceable"><code>&lt;variable_name&gt;</code></em> represents any stage variable name.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">${stageVariables[&apos;<em class="replaceable"><code>&lt;variable_name&gt;</code></em>&apos;]}</code></td>
                                 
                                 <td>
                                    
                                    <p><em class="replaceable"><code>&lt;variable_name&gt;</code></em> represents any stage variable name.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                     <h2 id="util-template-reference">Accessing the $util Variable</h2>
                     
                     
                     <p>The <code class="code">$util</code> variable contains utility functions for use in mapping templates.
                     </p>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p> Unless otherwise specified, the default character set is UTF-8.</p>
                     </div>
                     
                     
                     <div class="table">
                        <p class="title"><b>$util Variable Reference</b></p>
                        <div class="table-contents">
                           <table id="w1526aac13c27c17c13b6">
                              
                              <tbody><tr>
                                 
                                 <th>Function</th>
                                 
                                 <th>Description</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$util.escapeJavaScript()</code></td>
                                 
                                 <td>
                                    
                                    <p>Escapes the characters in a string using JavaScript string rules.</p>
                                    
                                    <div class="aws-note">
                                       <p class="aws-note">Note</p>
                                       <p>This function will turn any regular single quotes (<code class="code">&apos;</code>) into escaped ones (<code class="code">\&apos;</code>). However, the escaped single quotes are not valid in JSON. Thus, when the output
                                          from this function is used in a JSON property, you must turn any escaped single quotes
                                          (<code class="code">\&apos;</code>) back to regular single quotes (<code class="code">&apos;</code>). This is shown in the following example: 
                                       </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"> $util.escapeJavaScript(<em class="replaceable"><code>data</code></em>).replaceAll(&quot;\\&apos;&quot;,&quot;&apos;&quot;)</code></pre></div>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.parseJson()</code></td>
                                 
                                 <td>
                                    
                                    <p>
                                       Takes &quot;stringified&quot; JSON and returns an object representation of the result. 
                                       You can use the result from this function to access and manipulate elements 
                                       of the payload natively in Apache Velocity Template Language (VTL). For example,
                                       if you have the following payload:
                                       
                                    </p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{&quot;errorMessage&quot;:&quot;{\&quot;key1\&quot;:\&quot;var1\&quot;,\&quot;key2\&quot;:{\&quot;arr\&quot;:[1,2,3]}}&quot;}</code></pre>
                                    <p>
                                       and use the following mapping template
                                       
                                    </p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">#set ($errorMessageObj = $util.parseJson($input.path(&apos;$.errorMessage&apos;)))
{
   &quot;errorMessageObjKey2ArrVal&quot; : $errorMessageObj.key2.arr[0]
}
</code></pre>
                                    <p>You will get the following output:</p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;errorMessageObjKey2ArrVal&quot; : 1
}
</code></pre>
                                    </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.urlEncode()</code></td>
                                 
                                 <td>
                                    <p>Converts a string into &quot;application/x-www-form-urlencoded&quot; format.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.urlDecode()</code></td>
                                 
                                 <td>
                                    <p>Decodes an &quot;application/x-www-form-urlencoded&quot; string.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.base64Encode()</code></td>
                                 
                                 <td>
                                    <p>Encodes the data into a base64-encoded string.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.base64Decode()</code></td>
                                 
                                 <td>
                                    <p>Decodes the data from a base64-encoded string.</p>
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="integration-passthrough-behaviors.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="api-gateway-payload-encodings.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Accessing the $context Variable"><a class="pagetoc" href="#context-variable-reference">Accessing the $context Variable</a></li>
                        <li class="pagetoc" name="Accessing the $input Variable"><a class="pagetoc" href="#input-variable-reference">Accessing the $input Variable</a></li>
                        <li class="pagetoc" name="Accessing the $stageVariables Variable"><a class="pagetoc" href="#stagevariables-template-reference">Accessing the $stageVariables Variable</a></li>
                        <li class="pagetoc" name="Accessing the $util Variable"><a class="pagetoc" href="#util-template-reference">Accessing the $util Variable</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>