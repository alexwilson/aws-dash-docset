<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Amazon API Gateway API Request and Response Data Mapping Reference - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="mappings.html" title="Set up
            API Gateway
            Request and Response Data Mappings  ">
      <link rel="prev" href="example-employee.html" title="">
      <link rel="next" href="integration-passthrough-behaviors.html" title="Integration Passthrough Behaviors">
      <meta name="description" content="Set up data mappings from an API method request, including data stored in context, stage, or util variables to the integration request parameters and from the integration response, including data stored in context, stage, or util variables, to the method response parameters in Amazon API Gateway.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/request-response-data-mappings.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="how-to-create-api.html">Creating an API in Amazon API Gateway</a> &#xBB; <a href="mappings.html">Set up
                                    API Gateway
                                    Request and Response Data Mappings  </a> &#xBB; <span class="breadcrumb">Amazon API Gateway API Request and Response Data Mapping Reference</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="request-response-data-mappings">Amazon API Gateway API Request and Response Data Mapping Reference</h1>
                     <p> This section explains how to set up data mappings from an API&apos;s method request data,
                        including other data stored in <a href="api-gateway-mapping-template-reference.html#context-variable-reference"><code class="code">context</code></a>, <a href="api-gateway-mapping-template-reference.html#stagevariables-template-reference"><code class="code">stage</code></a>, or <a href="api-gateway-mapping-template-reference.html#util-template-reference"><code class="code">util</code></a> variables, to the corresponding integration request
                        parameters and from an integration response data, including the other data, to the
                        method
                        response parameters. The method request data includes request parameters (path, query
                        string, headers) and the body The integration response data includes response parameters
                        (headers) and
                        the body. For more information about using the stage variables, see <a href="aws-api-gateway-stage-variables-reference.html">Amazon API Gateway Stage Variables Reference</a>. 
                     </p>
                     <div class="highlights">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#mapping-request-parameters">Map Method Request Data to Integration Request
                                 Parameters</a></li>
                           <li><a href="#mapping-response-parameters">Map Integration Response Data to Method
                                 Response Headers</a></li>
                           <li><a href="#transforming-request-response-body">Map Request and Response Payloads
                                 between Method and Integration</a></li>
                           <li><a href="integration-passthrough-behaviors.html">Integration Passthrough Behaviors</a></li>
                        </ul>
                     </div>
                     <h2 id="mapping-request-parameters">Map Method Request Data to Integration Request
                        Parameters
                     </h2>
                     
                     
                     <p>
                        
                        Integration request parameters, in the form of path variables, query strings or headers,
                        can be mapped 
                        from any defined method request parameters and the payload.
                        
                        
                     </p>
                     
                     <div class="table">
                        <p class="title"><b>Integration request data mapping expressions</b></p>
                        <div class="table-contents">
                           <table id="w1526aac13c27c14b7b4">
                              
                              <tbody><tr>
                                 
                                 <th>Mapped data source</th>
                                 
                                 <th>Mapping expression</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td>Method request path</td>
                                 
                                 <td><code class="code">method.request.path.<em class="replaceable"><code>PARAM_NAME</code></em></code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Method request query string</td>
                                 
                                 <td><code class="code">method.request.querystring.<em class="replaceable"><code>PARAM_NAME</code></em></code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Method request header</td>
                                 
                                 <td><code class="code">method.request.header.<em class="replaceable"><code>PARAM_NAME</code></em></code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Method request body</td>
                                 
                                 <td><code class="code">method.request.body</code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Method request body (JsonPath)</td>
                                 
                                 <td><code class="code">method.request.body.<em class="replaceable"><code>JSONPath_EXPRESSION</code></em></code>.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Stage variables</td>
                                 
                                 <td><code class="code">stageVariables.<em class="replaceable"><code>VARIABLE_NAME</code></em></code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Context variables</td>
                                 
                                 <td><code class="code">context.<em class="replaceable"><code>VARIABLE_NAME</code></em></code> that must be one of the 
                                    <a href="api-gateway-mapping-template-reference.html#context-variable-reference">supported 
                                       context variables</a>.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Static value</td>
                                 
                                 <td><code class="code"><em class="replaceable"><code>&apos;STATIC_VALUE&apos;</code></em></code>. The <em class="replaceable"><code>STATIC_VALUE</code></em> is a string literal 
                                    and must be enclosed within a pair of single quotes.
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                     <p>
                        Here, <em class="replaceable"><code>PARAM_NAME</code></em> is the name of a method request parameter of the given parameter type. 
                        It must have been defined before it can be referenced.
                        
                        <em class="replaceable"><code>JSONPath_EXPRESSION</code></em> is a JSONPath expression for a JSON field of 
                        the body of a request or response. However, the &quot;$.&quot; prefix is omitted in this syntax.
                        
                     </p>
                     
                     <div class="example">
                        <p class="title"><b>Example mappings from method request parameter in Swagger</b></p>
                        <div class="example-contents">
                           <p>
                              The following example shows a Swagger snippet that maps 1) the method request&apos;s header,
                              named <code class="code">methodRequestHeadParam</code>, into 
                              the integration request path parameter, named <code class="code">integrationPathParam</code>; 2) the method request query string, named <code class="code">methodRequestQueryParam</code>, 
                              into the integration request query string, named <code class="code">integrationQueryParam</code>.
                              
                           </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
...
&quot;requestParameters&quot; : {
            
    &quot;integration.request.path.integrationPathParam&quot; : &quot;method.request.header.methodRequestHeaderParam&quot;,        
    &quot;integration.request.querystring.integrationQueryParam&quot; : &quot;method.request.querystring.methodRequestQueryParam&quot;
            
}
...
                
            </code></pre></div>
                     </div>
                     
                     
                     <p>
                        Integration request parameters can also be mapped from fields in the JSON request
                        body using a 
                        <a href="http://goessner.net/articles/JsonPath/index.html#e2" target="_blank">JSONPath expression</a>. 
                        The following table shows the mapping expressions for a method request body and its
                        JSON fields.
                        
                        
                     </p>
                     
                     
                     <div class="example">
                        <p class="title"><b>Example mapping from method request body in Swagger</b></p>
                        <div class="example-contents">
                           <p>
                              The following example shows a Swagger snippet that maps 1) the method request body
                              to 
                              the integration request header, named <code class="code">body-header</code>, and 
                              2) a JSON field of the body, as expressed by a JSON expression (<code class="code">petstore.pets[0].name</code>, 
                              without the <code class="code">$.</code> prefix).
                              
                           </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
...
&quot;requestParameters&quot; : {
            
    &quot;integration.request.header.body-header&quot; : &quot;method.request.body&quot;,
    &quot;integration.request.path.pet-name&quot; : &quot;method.request.body.petstore.pets[0].name&quot;,
            
}
...
                
            </code></pre></div>
                     </div>
                     
                     
                     
                     <h2 id="mapping-response-parameters">Map Integration Response Data to Method
                        Response Headers
                     </h2>
                     
                     
                     <p> Method response header parameters can be mapped from any integration response header
                        or integration response body, <code class="code">$context</code> variables, or static values.
                        
                        
                     </p>
                     
                     <div class="table">
                        <p class="title"><b>Method response header mapping expressions</b></p>
                        <div class="table-contents">
                           <table id="w1526aac13c27c14c11b4">
                              
                              <tbody><tr>
                                 
                                 <th>Mapped Data Source</th>
                                 
                                 <th>Mapping expression</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td>Integration response header</td>
                                 
                                 <td><code class="code">integration.response.header.<em class="replaceable"><code>PARAM_NAME</code></em></code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Integration response body</td>
                                 
                                 <td><code class="code">integration.response.body</code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Integration response body (JsonPath)</td>
                                 
                                 <td><code class="code">integration.response.body.<em class="replaceable"><code>JSONPath_EXPRESSION</code></em></code></td>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td>Stage variable</td>
                                 
                                 <td><code class="code">stageVariables.<em class="replaceable"><code>VARIABLE_NAME</code></em></code></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Context variable</td>
                                 
                                 <td><code class="code">context.<em class="replaceable"><code>VARIABLE_NAME</code></em></code> that must be one of the 
                                    <a href="api-gateway-mapping-template-reference.html#context-variable-reference">supported context variables</a>.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>Static value</td>
                                 
                                 <td><code class="code"><em class="replaceable"><code>&apos;STATIC_VALUE&apos;</code></em></code>. The <em class="replaceable"><code>STATIC_VALUE</code></em> is a string literal 
                                    and must be enclosed within a pair of single quotes.
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                     
                     <div class="example">
                        <p class="title"><b>Example data mapping from integration response in Swagger</b></p>
                        <div class="example-contents">
                           <p>
                              The following example shows a Swagger snippet that maps 1) the integration response&apos;s
                              <code class="code">redirect.url</code>, 
                              JSONPath field into the request response&apos;s <code class="code">location</code> header; and 
                              2) the integration response&apos;s <code class="code">x-app-id</code> header to the method response&apos;s 
                              <code class="code">id</code> header.
                              
                           </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
...
&quot;responseParameters&quot; : {
            
    &quot;method.response.header.location&quot; : &quot;integration.response.body.redirect.url&quot;,
    &quot;method.response.header.id&quot; : &quot;integration.response.header.x-app-id&quot;,
            
}
...
                
            </code></pre></div>
                     </div>
                     
                     
                     <h2 id="transforming-request-response-body">Map Request and Response Payloads
                        between Method and Integration
                     </h2>
                     
                     
                     <p> API Gateway uses  <a href="http://velocity.apache.org/engine/devel/vtl-reference-guide.html" target="_blank">Velocity
                           Template Language (VTL)</a> engine to process body <a href="models-mappings.html#models-mappings-mappings">mapping templates</a> for the integration
                        request and integration response. The mapping templates  translate method request
                        payloads to the corresponding integration request payloads and translate integration
                        response bodies to the method response bodies. 
                     </p>
                     
                     <p> The VTL templates use JSONPath expressions, other parameters such as calling contexts
                        and stage variables, and utility functions to process the JSON data. 
                     </p>
                     
                     
                     <p> If a model is defined to describe the data structure of a payload, API Gateway can
                        use the
                        model to generate a skeletal mapping template for an integration request or integration
                        response. You can use the skeletal template as an aid to customize and expand the
                        mapping VTL script. However, you can create a mapping template from scratch without
                        defining a model for the payload&apos;s data structure. 
                     </p>
                     
                     
                     <h3 id="selecting-mapping-templates">Select a VTL Mapping Template</h3>
                     
                     
                     
                     <p>
                        API Gateway uses the following logic to select a mapping template, in <a href="http://velocity.apache.org/engine/devel/vtl-reference-guide.html" target="_blank">Velocity Template Language (VTL)</a>, to map the payload from a method request to the corresponding integration request
                        or to map the payload from an integration response to the corresponding method response.
                        
                     </p>
                     
                     <p>
                        For a request payload, API Gateway uses the request&#x2019;s <code class="code">Content-Type</code> header value as the key to select the mapping template for the request payload. For
                        a response payload, API Gateway uses the incoming request&#x2019;s <code class="code">Accept</code> header value as the key to select the mapping template. 
                        
                     </p>
                     
                     <p>
                        When the <code class="code">Content-Type</code> header is absent in the request, API Gateway assumes that its default value is <code class="code">application/json</code>. For such a request, API Gateway uses <code class="code">application/json</code> as the default key to select the mapping template, if one is defined. When no template
                        matches this key, API Gateway passes the payload through unmapped if the <a href="./apigateway/api-reference/resource/integration/#passthroughBehavior" target="_blank">passthroughBehavior</a> property is set to <code class="code">WHEN_NO_MATCH</code> or <code class="code">WHEN_NO_TEMPLATES</code>.                
                        
                     </p>
                     
                     <p>
                        When the <code class="code">Accept</code> header is not specified in the request, API Gateway assumes that its default value
                        is <code class="code">application/json</code>. In this case, API Gateway selects an existing mapping template for <code class="code">application/json</code> to map the response payload. If no template is defined for <code class="code">application/json</code>, API Gateway selects the first existing template and uses it as the default to map
                        the response payload. Similarly, API Gateway uses the first existing template when
                        the specified <code class="code">Accept</code> header value does not match any existing template key. If no template is defined,
                        API Gateway simply passes the response payload through unmapped. 
                        
                     </p>
                     
                     
                     <p>
                        For example, suppose that an API has a <code class="code">application/json</code> template defined for a request payload and has a <code class="code">application/xml</code> template defined for the response payload. If the client sets the <code class="code">&quot;Content-Type : application/json&quot;</code>, and <code class="code">&quot;Accept : application/xml&quot;</code> headers in the request, both the request and response payloads will be processed
                        with the corresponding mapping templates. If the <code class="code">Accept:application/xml</code> header is absent, the <code class="code">application/xml</code> mapping template will be used to map the response payload. To return the response
                        payload unmapped instead, you must set up an empty template for <code class="code">application/json</code>.
                        
                     </p>
                     
                     <p> 
                        Only the MIME type is used from the <code class="code">Accept</code> and <code class="code">Content-Type</code> headers when 
                        selecting a mapping template. For example, a header of 
                        <code class="code">&quot;Content-Type: application/json; charset=UTF-8&quot;</code> will have a request template 
                        with the <code class="code">application/json</code> key selected.
                        
                     </p>
                     
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="example-employee.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="integration-passthrough-behaviors.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Map Method Request Data to Integration Request
            Parameters"><a class="pagetoc" href="#mapping-request-parameters">Map Method Request Data to Integration Request
                              Parameters</a></li>
                        <li class="pagetoc" name="Map Integration Response Data to Method
            Response Headers"><a class="pagetoc" href="#mapping-response-parameters">Map Integration Response Data to Method
                              Response Headers</a></li>
                        <li class="pagetoc" name="Map Request and Response Payloads
            between Method and Integration"><a class="pagetoc" href="#transforming-request-response-body">Map Request and Response Payloads
                              between Method and Integration</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>