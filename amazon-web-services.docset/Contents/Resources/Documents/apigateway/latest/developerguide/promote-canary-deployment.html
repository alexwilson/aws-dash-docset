<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Promote a Canary Release - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="canary-release.html" title="Set up an API Gateway Canary Release
            Deployment">
      <link rel="prev" href="update-canary-deployment.html" title="Update a Canary Release ">
      <link rel="next" href="delete-canary-deployment.html" title="Disable a Canary Release">
      <meta name="description" content="To promote a canary release makes it available in the production stage the API version under testing. The operation involves the following tasks:">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/promote-canary-deployment.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="how-to-deploy-api.html">Deploying an API in Amazon API Gateway</a> &#xBB; <a href="canary-release.html">Set up an API Gateway Canary Release
                                    Deployment</a> &#xBB; <span class="breadcrumb">Promote a Canary Release</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="promote-canary-deployment">Promote a Canary Release</h1>
                     <p>To promote a canary release makes it available in the production stage the API version
                        under testing. The operation involves the following tasks:
                     </p>
                     <div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p> Reset the <a href="./apigateway/api-reference/resource/stage/#deploymentId" target="_blank">deployment
                                    ID</a> of the stage with the  <a href="./apigateway/api-reference/resource/stage/#canarySettings" target="_blank">deployment ID</a>
                                 settings of the canary. This updates the API snapshot of the stage with the
                                 snapshot of the canary, making the test version the production release as
                                 well.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Update stage variables with canary stage variables, if any. This updates the
                                 API execution context of the stage with that of the canary. Without this update,
                                 the new API version may produce unexpected results if the test version uses
                                 different stage variables or different values of existing stage
                                 variables.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Set the percentage of canary traffic to 0.0%.</p>
                              
                           </li>
                        </ul>
                     </div>
                     <p>Promoting a canary release does not disable the canary on the stage. To disable a
                        canary, you must remove the canary settings on the stage.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#promote-canary-release-deployment-console">Promote a Canary Release
                                 Using the API Gateway Console</a></li>
                           <li><a href="#promote-canary-release-cli">Promote a Canary Release Using the
                                 AWS CLI</a></li>
                           <li><a href="#promote-canary-release-api">Promote a Canary
                                 Release Using the API Gateway REST API</a></li>
                        </ul>
                     </div>
                     
                     <h2 id="promote-canary-release-deployment-console">Promote a Canary Release
                        Using the API Gateway Console
                     </h2>
                     
                     
                     <p>To use the API Gateway console to promote a canary release deployment, do the
                        following:
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p> Sign in to the API Gateway console and choose an existing API in the primary
                              navigation pane.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose <b>Stages</b> under the API and then choose an
                              existing stage under the <b>Stages</b> list to open the
                              <b>Stage Editor</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose the <b>Canary</b> tab in the <b>Stage
                                 Editor</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose <b>Promote Canary</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Confirm changes to be made and choose <b>Update</b>.
                           </p>
                           
                           
                        </li>
                     </ol>
                     
                     <p>After the promotion, the production release references the same API version
                        (<b>deploymentId</b>) as the canary release. You can verify this
                        using the AWS CLI or API Gateway REST API. For example, see <a href="promote-canary-deployment.html#promote-canary-release-cli">Promote a Canary Release Using the
                           AWS CLI</a> or <a href="promote-canary-deployment.html#promote-canary-release-api">Promote a Canary
                           Release Using the API Gateway REST API</a>. 
                     </p>
                     
                     
                     <h2 id="promote-canary-release-cli">Promote a Canary Release Using the
                        AWS CLI
                     </h2>
                     
                     <p>To promote a canary release to the production release using the AWS CLI commands,
                        call the <code class="code">update-stage</code> command to copy the canary-associated
                        <code class="code">deploymentId</code> to the stage-associated
                        <code class="code">deploymentId</code>,
                        to reset the canary traffic percentage to zero (<code class="code">0.0</code>), and, to copy any
                        canary-bound stage variables to the corresponding stage-bound ones.
                        
                     </p>
                     
                     
                     <p>Suppose we have a canary release deployment, described by a stage similar to the
                        following: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
        ...
    },
    &quot;accessLogSettings&quot;: {
        ...
    },
    &quot;cacheClusterEnabled&quot;: false,
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;,
    &quot;canarySettings&quot;: {
        &quot;deploymentId&quot;: &quot;eh1sby&quot;,
        &quot;useStageCache&quot;: false,
        &quot;stageVariableOverrides&quot;: {
            &quot;sv2&quot;: &quot;val3&quot;,
            &quot;sv1&quot;: &quot;val2&quot;
        },
        &quot;percentTraffic&quot;: 10.5
    },
    &quot;createdDate&quot;: &quot;2017-11-20T04:42:19Z&quot;,
    &quot;deploymentId&quot;: &quot;nfcn0x&quot;,
    &quot;lastUpdatedDate&quot;: &quot;2017-11-22T00:54:28Z&quot;,
    &quot;methodSettings&quot;: {
        ...
    },
    &quot;stageName&quot;: &quot;prod&quot;,
    &quot;variables&quot;: {
        &quot;sv1&quot;: &quot;val1&quot;
    }
}</code></pre>
                     
                     <p>We call the following <code class="code">update-stage</code> request to promote it:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigateway update-stage                         \
    --rest-api-id {rest-api-id}                     \
    --stage-name &apos;{stage-name}&apos;                     \
    --patch-operations &apos;[{                          \
        &quot;op&quot;: &quot;replace&quot;,                            \
        &quot;value&quot;: &quot;0.0&quot;                              \
        &quot;path&quot;: &quot;/canarySettings/percentTraffic&quot;,   \
      }, {                                          \
        &quot;op&quot;: &quot;copy&quot;,                               \
        &quot;from&quot;: &quot;/canary/overriddenStageVariables&quot;  \
        &quot;path&quot;: &quot;/variables&quot;,                       \
      }, {                                          \
        &quot;op&quot;: &quot;copy&quot;,                               \
        &quot;from&quot;: &quot;/canary/deploymentId&quot;,             \
        &quot;path&quot;: &quot;/deploymentId&quot;                     \
      }]&apos;</code></pre>
                     
                     <p>After the promotion, the stage now looks like this:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
        ...
    },
    &quot;accessLogSettings&quot;: {
        ...
    },
    &quot;cacheClusterEnabled&quot;: false,
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;,
    &quot;canarySettings&quot;: {
        &quot;deploymentId&quot;: &quot;eh1sby&quot;,
        &quot;useStageCache&quot;: false,
        &quot;stageVariableOverrides&quot;: {
            &quot;sv2&quot;: &quot;val3&quot;,
            &quot;sv1&quot;: &quot;val2&quot;
        },
        &quot;percentTraffic&quot;: 0
    },
    &quot;createdDate&quot;: &quot;2017-11-20T04:42:19Z&quot;,
    &quot;deploymentId&quot;: &quot;eh1sby&quot;,
    &quot;lastUpdatedDate&quot;: &quot;2017-11-22T05:29:47Z&quot;,
    &quot;methodSettings&quot;: {
        ...
    },
    &quot;stageName&quot;: &quot;prod&quot;,
    &quot;variables&quot;: {
        &quot;sv2&quot;: &quot;val3&quot;,
        &quot;sv1&quot;: &quot;val2&quot;
    }
}</code></pre>
                     <p>As you can see, promoting a canary release to the stage does not disable the
                        canary and the deployment remains to be a canary release deployment. To make it a
                        regular production release deployment, you must disable the canary settings. For
                        more information about how to disable a canary release deployment, see <a href="delete-canary-deployment.html">Disable a Canary Release</a>.
                     </p>
                     
                     
                     
                     <h2 id="promote-canary-release-api">Promote a Canary
                        Release Using the API Gateway REST API
                     </h2>
                     
                     <p>To promote a canary release to the production release using the API Gateway REST API,
                        call the <code class="code">stage:update</code> request to copy the canary-associated
                        <code class="code">deploymentId</code> to the stage-associated
                        <code class="code">deploymentId</code>,
                        to reset the canary traffic percentage to zero (<code class="code">0.0</code>), and, to copy any
                        canary-bound stage variables to the corresponding stage-bound ones.
                        
                     </p>
                     
                     
                     <p>Suppose we have a canary release deployment, described by a stage similar to the
                        following: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
        ...
    },
    &quot;accessLogSettings&quot;: {
        ...
    },
    &quot;cacheClusterEnabled&quot;: false,
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;,
    &quot;canarySettings&quot;: {
        &quot;deploymentId&quot;: &quot;eh1sby&quot;,
        &quot;useStageCache&quot;: false,
        &quot;stageVariableOverrides&quot;: {
            &quot;sv2&quot;: &quot;val3&quot;,
            &quot;sv1&quot;: &quot;val2&quot;
        },
        &quot;percentTraffic&quot;: 10.5
    },
    &quot;createdDate&quot;: &quot;2017-11-20T04:42:19Z&quot;,
    &quot;deploymentId&quot;: &quot;nfcn0x&quot;,
    &quot;lastUpdatedDate&quot;: &quot;2017-11-22T00:54:28Z&quot;,
    &quot;methodSettings&quot;: {
        ...
    },
    &quot;stageName&quot;: &quot;prod&quot;,
    &quot;variables&quot;: {
        &quot;sv1&quot;: &quot;val1&quot;
    }
}</code></pre>
                     
                     
                     <p>We call the following <code class="code">stage:update</code> request to promote it:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">PATCH /restapis/4wk1k4onj3/stages/prod HTTP/1.1
Host: apigateway.us-east-1.amazonaws.com
Content-Type: application/json
X-Amz-Date: 20171121T232431Z
Authorization: AWS4-HMAC-SHA256 Credential={SECRET_ACCESS_KEY}/20171121/us-east-1/apigateway/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature={SIGV4_SIGNATURE}

{
	&quot;patchOperations&quot;: [
		{
			&quot;op&quot;: &quot;copy&quot;,
			&quot;path&quot;: &quot;/deploymentId&quot;,
			&quot;from&quot;: &quot;/canarySettings/deploymentId&quot;
		},
		{
			&quot;op&quot;: &quot;replace&quot;,
			&quot;path&quot;: &quot;/canarySettings/percentTraffic&quot;,
			&quot;value&quot;: &quot;0.0&quot;
		},
		{
			&quot;op&quot;: &quot;copy&quot;,
			&quot;path&quot;: &quot;/variables&quot;,
			&quot;from&quot;: &quot;/canarySettings/stageVariableOverrides&quot;
		}
	]
}</code></pre>
                     
                     <p>After the promotion, the stage now looks like this:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
        ...
    },
    &quot;accessLogSettings&quot;: {
        ...
    },
    &quot;cacheClusterEnabled&quot;: false,
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;,
    &quot;canarySettings&quot;: {
        &quot;deploymentId&quot;: &quot;eh1sby&quot;,
        &quot;useStageCache&quot;: false,
        &quot;stageVariableOverrides&quot;: {
            &quot;sv2&quot;: &quot;val3&quot;,
            &quot;sv1&quot;: &quot;val2&quot;
        },
        &quot;percentTraffic&quot;: 0
    },
    &quot;createdDate&quot;: &quot;2017-11-20T04:42:19Z&quot;,
    &quot;deploymentId&quot;: &quot;eh1sby&quot;,
    &quot;lastUpdatedDate&quot;: &quot;2017-11-22T05:29:47Z&quot;,
    &quot;methodSettings&quot;: {
        ...
    },
    &quot;stageName&quot;: &quot;prod&quot;,
    &quot;variables&quot;: {
        &quot;sv2&quot;: &quot;val3&quot;,
        &quot;sv1&quot;: &quot;val2&quot;
    }
}</code></pre>
                     <p>As you can see, promoting a canary release to the stage does not disable the
                        canary and the deployment remains to be a canary release deployment. To make it a
                        regular production release deployment, you must disable the canary settings. For
                        more information about how to disable a canary release deployment, see <a href="delete-canary-deployment.html">Disable a Canary Release</a>.
                     </p>
                     
                     
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="update-canary-deployment.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="delete-canary-deployment.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Promote a Canary Release
                    Using the API Gateway Console"><a class="pagetoc" href="#promote-canary-release-deployment-console">Promote a Canary Release
                              Using the API Gateway Console</a></li>
                        <li class="pagetoc" name="Promote a Canary Release Using the
                    AWS CLI"><a class="pagetoc" href="#promote-canary-release-cli">Promote a Canary Release Using the
                              AWS CLI</a></li>
                        <li class="pagetoc" name="Promote a Canary
                    Release Using the API Gateway REST API"><a class="pagetoc" href="#promote-canary-release-api">Promote a Canary
                              Release Using the API Gateway REST API</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>