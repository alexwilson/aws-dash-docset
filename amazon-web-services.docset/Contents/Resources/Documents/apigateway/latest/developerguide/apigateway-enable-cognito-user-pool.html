<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Integrate an API with a User
         Pool - Amazon API Gateway
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="apigateway-integrate-with-cognito.html" title="Use Amazon Cognito User Pools">
      <link rel="prev" href="apigateway-create-cognito-user-pool.html" title="Create an Amazon Cognito User Pool">
      <link rel="next" href="apigateway-invoke-api-integrated-with-cognito-user-pool.html" title="Call an API
                Integrated with a User Pool">
      <meta name="description" content="After creating an Amazon Cognito user pool, in API Gateway, you must then create a COGNITO_USER_POOLS authorizer that uses the user pool. The following procedure walks you through the steps to do this using the API Gateway console.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-enable-cognito-user-pool.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="apigateway-control-access-to-api.html"> Controlling Access to an API in
                                    			API Gateway</a> &#xBB; <a href="apigateway-integrate-with-cognito.html">Use Amazon Cognito User Pools</a> &#xBB; <span class="breadcrumb">Integrate an API with a User
                                    Pool</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="apigateway-enable-cognito-user-pool">Integrate an API with a User
                        Pool
                     </h1>
                     <p>After creating an Amazon Cognito user pool, in API Gateway, you must then create a
                        <code class="code">COGNITO_USER_POOLS</code> authorizer that uses the user pool. The following
                        procedure walks you through the steps to do this using the API Gateway console.
                     </p>
                     <p class="title"><b>To create a <code class="code">COGNITO_USER_POOLS</code> authorizer by using the API Gateway
                           console</b></p>
                     <ol>
                        <li>
                           
                           <p>Create a new API, or select an existing API in API Gateway.</p>
                           
                        </li>
                        <li>
                           
                           <p>From the main navigation pane, choose <b>Authorizers</b> under
                              the specified API.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Authorizers</b>, choose <b>Create New
                                 Authorizer</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>To configure the new authorizer to use a user pool, do the following:</p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Type an authorizer name in <b>Name</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Select the <b>Cognito</b> option.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose a region under <b>Cognito User Pool</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Select an available user pool. You must have created a user pool for
                                    the selected region in Amazon Cognito for it to show up in the drop-down
                                    list.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p> For <b>Token source</b>, type
                                    <code class="code">Authorization</code> as the header name to pass the identity
                                    or access token that&apos;s returned by Amazon Cognito when a user signs in
                                    successfully. 
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Optionally, type a regular expression in the <b>Token
                                       validation</b> field to validate the <code class="code">aud</code> field
                                    of the identity token before the request is authorized with
                                    Amazon Cognito.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>To finish integrating the user pool with the API, choose
                                    <b>Create</b>. 
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>After creating the <code class="code">COGNITO_USER_POOLS</code> authorizer, you can
                              optionally test invoke it by supplying an identity token that&apos;s provisioned from
                              the user pool. You can obtain this identity token by calling the <a href="./cognito/latest/developerguide/setting-up-the-javascript-sdk.html" target="_blank">Amazon Cognito Identity
                                 SDK</a> to perform user sign-in. Make sure to use the returned identity
                              token, not the access token. 
                           </p>
                           
                        </li>
                     </ol>
                     <p>The preceding procedure creates a <code class="code">COGNITO_USER_POOLS</code> authorizer that uses
                        the newly created Amazon Cognito user pool. Depending on how you enable the authorizer
                        on an API
                        method, you can use either an identity token or an access token that&apos;s provisioned
                        from
                        the integrated user pool. The next procedure walks you through the steps to configure
                        the authorizer on an API method.
                     </p>
                     <p class="title"><b>To configure a <code class="code">COGNITO_USER_POOLS</code> authorizer on methods</b></p>
                     <ol>
                        <li>
                           
                           <p>Choose (or create) a method
                              of
                              your API. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Method Request</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Settings</b>, choose the pencil icon next to
                              <b>Authorization</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose one of the available <b>Amazon Cognito user pool authorizers</b>
                              from the drop-down list.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>To save the settings, choose the check mark icon.</p>
                           
                        </li>
                        <li>
                           
                           <p> To use an identity token, do the following:</p>
                           
                           <ol>
                              <li>
                                 
                                 <p> Leave the <b>OAuth Scopes</b> option unspecified (as
                                    <code class="code">NONE</code>).
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>If needed, choose <b>Integration Request</b> to add the
                                    <code class="code">$context.authorizer.claims[&apos;<em class="replaceable"><code>property-name</code></em>&apos;]</code>
                                    or
                                    <code class="code">$context.authorizer.claims.<em class="replaceable"><code>property-name</code></em></code>
                                    expressions
                                    in
                                    a body-mapping template to pass the specified
                                    identity claims property from the user pool to the backend. For simple
                                    property names, such as <code class="code">sub</code> or <code class="code">custom-sub</code>, the
                                    two notations are identical. For complex property names, such as
                                    <code class="code">custom:role</code>, you can&apos;t use the dot notation. For
                                    example, the following mapping expressions pass the claim&apos;s <a href="http://openid.net/specs/openid-connect-core-1_0.html#StandardClaims" target="_blank">standard fields</a> of <code class="code">sub</code> and <code class="code">email</code>
                                    to the backend:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
	&quot;context&quot; : {
		&quot;sub&quot; : &quot;$context.authorizer.claims.sub&quot;,
		&quot;email&quot; : &quot;$context.authorizer.claims.email&quot;
	}
}</code></pre>
                                 <p>If you declared a custom claim field when you configured a user pool,
                                    you can follow the same pattern to access the custom fields. The
                                    following example gets a custom <code class="code">role</code> field of a
                                    claim:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
	&quot;context&quot; : {
		&quot;role&quot; : &quot;$context.authorizer.claims.role&quot;
    }
}</code></pre>
                                 <p>If the custom claim field is declared as <code class="code">custom:role</code>, use
                                    the following example to get the claim&apos;s property:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
	&quot;context&quot; : {
		&quot;role&quot; : &quot;$context.authorizer.claims[&apos;custom:role&apos;]&quot;
    }
}</code></pre>
                                 </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p> To use an access token, do the following: </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose the pencil icon next to <b>OAuth Scopes</b>.
                                    
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type one or more full names of a
                                    scope
                                    that has been configured when the Amazon Cognito user pool was created. For
                                    example, following the example given in <a href="apigateway-create-cognito-user-pool.html">Create an Amazon Cognito User Pool</a>,
                                    
                                    one of the scopes is
                                    <code class="code">com.hamuta.movies/drama.view</code>. Use a
                                    single space to separate multiple scopes. 
                                 </p>
                                 
                                 <p>At runtime, the method call succeeds if any scope that&apos;s specified on
                                    the method in this step matches a scope that&apos;s claimed in the incoming
                                    token. Otherwise, the call fails with a <code class="code">401 Unauthorized</code>
                                    response.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p> To save the setting, choose the check mark icon.</p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Repeat these steps for other methods that you choose.</p>
                           
                        </li>
                     </ol>
                     <p>With the <code class="code">COGNITO_USER_POOLS</code> authorizer, if the <b>OAuth
                           Scopes</b> option isn&apos;t specified, API Gateway treats the supplied token as an
                        identity token and verifies the claimed identity against the one from the user pool.
                        Otherwise, API Gateway treats the supplied token as an access token and verifies the
                        access
                        scopes that are claimed in the token against the authorization scopes declared on
                        the
                        method.
                     </p>
                     <p>Instead of using the API Gateway console, you can also enable an Amazon Cognito user
                        pool on a method
                        by specifying a Swagger definition file and importing the API definition into
                        API Gateway.
                     </p>
                     <p class="title"><b>To import a COGNITO_USER_POOLS authorizer with a Swagger definition file</b></p>
                     <ol>
                        <li>
                           
                           <p>Create (or export) a Swagger definition file for your API.</p>
                           
                        </li>
                        <li>
                           
                           <p>Specify the <code class="code">COGNITO_USER_POOLS</code> authorizer
                              (<code class="code">MyUserPool</code>) definition as part of the
                              <code class="code">securityDefinitions</code>:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">  &quot;securityDefinitions&quot;: {
    &quot;MyUserPool&quot;: {
      &quot;type&quot;: &quot;apiKey&quot;,
      &quot;name&quot;: &quot;Authorization&quot;,
      &quot;in&quot;: &quot;header&quot;,
      &quot;x-amazon-apigateway-authtype&quot;: &quot;cognito_user_pools&quot;,
      &quot;x-amazon-apigateway-authorizer&quot;: {
        &quot;type&quot;: &quot;cognito_user_pools&quot;,
        &quot;providerARNs&quot;: [
          &quot;arn:aws:cognito-idp:{region}:{account_id}:userpool/{user_pool_id}&quot;
        ]
      }
    }
</code></pre>
                           </li>
                        <li>
                           
                           <p>To use the identity token for method authorization, add <code class="code">{ &quot;MyUserPool&quot;:
                                 [] }</code> to the <code class="code">security</code> definition of the method, as shown
                              in the following GET method on the root resource.
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">  &quot;paths&quot;: {
    &quot;/&quot;: {
      &quot;get&quot;: {
        &quot;consumes&quot;: [
          &quot;application/json&quot;
        ],
        &quot;produces&quot;: [
          &quot;text/html&quot;
        ],
        &quot;responses&quot;: {
          &quot;200&quot;: {
            &quot;description&quot;: &quot;200 response&quot;,
            &quot;headers&quot;: {
              &quot;Content-Type&quot;: {
                &quot;type&quot;: &quot;string&quot;
              }
            }
          }
        },
        <b>&quot;security&quot;: [
          {
            &quot;MyUserPool&quot;: []
          }
        ],</b>        
        &quot;x-amazon-apigateway-integration&quot;: {
          &quot;type&quot;: &quot;mock&quot;,
          &quot;responses&quot;: {
            &quot;default&quot;: {
              &quot;statusCode&quot;: &quot;200&quot;,
              &quot;responseParameters&quot;: {
                &quot;method.response.header.Content-Type&quot;: &quot;&apos;text/html&apos;&quot;
              },
            }
          },
          &quot;requestTemplates&quot;: {
            &quot;application/json&quot;: &quot;{\&quot;statusCode\&quot;: 200}&quot;
          },
          &quot;passthroughBehavior&quot;: &quot;when_no_match&quot;
        }
      },
      ...
   }</code></pre>
                           </li>
                        <li>
                           
                           <p> To use the access token for method authorization, change the above security
                              definition to <code class="code">{ &quot;MyUserPool&quot;: [resource-server/scope, ...]
                                 }</code>:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">  &quot;paths&quot;: {
    &quot;/&quot;: {
      &quot;get&quot;: {
        &quot;consumes&quot;: [
          &quot;application/json&quot;
        ],
        &quot;produces&quot;: [
          &quot;text/html&quot;
        ],
        &quot;responses&quot;: {
          &quot;200&quot;: {
            &quot;description&quot;: &quot;200 response&quot;,
            &quot;headers&quot;: {
              &quot;Content-Type&quot;: {
                &quot;type&quot;: &quot;string&quot;
              }
            }
          }
        },
        <b>&quot;security&quot;: [
          {
            &quot;MyUserPool&quot;: [&quot;com.hamuta.movies/drama.view&quot;, &quot;http://my.resource.com/file.read&quot;]
          }
        ],</b>        
        &quot;x-amazon-apigateway-integration&quot;: {
          &quot;type&quot;: &quot;mock&quot;,
          &quot;responses&quot;: {
            &quot;default&quot;: {
              &quot;statusCode&quot;: &quot;200&quot;,
              &quot;responseParameters&quot;: {
                &quot;method.response.header.Content-Type&quot;: &quot;&apos;text/html&apos;&quot;
              },
            }
          },
          &quot;requestTemplates&quot;: {
            &quot;application/json&quot;: &quot;{\&quot;statusCode\&quot;: 200}&quot;
          },
          &quot;passthroughBehavior&quot;: &quot;when_no_match&quot;
        }
      },
      ...
   }</code></pre>
                           </li>
                        <li>
                           
                           <p>If needed, you can set other API configuration settings by using the
                              appropriate Swagger definitions or extensions. For more information, see <a href="api-gateway-swagger-extensions.html">API Gateway Extensions to Swagger</a>.
                           </p>
                           
                        </li>
                     </ol>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="apigateway-create-cognito-user-pool.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="apigateway-invoke-api-integrated-with-cognito-user-pool.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper"></div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>