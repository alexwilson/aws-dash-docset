<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Create an API Gateway API for AWS Lambda Functions - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="api-gateway-tutorials.html" title="Samples and Tutorials">
      <link rel="prev" href="api-gateway-tutorials.html" title="">
      <link rel="next" href="api-as-lambda-proxy-export-swagger-with-extensions.html" title="">
      <meta name="description" content="Learn how to create and configure an API in Amazon API Gateway as a proxy for AWS Lambda.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/integrating-api-with-aws-services-lambda.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="api-gateway-tutorials.html">Samples and Tutorials</a> &#xBB; <span class="breadcrumb">Create an API Gateway API for AWS Lambda Functions</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="integrating-api-with-aws-services-lambda">Create an API Gateway API for AWS Lambda Functions</h1>
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p> To integrate your API Gateway API with Lambda, you must choose a region where both
                           the API Gateway
                           and Lambda services are available. For region availability, see <a href="./general/latest/gr/rande.html#apigateway_region" target="_blank">Regions and
                              Endpoints</a>. 
                        </p>
                     </div>
                     <p> In the <a href="getting-started-with-lambda-integration.html">Getting Started</a> section, you learned how to
                        use the API Gateway console to build an API to expose a Lambda function. There, the
                        console let you
                        choose <code class="code">Lambda Function</code> for <b>Integration type</b>, among other
                        options of <code class="code">HTTP</code>, <code class="code">Mock</code> and <code class="code">AWS Service</code>. The
                        <code class="code">Lambda Function</code> option is a special case of the <code class="code">AWS Service</code>
                        integration type and simplifies the integration set-up for you with default settings.
                        For
                        example, with the former, the console automatically adds the required resource-based
                        permissions for invoking the Lambda function. With the latter, you have more control,
                        but
                        more responsibilities to set up the integration, including creating and specifying
                        an IAM
                        role containing appropriate permissions. For the both options, the underlying <a href="./apigateway/api-reference/resource/integration/#type" target="_blank">integration.type</a> is <code class="code">AWS</code> in the
                        API Gateway REST API and its Swagger definition file. 
                     </p>
                     <p>In this section, we walk you through the steps to integrate an API with a Lambda function
                        using the <code class="code">AWS Service</code> and <code class="code">Lambda Function</code> integration types. To support
                        asynchronous invocation of the Lambda function, you must explicitly add the
                        <code class="code">X-Amz-Invocation-Type:Event</code> header to the integration request. For the
                        synchronous invocation, you can add the <code class="code">X-Amz-Invocation-Type:RequestResponse</code>
                        header to the integration request or leave it unspecified. The following example shows
                        the
                        integration request of an asynchronous Lambda function invocation: 
                     </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
POST /2015-03-31/functions/<em class="replaceable"><code>FunctionArn</code></em>/invocations?Qualifier=Qualifier HTTP/1.1 
X-Amz-Invocation-Type: Event 
...
Authorization: ...
Content-Type: application/json
Content-Length: <em class="replaceable"><code>PayloadSize</code></em>

<em class="replaceable"><code>Payload</code></em>        
    </code></pre><p> In this example, <em class="replaceable"><code>FunctionArn</code></em> is the ARN of the Lambda function
                        to be invoked. The <code class="code">Authorization</code> header is required by secure invocation of
                        Lambda functions over HTTPS. For more information, see the <code class="code"><a href="./lambda/latest/dg/API_Invoke.html" target="_blank">Invoke</a></code> action in the
                        <em>AWS Lambda Developer Guide</em>. 
                     </p>
                     <p> To illustrate how to create and configure an API as an AWS service proxy for Lambda,
                        we
                        will create a Lambda function (<code class="code">Calc</code>) that performs addition (+), subtraction
                        (-), multiplication (*), and division (/). When a client submits a method request
                        to perform
                        any of these operations, API Gateway will post the corresponding integration request
                        to call the
                        specified Lambda function, passing the required input (two operands and one operator)
                        as a
                        JSON payload. A synchronous call will return the result, if any, as the JSON payload.
                        An
                        asynchronous call will return no data. 
                     </p>
                     <p>You can expose a GET or POST method on the <code class="code">/calc</code> resource to invoke the Lambda
                        function. With the GET method, a client supplies the input to the backend Lambda function
                        through three query string parameters (<code class="code">operand1</code>, <code class="code">operand2</code>, and
                        <code class="code">operator</code>). You will set up a mapping template to map these to the JSON
                        payload of the integration request. With the POST method, a client provides the input
                        to the
                        Lambda function as a JSON payload of the method request. You can pass the method request
                        payload through to the integration request, if the client input conforms to the input
                        model.
                        Alternatively, you can expose a GET method on the
                        <code class="code">/calc/{operand1}/{operand2}/{operator}</code> resource. With this method, the
                        client specifies the Lambda function input as the values of the path parameters. You
                        will
                        need to provide a mapping template to translate the path parameters of the method
                        request
                        into an integration request payload as the Lambda function input and to translate
                        the output
                        from the integration responses to the method response. 
                     </p>
                     <p>In this tutorial, we will cover the following topics: </p>
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p> Create the <code class="code">Calc</code> Lambda function to implement the arithmetic
                                 operations, accepting and returning JSON-formatted input and output. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Expose GET on the <code class="code">/calc</code> resource to invoke the Lambda function,
                                 supplying the input as query strings. We will enable a request validator to ensure
                                 that the client submit all the required query string parameters before API Gateway
                                 calling
                                 the Lambda function. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Expose POST on the <code class="code">/calc</code> resource to invoke the Lambda function,
                                 supplying the input in the payload. We will enable a request validator to ensure
                                 that the client submitted the valid request payload before API Gateway call the Lambda
                                 function.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p> Expose GET on the <code class="code">/calc/{operand1}/{operand2}/{operator}</code> resource to
                                 invoke the Lambda function, specifying the input in the path parameters. We also explain
                                 how to
                                 define a <code class="code">Result</code> schema to model the method response body so that any strongly typed 
                                 SDK of the API can access the method response data 
                                 through properties defined in the <code class="code">Result</code> schema. 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     <p>
                        You can inspect the sample API in its
                        <a href="api-as-lambda-proxy-export-swagger-with-extensions.html">Swagger definition file</a>. 
                        You can also <a href="./apigateway/api-reference/link-relation/restapi-import/" target="_blank">import</a> the API Swagger definitions to API Gateway, following the instructions given
                        in <a href="api-gateway-import-api.html">Import an API into API Gateway</a>.
                     </p>
                     <p> To use the API Gateway console to create the API, you must first sign up for an AWS
                        account. 
                     </p>
                     <p>If you do not have an AWS account, use the following procedure to create one.</p>
                     <p class="title"><b>To sign up for AWS</b></p>
                     <ol>
                        <li>
                           <p>Open <a href="https://aws.amazon.com/" target="_blank">https://aws.amazon.com/</a> and 
                              choose <b>Create an AWS Account</b>.
                           </p>
                        </li>
                        <li>
                           <p>Follow the online instructions.</p>
                        </li>
                     </ol>
                     <p> To allow the API to invoke Lambda functions, you must have an IAM role that has
                        appropriate IAM policies attached to it. The next section describes how to verify
                        and to
                        create, if necessary, the required IAM role and policies. 
                     </p>
                     <div class="highlights">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#api-as-lambda-proxy-setup-iam-role-policies">Set Up an IAM Role and
                                 Policy for an API to Invoke Lambda Functions</a></li>
                           <li><a href="#api-as-lambda-proxy-create-lambda-function">Create a Lambda Function in the
                                 Backend</a></li>
                           <li><a href="#api-as-lambda-proxy-create-api-resources">Create API Resources for the
                                 Lambda Function</a></li>
                           <li><a href="#api-as-lambda-proxy-expose-get-method-with-query-strings-to-call-lambda-function"> Create a GET Method with Query Parameters to Call the Lambda Function </a></li>
                           <li><a href="#api-as-lambda-proxy-expose-post-method-with-json-body-to-call-lambda-function"> Create a POST Method with a JSON Payload to Call the Lambda Function </a></li>
                           <li><a href="#api-as-lambda-proxy-expose-get-method-with-path-parameters-to-call-lambda-function"> Create a GET Method with Path Parameters to Call the Lambda Function </a></li>
                           <li><a href="api-as-lambda-proxy-export-swagger-with-extensions.html">Swagger Definitions of Sample API Integrated with a Lambda Function</a></li>
                        </ul>
                     </div>
                     <h2 id="api-as-lambda-proxy-setup-iam-role-policies">Set Up an IAM Role and
                        Policy for an API to Invoke Lambda Functions
                     </h2>
                     
                     
                     <p> For API Gateway to invoke a Lambda function, the API must have a permission to call
                        the Lambda&apos;s <a href="./lambda/latest/dg/API_Invoke.html" target="_blank">InvokeFunction</a> action. This means that, at minimum, you must attach
                        the following IAM policy to an IAM role for API Gateway to assume the policy. 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;lambda:InvokeFunction&quot;,
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}                        
        </code></pre>
                     <p> If you do not enact this policy, the API caller will receive a 500 Internal Server
                        Error response. The response contains the &quot;Invalid permissions on Lambda function&quot;
                        error
                        message. For a complete list of error messages returned by Lambda, see the <a href="./lambda/latest/dg/API_Invoke.html" target="_blank">Invoke</a> topic. 
                     </p>
                     
                     <p> An API Gateway assumable role is an IAM role with the following trusted relationship:
                        
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;apigateway.amazonaws.com&quot;
      },
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    }
  ]
}                        
        </code></pre>
                     
                     <h2 id="api-as-lambda-proxy-create-lambda-function">Create a Lambda Function in the
                        Backend
                     </h2>
                     
                     
                     <p>The following procedure outlines the steps to create a Lambda function using the Lambda
                        console.
                     </p>
                     
                     <ol>
                        <li>
                           <p>Go to the Lambda console.</p>
                        </li>
                        <li>
                           <p>Choose <b>Create a Lambda function</b>.
                           </p>
                        </li>
                        <li>
                           <p>Choose the <b>Blank Function</b> blueprint for the runtime of Node.js 4.3 or later.
                           </p>
                        </li>
                        <li>
                           <p>Follow the on-screen instructions to the <b>Lambda function code</b> editor.
                           </p>
                        </li>
                        <li>
                           
                           <p> Copy the following Lambda function and paste it into the code editor in the Lambda
                              console. 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">console.log(&apos;Loading the Calc function&apos;);

exports.handler = function(event, context, callback) {
    console.log(&apos;Received event:&apos;, JSON.stringify(event, null, 2));
    if (event.a === undefined || event.b === undefined || event.op === undefined) {
        callback(&quot;400 Invalid Input&quot;);
    }
    
    var res = {};
    res.a = Number(event.a);
    res.b = Number(event.b);
    res.op = event.op;
    
    if (isNaN(event.a) || isNaN(event.b)) {
        callback(&quot;400 Invalid Operand&quot;);
    }

    switch(event.op)
    {
        case &quot;+&quot;:
        case &quot;add&quot;:
            res.c = res.a + res.b;
            break;
        case &quot;-&quot;:
        case &quot;sub&quot;:
            res.c = res.a - res.b;
            break;
        case &quot;*&quot;:
        case &quot;mul&quot;:
            res.c = res.a * res.b;
            break;
        case &quot;/&quot;:
        case &quot;div&quot;:
            res.c = res.b===0 ? NaN : Number(event.a) / Number(event.b);
            break;
        default:
            callback(&quot;400 Invalid Operator&quot;);
            break;
    }
    callback(null, res);
};</code></pre>                
                           </li>
                        <li>
                           <p>Choose an existing or create a new IAM role</p>
                        </li>
                        <li>
                           <p>Follow the on-screen instructions to finish creating the function.</p>
                        </li>
                     </ol>
                     
                     <p> This function requires two operands (<code class="code">a</code> and <code class="code">b</code>) and an
                        operator (<code class="code">op</code>) from the <code class="code">event</code> input parameter. The input is a
                        JSON object of the following format: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: &quot;Number&quot; | &quot;String&quot;,
  &quot;b&quot;: &quot;Number&quot; | &quot;String&quot;,
  &quot;op&quot;: &quot;String&quot;
}
        </code></pre>
                     <p>This function returns the calculated result (<code class="code">c</code>) and the input. For an
                        invalid input, the function returns either the null value or the &quot;Invalid op&quot; string
                        as
                        the result. The output is of the following JSON format: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: &quot;Number&quot;,
  &quot;b&quot;: &quot;Number&quot;,
  &quot;op&quot;: &quot;String&quot;,
  &quot;c&quot;: &quot;Number&quot; | &quot;String&quot;
}
        </code></pre>
                     <p>You should test the function in the Lambda console before integrating it with the
                        API in the next step. 
                     </p>
                     
                     <h2 id="api-as-lambda-proxy-create-api-resources">Create API Resources for the
                        Lambda Function
                     </h2>
                     
                     
                     <p>The following procedure describes how to create API resources for the Lambda function.
                        As an illustration, we use multiple API resources and methods to enable different
                        API
                        behaviors for calling the same function.
                     </p>
                     
                     <p class="title"><b>To create API resources for Lambda functions</b></p>
                     <ol>
                        <li>
                           
                           <p> In the API Gateway console, create an API named <b>LambdaGate</b>.
                              
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Create the <b>/calc</b> resource off the API&apos;s root. We will
                              expose the GET and POST methods on this resource for the client to invoke the
                              backend Lambda function. The caller must supply the required input as query
                              string parameters (to be declared as
                              <code class="code">?operand1=...&amp;operand2=...&amp;operator=...</code>) in the GET
                              request and as a JSON payload in the POST request, respectively. 
                           </p>
                           
                           <p> We will also create the
                              <b>/calc/{operand1}/{operand2}/{operator}</b> resource subtree
                              to expose the GET method to invoke the Lambda function. The caller must supply
                              the required input by specifying the three path parameters
                              (<b>operand1</b>, <b>operand2</b>, and
                              <b>operator</b>). 
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/aws_proxy_lambda_create_api_resources.png" alt="
                                Create an API in API Gateway as a Lambda proxy
                            " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                     </ol>
                     
                     <h2 id="api-as-lambda-proxy-expose-get-method-with-query-strings-to-call-lambda-function"> Create a GET Method with Query Parameters to Call the Lambda Function </h2>
                     
                     
                     <p> By creating a GET method with query parameters to call the Lambda function, we can
                        let
                        the API user to do the calculations via any browser. This can be useful especially
                        if
                        the API allows open access. 
                     </p>
                     
                     <p class="title"><b>To set up the GET method with query strings to invoke the Lambda function</b></p>
                     <ol>
                        <li>
                           
                           <p> In the API Gateway console, choose the API&apos;s <b>/calc</b> resource under <b>Resources</b>.
                           </p>
                           
                        </li>
                        <li>        
                           
                           <p>Choose <b>Create Method</b>, from the <b>Actions</b> drop-down menu, to create the GET method. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> In the ensuing <b>Set up</b> pane, 
                           </p>
                           
                           <ol>
                              <li>
                                 <p>Choose <code class="code">AWS Service</code> for <b>Integration type</b>.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose the region (e.g., <code class="code">us-west-2</code>) where you created the Lambda function for <b>AWS Region</b>.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <code class="code">Lambda</code> for <b>AWS Service</b>.
                                 </p>
                              </li>
                              <li>
                                 <p>Leave <b>AWS Subdomain</b> blank because our Lambda function is not hosted on any of AWS subdomain.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <code class="code">POST</code> for <b>HTTP method</b>. Lambda requires that the <code class="code">POST</code> request be used to invoke any Lambda function. This examples shows that the HTTP
                                    method in a frontend method request can be different from the integration request
                                    in the backend.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <code class="code">Use path override</code> for <b>Action Type</b>. This option allows us to specify the ARN of the <a href="./lambda/latest/dg/API_Invoke.html" target="_blank">Invoke</a> action to execute our <code class="code">Calc</code> function.
                                 </p>
                              </li>
                              <li>
                                 <p>Type <code class="code">/2015-03-31/functions/arn:aws:lambda:<em class="replaceable"><code>region</code></em>:<em class="replaceable"><code>account-id</code></em>:function:Calc/invocations</code> in <b>Path override</b>.
                                 </p>
                              </li>
                              <li>
                                 <p>Specify the ARN of an IAM role for <b>Execution role</b>. You can find the ARN of the role in the IAM console. The role must contain the necessary
                                    permissions for the caller to call the <code class="code">Calc</code> function and for API Gateway to assume the role of the caller.
                                 </p>
                              </li>
                              <li>
                                 <p>Leave the <code class="code">Passthrough</code> as the default of <b>Content Handling</b>, because we will not deal with any binary data.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose the <b>Save</b> to finish setting up the <code class="code">GET /calc</code> method.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                           <p>After the setup succeeds, the configuration should look as follows: </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/aws_proxy_lambda_calc_get_method_settings.png" alt="
                                Set up a method for integration with Lambda
                            " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                           <p> You can also add, in <b>Integration Request</b>, the <code class="code">X-Amz-Invocation-Type: Event | RequestReponse |
                                 DryRun</code> header to have the action invoked asynchronously, as request
                              and response, or as a test run, respectively. If the header is not specified,
                              the action will be invoked as request and response. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Go to <b>Method Request</b> to set up query parameters for the <b>GET</b>
                              method on <b>/calc</b> to receive input to the backend Lambda function.
                           </p>
                           
                           <ol>
                              <li>
                                 <p>Choose the pencil icon next to <b>Request Validator</b> to select <code class="code">Validate query string parameters and headers</code>. This setting will cause an error message to return to state the required parameters
                                    are missing if the client does not specify them. You will not get charged for the
                                    call to the backend.
                                 </p>
                              </li>
                              <li>
                                 <p>Expand the <b>URL Query String
                                       Parameters</b> section. Choose <b>Add query string</b>
                                    to add the <b>operand1</b>, <b>operand2</b>, and
                                    <b>operator</b> query string parameters. Check the <b>Required</b> option for each parameter to ensure that they are validated.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                           <p>The configuration now looks as follows:</p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/aws_proxy_lambda_calc_get_method_query_strings.png" alt="
                                Set up a method request URL query strings for integration
                                    with Lambda
                            " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p> Go back to <b>Integration Request</b> to set up the mapping template to translate the client-supplied query strings to
                              the integration request payload as required by the <code class="code">Calc</code> function.
                           </p>               
                           
                           <ol>
                              <li>
                                 <p>Expand the <b>Body Mapping Templates</b> section.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <code class="code">When no template matches the request Content-Type
                                       header</code> for <b>Request body passthrough</b>. 
                                 </p>
                              </li>
                              <li>
                                 
                                 <p>If <code class="code">application/json</code> is not shown under
                                    <b>Content-Type</b>, choose <b>Add mapping
                                       template</b> to add it. 
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>And then type and save the following mapping script in the mapping template editor:
                                    
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;a&quot;:  &quot;$input.params(&apos;operand1&apos;)&quot;,
    &quot;b&quot;:  &quot;$input.params(&apos;operand2&apos;)&quot;, 
    &quot;op&quot;: &quot;$input.params(&apos;operator&apos;)&quot;   
}</code></pre>
                                 <p> This template maps the three query string parameters declared in
                                    <b>Method Request</b> into designated property values of the
                                    JSON object as the input to the backend Lambda function. The transformed JSON
                                    object will be included as the integration request payload. 
                                 </p>
                                 
                              </li>
                           </ol>
                           
                           <p>The final settings of this step is shown as follows:</p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/aws_proxy_lambda_calc_get_method_query_strings_mapping.png" alt="
                                Map a method request URL query strings to integration
                                    request payload to call Lambda function
                            " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p> You can now choose <b>Test</b> to verify that the GET method on
                              the <b>/calc</b> resource has been properly set up to invoke the
                              Lambda function. 
                           </p>
                           
                        </li>
                     </ol>
                     
                     <h2 id="api-as-lambda-proxy-expose-post-method-with-json-body-to-call-lambda-function"> Create a POST Method with a JSON Payload to Call the Lambda Function </h2>
                     
                     
                     <p>By creating a POST method with a JSON payload to call the Lambda function, we expect
                        the
                        client to submit the necessary input to the backend function in the request body.
                        To
                        ensure that the client uploads the correct input data, we will enable request validation
                        on the payload.
                     </p>
                     
                     <p class="title"><b>To set up the POST method with a JSON payload to invoke a Lambda function</b></p>
                     <ol>
                        <li>
                           <p>Go to the API Gateway console and choose the API created previously.</p>
                        </li>
                        <li>
                           <p>Highlight the <b>/calc</b> resource from <b>Resources</b> pane.
                           </p>
                        </li>
                        <li>
                           <p> Choose <b>Create Method</b> from the <b>Actions</b> menu to create the <b>POST /calc</b> method. 
                           </p>
                        </li>
                        <li>
                           
                           <p> In the method&apos;s <b>Set Up</b> panel, configure this POST method
                              with the following integration settings. For more information, follow the discussions
                              in <a href="integrating-api-with-aws-services-lambda.html#api-as-lambda-proxy-expose-get-method-with-query-strings-to-call-lambda-function"> Create a GET Method with Query Parameters to Call the Lambda Function </a>.
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/aws_proxy_lambda_calc_post_method_settings.png" alt="
                                Set up the POST method to invoke the Lambda function
                            " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Models</b> under the API from the API Gateway console&apos;s primary navigation pane to create data
                              models for the method&apos;s input and output:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Create</b> in the <b>Models</b> pane. Type <code class="code">Input</code> in <b>Model name</b>,  type <code class="code">application/json</code> in <b>Content type</b>, and type the following schema definition in <b>Model schema</b>: 
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;type&quot;:&quot;object&quot;,
    &quot;properties&quot;:{
        &quot;a&quot;:{&quot;type&quot;:&quot;number&quot;},
        &quot;b&quot;:{&quot;type&quot;:&quot;number&quot;},
        &quot;op&quot;:{&quot;type&quot;:&quot;string&quot;}
    },
    &quot;title&quot;:&quot;Input&quot;
}</code></pre>
                                 <p>This model describes the input data structure and will be used to validate the incoming
                                    request body.
                                 </p>
                                 
                              </li>
                              <li>
                                 <p>Choose <b>Create</b> in the <b>Models</b> pane. Type <code class="code">Output</code> in <b>Model name</b>,  type <code class="code">application/json</code> in <b>Content type</b>, and type the following schema definition in <b>Model schema</b>: 
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;type&quot;:&quot;object&quot;,
    &quot;properties&quot;:{
        &quot;c&quot;:{&quot;type&quot;:&quot;number&quot;}
    },
    &quot;title&quot;:&quot;Output&quot;
}</code></pre>
                                 <p>This model describes the data structure of the calculated output from the backend.
                                    It can be used to map the integration response data  to a different model. This tutorial
                                    relies on the passthrough behavior and does not use this model.
                                 </p>
                                 
                              </li>
                              <li>
                                 <p>Choose <b>Create</b> in the <b>Models</b> pane. Type <code class="code">Result</code> in <b>Model name</b>,  type <code class="code">application/json</code> in <b>Content type</b>, and type the following schema definition in <b>Model schema</b>: 
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;type&quot;:&quot;object&quot;,
    &quot;properties&quot;:{
        &quot;input&quot;:{
            &quot;$ref&quot;:&quot;https://apigateway.amazonaws.com/restapis/<em class="replaceable"><code>restapi-id</code></em>/models/Input&quot;
        },
        &quot;output&quot;:{
            &quot;$ref&quot;:&quot;https://apigateway.amazonaws.com/restapis/<em class="replaceable"><code>restapi-id</code></em>/models/Output&quot;
        }
    },
    &quot;title&quot;:&quot;Output&quot;
}</code></pre>
                                 <p>This model describes the data structure of the returned response data. It references
                                    both the <code class="code">Input</code> and <code class="code">Output</code> schemas defined in the specified API (<code class="code"><em class="replaceable"><code>restapi-id</code></em></code>). Again, this model is not used in this tutorial because it leverages the passthrough
                                    behavior.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           <p>In the <b>Method Request</b> configuration settings, do the following to enable request validation on the incoming
                              request body:
                           </p>
                           
                           <ol>
                              <li>
                                 <p>Choose the pencil icon next to <b>Request Validator</b> to choose <code class="code">Validate body</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Expand the <b>Request Body</b> section, choose <b>Add model</b></p>
                              </li>
                              <li>
                                 <p>Type <code class="code">application/json</code> in the <b>Content-Type</b> input field and choose <code class="code">Input</code> from the drop-down list in the <b>Model name</b> column.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p> You can now choose <b>Test</b> to verify the POST method works
                              as expected. The following input: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;a&quot;: 1,
    &quot;b&quot;: 2,
    &quot;op&quot;: &quot;+&quot;
}
                </code></pre>
                           <p> should produce the following output:</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: 1,
  &quot;b&quot;: 2,
  &quot;op&quot;: &quot;+&quot;,
  &quot;c&quot;: 3
}                    
                </code></pre>
                           </li>
                     </ol>
                     
                     <p> If you would like to implement this method as an asynchronous call, you can add an
                        <code class="code">InvocationType</code> header in the method request and map it to the
                        <code class="code">X-Amz-Invocation-Type</code> header in the integration request with either a static value of 
                        <code class="code">&apos;Event&apos;</code> or the
                        header mapping expression of <code class="code">method.request.header.InvocationType</code>. For the latter, 
                        the client must include the <code class="code">InvocationType:Event</code> header in the method
                        request. The asynchronous call will return an empty response,
                        instead. 
                     </p>
                     
                     <h2 id="api-as-lambda-proxy-expose-get-method-with-path-parameters-to-call-lambda-function"> Create a GET Method with Path Parameters to Call the Lambda Function </h2>
                     
                     
                     <p> In this section, we create a GET method on a resource specified by a sequence of
                        path 
                        parameters to call the backend Lambda function. The path parameter values
                        specify the input data to the Lambda function. We will define a mapping template 
                        to map the incoming path parameter values to the required integration request payload.
                        
                     </p>
                     
                     <p>In addition, we will use the simple Lambda integration feature provided by the API
                        Gateway
                        console to set up the method. As you can see, this console-provided feature provides
                        much more streamlined user experiences. 
                     </p>
                     
                     <p class="title"><b>To set up the GET method with URL path parameters to call the Lambda
                           function</b></p>
                     <ol>
                        <li>
                           <p>Go to the API Gateway console. </p>
                        </li>
                        <li>
                           <p>Highlight the <b>/calc/{operand1}/{operand2}/{operator}</b> resource on the <b>Resources</b> tree of the previously created API
                           </p>
                        </li>
                        <li>
                           <p>Choose <b>Create Method</b> from the <b>Actions</b> drop-down menu, choose <code class="code">GET</code>.
                           </p>
                        </li>
                        <li>
                           <p>In the <b>Setup</b> pane, choose <code class="code">Lambda Function</code> for <b>Integration type</b>, to use the streamlined setup process enabled by the console.
                           </p>
                        </li>
                        <li>
                           <p>Choose a region (e.g., <code class="code">us-west-2</code>) for <b>Lambda Region</b>. This is the region where the Lambda function is hosted.
                           </p>
                        </li>
                        <li>
                           <p>Choose an existing Lambda function (e.g., <code class="code">Calc</code>) for <b>Lambda Function</b>. 
                           </p>
                        </li>
                        <li>
                           <p>Choose <b>Save</b> and then choose <b>OK</b> to consent to <b>Add Permissions to Lambda Function</b>.
                           </p>
                        </li>
                        <li>
                           
                           <p>Choose <b>Integration Request</b> to set up body mapping template.
                           </p>
                           
                           <ol>
                              <li>
                                 <p>Expand the <b>Body Mapping Templates</b> section.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <b>Add mapping template</b>.
                                 </p>
                              </li>
                              <li>
                                 <p>Type <code class="code">application/json</code> for <b>Content-Type</b> and then choose the check mark icon to open the template editor.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <b>Yes, secure this integration</b> to proceed.
                                 </p>
                              </li>
                              <li>
                                 <p>Type the following mapping script to the template editor:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;a&quot;: &quot;$input.params(&apos;operand1&apos;)&quot;,
   &quot;b&quot;: &quot;$input.params(&apos;operand2&apos;)&quot;,
   &quot;op&quot;: #if($input.params(&apos;operator&apos;)==&apos;%2F&apos;)&quot;/&quot;#{else}&quot;$input.params(&apos;operator&apos;)&quot;#end
   
}</code></pre>
                                 <p>This template maps the three URL path parameters, declared when the
                                    <b>/calc/{operand1}/{operand2}/{operator}</b> resource was
                                    created, into designated property values of the JSON object. Because URL paths
                                    must be URL-encoded, the division operator must be specified as <code class="code">%2F</code>
                                    instead of <code class="code">/</code>. This template translates the <code class="code">%2F</code> into &apos;<code class="code">/</code> before passing it to the Lambda function. 
                                    
                                 </p>
                                 
                              </li>
                              <li>
                                 <p>Save the mapping template.</p>
                              </li>
                           </ol>
                           
                           <p> When the method is set up correctly, the settings should look similar to the following:
                              
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/aws_proxy_lambda_calc_get_method_with_paths_settings.png" alt="
                                Set up the GET method with path parameters to invoke the
                                    Lambda function
                            " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           <p>Now, let us test the API using the TestInvoke feature of the console.  </p>
                           
                           <ol>
                              <li>
                                 <p>Choose <b>Test</b> from <b>Method Execution</b>.
                                 </p>
                              </li>
                              <li>
                                 <p>Type <code class="code">1</code>, <code class="code">2</code> and <code class="code">+</code> in <b>{operand1}</b>, <b>{operand2}</b> and <b>{operator}</b> fields, respectively.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <b>Test</b>.
                                 </p>
                              </li>
                              <li>
                                 
                                 <p>The result will be shown similar to the following:</p>
                                 
                                 <div class="mediaobject">
                                    
                                    <img src="../../..//img/aws_proxy_lambda_calc_get_method_test_result.png" alt="
                                        Map a method request URL path parameters to the integration
                                            request payload to call the Lambda function
                                    " style="max-width:100%">
                                    
                                    
                                    
                                 </div>
                                 
                              </li>
                           </ol>
                           
                           <p>This test result shows the original output from the backend Lambda function, as passed
                              through the integration response without mapping, because we have not configured any
                              mapping template. Next, we model the data structure of the method response payload
                              after the <code class="code">Result</code> schema.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>
                              By default, the method response body is assigned an Empty model. This will cause the
                              integration response body passed through without mapping. However, when you generate
                              an SDK for one of the strongly-type languages, such as Java or Objective-C, your SDK
                              users will receive an empty object as the result. To ensure both the REST client and
                              SDK clients receive the desired result, you must model the response data using a predefined
                              schema. Here, we demonstrate how to define a model for the method response body and
                              to construct a mapping template to transform the integration response body to the
                              method response body.
                              
                           </p>
                           
                           <ol>
                              <li>
                                 <p>In <b>/calc/{operand1}/{operand2}/{operator} - GET - Method Execution</b>, choose <b>Method Response</b>.
                                 </p>
                              </li>
                              <li>
                                 <p>Expand the <b>200</b> response, 
                                 </p>
                              </li>
                              <li>
                                 <p>Under <b>Response Body for 200</b> section.
                                    
                                    If no model has been assigned for the method response, 
                                 </p>
                              </li>
                              <li>
                                 <p>Choose the pencil icon next to the model for the <code class="code">application/json</code> content type. 
                                 </p>
                              </li>
                              <li>
                                 <p>Choose a predefined model from the <b>Models</b> drop-down list. For this tutorial, this is <code class="code">Result</code>. 
                                 </p>
                              </li>
                              <li>
                                 <p>Save the model choice. </p>
                              </li>
                           </ol>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>If no model is defined for the content type of <code class="code">application/json</code>, choose <b>Add Response Model</b> and follow the on-screen instructions to add the model.
                              </p>
                           </div>
                           
                           <p>Setting the model for the method response body ensure that the response data will
                              be cast into the <code class="code">Result</code> object of a given SDK. For this, we also need to make sure that the integration response
                              data is mapped accordingly, which we discuss next.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>To return the backend result according to the specified schema, </p>
                           
                           <ol>
                              <li>
                                 <p> Choose <b>Integration Response</b> and expand the 200 method response entry.
                                 </p>
                              </li>
                              <li>
                                 <p>Expand the <b>Body Mapping Templates</b> section.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose or add <code class="code">application/json</code> to the <b>Content-Type</b> list.
                                 </p>
                              </li>
                              <li>
                                 <p>Choose <code class="code">Result</code> from the <b>Generate template</b> drop-down list to bring up the <code class="code">Result</code> template blueprint.
                                 </p>
                              </li>
                              <li>
                                 <p>Change the template blueprint as follows:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">#set($inputRoot = $input.path(&apos;$&apos;))
{
  &quot;input&quot; : {
    &quot;a&quot; : $inputRoot.a,
    &quot;b&quot; : $inputRoot.b,
    &quot;op&quot; : &quot;$inputRoot.op&quot;
  },
  &quot;output&quot; : {
    &quot;c&quot; : $inputRoot.c
  }
}</code></pre></li>
                              <li>
                                 <p>Choose <b>Save</b>.
                                 </p>
                              </li>
                              <li>
                                 
                                 <p>To test the mapping template, choose <b>Test</b> in <b>Method Execution</b> and type <code class="code">1</code> <code class="code">2</code> and <code class="code">+</code> in the <b>operand1</b>, <b>operand2</b> and <b>operator</b> input fields, respectively. The integration response from the Lambda function is
                                    now mapped to a <code class="code">Result</code> object:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;input&quot;: {
    &quot;a&quot;: 1,
    &quot;b&quot;: 2,
    &quot;op&quot;: &quot;+&quot;
  },
  &quot;output&quot;: {
    &quot;c&quot;: 3
  }
}</code></pre></li>
                           </ol>
                           
                           
                        </li>
                        <li>
                           
                           <p>To make the API accessible beyond Test Invoke in the API Gateway console, choose <b>Deploy API</b>
                              from the <b>Actions</b> drop-down menu. Make sure to repeat deploying the API whenever you finish
                              adding, modifying or deleting a resource or method, updating any data mapping, updating
                              the stage settings.
                              Otherwise, new features or updates will not be available.
                           </p>
                           
                        </li>
                     </ol>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="api-gateway-tutorials.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="api-as-lambda-proxy-export-swagger-with-extensions.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Set Up an IAM Role and
            Policy for an API to Invoke Lambda Functions"><a class="pagetoc" href="#api-as-lambda-proxy-setup-iam-role-policies">Set Up an IAM Role and
                              Policy for an API to Invoke Lambda Functions</a></li>
                        <li class="pagetoc" name="Create a Lambda Function in the
            Backend"><a class="pagetoc" href="#api-as-lambda-proxy-create-lambda-function">Create a Lambda Function in the
                              Backend</a></li>
                        <li class="pagetoc" name="Create API Resources for the
            Lambda Function"><a class="pagetoc" href="#api-as-lambda-proxy-create-api-resources">Create API Resources for the
                              Lambda Function</a></li>
                        <li class="pagetoc" name=" Create a GET Method with Query Parameters to Call the Lambda Function "><a class="pagetoc" href="#api-as-lambda-proxy-expose-get-method-with-query-strings-to-call-lambda-function"> Create a GET Method with Query Parameters to Call the Lambda Function </a></li>
                        <li class="pagetoc" name=" Create a POST Method with a JSON Payload to Call the Lambda Function "><a class="pagetoc" href="#api-as-lambda-proxy-expose-post-method-with-json-body-to-call-lambda-function"> Create a POST Method with a JSON Payload to Call the Lambda Function </a></li>
                        <li class="pagetoc" name=" Create a GET Method with Path Parameters to Call the Lambda Function "><a class="pagetoc" href="#api-as-lambda-proxy-expose-get-method-with-path-parameters-to-call-lambda-function"> Create a GET Method with Path Parameters to Call the Lambda Function </a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>