<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Configure
         Lambda Authorizer Using the API Gateway Console - Amazon API Gateway
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="apigateway-use-lambda-authorizer.html" title="Use API Gateway Lambda Authorizers">
      <link rel="prev" href="api-gateway-lambda-authorizer-output.html" title="Output from an Amazon API Gateway Lambda
                Authorizer">
      <link rel="next" href="call-api-with-api-gateway-lambda-authorization.html" title="Call an API with API Gateway
                Lambda Authorizers">
      <meta name="description" content="Learn how to configure an API Gateway Lambda authorizer.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/configure-api-gateway-lambda-authorization-with-console.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="apigateway-control-access-to-api.html"> Controlling Access to an API in
                                    			API Gateway</a> &#xBB; <a href="apigateway-use-lambda-authorizer.html">Use API Gateway Lambda Authorizers</a> &#xBB; <span class="breadcrumb">Configure
                                    Lambda Authorizer Using the API Gateway Console</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="configure-api-gateway-lambda-authorization-with-console">Configure
                        Lambda Authorizer Using the API Gateway Console
                     </h1>
                     <p> After you create the Lambda function and verify that it works, use the following
                        steps
                        to configure the API Gateway Lambda authorizer (formerly known as the custom authorizer)
                        in the
                        API Gateway console. 
                     </p>
                     <p class="title"><b>To enable a Lambda authorizer on API methods</b></p>
                     <ol>
                        <li>
                           
                           <p> Sign in to the API Gateway console. </p>
                           
                        </li>
                        <li>
                           
                           <p> Create a new or select an existing API and choose
                              <b>Authorizers</b> under that API. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose <b>Create New Authorizer</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> For <b>Create Authorizer</b>, type an authorizer name in the
                              <b>Name</b> input field. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> For <b>Type</b>, choose the <b>Lambda</b> option.
                              
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> For <b>Lambda Function</b>, choose a region and then choose an
                              available Lambda authorizer function that&apos;s in your account. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Leave <b>Lambda Invoke Role</b> blank to let the API Gateway console
                              set a resource-based policy. The policy grants API Gateway permissions to invoke the
                              authorizer Lambda function. You can also choose to type the name of an IAM role
                              to allow API Gateway to invoke the authorizer Lambda function. For an example of such
                              a
                              role, see <a href="integrating-api-with-aws-services-lambda.html#api-as-lambda-proxy-setup-iam-role-policies">Set Up an IAM Role and
                                 Policy for an API to Invoke Lambda Functions</a>. 
                           </p>
                           
                           
                           <p> If you choose to let the API Gateway console set the resource-based policy, the
                              <b>Add Permission to Lambda Function</b> dialog is displayed.
                              Choose <b>OK</b>. After the Lambda authorization is created, you
                              can test it with appropriate authorization token values to verify that it works
                              as expected. 
                           </p>
                           
                           
                        </li>
                        <li>
                           
                           <p> For <b>Lambda Event Payload</b>, choose either
                              <b>Token</b> for a <code class="code">TOKEN</code> authorizer or
                              <b>Request</b> for a <code class="code">REQUEST</code> authorizer. (This is
                              the same as setting the <a href="./apigateway/api-reference/resource/authorizer/#type" target="_blank">type</a> property to <code class="code">TOKEN</code> or <code class="code">REQUEST</code>.)
                              
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Depending on the choice of the previous step, do one of the following:</p>
                           
                           <ol>
                              <li>
                                 
                                 <p> For the <b>Token</b> options, do the following: 
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    
                                    
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Type the name of a header in <b>Token
                                                Source</b>. The API client must include a header of this
                                             name to send the authorization token to the Lambda authorizer.
                                             
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Optionally, provide a RegEx statement in <code class="code">Token
                                                Validation</code> input field. API Gateway performs initial
                                             validation of the input token against this expression and
                                             invokes the authorizer upon successful validation. This helps
                                             reduce chances of being charged for invalid tokens.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>For <b>Authorization Caching</b>, select or
                                             clear the <b>Enabled</b> option, depending on
                                             whether you want to cache the authorization policy generated by
                                             the authorizer or not. When policy caching is enabled, you can
                                             choose to modify the <b>TTL</b> value from the
                                             default (300). Setting TTL=0 disables policy caching. When
                                             policy caching is enabled, the header name specified in
                                             <b>Token Source</b> becomes the cache
                                             key.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                              </li>
                              <li>
                                 
                                 <p>For the <b>Request</b> option, do the following:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>For <b>Identity Sources</b>, type a request
                                             parameter name of a chosen parameter type. Supported parameter
                                             types are <code class="code">Header</code>, <code class="code">Query String</code>,
                                             <code class="code">Stage Variable</code>, and <code class="code">Context</code>. To
                                             add more identity sources, choose <b>Add Identity
                                                Source</b>. 
                                          </p>
                                          
                                          
                                          <p>API Gateway uses the specified identity sources as the request
                                             authorizer caching key. When caching is enabled, API Gateway calls the
                                             authorizer&apos;s Lambda function only after successfully verifying
                                             that all the specified identity sources are present at runtime.
                                             If a specified identify source is missing, null, or empty, API Gateway
                                             returns a <code class="code">401 Unauthorized</code> response without calling
                                             the authorizer Lambda function. 
                                          </p>
                                          
                                          
                                          <p>When multiple identity sources are defined, they all used to
                                             derive the authorizer&apos;s cache key. Changing any of the cache key
                                             parts causes the authorizer to discard the cached policy
                                             document and generate a new one.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>For <b>Authorization Caching</b>, select or
                                             deselect the <b>Enabled</b> option, depending on
                                             whether you want to cache the authorization policy generated by
                                             the authorizer or not. When policy caching is enabled, you can
                                             choose to modify the <b>TTL</b> value from the
                                             default (300). Setting TTL=0 disables policy caching.
                                          </p>
                                          
                                          <p>When caching is disabled, it is not necessary to specify an
                                             identity source. API Gateway does not perform any validation before
                                             invoking the authorizer&apos;s Lambda function.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                              </li>
                           </ol>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p> To enable caching, your authorizer must return a policy that is
                                 applicable to all methods across an API. To enforce method-specific policy,
                                 you can set the TTL value to zero to disable policy caching for the API.
                                 
                              </p>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create</b> to create the new Lambda authorizer for the
                              chosen API.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> After the authorizer is created for the API, you can optionally test invoking
                              the authorizer before it is configured on a method. 
                           </p>
                           
                           <p> For the <code class="code">TOKEN</code> authorizer, type a valid token in the
                              <b>Identity token</b> input text field and the choose
                              <b>Test</b>. The token will be passed to the Lambda function as
                              the header you specified in the <b>Identity token source</b>
                              setting of the authorizer. 
                           </p>
                           
                           <p> For the <code class="code">REQUEST</code> authorizer, type the valid request parameters
                              corresponding to the specified identity sources and then choose
                              <b>Test</b>. 
                           </p>
                           
                           <p> In addition to using the API Gateway console, you can use AWS CLI or an AWS SDK for
                              API Gateway to test invoking an authorizer. To do so using the AWS CLI, see <a href="./cli/latest/reference/apigateway/test-invoke-authorizer.html" target="_blank">test-invoke-authorizer</a>. 
                           </p>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>Test-invoke for method executions test-invoke for authorizers are
                                 independent processes. 
                              </p>
                              <p>To test invoking a method using the API Gateway console, see <a href="how-to-test-method.html">Use the Console to Test a Method</a>. To
                                 test invoking a method using the AWS CLI, see <a href="./cli/latest/reference/apigateway/test-invoke-method.html" target="_blank">test-invoke-method</a>. 
                              </p>
                              <p>To test invoking a method and a configured authorizer, deploy the API, and
                                 then use cURL or Postman to call the method, providing the required token or
                                 request parameters.
                              </p>
                           </div>
                           
                        </li>
                     </ol>
                     <p> The next procedure shows how to configure an API method to use the Lambda authorizer.
                        
                     </p>
                     <p class="title"><b>To configure an API method to use a Lambda authorizer</b></p>
                     <ol>
                        <li>
                           
                           <p> Go back to the API. Create a new method or choose an existing method. If
                              necessary, create a new resource. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> In <b>Method Execution</b>, choose the <b>Method
                                 Request</b> link. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Under <b>Settings</b>, expand the
                              <b>Authorization</b> drop-down list to select the Lambda
                              authorizer you just created (for example,
                              <b>myTestApiAuthorizer</b>), and then choose the check mark
                              icon to save the choice. 
                           </p>
                           
                           
                        </li>
                        <li>
                           
                           <p> Optionally, while still on the <b>Method Request</b> page,
                              choose <b>Add header</b> if you also want to pass the
                              authorization token to the backend. In <b>Name</b>, type a header
                              name that matches the <b>Token Source</b> name you specified when
                              you created the Lambda authorizer for the API. Then, choose the check mark icon
                              to save the settings. This step does not apply to <code class="code">REQUEST</code>
                              authorizers. 
                           </p>
                           
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Deploy API</b> to deploy the API to a stage. Note the
                              <b>Invoke URL</b> value. You need it when calling the API. For
                              a <code class="code">REQUEST</code> authorizer using stage variables, you must also define
                              the required stage variables and specify their values while in <b>Stage
                                 Editor</b>. 
                           </p>
                           
                        </li>
                     </ol>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="api-gateway-lambda-authorizer-output.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="call-api-with-api-gateway-lambda-authorization.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper"></div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>