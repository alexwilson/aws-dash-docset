<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Enable API Caching to Enhance Responsiveness - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="set-up-stages.html" title="Set up a Stage in API Gateway">
      <link rel="prev" href="api-gateway-request-throttling.html" title="Throttle API Requests for Better
            Throughput">
      <link rel="next" href="set-up-logging.html" title="Set up API Logging in API Gateway">
      <meta name="description" content="Learn how to enable Amazon API Gateway caching to enhance your API&apos;s performance.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-caching.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="how-to-deploy-api.html">Deploying an API in Amazon API Gateway</a> &#xBB; <a href="set-up-stages.html">Set up a Stage in API Gateway</a> &#xBB; <span class="breadcrumb">Enable API Caching to Enhance Responsiveness</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="api-gateway-caching">Enable API Caching to Enhance Responsiveness</h1>
                     <p>You can enable API caching in Amazon API Gateway to cache your endpoint&#x2019;s response.
                        With caching, you can reduce the number of calls made to your endpoint and also improve
                        the latency of the requests to your API. When you enable caching for a stage, API
                        Gateway
                        caches responses from your endpoint for a specified time-to-live (TTL) period, in
                        seconds. API Gateway then responds to the request by looking up the endpoint response
                        from the
                        cache instead of making a request to your endpoint. The default TTL value for API
                        caching is 300 seconds. The maximum TTL value is 3600 seconds. TTL=0 means caching
                        is disabled.
                     </p>
                     <div class="aws-note">
                        <p class="aws-note">Important</p>
                        <p>Only <code class="code">GET</code> methods can be cached.
                        </p>
                     </div>
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>Caching is charged by the hour and is not eligible for the AWS free tier. </p>
                     </div>
                     <h2 id="enable-api-gateway-caching">Enable
                        Amazon API Gateway Caching
                     </h2>
                     
                     
                     
                     <p> In API Gateway, you can enable caching for all methods for a specified stage. When
                        you
                        enable caching, you must choose a cache capacity. In general, a larger capacity gives
                        a
                        better performance, but also costs more. 
                     </p>
                     
                     <p> API Gateway enables caching by creating a dedicated cache instance. This process
                        can take
                        up to 4 minutes. 
                     </p>
                     
                     <p>API Gateway changes caching capacity by removing the existing cache instance and recreating
                        a new one with a modified capacity. All existing cached data is deleted. 
                     </p>
                     
                     <p> In the API Gateway console, you configure caching in the <b>Settings</b> tab
                        of a named <b>Stage Editor</b>.  
                     </p>
                     
                     <p class="title"><b>To configure API caching for a given stage:</b></p>
                     <ol>
                        <li>
                           
                           <p>Go to the API Gateway console.</p>
                           
                        </li>
                        <li>
                           <p>Navigate to the <b>Stage Editor</b> for the stage for which you want to enable caching.
                           </p>
                        </li>
                        <li>
                           <p>Choose <b>Settings</b>.
                           </p>
                        </li>
                        <li>
                           <p>Select <b>Enable API cache</b>.
                           </p>
                        </li>
                        <li>
                           <p>Wait for the cache creation to complete. </p>
                        </li>
                     </ol>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>
                           Creating or deleting a cache takes about 4 minutes for API Gateway to complete. 
                           When cache is created, the <b>Cache status</b> value changes from <code class="code">CREATE_IN_PROGRESS</code> to 
                           <code class="code">AVAILABLE</code>. When cache deletion is completed, the <b>Cache status</b> value changes from 
                           <code class="code">DELETE_IN_PROGRESS</code> to an empty string.  
                           
                        </p>
                     </div>
                     
                     <p>
                        When you enable caching within a stage&apos;s <b>Cache Settings</b>, you enable caching for all methods in that stage.
                        
                     </p>
                     
                     
                     <p>
                        If you would like to verify if caching is functioning as expected, you have two general
                        options:
                        
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p> Inspect the CloudWatch metrics of <b>CacheHitCount</b> and
                                 <b>CacheMissCount</b> for your API and stage.
                                 
                                 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>
                                 Put a timestamp in the response.
                                 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>
                           You should not use the X-Cache header from the CloudFront response to determine if
                           your API is being served from your API Gateway cache instance.
                           
                        </p>
                     </div>
                     
                     
                     <h2 id="override-api-gateway-stage-cache-for-method-cache">Override API Gateway Stage-Level Caching for Method Caching</h2>
                     
                     
                     
                     <p>  If you want more granularity in your caching settings, you can override the
                        stage-level caching for individual methods . This includes disabling caching for a
                        specific method, increasing or decreasing its TTL period, and turning on or off
                        encryption of the cached response. If you anticipate that a method will receive
                        sensitive data in its responses, in <b>Cache Settings</b>, choose
                        <b>Encrypt cache data</b>. 
                        
                     </p>
                     
                     <p class="title"><b>To configure API caching for individual methods using the console:</b></p>
                     <ol>
                        <li>
                           
                           <p>Choose <b>Stages</b> of an API from the main navigation pane.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose a method of the API in the chosen stage, from the secondary navigation pane.</p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Override for this method</b> in <b>Settings</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose appropriate settings under the <b>Cache Settings</b> section (that is shown only if the stage-level caching is enabled). 
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="enable-api-gateway-cache-keys">Use Method or Integration Parameters as Cache Keys to Index Cached Responses</h2>
                     
                     
                     
                     <p> When a cached method or integration has parameters, which can take the form of custom
                        headers, URL paths, or query strings, you can use some or all of the parameters to
                        form
                        cache keys. API Gateway can cache the method&apos;s responses, depending on the parameter
                        values
                        used. 
                     </p>
                     
                     <p>
                        For example, suppose you have a request of the following format:
                        
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
GET /users?type=... HTTP/1.1
host: example.com
...
        </code></pre>
                     <p>In this request, <code class="code">type</code> can take a value of <code class="code">admin</code> or
                        <code class="code">regular</code>. If you include the <code class="code">type</code> parameter as part of the
                        cache key, the responses from <code class="code">GET /users?type=admin</code> will be cached
                        separately from those from <code class="code">GET /users?type=regular</code>. 
                     </p>
                     
                     
                     
                     <p> When a method or integration request takes more than one parameter, you can choose
                        to
                        include some or all of the parameters to create the cache key. For example, you can
                        include only the <code class="code">type</code> parameter in the cache key for the following request,
                        made in the listed order within a TTL period: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
GET /users?type=admin&amp;department=A HTTP/1.1
host: example.com
...
        </code></pre>
                     <p> The response from this request will be cached and will be used to serve the following
                        request: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
GET /users?type=admin&amp;department=B HTTP/1.1
host: example.com
...
        </code></pre>        
                     
                     <p> To include a method or integration request parameter as part of a cache key in the
                        API Gateway console, select <b>Caching</b> after you add the parameter. 
                     </p>
                     
                     <div class="mediaobject">                    
                        
                        <img src="../../..//img/api-caching-including-parameter-as-cache-key.png" alt="
                        Include Method or Integration Parameters as Cache Keys to Index Cached Response
                    " style="max-width:100%">
                        
                        
                        
                     </div>
                     
                     
                     <h2 id="flush-api-caching">Flush the API Stage Cache in API Gateway</h2>
                     
                     <p> When API caching is enabled, you can flush your API stage&apos;s entire cache to ensure
                        your API&apos;s clients get the most recent responses from your integration endpoints.
                        
                     </p>
                     
                     <p> To flush the API stage cache, you can choose the <b>Flush entire
                           cache</b> button under the <b>Cache Settings</b> section in the
                        <b>Settings</b> tab in a stage editor of the API Gateway console. The
                        cache-flushing operation is almost instantaneous. As a result, the cache status is
                        <code class="code">AVAILABLE</code> immediately after flushing. 
                     </p>
                     
                     <p>Notice that flushing the cache will cause the responses to ensuing requests to be
                        serviced from the backend until the cache is built up again. During this period, the
                        number of requests sent to the integration endpoint may increase. That may affect
                        the
                        overall latency of your API. 
                     </p>
                     
                     <h2 id="invalidate-method-caching">Invalidate an API Gateway Cache Entry</h2>
                     
                     
                     <p>A client of your API can invalidate an existing cache entry and reloads it from the
                        integration endpoint for individual requests. The client must send a request that
                        contains the <code class="code">Cache-Control: max-age=0</code> header. The client receives the
                        response directly from the integration endpoint instead of the cache, provided that
                        the
                        user is authorized to do so. This replaces the existing cache entry
                        with the new response, which is fetched from the integration endpoint. 
                     </p>
                     
                     <p> To grant permission for
                        a
                        caller, attach a policy of the following format to an IAM execution
                        role for the user. 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [
        &quot;execute-api:InvalidateCache&quot;
      ],
      &quot;Resource&quot;: [
        &quot;arn:aws:execute-api:<em class="replaceable"><code>region</code></em>:<em class="replaceable"><code>account-id</code></em>:<em class="replaceable"><code>api-id</code></em>/<em class="replaceable"><code>stage-name</code></em>/GET/<em class="replaceable"><code>resource-path-specifier</code></em>&quot;
      ]
    }
  ]
}            
        </code></pre>
                     <p> This policy allows the API Gateway execution service to invalidate cache for requests
                        on
                        the specified resource (or resources). To specify a group of targeted resources, use
                        a
                        wild card (*) character for <code class="code">account-id</code>, <code class="code">api-id</code>, and other
                        entries in the ARN value of <code class="code">Resource</code>. For more information on how to set
                        permissions for the API Gateway execution service, see <a href="permissions.html">Control Access to an API with IAM Permissions</a>
                        
                     </p>
                     
                     <p> If you do not impose an <code class="code">InvalidateCache</code> policy, any client can
                        invalidate the API cache. If all or most of the clients invalidate the API cache,
                        there
                        could be significant latency impact on your API. 
                     </p>
                     
                     <p> When the policy is in place, caching is enabled, and authorization is required, you
                        can control how unauthorized requests are handled by choosing an option from
                        <b>Handle unauthorized requests</b> in the API Gateway console. 
                     </p>
                     
                     <div class="mediaobject">
                        
                        <img src="../../..//img/apig-cache-invalidation.png" alt="
                        Configure cache invalidation
                    " style="max-width:100%">
                        
                        
                        
                     </div>
                     
                     <p> The three options result in the following behaviors: </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>
                                 
                                 <b>Fail the request with 403 status code</b>: returns a 403
                                 Unauthorized response. 
                              </p>
                              
                              <p> To set this option using the API, use <code class="code">FAIL_WITH_403</code>. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>
                                 
                                 <b>Ignore cache control header; Add a warning in response
                                    header</b>: process the request and add a warning header in the
                                 response. 
                              </p>
                              
                              <p> To set this option using the API, use
                                 <code class="code">SUCCEED_WITH_RESPONSE_HEADER</code>. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>
                                 
                                 <b>Ignore cache control header</b>: process the request and do not
                                 add a warning header in the response. 
                              </p>
                              
                              <p> To set this option using the API, use
                                 <code class="code">SUCCEED_WITHOUT_RESPONSE_HEADER</code>. 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="api-gateway-request-throttling.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="set-up-logging.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Enable
            Amazon API Gateway Caching"><a class="pagetoc" href="#enable-api-gateway-caching">Enable API Caching</a></li>
                        <li class="pagetoc" name="Override API Gateway Stage-Level Caching for Method Caching"><a class="pagetoc" href="#override-api-gateway-stage-cache-for-method-cache">Override Stage Caching for Method Caching</a></li>
                        <li class="pagetoc" name="Use Method or Integration Parameters as Cache Keys to Index Cached Responses"><a class="pagetoc" href="#enable-api-gateway-cache-keys">Use Method/Integration Parameters as Cache Keys</a></li>
                        <li class="pagetoc" name="Flush the API Stage Cache in API Gateway"><a class="pagetoc" href="#flush-api-caching">Flush the API Stage Cache in API Gateway</a></li>
                        <li class="pagetoc" name="Invalidate an API Gateway Cache Entry"><a class="pagetoc" href="#invalidate-method-caching">Invalidate an API Gateway Cache Entry</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>