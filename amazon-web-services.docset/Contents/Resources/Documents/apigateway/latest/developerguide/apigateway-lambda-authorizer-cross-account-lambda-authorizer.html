<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>
         Configure Cross-Account Lambda Authorizer Using the API Gateway Console - Amazon API Gateway
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="apigateway-use-lambda-authorizer.html" title="Use API Gateway Lambda Authorizers">
      <link rel="prev" href="call-api-with-api-gateway-lambda-authorization.html" title="Call an API with API Gateway
                Lambda Authorizers">
      <link rel="next" href="apigateway-integrate-with-cognito.html" title="Use Amazon Cognito User Pools">
      <meta name="description" content="Learn how to configure a cross-account API Gateway Lambda authorizer.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-lambda-authorizer-cross-account-lambda-authorizer.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="apigateway-control-access-to-api.html"> Controlling Access to an API in
                                    			API Gateway</a> &#xBB; <a href="apigateway-use-lambda-authorizer.html">Use API Gateway Lambda Authorizers</a> &#xBB; <span class="breadcrumb">
                                    Configure Cross-Account Lambda Authorizer Using the API Gateway Console</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="apigateway-lambda-authorizer-cross-account-lambda-authorizer">
                        Configure Cross-Account Lambda Authorizer Using the API Gateway Console
                     </h1>
                     <p>You can now also use an AWS Lambda function from a different AWS account as your API
                        authorizer function. Each account can be in any region where Amazon API Gateway is
                        available. the
                        Lambda authorizer function can use bearer token authentication strategies such as
                        OAuth
                        or SAML. This makes it easy to centrally manage and share a central Lambda authorizer
                        functions across multiple API Gateway APIs.
                     </p>
                     <p>In this section, we show how to configure a cross-account Lambda authorizer function
                        using the Amazon API Gateway console.
                     </p>
                     <p>These instructions assume that you already have an API Gateway API in one AWS account
                        and
                        a Lambda authorizer function in another account.
                     </p>
                     
                     <h2 id="apigateway-cross-account-lambda-auth-configure-cross-account-authorizer">Configure Cross-Account Lambda Authorizer Using the API Gateway Console</h2>
                     
                     <p>Log in to the Amazon API Gateway console in your first account (the one that has your
                        API
                        in it) and do the following:
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p>Locate your API and choose <b>Authorizers</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create New Authorizer</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Create Authorizer</b>, type an authorizer name in the
                              <b>Name</b> input field. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Type</b>, choose the <b>Lambda</b>
                              option. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Lambda Function</b>, copy-paste the full ARN for the
                              Lambda authorizer function that you have in your second account.
                           </p>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>In the Lambda console, you can find the ARN for your function in the
                                 upper right corner of the console window.
                              </p>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p> Leave <b>Lambda Invoke Role</b> blank to let the API Gateway
                              console set a resource-based policy. The policy grants API Gateway permissions to
                              invoke the authorizer Lambda function. You can also choose to type the name
                              of an IAM role to allow API Gateway to invoke the authorizer Lambda function. For
                              an example of such a role, see <a href="integrating-api-with-aws-services-lambda.html#api-as-lambda-proxy-setup-iam-role-policies">Set Up an IAM Role and
                                 Policy for an API to Invoke Lambda Functions</a>. 
                           </p>
                           
                           
                           <p> If you choose to let the API Gateway console set the resource-based policy, the
                              <b>Add Permission to Lambda Function</b> dialog is
                              displayed. Choose <b>OK</b>. After the Lambda authorization is
                              created, you can test it with appropriate authorization token values to
                              verify that it works as expected. 
                           </p>
                           
                           
                        </li>
                        <li>
                           
                           <p>For <b>Lambda Event Payload</b>, choose either
                              <b>Token</b> for a <code class="code">TOKEN</code> authorizer or
                              <b>Request</b> for a <code class="code">REQUEST</code>
                              authorizer.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Depending on the choice you made in the previous step, do one of the
                              following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p> For the <b>Token</b> options, do the following: 
                                 </p>
                                 
                                 <ol>
                                    <li>
                                       
                                       <p>Type the name of a header in <b>Token
                                             Source</b>. The API client must include a header
                                          of this name to send the authorization token to the Lambda
                                          authorizer. 
                                       </p>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>Optionally, provide a RegEx statement in <code class="code">Token
                                             Validation</code> input field. API Gateway performs initial
                                          validation of the input token against this expression and
                                          invokes the authorizer upon successful validation. This
                                          helps reduce chances of being charged for invalid
                                          tokens.
                                       </p>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>For <b>Authorization Caching</b>, select or
                                          clear the <b>Enabled</b> option, depending on
                                          whether you want to cache the authorization policy generated
                                          by the authorizer or not. When policy caching is enabled,
                                          you can choose to modify the <b>TTL</b> value
                                          from the default (300). Setting TTL=0 disables policy
                                          caching. When policy caching is enabled, the header name
                                          specified in <b>Token Source</b> becomes the
                                          cache key.
                                       </p>
                                       
                                    </li>
                                 </ol>
                                 
                              </li>
                              <li>
                                 
                                 <p>For the <b>Request</b> option, do the
                                    following:
                                 </p>
                                 
                                 <ol>
                                    <li>
                                       
                                       <p>For <b>Identity Sources</b>, type a request
                                          parameter name of a chosen parameter type. Supported
                                          parameter types are <code class="code">Header</code>, <code class="code">Query
                                             String</code>, <code class="code">Stage Variable</code>, and
                                          <code class="code">Context</code>. To add more identity sources,
                                          choose <b>Add Identity Source</b>. 
                                       </p>
                                       
                                       
                                       <p>API Gateway uses the specified identity sources as the request
                                          authorizer caching key. When caching is enabled, API Gateway calls
                                          the authorizer&apos;s Lambda function only after successfully
                                          verifying that all the specified identity sources are
                                          present at runtime. If a specified identify source is
                                          missing, null, or empty, API Gateway returns a <code class="code">401
                                             Unauthorized</code> response without calling the
                                          authorizer Lambda function. 
                                       </p>
                                       
                                       
                                       <p>When multiple identity sources are defined, they are all
                                          used to derive the authorizer&apos;s cache key. Changing any of
                                          the cache key parts causes the authorizer to discard the
                                          cached policy document and generate a new one.
                                       </p>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>For <b>Authorization Caching</b>, leave the
                                          <b>Enabled</b> option selected. Leave the
                                          <b>TTL</b> value set to the default
                                          (300).
                                       </p>
                                       
                                    </li>
                                 </ol>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create</b> to create the new Lambda authorizer for
                              the chosen API.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>You&apos;ll see a popup that says <b>Add Permission to Lambda Function:
                                 You have selected a Lambda function from another account. Please ensure
                                 that you have the appropriate Function Policy on this function. You can
                                 do this by running the following AWS CLI command from account
                                 <em class="replaceable"><code>123456789012</code></em>:</b>, followed by an
                              <code class="code">aws lambda add-permission</code> command string.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Copy-paste the <code class="code">aws lambda add-permission</code> command string into
                              an AWS CLI window that is configured for your second account. This will grant
                              your first account access to your second account&apos;s Lambda authorizor
                              function.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the popup from the previous step, choose
                              <b>OK</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="call-api-with-api-gateway-lambda-authorization.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="apigateway-integrate-with-cognito.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Configure Cross-Account Lambda Authorizer Using the API Gateway Console"><a class="pagetoc" href="#apigateway-cross-account-lambda-auth-configure-cross-account-authorizer">Configure Cross-Account Lambda Authorizer Using the API Gateway Console</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>