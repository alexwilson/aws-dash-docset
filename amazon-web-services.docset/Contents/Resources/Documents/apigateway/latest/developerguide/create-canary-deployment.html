<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Create a Canary Release Deployment - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="canary-release.html" title="Set up an API Gateway Canary Release
            Deployment">
      <link rel="prev" href="canary-release.html" title="Set up an API Gateway Canary Release
            Deployment">
      <link rel="next" href="update-canary-deployment.html" title="Update a Canary Release ">
      <meta name="description" content="You create a canary release deployment when deploying the API with canary settings as an additional input to the deployment creation operation.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/create-canary-deployment.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/apigateway">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="how-to-deploy-api.html">Deploying an API in Amazon API Gateway</a> &#xBB; <a href="canary-release.html">Set up an API Gateway Canary Release
                                    Deployment</a> &#xBB; <span class="breadcrumb">Create a Canary Release Deployment</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="create-canary-deployment">Create a Canary Release Deployment</h1>
                     <p>You create a canary release deployment when deploying the API with <a href="./apigateway/api-reference/link-relation/deployment-create/#canarySettings" target="_blank">canary
                           settings</a> as an additional input to the <a href="./apigateway/api-reference/link-relation/deployment-create/" target="_blank">deployment creation</a>
                        operation. 
                     </p>
                     <p>You can also create a canary release deployment from an existing non-canary deployment
                        by making a <a href="./apigateway/api-reference/link-relation/stage-update/" target="_blank"><code class="code">stage:update</code></a> request to add the canary settings on the
                        stage.
                     </p>
                     <p>When creating a non-canary release deployment, you can specify a non-existing stage
                        name. API Gateway creates one if the specified stage does not exist. However, you
                        cannot
                        specify any non-existing stage name when creating a canary release deployment. You
                        will
                        get an error and API Gateway will not create any canary release deployment. 
                     </p>
                     <p> You can create a canary release deployment in API Gateway using the API Gateway console,
                        AWS CLI,
                        an AWS SDK, and the API Gateway REST API.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#create-canary-deployment-using-console">Create a Canary Deployment Using the API Gateway Console</a></li>
                           <li><a href="#create-canary-deployment-using-cli">Create a Canary Deployment
                                 Using the AWS CLI</a></li>
                           <li><a href="#create-canary-deployment-using-api">Create a Canary Deployment
                                 Using the API Gateway API</a></li>
                        </ul>
                     </div>
                     
                     <h2 id="create-canary-deployment-using-console">Create a Canary Deployment Using the API Gateway Console</h2>
                     
                     <p>To use the API Gateway console to create a canary release deployment, follow the
                        instructions below:
                     </p>
                     <a id="to-create-canary-release-on-new-deployment"></a><p class="title"><b>To create the initial
                           canary release deployment</b></p>
                     <ol>
                        <li>
                           
                           <p> Sign in to the API Gateway console.</p>
                           
                        </li>
                        <li>
                           
                           <p> Choose an existing API or create a new API.</p>
                           
                        </li>
                        <li>
                           
                           <p> Change the API, if necessary, or set up desired API methods and
                              integrations.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose <b>Deploy API</b> from the
                              <b>Actions</b> drop-down menu. Follow the on-screen
                              instructions in <b>Deploy API</b> to deploy the API to a new
                              stage. 
                           </p>
                           
                           <p>So far, you have deployed the API to a production release stage. Next, you
                              configure canary settings on the stage and, if needed, also enable caching,
                              set stage variables, or configure API execution or access logs.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> To enable API caching, choose the <b>Settings</b> tab in
                              <b>Stage Editor</b> and follow the on-screen instructions.
                              For more information, see <a href="api-gateway-caching.html">Enable API Caching to Enhance Responsiveness</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>To set stage variables, choose the <b>Stage Variables</b>
                              tab in <b>Stage Editor</b> and follow the on-screen
                              instructions to add or modify stage variables. For more information, see
                              <a href="stage-variables.html">Set up Stage Variable for API Deployment</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> To configure execution or access logging, choose the
                              <b>Logs</b> tab in <b>Stage Editor</b> and
                              follow the on-screen instructions. For more information, see <a href="set-up-logging.html">Set up API Logging in API Gateway</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> In <b>Stage Editor</b>, choose the
                              <b>Canary</b> tab and then choose <b>Create
                                 Canary</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Under the <b>Stage&apos;s Request Distribution</b> section,
                              choose the pencil icon next to <b>Percentage of requests to
                                 Canary</b> and type a number (for example, <code class="code">5.0</code>) in
                              the input text field. Choose the check mark icon to save the setting.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>If needed, choose <b>Add Stage Variables</b> to add them
                              under the <b>Canary Stage Variables</b> section to override
                              existing stage variables or add new stage variables for the canary release. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>If desired, choose <b>Enable use of stage cache</b> to
                              enable caching for the canary release and save your choice. The cache is not
                              available for the canary release until API caching is enabled.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <p>After the canary release is initialized on the deployment stage, you change the
                        API and want to test the changes. You can redeploy the API to the same stage so that
                        both the updated version and the base version are accessible through the same stage.
                        The following steps describe how to do that. 
                     </p>
                     <a id="to-deploy-latest-api-to-canary-release"></a><p class="title"><b>To deploy the latest API
                           version to a canary</b></p>
                     <ol>
                        <li>
                           
                           <p> With each update of the API, choose <b>Deploy API</b> from
                              the <b>Actions</b> drop-down menu next to the
                              <b>Resources</b> list.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> In <b>Deploy API</b>, choose the now canary-enabled stage
                              from the <b>Deployment stage</b> drop-down list. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Optionally, type a description in <b> Deployment
                                 description</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Choose <b>Deploy</b> to push the latest API version to the
                              canary release. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> If desired, reconfigure the stage settings, logs, or canary settings, as
                              describe in <a href="create-canary-deployment.html#to-create-canary-release-on-new-deployment">To create the initial
                                 canary release deployment</a>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p> As a result, the canary release points to the latest version while the production
                        release still points to the initial version of the API. The <a href="./apigateway/api-reference/resource/stage/#canarySettings" target="_blank"><b>canarySettings</b></a> now has a new
                        <b>deploymentId</b> value, whereas the stage still has the initial
                        <a href="./apigateway/api-reference/resource/stage/#deploymentId" target="_blank"><b>deploymentId</b></a> value. Behind the scenes, the
                        console calls <a href="./apigateway/api-reference/link-relation/stage-update/" target="_blank"><b>stage:update</b></a>.
                     </p>
                     
                     
                     <h2 id="create-canary-deployment-using-cli">Create a Canary Deployment
                        Using the AWS CLI
                     </h2>
                     
                     <p>First create a baseline deployment with two stage variables, but without any
                        canary:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigateway create-deployment 
    --variables sv0=val0,sv1=val1
    --rest-api-id 4wk1k4onj3 
    --stage-name prod</code></pre>
                     <p>The command returns a representation of the resulting <a href="./apigateway/api-reference/resource/deployment/" target="_blank"><code class="code">Deployment</code></a>, similar
                        to the following:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;id&quot;: &quot;du4ot1&quot;, 
    &quot;createdDate&quot;: 1511379050
}</code></pre>
                     <p>The resulting deployment <code class="code">id</code> identifies a snapshot (or version) of the
                        API. 
                     </p>
                     
                     <p>Now create a canary deployment on the <code class="code">prod</code> stage: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigateway create-deployment  
    --canary-settings &apos;{ \
        &quot;percentTraffic&quot;:10.5, \
        &quot;useStageCache&quot;:false, \
        &quot;stageVariableOverrides&quot;:{ \
            &quot;sv1&quot;:&quot;val2&quot;,  \
            &quot;sv2&quot;:&quot;val3&quot; \
        } \ 
    }&apos; \
    --rest-api-id 4wk1k4onj3 \
    --stage-name prod</code></pre>
                     
                     <p>If the specified stage (<code class="code">prod</code>) does not exist, the preceding command
                        returns an error. Otherwise, it returns the newly created <a href="./apigateway/api-reference/resource/deployment/" target="_blank">deployment</a> resource
                        representation similar to the following:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;id&quot;: &quot;a6rox0&quot;, 
    &quot;createdDate&quot;: 1511379433
}</code></pre>
                     <p>The resulting deployment <code class="code">id</code> identifies the test version of the API
                        for the canary release. As a result, the associated stage is canary-enabled. You can
                        view this stage representation by calling the <code class="code">get-stage</code> command,
                        similar to the following:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigateway get-stage --rest-api-id 4wk1k4onj3 --stage-name prod</code></pre>
                     <p>The following shows a representation of the <code class="code">Stage</code> as the output of
                        the command:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;stageName&quot;: &quot;prod&quot;, 
    &quot;variables&quot;: {
        &quot;sv0&quot;: &quot;val0&quot;, 
        &quot;sv1&quot;: &quot;val1&quot;
    }, 
    &quot;cacheClusterEnabled&quot;: false, 
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;, 
    &quot;deploymentId&quot;: &quot;du4ot1&quot;, 
    &quot;lastUpdatedDate&quot;: 1511379433, 
    &quot;createdDate&quot;: 1511379050, 
    &quot;canarySettings&quot;: {
        &quot;percentTraffic&quot;: 10.5, 
        &quot;deploymentId&quot;: &quot;a6rox0&quot;, 
        &quot;useStageCache&quot;: false, 
        &quot;stageVariableOverrides&quot;: {
            &quot;sv2&quot;: &quot;val3&quot;, 
            &quot;sv1&quot;: &quot;val2&quot;
        }
    }, 
    &quot;methodSettings&quot;: {}
}</code></pre>
                     <p>In this example, the base version of the API will use the stage variables of
                        <code class="code">{&quot;sv0&quot;:val0&quot;, &quot;sv1&quot;:val1&quot;}</code>, while the test version uses the stage
                        variables of <code class="code">{&quot;sv1&quot;:val2&quot;, &quot;sv2&quot;:val3&quot;}</code>. Both the production release
                        and canary release use the same stage variable of <code class="code">sv1</code>, but with
                        different values, <code class="code">val1</code> and <code class="code">val2</code>, respectively. The stage
                        variable of <code class="code">sv0</code> is used solely in the production release and the stage
                        variable of <code class="code">sv2</code> is used in the canary release only. 
                     </p>
                     
                     <p>You can create a canary release deployment from an existing regular deployment by
                        updating the stage to enable a canary. To demonstrate this, create a regular
                        deployment first:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigateway create-deployment \
    --variables sv0=val0,sv1=val1 \  
    --rest-api-id 4wk1k4onj3 \
    --stage-name beta</code></pre>
                     <p>The command returns a representation of the base version deployment:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;id&quot;: &quot;cifeiw&quot;, 
    &quot;createdDate&quot;: 1511380879
}</code></pre>
                     <p>The associated beta stage does not have any canary settings:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;stageName&quot;: &quot;beta&quot;, 
    &quot;variables&quot;: {
        &quot;sv0&quot;: &quot;val0&quot;, 
        &quot;sv1&quot;: &quot;val1&quot;
    }, 
    &quot;cacheClusterEnabled&quot;: false, 
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;, 
    &quot;deploymentId&quot;: &quot;cifeiw&quot;, 
    &quot;lastUpdatedDate&quot;: 1511380879, 
    &quot;createdDate&quot;: 1511380879, 
    &quot;methodSettings&quot;: {}
}</code></pre>
                     <p>Now, create a new canary release deployment by attaching a canary on the
                        stage:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigateway update-stage  \
    --patch-operations &apos;[{ \
        &quot;op&quot;:&quot;replace&quot;, \
        &quot;path&quot;:&quot;/canarySettings/percentTraffic&quot;, \
        &quot;value&quot;:&quot;10.5&quot; \
    },{ \
        &quot;op&quot;:&quot;replace&quot;, \
        &quot;path&quot;:&quot;/canarySettings/useStageCache&quot;, \
        &quot;value&quot;:&quot;false&quot; \
    },{ \
        &quot;op&quot;:&quot;replace&quot;, \
        &quot;path&quot;:&quot;/canarySettings/stageVariableOverrides/sv1&quot;, \
        &quot;value&quot;:&quot;val2&quot; \
    },{ \
        &quot;op&quot;:&quot;replace&quot;, \
        &quot;path&quot;:&quot;/canarySettings/stageVariableOverrides/sv2&quot;, \
        &quot;value&quot;:&quot;val3&quot; \
    }]&apos; \
    --rest-api-id 4wk1k4onj3  \
    --stage-name beta</code></pre>
                     <p>A representation of the updated stage looks like this:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;stageName&quot;: &quot;beta&quot;, 
    &quot;variables&quot;: {
        &quot;sv0&quot;: &quot;val0&quot;, 
        &quot;sv1&quot;: &quot;val1&quot;
    }, 
    &quot;cacheClusterEnabled&quot;: false, 
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;, 
    &quot;deploymentId&quot;: &quot;<b>cifeiw</b>&quot;, 
    &quot;lastUpdatedDate&quot;: 1511381930, 
    &quot;createdDate&quot;: 1511380879, 
    &quot;canarySettings&quot;: {
        &quot;percentTraffic&quot;: 10.5, 
        &quot;deploymentId&quot;: &quot;<b>cifeiw</b>&quot;, 
        &quot;useStageCache&quot;: false, 
        &quot;stageVariableOverrides&quot;: {
            &quot;sv2&quot;: &quot;val3&quot;, 
            &quot;sv1&quot;: &quot;val2&quot;
        }
    }, 
    &quot;methodSettings&quot;: {}
}</code></pre>
                     <p>Because we just enabled a canary on an existing version of the API, both the
                        production release (<code class="code">Stage</code>) and canary release
                        (<code class="code">canarySettings</code>) point to the same deployment, i.e., the same
                        version (<code class="code">deploymentId</code>) of the API. After you change the API and deploy
                        it to this stage again, the new version will be in the canary release, while the
                        base version remains in the production release. This is manifested in the stage
                        evolution when the <code class="code">deploymentId</code> in the canary release is updated to the
                        new deployment <code class="code">id</code> and the <code class="code">deploymentId</code> in the production
                        release remains unchanged.
                     </p>
                     
                     
                     
                     <h2 id="create-canary-deployment-using-api">Create a Canary Deployment
                        Using the API Gateway API
                     </h2>
                     
                     <p>To use the API Gateway REST API to deploy your API as a canary release, call <a href="./apigateway/api-reference/link-relation/deployment-create/" target="_blank"><code class="code">deployment:create</code></a>  as follows:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">POST /restapis/fugvjdxtri/deployments HTTP/1.1
Content-Type: application/json
Host: apigateway.us-east-1.amazonaws.com
X-Amz-Date: 20171103T175605Z
Authorization: AWS4-HMAC-SHA256 Credential={SECRET_ACCESS_KEY}/20160603/us-east-1/apigateway/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature={SIGV4_SIGNATURE}

{
  &quot;stageName&quot; : &quot;prod&quot;,
  &quot;stageDescription&quot; : &quot;Production stage&quot;,
  &quot;description&quot; : &quot;Production deployment with canary&quot;,
  &quot;variables&quot; : {
    &quot;sv1&quot; : &quot;val1&quot;
  },
  &quot;canarySettings&quot;: {
    &quot;percentTraffic&quot;: 10.5,
    &quot;useStageCache&quot;: false,
    &quot;stageVariableOverrides&quot;: {
        &quot;sv1&quot;: &quot;val2&quot;,
        &quot;sv2&quot;: &quot;val3&quot;
    }
  }
}</code></pre>
                     <p>If successful, and if this is the first time to deploy the API to the stage, you
                        get a brand new canary release deployment (<code class="code">nfcn0x</code>): 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
        ...
    },
    &quot;createdDate&quot;: &quot;2017-11-22T00:54:28Z&quot;,
    &quot;description&quot;: &quot;Production deployment with canary&quot;,
    &quot;id&quot;: &quot;nfcn0x&quot;
}</code></pre>
                     <p>In this deployment, both the stage and the canary have the same
                        <code class="code">deploymentId</code>. That is, they both reference the same API version. 
                     </p>
                     
                     <p>In any subsequent API deployments to the same stage, you must always specify
                        <code class="code">canarySettings</code> as an input, until the canary is disabled on that
                        stage. For example, when you call the previous <code class="code">deployment:create</code>
                        request the second time, you get a new deployment (<code class="code">eh1sby</code>) as the
                        result:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
        ...
    },
    &quot;createdDate&quot;: &quot;2017-11-22T01:24:23Z&quot;,
    &quot;description&quot;: &quot;Production deployment with canary&quot;,
    &quot;id&quot;: &quot;eh1sby&quot;
}</code></pre>
                     <p>The newer <code class="code">deploymentId</code> value is set on the
                        <code class="code">canarySettings</code> and the canary represents the new API version, while
                        the initial <code class="code">deploymentId</code> remains associated with the stage that
                        represents the initial API version. You can verify this by calling the <a href="./apigateway/api-reference/link-relation/stage-by-name/" target="_blank"><code class="code">GET
                              /restapis/fugvjdxtri/stages/prod</code></a> request and examining the
                        successful response payload:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
        ...
    },
    &quot;accessLogSettings&quot;: {
        ...
    },
    &quot;cacheClusterEnabled&quot;: false,
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;,
    &quot;canarySettings&quot;: {
        <b>&quot;deploymentId&quot;: &quot;eh1sby&quot;</b>,
        &quot;useStageCache&quot;: false,
        &quot;stageVariableOverrides&quot;: {
            &quot;sv2&quot;: &quot;val3&quot;,
            &quot;sv1&quot;: &quot;val2&quot;
        },
        &quot;percentTraffic&quot;: 10.5
    },
    &quot;createdDate&quot;: &quot;2017-11-20T04:42:19Z&quot;,
    <b>&quot;deploymentId&quot;: &quot;nfcn0x&quot;</b>,
    &quot;lastUpdatedDate&quot;: &quot;2017-11-22T00:54:28Z&quot;,
    &quot;methodSettings&quot;: {
        &quot;*/*&quot;: {
            &quot;dataTraceEnabled&quot;: true,
            &quot;throttlingRateLimit&quot;: 10000,
            &quot;cacheTtlInSeconds&quot;: 300,
            &quot;cachingEnabled&quot;: false,
            &quot;requireAuthorizationForCacheControl&quot;: true,
            &quot;metricsEnabled&quot;: true,
            &quot;loggingLevel&quot;: &quot;INFO&quot;,
            &quot;unauthorizedCacheControlHeaderStrategy&quot;: &quot;SUCCEED_WITH_RESPONSE_HEADER&quot;,
            &quot;throttlingBurstLimit&quot;: 5000,
            &quot;cacheDataEncrypted&quot;: false
        }
    },
    &quot;stageName&quot;: &quot;canary&quot;,
    &quot;variables&quot;: {
        &quot;sv1&quot;: &quot;val1&quot;
    }
}</code></pre>
                     <p>For a regular production deployment without a canary enabled on the associated
                        stage, you can turn the deployment into a canary release deployment by enabling the
                        canary on the stage. To do this, call <a href="./apigateway/api-reference/link-relation/stage-update/" target="_blank"><code class="code">stage:update</code></a>, as shown in the following, assuming the original
                        deployment ID is <code class="code">ghdx4w</code>:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">PATCH /restapis/4wk1k4onj3/stages/prod HTTP/1.1
Host: apigateway.us-east-1.amazonaws.com
Content-Type: application/json
X-Amz-Date: 20171121T232431Z
Authorization: AWS4-HMAC-SHA256 Credential={SECRET_ACCESS_KEY}/20171121/us-east-1/apigateway/aws4_request, SignedHeaders=content-length;content-type;host;x-amz-date, Signature={SIGV4_SIGNATURE}

{
	&quot;patchOperations&quot;: [
		{
			&quot;op&quot;: &quot;replace&quot;,
			&quot;path&quot;: &quot;/canarySettings/deploymentId&quot;,
			&quot;value&quot;: &quot;ghdx4w&quot;
		},
		{
			&quot;op&quot;: &quot;replace&quot;,
			&quot;path&quot;: &quot;/canarySettings/percentTraffic&quot;,
			&quot;value&quot;: &quot;15.0&quot;
		}
	]
} </code></pre>
                     <p>Because the original deployment is without a canary release, we set the
                        <code class="code">/canarysettings/deploymentId</code> value to the <code class="code">deploymentId</code>
                        (<code class="code">&quot;ghdx4w&quot;</code>) associated with the deployment stage. 
                     </p>
                     
                     <p>The successful response returns a payload similar to the following:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;_links&quot;: {
         ...
    },
    &quot;accessLogSettings&quot;: {
        ...
    },
    &quot;cacheClusterEnabled&quot;: false,
    &quot;cacheClusterStatus&quot;: &quot;NOT_AVAILABLE&quot;,
    &quot;canarySettings&quot;: {
        &quot;deploymentId&quot;: &quot;<b>ghdx4w</b>&quot;,
        &quot;useStageCache&quot;: false,
        &quot;stageVariableOverrides&quot;: null,
        &quot;percentTraffic&quot;: 15
    },
    &quot;createdDate&quot;: &quot;2017-11-20T04:42:19Z&quot;,
    &quot;deploymentId&quot;: &quot;<b>ghdx4w</b>&quot;,
    &quot;lastUpdatedDate&quot;: &quot;2017-11-21T23:24:31Z&quot;,
    &quot;methodSettings&quot;: {
        &quot;*/*&quot;: {
            &quot;dataTraceEnabled&quot;: true,
            &quot;throttlingRateLimit&quot;: 10000,
            &quot;cacheTtlInSeconds&quot;: 300,
            &quot;cachingEnabled&quot;: false,
            &quot;requireAuthorizationForCacheControl&quot;: true,
            &quot;metricsEnabled&quot;: true,
            &quot;loggingLevel&quot;: &quot;INFO&quot;,
            &quot;unauthorizedCacheControlHeaderStrategy&quot;: &quot;SUCCEED_WITH_RESPONSE_HEADER&quot;,
            &quot;throttlingBurstLimit&quot;: 5000,
            &quot;cacheDataEncrypted&quot;: false
        }
    },
    &quot;stageName&quot;: &quot;prod&quot;
}</code></pre>
                     <p>With a canary enabled on the stage, the deployment becomes a canary release
                        deployment. The stage cannot be associated with any non-canary deployment until the
                        canary settings are removed from the stage.
                     </p>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="canary-release.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="update-canary-deployment.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Create a Canary Deployment Using the API Gateway Console"><a class="pagetoc" href="#create-canary-deployment-using-console">Create a Canary Deployment Using the API Gateway Console</a></li>
                        <li class="pagetoc" name="Create a Canary Deployment
                    Using the AWS CLI"><a class="pagetoc" href="#create-canary-deployment-using-cli">Create a Canary Deployment
                              Using the AWS CLI</a></li>
                        <li class="pagetoc" name="Create a Canary Deployment
                    Using the API Gateway API"><a class="pagetoc" href="#create-canary-deployment-using-api">Create a Canary Deployment
                              Using the API Gateway API</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>