<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Walkthrough: Updating a Stack - AWS CloudFormation</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="GettingStarted.html" title="Getting Started with AWS CloudFormation">
      <link rel="prev" href="gettingstarted.templatebasics.html" title="Learn Template Basics">
      <link rel="next" href="best-practices.html" title="AWS CloudFormation Best Practices">
      <meta name="description" content="Walk through a simple progression of updates to a running stack with AWS CloudFormation.">
      <meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation Designer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="AWS CloudFormation">
      <meta name="guide" content="User Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/updating.stacks.walkthrough.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/cloudformation">AWS CloudFormation</a> &#xBB; <a href="index.html">User Guide</a> &#xBB; <a href="GettingStarted.html">Getting Started with AWS CloudFormation</a> &#xBB; <span class="breadcrumb">Walkthrough: Updating a Stack</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="updating.stacks.walkthrough">Walkthrough: Updating a Stack</h1>
                     <p>With AWS CloudFormation, you can update the properties for resources in your existing
                        stacks. These
                        changes can range from simple configuration changes, such as updating the alarm threshold
                        on a
                        CloudWatch alarm, to more complex changes, such as updating the Amazon Machine Image
                        (AMI)
                        running on an Amazon EC2 instance. Many of the AWS resources in a template can be
                        updated, and
                        we continue to add support for more.
                     </p>
                     <p>This section walks through a simple progression of updates of a running stack. It
                        shows how
                        the use of templates makes it possible to use a version control system for the configuration
                        of
                        your AWS infrastructure, just as you use version control for the software you are
                        running. We
                        will walk through the following steps:
                     </p>
                     <div class="orderedlist">
                        
                        
                        
                        
                        
                        
                        
                        <ol>
                           <li>
                              
                              <p><a href="updating.stacks.walkthrough.html#updating.create.initial.stack">Create the Initial Stack</a>&#x2014;create a stack using a base Amazon
                                 Linux AMI, installing the Apache Web Server and a simple PHP application using the
                                 AWS CloudFormation
                                 helper scripts.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p><a href="updating.stacks.walkthrough.html#update.application">Update the Application</a>&#x2014;update one
                                 of the files in the application and deploy the software using AWS CloudFormation.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>
                                 <a href="updating.stacks.walkthrough.html#update.walkthrough.instance.type">Update the Instance Type</a>&#x2014;change the instance type of the
                                 underlying Amazon EC2 instance.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>
                                 <a href="updating.stacks.walkthrough.html#update.walkthrough.ami">Update the AMI on an Amazon EC2 instance</a>&#x2014;change
                                 the Amazon Machine Image (AMI) for the Amazon EC2 instance in your stack.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p><a href="updating.stacks.walkthrough.html#update.walkthrough.security.group">Add a Key Pair to an Instance</a>&#x2014;add an Amazon EC2 key pair to
                                 the instance, and then update the security group to allow SSH access to the instance.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p><a href="updating.stacks.walkthrough.html#update.walkthrough.change.resources">Change the Stack&apos;s Resources</a>&#x2014;add and remove resources from
                                 the stack, converting it to an auto-scaled, load-balanced application by updating
                                 the
                                 template.
                              </p>
                              
                           </li>
                        </ol>
                     </div>
                     <h2 id="updating.simple.application">A Simple Application</h2>
                     
                     
                     <p>We&apos;ll begin by creating a stack that we can use throughout the rest of this section.
                        We
                        have provided a simple template that launches a single instance PHP web application
                        hosted on
                        the Apache Web Server and running on an Amazon Linux AMI.
                     </p>
                     
                     <p>The Apache Web Server, PHP, and the simple PHP application are all installed by the
                        AWS
                        CloudFormation helper scripts that are installed by default on the Amazon Linux AMI.
                        The
                        following template snippet shows the metadata that describes the packages and files
                        to
                        install, in this case the Apache Web Server and the PHP infrastructure from the Yum
                        repository
                        for the Amazon Linux AMI. The snippet also shows the Services section, which ensures
                        that the
                        Apache Web Server is running. In the Properties section of the Amazon EC2 instance
                        definition, the
                        UserData property contains the CloudInit script that calls cfn-init to install the
                        packages
                        and files.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">
  &quot;WebServerInstance&quot;: {
    &quot;Type&quot; : &quot;AWS::EC2::Instance&quot;,
    &quot;Metadata&quot; : {
      &quot;AWS::CloudFormation::Init&quot; : {
        &quot;config&quot; : {
          &quot;packages&quot; : {
            &quot;yum&quot; : {
              &quot;httpd&quot;             : [],
              &quot;php&quot;               : []
            }
          },

          &quot;files&quot; : {

            &quot;/var/www/html/index.php&quot; : {
              &quot;content&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
                &quot;&lt;?php\n&quot;,
                &quot;echo &apos;&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;&apos;;\n&quot;,
                &quot;echo &apos;&lt;p&gt;&quot;, { &quot;Ref&quot; : &quot;WelcomeMessage&quot; }, &quot;&lt;/p&gt;&apos;;\n&quot;,
                &quot;?&gt;\n&quot;
              ]]},
              &quot;mode&quot;    : &quot;000644&quot;,
              &quot;owner&quot;   : &quot;apache&quot;,
              &quot;group&quot;   : &quot;apache&quot;
            },
          },

          :

          &quot;services&quot; : {
            &quot;sysvinit&quot; : {
              &quot;httpd&quot;    : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot; }
            }
          }
        }
      }
    },

    &quot;Properties&quot;: {
      :
      &quot;UserData&quot;       : { &quot;Fn::Base64&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
        &quot;#!/bin/bash\n&quot;,
        &quot;yum install -y aws-cfn-bootstrap\n&quot;,

        :

        &quot;# Install the files and packages from the metadata\n&quot;,
        &quot;/opt/aws/bin/cfn-init -v &quot;,
        &quot;         --stack &quot;, { &quot;Ref&quot; : &quot;AWS::StackName&quot; },
        &quot;         --resource WebServerInstance &quot;,
        &quot;         --region &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;, 
        :
      ]]}}
    }
  },     </code></pre>
                     <p>The application itself is a very simple two-line &quot;Hello, World&quot; example that is entirely
                        defined within the template. For a real-world application, the files may be stored
                        on Amazon S3,
                        GitHub, or another repository and referenced from the template. AWS CloudFormation
                        can
                        download packages (such as RPMs or RubyGems), as well as reference individual files
                        and expand
                        <code>.zip</code> and <code>.tar</code> files to create the application
                        artifacts on the Amazon EC2 instance.
                     </p>
                     
                     <p>The template enables and configures the cfn-hup daemon to listen for changes to the
                        configuration defined in the metadata for the Amazon EC2 instance. By using the cfn-hup
                        daemon, you
                        can update application software, such as the version of Apache or PHP, or you can
                        update the
                        PHP application file itself from AWS CloudFormation. The following snippet from the
                        same Amazon EC2 resource in
                        the template shows the pieces necessary to configure cfn-hup to call cfn-init to update
                        the
                        software if any changes to the metadata are detected:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">
  &quot;WebServerInstance&quot;: {
    &quot;Type&quot; : &quot;AWS::EC2::Instance&quot;,
    &quot;Metadata&quot; : {
      &quot;AWS::CloudFormation::Init&quot; : {
        &quot;config&quot; : {

            :

          &quot;files&quot; : {

            :

            &quot;/etc/cfn/cfn-hup.conf&quot; : {
              &quot;content&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
                &quot;[main]\n&quot;,
                &quot;stack=&quot;, { &quot;Ref&quot; : &quot;AWS::StackName&quot; }, &quot;\n&quot;,
                &quot;region=&quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;
              ]]},
              &quot;mode&quot;    : &quot;000400&quot;,
              &quot;owner&quot;   : &quot;root&quot;,
              &quot;group&quot;   : &quot;root&quot;
            },

            &quot;/etc/cfn/hooks.d/cfn-auto-reloader.conf&quot; : {
              &quot;content&quot;: { &quot;Fn::Join&quot; : [&quot;&quot;, [
                &quot;[cfn-auto-reloader-hook]\n&quot;,
                &quot;triggers=post.update\n&quot;,
                &quot;path=Resources.WebServerInstance.Metadata.AWS::CloudFormation::Init\n&quot;,
                &quot;action=/opt/aws/bin/cfn-init -s &quot;, { &quot;Ref&quot; : &quot;AWS::StackId&quot; }, &quot; -r WebServerInstance &quot;,
                &quot; --region     &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;,  
                &quot;runas=root\n&quot;
              ]]}
            }
          },
          :
    },

    &quot;Properties&quot;: {

         :

      &quot;UserData&quot;       : { &quot;Fn::Base64&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [

        :

        &quot;# Start up the cfn-hup daemon to listen for changes to the Web Server metadata\n&quot;,
        &quot;/opt/aws/bin/cfn-hup || error_exit &apos;Failed to start cfn-hup&apos;\n&quot;,  

        :
      ]]}}
    }
  },     </code></pre>
                     <p>To complete the stack, the template creates an Amazon EC2 security group.</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">{
  &quot;AWSTemplateFormatVersion&quot; : &quot;2010-09-09&quot;,

  &quot;Description&quot; : &quot;AWS CloudFormation Sample Template: Sample template that can be used to test EC2 updates. **WARNING** This template creates an Amazon Ec2 Instance. You will be billed for the AWS resources used if you create a stack from this template.&quot;,
  
  &quot;Parameters&quot; : {
          
    &quot;InstanceType&quot; : {
      &quot;Description&quot; : &quot;WebServer EC2 instance type&quot;,
      &quot;Type&quot; : &quot;String&quot;,
      &quot;Default&quot; : &quot;m1.small&quot;,
      &quot;AllowedValues&quot; : [ &quot;t1.micro&quot;, &quot;t2.micro&quot;, &quot;t2.small&quot;, &quot;t2.medium&quot;, &quot;m1.small&quot;, &quot;m1.medium&quot;, &quot;m1.large&quot;, &quot;m1.xlarge&quot;, &quot;m2.xlarge&quot;,
&quot;m2.2xlarge&quot;, &quot;m2.4xlarge&quot;, &quot;m3.medium&quot;, &quot;m3.large&quot;, &quot;m3.xlarge&quot;, &quot;m3.2xlarge&quot;, &quot;c1.medium&quot;, &quot;c1.xlarge&quot;, &quot;c3.large&quot;, &quot;c3.xlarge&quot;, &quot;c3.2xlarge&quot;,
&quot;c3.4xlarge&quot;, &quot;c3.8xlarge&quot;, &quot;g2.2xlarge&quot;, &quot;r3.large&quot;, &quot;r3.xlarge&quot;, &quot;r3.2xlarge&quot;, &quot;r3.4xlarge&quot;, &quot;r3.8xlarge&quot;, &quot;i2.xlarge&quot;, &quot;i2.2xlarge&quot;, &quot;i2.4xlarge&quot;,
&quot;i2.8xlarge&quot;, &quot;hi1.4xlarge&quot;, &quot;hs1.8xlarge&quot;, &quot;cr1.8xlarge&quot;, &quot;cc2.8xlarge&quot;, &quot;cg1.4xlarge&quot;],
      &quot;ConstraintDescription&quot; : &quot;must be a valid EC2 instance type.&quot;
    }
  },
  
  &quot;Mappings&quot; : {
    &quot;AWSInstanceType2Arch&quot; : {
      &quot;t1.micro&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;t2.micro&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;t2.small&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;t2.medium&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m1.small&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.medium&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.large&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.4xlarge&quot;  : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m3.medium&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c1.medium&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;c1.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;c3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;g2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVMG2&quot;  },
      &quot;r3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;hi1.4xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;hs1.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;cr1.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;cc2.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  }
    },

    &quot;AWSRegionArch2AMI&quot; : {
      &quot;us-east-1&quot;      : { &quot;PV64&quot; : &quot;ami-50842d38&quot;, &quot;HVM64&quot; : &quot;ami-08842d60&quot;, &quot;HVMG2&quot; : &quot;ami-3a329952&quot;  },
      &quot;us-west-2&quot;      : { &quot;PV64&quot; : &quot;ami-af86c69f&quot;, &quot;HVM64&quot; : &quot;ami-8786c6b7&quot;, &quot;HVMG2&quot; : &quot;ami-47296a77&quot;  },
      &quot;us-west-1&quot;      : { &quot;PV64&quot; : &quot;ami-c7a8a182&quot;, &quot;HVM64&quot; : &quot;ami-cfa8a18a&quot;, &quot;HVMG2&quot; : &quot;ami-331b1376&quot;  },
      &quot;eu-west-1&quot;      : { &quot;PV64&quot; : &quot;ami-aa8f28dd&quot;, &quot;HVM64&quot; : &quot;ami-748e2903&quot;, &quot;HVMG2&quot; : &quot;ami-00913777&quot;  },
      &quot;ap-southeast-1&quot; : { &quot;PV64&quot; : &quot;ami-20e1c572&quot;, &quot;HVM64&quot; : &quot;ami-d6e1c584&quot;, &quot;HVMG2&quot; : &quot;ami-fabe9aa8&quot;  },
      &quot;ap-northeast-1&quot; : { &quot;PV64&quot; : &quot;ami-21072820&quot;, &quot;HVM64&quot; : &quot;ami-35072834&quot;, &quot;HVMG2&quot; : &quot;ami-5dd1ff5c&quot;  },
      &quot;ap-southeast-2&quot; : { &quot;PV64&quot; : &quot;ami-8b4724b1&quot;, &quot;HVM64&quot; : &quot;ami-fd4724c7&quot;, &quot;HVMG2&quot; : &quot;ami-e98ae9d3&quot;  },
      &quot;sa-east-1&quot;      : { &quot;PV64&quot; : &quot;ami-9d6cc680&quot;, &quot;HVM64&quot; : &quot;ami-956cc688&quot;, &quot;HVMG2&quot; : &quot;NOT_SUPPORTED&quot; },
      &quot;cn-north-1&quot;     : { &quot;PV64&quot; : &quot;ami-a857c591&quot;, &quot;HVM64&quot; : &quot;ami-ac57c595&quot;, &quot;HVMG2&quot; : &quot;NOT_SUPPORTED&quot; },
      &quot;eu-central-1&quot;   : { &quot;PV64&quot; : &quot;ami-a03503bd&quot;, &quot;HVM64&quot; : &quot;ami-b43503a9&quot;, &quot;HVMG2&quot; : &quot;ami-b03503ad&quot;  }
    }
  },
    
  &quot;Resources&quot; : {   

    &quot;WebServerInstance&quot;: {  
      &quot;Type&quot; : &quot;AWS::EC2::Instance&quot;,
      &quot;Metadata&quot; : {
        &quot;Comment&quot; : &quot;Install a simple PHP application&quot;,
        &quot;AWS::CloudFormation::Init&quot; : {
          &quot;config&quot; : {
            &quot;packages&quot; : {
              &quot;yum&quot; : {
                &quot;httpd&quot;             : [],
                &quot;php&quot;               : []
              }
            },

            &quot;files&quot; : {

              &quot;/var/www/html/index.php&quot; : {
                &quot;content&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
                  &quot;&lt;?php\n&quot;,
                  &quot;echo &apos;&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;&apos;;\n&quot;,
                  &quot;?&gt;\n&quot;
                ]]},
                &quot;mode&quot;    : &quot;000644&quot;,
                &quot;owner&quot;   : &quot;apache&quot;,
                &quot;group&quot;   : &quot;apache&quot;
              },


              &quot;/etc/cfn/cfn-hup.conf&quot; : {
                &quot;content&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
                  &quot;[main]\n&quot;,
                  &quot;stack=&quot;, { &quot;Ref&quot; : &quot;AWS::StackId&quot; }, &quot;\n&quot;,
                  &quot;region=&quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;
                ]]},
                &quot;mode&quot;    : &quot;000400&quot;,
                &quot;owner&quot;   : &quot;root&quot;,
                &quot;group&quot;   : &quot;root&quot;
              },

              &quot;/etc/cfn/hooks.d/cfn-auto-reloader.conf&quot; : {
                &quot;content&quot;: { &quot;Fn::Join&quot; : [&quot;&quot;, [
                  &quot;[cfn-auto-reloader-hook]\n&quot;,
                  &quot;triggers=post.update\n&quot;,
                  &quot;path=Resources.WebServerInstance.Metadata.AWS::CloudFormation::Init\n&quot;,
                  &quot;action=/opt/aws/bin/cfn-init -s &quot;, { &quot;Ref&quot; : &quot;AWS::StackId&quot; }, &quot; -r WebServerInstance &quot;,
                                                   &quot; --region     &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;,
                  &quot;runas=root\n&quot;
                ]]}
              }
            },

            &quot;services&quot; : {
              &quot;sysvinit&quot; : {
                &quot;httpd&quot;    : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot; },
                &quot;cfn-hup&quot; : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot;,
                    &quot;files&quot; : [&quot;/etc/cfn/cfn-hup.conf&quot;, &quot;/etc/cfn/hooks.d/cfn-auto-reloader.conf&quot;]}
              }
            }
          }
        }
      },

      &quot;Properties&quot;: {
        &quot;ImageId&quot; : { &quot;Fn::FindInMap&quot; : [ &quot;AWSRegionArch2AMI&quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; },
                          { &quot;Fn::FindInMap&quot; : [ &quot;AWSInstanceType2Arch&quot;, { &quot;Ref&quot; : &quot;InstanceType&quot; }, &quot;Arch&quot; ] } ] },
        &quot;InstanceType&quot;   : { &quot;Ref&quot; : &quot;InstanceType&quot; },
        &quot;SecurityGroups&quot; : [ {&quot;Ref&quot; : &quot;WebServerSecurityGroup&quot;} ],
        &quot;UserData&quot;       : { &quot;Fn::Base64&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
             &quot;#!/bin/bash -xe\n&quot;,
             &quot;yum install -y aws-cfn-bootstrap\n&quot;,

             &quot;# Install the files and packages from the metadata\n&quot;,
             &quot;/opt/aws/bin/cfn-init -v &quot;,
             &quot;         --stack &quot;, { &quot;Ref&quot; : &quot;AWS::StackName&quot; },
             &quot;         --resource WebServerInstance &quot;,
             &quot;         --region &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;,

             &quot;# Start up the cfn-hup daemon to listen for changes to the Web Server metadata\n&quot;,
             &quot;/opt/aws/bin/cfn-hup || error_exit &apos;Failed to start cfn-hup&apos;\n&quot;,  

             &quot;# Signal the status from cfn-init\n&quot;,
             &quot;/opt/aws/bin/cfn-signal -e $? &quot;,
             &quot;         --stack &quot;, { &quot;Ref&quot; : &quot;AWS::StackName&quot; },
             &quot;         --resource WebServerInstance &quot;,
             &quot;         --region &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;
        ]]}}        
      },
      &quot;CreationPolicy&quot; : {
        &quot;ResourceSignal&quot; : {
          &quot;Timeout&quot; : &quot;PT5M&quot;
        }
      }
    },

    &quot;WebServerSecurityGroup&quot; : {
      &quot;Type&quot; : &quot;AWS::EC2::SecurityGroup&quot;,
      &quot;Properties&quot; : {
        &quot;GroupDescription&quot; : &quot;Enable HTTP access via port 80&quot;,
        &quot;SecurityGroupIngress&quot; : [
          {&quot;IpProtocol&quot; : &quot;tcp&quot;, &quot;FromPort&quot; : &quot;80&quot;, &quot;ToPort&quot; : &quot;80&quot;, &quot;CidrIp&quot; : &quot;0.0.0.0/0&quot;}
        ]
      }      
    }          
  },
  
  &quot;Outputs&quot; : {
    &quot;WebsiteURL&quot; : {
      &quot;Description&quot; : &quot;Application URL&quot;,
      &quot;Value&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [&quot;http://&quot;, { &quot;Fn::GetAtt&quot; : [ &quot;WebServerInstance&quot;, &quot;PublicDnsName&quot; ]}]] }
    }
  }
}</code></pre>
                     <p>This example uses a single Amazon EC2 instance, but you can use the same mechanisms
                        on more
                        complex solutions that make use of Elastic Load Balancers and Auto Scaling groups
                        to manage a
                        collection of application servers. There are, however, some special considerations
                        for Auto
                        Scaling groups. For more information, see <a href="updating.stacks.walkthrough.html#updating.autoscaling">Updating Auto Scaling Groups</a>.
                     </p>
                     
                     <h2 id="updating.create.initial.stack">Create the Initial Stack</h2>
                     
                     
                     
                     <p>For the purposes of this example, we&#x2019;ll use the AWS Management Console to create an
                        initial stack from the sample template.
                     </p>
                     
                     <div class="aws-note">
                        <p class="aws-note">Warning</p>
                        <p>Completing this procedure will deploy live AWS services. You will be charged the
                           standard usage rates as long as these services are running.
                        </p>
                     </div>
                     
                     <p class="title"><b>To create the stack from the AWS Management Console</b></p>
                     <ol>
                        <li>
                           
                           <p>Copy the previous template and save it locally on your system as a text file. Note
                              the
                              location because you&apos;ll need to use the file in a subsequent step.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Log in to the AWS CloudFormation console at <a href="https://console.aws.amazon.com/cloudformation" target="_blank">
                                 https://console.aws.amazon.com/cloudformation </a>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Click <b>Create New Stack</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Create New Stack</b> wizard, on the <b>Select
                                 Template</b> screen, type <strong class="userinput"><code>UpdateTutorial</code></strong> in the
                              <b>Name</b> field. On the same page, select <b>Upload a template to
                                 Amazon S3</b> and browse to the file that you downloaded in the first step, and
                              then click <b>Next</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>Specify Parameters</b> screen, in the <b>Instance
                                 Type</b> box, type <strong class="userinput"><code>t1.micro</code></strong>. Then click
                              <b>Next</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>Options</b> screen, click <b>Next</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>Review</b> screen, verify that all the settings are as you
                              want them, and then click <b>Create</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p>After the status of your stack is CREATE_COMPLETE, the output tab will display the
                        URL of
                        your website. If you click the value of the WebsiteURL output, you will see your new
                        PHP
                        application working.
                     </p>
                     
                     <h2 id="update.application">Update the Application</h2>
                     
                     
                     
                     <p>Now that we have deployed the stack, let&apos;s update the application. We&apos;ll make a simple
                        change to the text that is printed out by the application. To do so, we&#x2019;ll add an
                        echo command
                        to the index.php file as shown in this template snippet:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">&quot;WebServerInstance&quot;: {
      &quot;Type&quot; : &quot;AWS::EC2::Instance&quot;,
      &quot;Metadata&quot; : {
        &quot;AWS::CloudFormation::Init&quot; : {
          &quot;config&quot; : {
              :

            &quot;files&quot; : {

              &quot;/var/www/html/index.php&quot; : {
                &quot;content&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
                  &quot;&lt;?php\n&quot;,
                  &quot;echo &apos;&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;&apos;;\n&quot;,
                  <em class="replaceable"><code>&quot;echo &apos;Updated version via UpdateStack&apos;;\n &quot;,</code></em>
                  &quot;?&gt;\n&quot;
                ]]},
                &quot;mode&quot;    : &quot;000644&quot;,
                &quot;owner&quot;   : &quot;apache&quot;,
                &quot;group&quot;   : &quot;apache&quot;
              },

              :

      }
    },</code></pre>
                     <p>Use a text editor to manually edit the template file that you saved locally.</p>
                     
                     <p>Now, we&apos;ll update the stack.</p>
                     
                     
                     <p class="title"><b>To update the stack from the AWS Management Console</b></p>
                     <ol>
                        <li>
                           
                           <p>Log in to the AWS CloudFormation console, at: <a href="https://console.aws.amazon.com/cloudformation" target="_blank">
                                 https://console.aws.amazon.com/cloudformation</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the AWS CloudFormation dashboard, click the stack you created previously, and then
                              click
                              <b>Update Stack</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Update Stack</b> wizard, on the <b>Select
                                 Template</b> screen, select <b>Upload a template to Amazon S3</b>,
                              select the modified template, and then click <b>Next</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>Options</b> screen, click <b>Next</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Click <b>Next</b> because the stack doesn&apos;t have a stack policy. All
                              resources can be updated without an overriding policy.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>Review</b> screen, verify that all the settings are as you
                              want them, and then click <b>Update</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p>If you update the stack from the AWS Management Console, you will notice that the
                        parameters that were
                        used to create the initial stack are prepopulated on the <b>Parameters</b> page
                        of the <b>Update Stack</b> wizard. If you use the
                        <code class="code">aws cloudformation update-stack</code> command, be sure to type in the same values for the
                        parameters that you used originally to create the stack.
                     </p>
                     
                     <p>When your stack is in the UPDATE_COMPLETE state, you can click the WebsiteURL output
                        value
                        again to verify that the changes to your application have taken effect. By default,
                        the
                        cfn-hup daemon runs every 15 minutes, so it may take up to 15 minutes for the application
                        to
                        change once the stack has been updated.
                     </p>
                     
                     <p>To see the set of resources that were updated, go to the AWS CloudFormation console.
                        On the <b>Events</b> tab, look at the stack events. In this particular case, the metadata for the Amazon
                        EC2 instance WebServerInstance was updated, which caused AWS CloudFormation to also
                        reevaluate the other resources (<code class="code">WebServerSecurityGroup</code>) to ensure that there were no other changes. None of the other stack resources were
                        modified. AWS CloudFormation will update only those resources in the stack that are
                        affected
                        by any changes to the stack. Such changes can be direct, such as property or metadata
                        changes, or they can be due to dependencies or data flows through Ref, GetAtt, or
                        other intrinsic template functions.
                     </p>
                     
                     <p>This simple update illustrates the process; however, you can make much more complex
                        changes to the files and packages that are deployed to your Amazon EC2 instances.
                        For example, you
                        might decide that you need to add MySQL to the instance, along with PHP support for
                        MySQL. To
                        do so, simply add the additional packages and files along with any additional services
                        to the
                        configuration and then update the stack to deploy the changes. In the following template
                        snippet, the changes are highlighted in red:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">    &quot;WebServerInstance&quot;: {
      &quot;Type&quot; : &quot;AWS::EC2::Instance&quot;,
      &quot;Metadata&quot; : {
        &quot;Comment&quot; : &quot;Install a simple PHP application&quot;,
        &quot;AWS::CloudFormation::Init&quot; : {
          &quot;config&quot; : {
            &quot;packages&quot; : {
              &quot;yum&quot; : {
                &quot;httpd&quot;             : [],
                &quot;php&quot;               : []<em class="replaceable"><code>,
                &quot;php-mysql&quot;         : [],
                &quot;mysql-server&quot;      : [],
                &quot;mysql-libs&quot;        : [],
                &quot;mysql&quot;             : []</code></em>
              }
            },

            :

            &quot;services&quot; : {
              &quot;sysvinit&quot; : {
                &quot;httpd&quot;    : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot; },
                &quot;cfn-hup&quot; : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot;,
                    &quot;files&quot; : [&quot;/etc/cfn/cfn-hup.conf&quot;, &quot;/etc/cfn/hooks.d/cfn-auto-reloader.conf&quot;]},
                <em class="replaceable"><code>&quot;mysqld&quot;   : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot; }</code></em>
              }
            }
          }
        }
      },

      &quot;Properties&quot;: {
           :
      }
    }
      </code></pre>
                     <p>You can update the CloudFormation metadata to update to new versions of the packages
                        used by the application. In the previous examples, the version property for each package
                        is empty, indicating that cfn-init should install the latest version of the package.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">     &quot;packages&quot; : {
       &quot;yum&quot; : {
         &quot;httpd&quot;             : [],
         &quot;php&quot;               : []
      }</code></pre>
                     <p>You can optionally specify a version string for a package. If you change the version
                        string in subsequent update stack calls, the new version of the package will be deployed.
                        Here&apos;s an example of using version numbers for RubyGems packages. Any package that
                        supports
                        versioning can have specific versions.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">  &quot;packages&quot; : {
    &quot;rubygems&quot; : {
      &quot;mysql&quot;           : [],
      &quot;rubygems-update&quot; : [&quot;1.6.2&quot;],
      &quot;rake&quot;            : [&quot;0.8.7&quot;],
      &quot;rails&quot;           : [&quot;2.3.11&quot;]
    }
    }</code></pre>
                     <h3 id="updating.autoscaling">Updating Auto Scaling Groups</h3>
                     
                     
                     <p>If you are using Auto Scaling groups in your template, as opposed to Amazon EC2 instance
                        resources, updating the application will work in exactly the same way; however, AWS
                        CloudFormation does
                        not provide any synchronization or serialization across the Amazon EC2 instances in
                        an Auto
                        Scaling group. The cfn-hup daemon on each host will run independently and update the
                        application on its own schedule. When you use cfn-hup to update the on-instance
                        configuration, each instance will run the cfn-hup hooks on its own schedule; there
                        is no
                        coordination between the instances in the stack. You should consider the following:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>If the cfn-hup changes run on all Amazon EC2 instances in the Auto Scaling group at
                                 the
                                 same time, your service might be unavailable during the update.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>If the cfn-hup changes run at different times, old and new versions of the software
                                 may be running at the same.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <p>To avoid these issues, consider forcing a rolling update on your instances in the
                        Auto Scaling group. For more information, see <a href="aws-attribute-updatepolicy.html">UpdatePolicy</a>.
                     </p>
                     
                     
                     <h2 id="update.walkthrough.changing.resource.properties">Changing Resource
                        Properties
                     </h2>
                     
                     
                     
                     <p>With AWS CloudFormation, you can change the properties of an existing resource in
                        the stack. The
                        following sections describe various updates that solve specific problems; however,
                        any
                        property of any resource that supports updating in the stack can be modified as
                        necessary.
                     </p>
                     
                     <h3 id="update.walkthrough.instance.type">Update the Instance Type</h3>
                     
                     
                     <p>The stack we have built so far uses a t1.micro Amazon EC2 instance. Let&apos;s suppose
                        that your
                        newly created website is getting more traffic than a t1.micro instance can handle,
                        and now
                        you want to move to an m1.small Amazon EC2 instance type. If the architecture of the
                        instance
                        type changes, the instance will be created with a different AMI. If you check out
                        the
                        mappings in the template, you will see that both the t1.micro and m1.small are the
                        same
                        architectures and use the same Amazon Linux AMIs.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">&quot;Mappings&quot; : {
    &quot;AWSInstanceType2Arch&quot; : {
      &quot;t1.micro&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;t2.micro&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;t2.small&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;t2.medium&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m1.small&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.medium&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.large&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.4xlarge&quot;  : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m3.medium&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c1.medium&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;c1.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;c3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;g2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVMG2&quot;  },
      &quot;r3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;hi1.4xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;hs1.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;cr1.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;cc2.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  }
    },

    &quot;AWSRegionArch2AMI&quot; : {
      &quot;us-east-1&quot;      : { &quot;PV64&quot; : &quot;ami-50842d38&quot;, &quot;HVM64&quot; : &quot;ami-08842d60&quot;, &quot;HVMG2&quot; : &quot;ami-3a329952&quot;  },
      &quot;us-west-2&quot;      : { &quot;PV64&quot; : &quot;ami-af86c69f&quot;, &quot;HVM64&quot; : &quot;ami-8786c6b7&quot;, &quot;HVMG2&quot; : &quot;ami-47296a77&quot;  },
      &quot;us-west-1&quot;      : { &quot;PV64&quot; : &quot;ami-c7a8a182&quot;, &quot;HVM64&quot; : &quot;ami-cfa8a18a&quot;, &quot;HVMG2&quot; : &quot;ami-331b1376&quot;  },
      &quot;eu-west-1&quot;      : { &quot;PV64&quot; : &quot;ami-aa8f28dd&quot;, &quot;HVM64&quot; : &quot;ami-748e2903&quot;, &quot;HVMG2&quot; : &quot;ami-00913777&quot;  },
      &quot;ap-southeast-1&quot; : { &quot;PV64&quot; : &quot;ami-20e1c572&quot;, &quot;HVM64&quot; : &quot;ami-d6e1c584&quot;, &quot;HVMG2&quot; : &quot;ami-fabe9aa8&quot;  },
      &quot;ap-northeast-1&quot; : { &quot;PV64&quot; : &quot;ami-21072820&quot;, &quot;HVM64&quot; : &quot;ami-35072834&quot;, &quot;HVMG2&quot; : &quot;ami-5dd1ff5c&quot;  },
      &quot;ap-southeast-2&quot; : { &quot;PV64&quot; : &quot;ami-8b4724b1&quot;, &quot;HVM64&quot; : &quot;ami-fd4724c7&quot;, &quot;HVMG2&quot; : &quot;ami-e98ae9d3&quot;  },
      &quot;sa-east-1&quot;      : { &quot;PV64&quot; : &quot;ami-9d6cc680&quot;, &quot;HVM64&quot; : &quot;ami-956cc688&quot;, &quot;HVMG2&quot; : &quot;NOT_SUPPORTED&quot; },
      &quot;cn-north-1&quot;     : { &quot;PV64&quot; : &quot;ami-a857c591&quot;, &quot;HVM64&quot; : &quot;ami-ac57c595&quot;, &quot;HVMG2&quot; : &quot;NOT_SUPPORTED&quot; },
      &quot;eu-central-1&quot;   : { &quot;PV64&quot; : &quot;ami-a03503bd&quot;, &quot;HVM64&quot; : &quot;ami-b43503a9&quot;, &quot;HVMG2&quot; : &quot;ami-b03503ad&quot;  }
    }
  }</code></pre>
                     <p>Let&apos;s use the template that we modified in the previous section to change the instance
                        type. Because InstanceType was an input parameter to the template, we don&apos;t need to
                        modify
                        the template; we can simply change the value of the parameter in the Stack Update
                        wizard, on
                        the Specify Parameters page.
                     </p>
                     
                     <p class="title"><b>To update the stack from the AWS Management Console</b></p>
                     <ol>
                        <li>
                           
                           <p>Log in to the AWS CloudFormation console at <a href="https://console.aws.amazon.com/cloudformation" target="_blank">https://console.aws.amazon.com/cloudformation</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the AWS CloudFormation dashboard, click the stack you created previously, and
                              then click <b>Update Stack</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Update Stack</b> wizard, on the <b>Select
                                 Template</b> screen, select <b>Use current template</b>, and then
                              click <b>Next</b>. 
                           </p>
                           
                           <p>The Specify Details page appears with the parameters that were used to create the
                              initial stack are pre-populated in the <b>Specify Parameters</b>
                              section.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Change the value of the <b>InstanceType</b> text box from
                              <code class="code">t1.micro</code> to <code class="code">t2.small</code>. Then, click
                              <b>Next</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>Options</b> screen, click <b>Next</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Click <b>Next</b> because the stack doesn&apos;t have a stack policy. All
                              resources can be updated without an overriding policy.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>Review</b> screen, verify that all the settings are as you
                              want them, and then click <b>Update</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p>You can dynamically change the instance type of an EBS-backed Amazon EC2 instance
                        by starting
                        and stopping the instance. AWS CloudFormation tries to optimize the change by updating
                        the instance type
                        and restarting the instance, so the instance ID does not change. When the instance
                        is
                        restarted, however, the public IP address of the instance does change. To ensure that
                        the
                        Elastic IP address is bound correctly after the change, AWS CloudFormation will also
                        update the Elastic
                        IP address. You can see the changes in the AWS CloudFormation console on the Events
                        tab.
                     </p>
                     
                     <p>To check the instance type from the AWS Management Console, open the Amazon EC2 console,
                        and locate your instance there.
                     </p>
                     
                     
                     <h3 id="update.walkthrough.ami">Update the AMI on an Amazon EC2 instance</h3>
                     
                     
                     <p>Now let&apos;s look at how we might change the Amazon Machine Image (AMI) running on the
                        instance. We will trigger the AMI change by updating the stack to use a new Amazon
                        EC2 instance
                        type, such as t2.medium, which is an HVM64 instance type. 
                     </p>
                     
                     <p>As in the previous section, we&#x2019;ll use our existing template to change the instance
                        type
                        used by our example stack. In the Stack Update wizard, on the Specify Parameters page,
                        change the value of the Instance Type.
                     </p>
                     
                     <p>In this case, we cannot simply start and stop the instance to modify the AMI; AWS
                        CloudFormation
                        considers this a change to an immutable property of the resource. In order to make
                        a change
                        to an immutable property, AWS CloudFormation must launch a replacement resource, in
                        this case a new Amazon EC2
                        instance running the new AMI.
                     </p>
                     
                     <p>After the new instance is running, AWS CloudFormation updates the other resources
                        in the stack to
                        point to the new resource. When all new resources are created, the old resource is
                        deleted,
                        a process known as UPDATE_CLEANUP. This time, you will notice that the instance ID
                        and
                        application URL of the instance in the stack has changed as a result of the update.
                        The
                        events in the Event table contain a description &quot;Requested update has a change to
                        an
                        immutable property and hence creating a new physical resource&quot; to indicate that a
                        resource
                        was replaced.
                     </p>
                     
                     <p>If you have application code written into the AMI that you want to update, you can
                        use
                        the same stack update mechanism to update the AMI to load your new application.
                     </p>
                     
                     <p class="title"><b>To update the AMI for an instance on your stack</b></p>
                     <ol>
                        <li>
                           
                           <p>Create your new AMIs containing your application or operating system changes. For
                              more information, go to <a href="./AWSEC2/latest/UserGuide/creating-an-ami.html" target="_blank">Creating Your Own
                                 AMIs</a> in the <em>Amazon EC2 User Guide for Linux Instances</em>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Update your template to incorporate the new AMI IDs.</p>
                           
                        </li>
                        <li>
                           
                           <p>Update the stack, either from the AWS Management Console as explained in <a href="updating.stacks.walkthrough.html#update.application">Update the Application</a> or by using the AWS
                              command <a href="./cli/latest/reference/cloudformation/update-stack.html" target="_blank"><code class="code">aws cloudformation update-stack</code></a>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p>When you update the stack, AWS CloudFormation detects that the AMI ID has changed,
                        and
                        then it triggers a stack update in the same way as we triggered the one above.
                     </p>
                     
                     
                     <h3 id="update.walkthrough.launch.config">Update the Amazon EC2 Launch Configuration for
                        an Auto Scaling Group
                     </h3>
                     
                     
                     <p>If you are using Auto Scaling groups rather than Amazon EC2 instances, the process
                        of
                        updating the running instances is a little different. With Auto Scaling resources,
                        the
                        configuration of the Amazon EC2 instances, such as the instance type or the AMI ID
                        is
                        encapsulated in the Auto Scaling launch configuration. You can make changes to the
                        launch
                        configuration in the same way as we made changes to the Amazon EC2 instance resources
                        in the
                        previous sections. However, changing the launch configuration does not impact any
                        of the
                        running Amazon EC2 instances in the Auto Scaling group. An updated launch configuration
                        applies
                        only to new instances that are created after the update.
                     </p>
                     
                     <p>If you want to propagate the change to your launch configuration across all the
                        instances in your Auto Scaling group, you can use an update attribute. For more information,
                        see <a href="aws-attribute-updatepolicy.html">UpdatePolicy</a>.
                     </p>
                     
                     
                     <h2 id="update.walkthrough.adding.properties">Adding Resource Properties</h2>
                     
                     
                     
                     <p>So far, we&apos;ve looked at changing existing properties of a resource in a template.
                        You can
                        also add properties that were not originally specified in the template. To illustrate
                        that,
                        we&#x2019;ll add an Amazon EC2 key pair to an existing EC2 instance and then open up port
                        22 in the
                        Amazon EC2 Security Group so that you can use Secure Shell (SSH) to access the
                        instance.
                     </p>
                     
                     <h3 id="update.walkthrough.security.group">Add a Key Pair to an Instance</h3>
                     
                     
                     <p class="title"><b>To add SSH access to an existing Amazon EC2 instance</b></p>
                     <ol>
                        <li>
                           
                           <p>Add two additional parameters to the template to pass in the name of an existing
                              Amazon EC2 key pair and SSH location.
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">  &quot;Parameters&quot; : {

    &quot;KeyName&quot; : {
      &quot;Description&quot; : &quot;Name of an existing Amazon EC2 key pair for SSH access&quot;,
      &quot;Type&quot;: &quot;AWS::EC2::KeyPair::KeyName&quot;
    },
    &quot;SSHLocation&quot; : {
      &quot;Description&quot; : &quot; The IP address range that can be used to SSH to the EC2 instances&quot;,
      &quot;Type&quot;: &quot;String&quot;,
      &quot;MinLength&quot;: &quot;9&quot;,
      &quot;MaxLength&quot;: &quot;18&quot;,
      &quot;Default&quot;: &quot;0.0.0.0/0&quot;,
      &quot;AllowedPattern&quot;: &quot;(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})&quot;,
      &quot;ConstraintDescription&quot;: &quot;must be a valid IP CIDR range of the form x.x.x.x/x.&quot;
    }  
    :
  },
</code></pre>
                           </li>
                        <li>
                           
                           <p>Add the KeyName property to the Amazon EC2 instance.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">          &quot;WebServerInstance&quot;: {
          &quot;Type&quot; : &quot;AWS::EC2::Instance&quot;,
          :
          &quot;Properties&quot;: {
          :
         <em class="replaceable"><code> &quot;KeyName&quot; : { &quot;Ref&quot; : &quot;KeyName&quot; },</code></em>
          :
          }
          },
</code></pre>
                           </li>
                        <li>
                           
                           <p>Add port 22 and the SSH location to the ingress rules for the Amazon EC2 security
                              group.
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">    &quot;WebServerSecurityGroup&quot; : {
      &quot;Type&quot; : &quot;AWS::EC2::SecurityGroup&quot;,
      &quot;Properties&quot; : {
        &quot;GroupDescription&quot; : &quot;Enable HTTP and SSH&quot;,
        &quot;SecurityGroupIngress&quot; : [
          {&quot;IpProtocol&quot; : &quot;tcp&quot;, &quot;FromPort&quot; : &quot;22&quot;, &quot;ToPort&quot; : &quot;22&quot;, &quot;CidrIp&quot; : { &quot;Ref&quot; : &quot;SSHLocation&quot;}},
          {&quot;IpProtocol&quot; : &quot;tcp&quot;, &quot;FromPort&quot; : &quot;80&quot;, &quot;ToPort&quot; : &quot;80&quot;, &quot;CidrIp&quot; :  &quot;0.0.0.0/0&quot;}
        ]
      }
    },    </code></pre>
                           </li>
                        <li>
                           
                           <p>Update the stack, either from the AWS Management Console as explained in <a href="updating.stacks.walkthrough.html#update.application">Update the Application</a> or by using the AWS
                              command <a href="./cli/latest/reference/cloudformation/update-stack.html" target="_blank"><code class="code">aws cloudformation update-stack</code></a>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="update.walkthrough.change.resources">Change the Stack&apos;s Resources</h2>
                     
                     
                     
                     <p>Since application needs can change over time, AWS CloudFormation allows you to change
                        the set of
                        resources that make up the stack. To demonstrate, we&#x2019;ll take the single instance application
                        from <a href="updating.stacks.walkthrough.html#update.walkthrough.adding.properties">Adding Resource Properties</a> and convert it to an auto-scaled,
                        load-balanced application by updating the stack.
                     </p>
                     
                     <p>This will create a simple, single instance PHP application using an Elastic IP address.
                        We&apos;ll now turn the application into a highly available, auto-scaled, load balanced
                        application
                        by changing its resources during an update.
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p>Add an Elastic Load Balancer resource.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">    &quot;ElasticLoadBalancer&quot; : {
      &quot;Type&quot; : &quot;AWS::ElasticLoadBalancing::LoadBalancer&quot;,
      &quot;Properties&quot; : {
        &quot;CrossZone&quot; : &quot;true&quot;,
        &quot;AvailabilityZones&quot; : { &quot;Fn::GetAZs&quot; : &quot;&quot; },
        &quot;LBCookieStickinessPolicy&quot; : [ {
          &quot;PolicyName&quot; : &quot;CookieBasedPolicy&quot;,
          &quot;CookieExpirationPeriod&quot; : &quot;30&quot;
        } ],
        &quot;Listeners&quot; : [ {
          &quot;LoadBalancerPort&quot; : &quot;80&quot;,
          &quot;InstancePort&quot; : &quot;80&quot;,
          &quot;Protocol&quot; : &quot;HTTP&quot;,
          &quot;PolicyNames&quot; : [ &quot;CookieBasedPolicy&quot; ]
        } ],
        &quot;HealthCheck&quot; : {
          &quot;Target&quot; : &quot;HTTP:80/&quot;,
          &quot;HealthyThreshold&quot; : &quot;2&quot;,
          &quot;UnhealthyThreshold&quot; : &quot;5&quot;,
          &quot;Interval&quot; : &quot;10&quot;,
          &quot;Timeout&quot; : &quot;5&quot;
        }
      }
    }</code></pre>
                           </li>
                        <li>
                           
                           <p>Convert the EC2 instance in the template into an Auto Scaling Launch Configuration.
                              The properties are identical, so we only need to change the type name from:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
<em class="replaceable"><code>&quot;WebServerInstance&quot;</code></em>: {
  &quot;Type&quot; : <em class="replaceable"><code>&quot;AWS::EC2::Instance&quot;</code></em>,</code></pre>
                           <p>to:</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
<em class="replaceable"><code>&quot;LaunchConfig&quot;</code></em>: {
  &quot;Type&quot; : <em class="replaceable"><code>&quot;AWS::AutoScaling::LaunchConfiguration&quot;</code></em>,</code></pre>
                           <p>For clarity in the template, we changed the name of the resource from
                              <em>WebServerInstance</em> to <em>LaunchConfig</em>, so you&#x2019;ll
                              need to update the resource name referenced by cfn-init and cfn-hup (just search for
                              WebServerInstance and replace it with LaunchConfig, except for cfn-signal). For
                              cfn-signal, you&apos;ll need to signal the Auto Scaling group (WebServerGroup) not the
                              instance, as
                              shown in the following snippet:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">             &quot;# Signal the status from cfn-init\n&quot;,
             &quot;/opt/aws/bin/cfn-signal -e $? &quot;,
             &quot;         --stack &quot;, { &quot;Ref&quot; : &quot;AWS::StackName&quot; },
             &quot;         --resource <em class="replaceable"><code>WebServerGroup</code></em> &quot;,
             &quot;         --region &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;</code></pre>
                           </li>
                        <li>
                           
                           <p>Add an Auto Scaling Group resource.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">    &quot;WebServerGroup&quot; : {
      &quot;Type&quot; : &quot;AWS::AutoScaling::AutoScalingGroup&quot;,
      &quot;Properties&quot; : {
        &quot;AvailabilityZones&quot; : { &quot;Fn::GetAZs&quot; : &quot;&quot; },
        &quot;LaunchConfigurationName&quot; : { &quot;Ref&quot; : &quot;LaunchConfig&quot; },
        &quot;MinSize&quot; : &quot;1&quot;,
        &quot;DesiredCapacity&quot; : &quot;1&quot;,
        &quot;MaxSize&quot; : &quot;5&quot;,
        &quot;LoadBalancerNames&quot; : [ { &quot;Ref&quot; : &quot;ElasticLoadBalancer&quot; } ]
      },
      &quot;CreationPolicy&quot; : {
        &quot;ResourceSignal&quot; : {
          &quot;Timeout&quot; : &quot;PT15M&quot;
        }
      },
      &quot;UpdatePolicy&quot;: {
        &quot;AutoScalingRollingUpdate&quot;: {
          &quot;MinInstancesInService&quot;: &quot;1&quot;,
          &quot;MaxBatchSize&quot;: &quot;1&quot;,
          &quot;PauseTime&quot; : &quot;PT15M&quot;,
          &quot;WaitOnResourceSignals&quot;: &quot;true&quot;
        }
      }
    }</code></pre>
                           </li>
                        <li>
                           
                           <p>Update the Security Group definition to lock down the traffic to the instances from
                              the load balancer.
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">    &quot;WebServerSecurityGroup&quot; : {
      &quot;Type&quot; : &quot;AWS::EC2::SecurityGroup&quot;,
      &quot;Properties&quot; : {
        &quot;GroupDescription&quot; : &quot;Enable HTTP access via port 80 locked down to the ELB and SSH access&quot;,
        &quot;SecurityGroupIngress&quot; : [
          {&quot;IpProtocol&quot; : &quot;tcp&quot;, &quot;FromPort&quot; : &quot;80&quot;, &quot;ToPort&quot; : &quot;80&quot;, &quot;SourceSecurityGroupOwnerId&quot; : {&quot;Fn::GetAtt&quot; : [&quot;ElasticLoadBalancer&quot;, &quot;SourceSecurityGroup.OwnerAlias&quot;]},
&quot;SourceSecurityGroupName&quot; : {&quot;Fn::GetAtt&quot; : [&quot;ElasticLoadBalancer&quot;, &quot;SourceSecurityGroup.GroupName&quot;]}},
          {&quot;IpProtocol&quot; : &quot;tcp&quot;, &quot;FromPort&quot; : &quot;22&quot;, &quot;ToPort&quot; : &quot;22&quot;, &quot;CidrIp&quot; : { &quot;Ref&quot; : &quot;SSHLocation&quot;}}
        ]
      }
    }</code></pre>
                           </li>
                        <li>
                           
                           <p>Update the Outputs to return the DNS Name of the Elastic Load Balancer as the location
                              of the application from:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
&quot;WebsiteURL&quot; : {
  &quot;Value&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [&quot;http://&quot;, 
      { &quot;Fn::GetAtt&quot; : [ &quot;<em class="replaceable"><code>WebServerInstance</code></em>&quot;, &quot;<em class="replaceable"><code>PublicDnsName</code></em>&quot; ]}]]},
  &quot;Description&quot; : &quot;Application URL&quot;
}              </code></pre>
                           <p>to:</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
&quot;WebsiteURL&quot; : {
  &quot;Value&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [&quot;http://&quot;, 
      { &quot;Fn::GetAtt&quot; : [ &quot;<em class="replaceable"><code>ElasticLoadBalancer</code></em>&quot;, &quot;<em class="replaceable"><code>DNSName</code></em>&quot; ]}]]},
  &quot;Description&quot; : &quot;Application URL&quot;
}              </code></pre>
                           </li>
                     </ol>
                     
                     <p>For reference, the follow sample shows the complete template. If you use this template
                        to
                        update the stack, you will convert your simple, single instance application into a
                        highly
                        available, multi-AZ, auto-scaled and load balanced application. Only the resources
                        that need
                        to be updated will be altered, so had there been any data stores for this application,
                        the
                        data would have remained intact. Now, you can use AWS CloudFormation to grow or enhance
                        your stacks as your
                        requirements change.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">{
  &quot;AWSTemplateFormatVersion&quot; : &quot;2010-09-09&quot;,

  &quot;Description&quot; : &quot;AWS CloudFormation Sample Template: Sample template that can be used to test EC2 updates. **WARNING** This template creates an Amazon Ec2 Instance. You will be billed for the AWS resources used if you create a stack from this template.&quot;,
  
  &quot;Parameters&quot; : {
  
    &quot;KeyName&quot;: {
      &quot;Description&quot; : &quot;Name of an existing EC2 KeyPair to enable SSH access to the instance&quot;,
      &quot;Type&quot;: &quot;AWS::EC2::KeyPair::KeyName&quot;,
      &quot;ConstraintDescription&quot; : &quot;must be the name of an existing EC2 KeyPair.&quot;
    },

    &quot;SSHLocation&quot; : {
      &quot;Description&quot; : &quot; The IP address range that can be used to SSH to the EC2 instances&quot;,
      &quot;Type&quot;: &quot;String&quot;,
      &quot;MinLength&quot;: &quot;9&quot;,
      &quot;MaxLength&quot;: &quot;18&quot;,
      &quot;Default&quot;: &quot;0.0.0.0/0&quot;,
      &quot;AllowedPattern&quot;: &quot;(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})&quot;,
      &quot;ConstraintDescription&quot;: &quot;must be a valid IP CIDR range of the form x.x.x.x/x.&quot;
    },
    
    &quot;InstanceType&quot; : {
      &quot;Description&quot; : &quot;WebServer EC2 instance type&quot;,
      &quot;Type&quot; : &quot;String&quot;,
      &quot;Default&quot; : &quot;m1.small&quot;,
      &quot;AllowedValues&quot; : [ &quot;t1.micro&quot;, &quot;t2.micro&quot;, &quot;t2.small&quot;, &quot;t2.medium&quot;, &quot;m1.small&quot;, &quot;m1.medium&quot;, &quot;m1.large&quot;, &quot;m1.xlarge&quot;, &quot;m2.xlarge&quot;,
&quot;m2.2xlarge&quot;, &quot;m2.4xlarge&quot;, &quot;m3.medium&quot;, &quot;m3.large&quot;, &quot;m3.xlarge&quot;, &quot;m3.2xlarge&quot;, &quot;c1.medium&quot;, &quot;c1.xlarge&quot;, &quot;c3.large&quot;, &quot;c3.xlarge&quot;, &quot;c3.2xlarge&quot;,
&quot;c3.4xlarge&quot;, &quot;c3.8xlarge&quot;, &quot;g2.2xlarge&quot;, &quot;r3.large&quot;, &quot;r3.xlarge&quot;, &quot;r3.2xlarge&quot;, &quot;r3.4xlarge&quot;, &quot;r3.8xlarge&quot;, &quot;i2.xlarge&quot;, &quot;i2.2xlarge&quot;, &quot;i2.4xlarge&quot;,
&quot;i2.8xlarge&quot;, &quot;hi1.4xlarge&quot;, &quot;hs1.8xlarge&quot;, &quot;cr1.8xlarge&quot;, &quot;cc2.8xlarge&quot;, &quot;cg1.4xlarge&quot;],
      &quot;ConstraintDescription&quot; : &quot;must be a valid EC2 instance type.&quot;
    }
  },
  
  &quot;Mappings&quot; : {
    &quot;AWSInstanceType2Arch&quot; : {
      &quot;t1.micro&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;t2.micro&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;t2.small&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;t2.medium&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m1.small&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.medium&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.large&quot;    : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m1.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m2.4xlarge&quot;  : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;m3.medium&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;m3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c1.medium&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;c1.xlarge&quot;   : { &quot;Arch&quot; : &quot;PV64&quot;   },
      &quot;c3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;c3.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;g2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVMG2&quot;  },
      &quot;r3.large&quot;    : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;r3.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.xlarge&quot;   : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.2xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.4xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;i2.8xlarge&quot;  : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;hi1.4xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;hs1.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;cr1.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  },
      &quot;cc2.8xlarge&quot; : { &quot;Arch&quot; : &quot;HVM64&quot;  }
    },

    &quot;AWSRegionArch2AMI&quot; : {
      &quot;us-east-1&quot;      : { &quot;PV64&quot; : &quot;ami-50842d38&quot;, &quot;HVM64&quot; : &quot;ami-08842d60&quot;, &quot;HVMG2&quot; : &quot;ami-3a329952&quot;  },
      &quot;us-west-2&quot;      : { &quot;PV64&quot; : &quot;ami-af86c69f&quot;, &quot;HVM64&quot; : &quot;ami-8786c6b7&quot;, &quot;HVMG2&quot; : &quot;ami-47296a77&quot;  },
      &quot;us-west-1&quot;      : { &quot;PV64&quot; : &quot;ami-c7a8a182&quot;, &quot;HVM64&quot; : &quot;ami-cfa8a18a&quot;, &quot;HVMG2&quot; : &quot;ami-331b1376&quot;  },
      &quot;eu-west-1&quot;      : { &quot;PV64&quot; : &quot;ami-aa8f28dd&quot;, &quot;HVM64&quot; : &quot;ami-748e2903&quot;, &quot;HVMG2&quot; : &quot;ami-00913777&quot;  },
      &quot;ap-southeast-1&quot; : { &quot;PV64&quot; : &quot;ami-20e1c572&quot;, &quot;HVM64&quot; : &quot;ami-d6e1c584&quot;, &quot;HVMG2&quot; : &quot;ami-fabe9aa8&quot;  },
      &quot;ap-northeast-1&quot; : { &quot;PV64&quot; : &quot;ami-21072820&quot;, &quot;HVM64&quot; : &quot;ami-35072834&quot;, &quot;HVMG2&quot; : &quot;ami-5dd1ff5c&quot;  },
      &quot;ap-southeast-2&quot; : { &quot;PV64&quot; : &quot;ami-8b4724b1&quot;, &quot;HVM64&quot; : &quot;ami-fd4724c7&quot;, &quot;HVMG2&quot; : &quot;ami-e98ae9d3&quot;  },
      &quot;sa-east-1&quot;      : { &quot;PV64&quot; : &quot;ami-9d6cc680&quot;, &quot;HVM64&quot; : &quot;ami-956cc688&quot;, &quot;HVMG2&quot; : &quot;NOT_SUPPORTED&quot; },
      &quot;cn-north-1&quot;     : { &quot;PV64&quot; : &quot;ami-a857c591&quot;, &quot;HVM64&quot; : &quot;ami-ac57c595&quot;, &quot;HVMG2&quot; : &quot;NOT_SUPPORTED&quot; },
      &quot;eu-central-1&quot;   : { &quot;PV64&quot; : &quot;ami-a03503bd&quot;, &quot;HVM64&quot; : &quot;ami-b43503a9&quot;, &quot;HVMG2&quot; : &quot;ami-b03503ad&quot;  }
    }
  },
    
  &quot;Resources&quot; : {   
  
    &quot;ElasticLoadBalancer&quot; : {
      &quot;Type&quot; : &quot;AWS::ElasticLoadBalancing::LoadBalancer&quot;,
      &quot;Properties&quot; : {
        &quot;CrossZone&quot; : &quot;true&quot;,
        &quot;AvailabilityZones&quot; : { &quot;Fn::GetAZs&quot; : &quot;&quot; },
        &quot;LBCookieStickinessPolicy&quot; : [ {
          &quot;PolicyName&quot; : &quot;CookieBasedPolicy&quot;,
          &quot;CookieExpirationPeriod&quot; : &quot;30&quot;
        } ],
        &quot;Listeners&quot; : [ {
          &quot;LoadBalancerPort&quot; : &quot;80&quot;,
          &quot;InstancePort&quot; : &quot;80&quot;,
          &quot;Protocol&quot; : &quot;HTTP&quot;,
          &quot;PolicyNames&quot; : [ &quot;CookieBasedPolicy&quot; ]
        } ],
        &quot;HealthCheck&quot; : {
          &quot;Target&quot; : &quot;HTTP:80/&quot;,
          &quot;HealthyThreshold&quot; : &quot;2&quot;,
          &quot;UnhealthyThreshold&quot; : &quot;5&quot;,
          &quot;Interval&quot; : &quot;10&quot;,
          &quot;Timeout&quot; : &quot;5&quot;
        }
      }
    },
    
    &quot;WebServerGroup&quot; : {
      &quot;Type&quot; : &quot;AWS::AutoScaling::AutoScalingGroup&quot;,
      &quot;Properties&quot; : {
        &quot;AvailabilityZones&quot; : { &quot;Fn::GetAZs&quot; : &quot;&quot; },
        &quot;LaunchConfigurationName&quot; : { &quot;Ref&quot; : &quot;LaunchConfig&quot; },
        &quot;MinSize&quot; : &quot;1&quot;,
        &quot;DesiredCapacity&quot; : &quot;1&quot;,
        &quot;MaxSize&quot; : &quot;5&quot;,
        &quot;LoadBalancerNames&quot; : [ { &quot;Ref&quot; : &quot;ElasticLoadBalancer&quot; } ]
      },
      &quot;CreationPolicy&quot; : {
        &quot;ResourceSignal&quot; : {
          &quot;Timeout&quot; : &quot;PT15M&quot;
        }
      },
      &quot;UpdatePolicy&quot;: {
        &quot;AutoScalingRollingUpdate&quot;: {
          &quot;MinInstancesInService&quot;: &quot;1&quot;,
          &quot;MaxBatchSize&quot;: &quot;1&quot;,
          &quot;PauseTime&quot; : &quot;PT15M&quot;,
          &quot;WaitOnResourceSignals&quot;: &quot;true&quot;
        }
      }
    },
    
    &quot;LaunchConfig&quot;: {  
      &quot;Type&quot; : &quot;AWS::AutoScaling::LaunchConfiguration&quot;,
      &quot;Metadata&quot; : {
        &quot;Comment&quot; : &quot;Install a simple PHP application&quot;,
        &quot;AWS::CloudFormation::Init&quot; : {
          &quot;config&quot; : {
            &quot;packages&quot; : {
              &quot;yum&quot; : {
                &quot;httpd&quot;             : [],
                &quot;php&quot;               : []
              }
            },

            &quot;files&quot; : {

              &quot;/var/www/html/index.php&quot; : {
                &quot;content&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
                  &quot;&lt;?php\n&quot;,
                  &quot;echo &apos;&lt;h1&gt;AWS CloudFormation sample PHP application&lt;/h1&gt;&apos;;\n&quot;,
                  &quot;echo &apos;Updated version via UpdateStack&apos;;\n &quot;,
                  &quot;?&gt;\n&quot;
                ]]},
                &quot;mode&quot;    : &quot;000644&quot;,
                &quot;owner&quot;   : &quot;apache&quot;,
                &quot;group&quot;   : &quot;apache&quot;
              },


              &quot;/etc/cfn/cfn-hup.conf&quot; : {
                &quot;content&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
                  &quot;[main]\n&quot;,
                  &quot;stack=&quot;, { &quot;Ref&quot; : &quot;AWS::StackId&quot; }, &quot;\n&quot;,
                  &quot;region=&quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;
                ]]},
                &quot;mode&quot;    : &quot;000400&quot;,
                &quot;owner&quot;   : &quot;root&quot;,
                &quot;group&quot;   : &quot;root&quot;
              },

              &quot;/etc/cfn/hooks.d/cfn-auto-reloader.conf&quot; : {
                &quot;content&quot;: { &quot;Fn::Join&quot; : [&quot;&quot;, [
                  &quot;[cfn-auto-reloader-hook]\n&quot;,
                  &quot;triggers=post.update\n&quot;,
                  &quot;path=Resources.LaunchConfig.Metadata.AWS::CloudFormation::Init\n&quot;,
                  &quot;action=/opt/aws/bin/cfn-init -s &quot;, { &quot;Ref&quot; : &quot;AWS::StackId&quot; }, &quot; -r LaunchConfig &quot;,
                                                   &quot; --region     &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;,
                  &quot;runas=root\n&quot;
                ]]}
              }
            },

            &quot;services&quot; : {
              &quot;sysvinit&quot; : {
                &quot;httpd&quot;    : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot; },
                &quot;cfn-hup&quot; : { &quot;enabled&quot; : &quot;true&quot;, &quot;ensureRunning&quot; : &quot;true&quot;,
                    &quot;files&quot; : [&quot;/etc/cfn/cfn-hup.conf&quot;, &quot;/etc/cfn/hooks.d/cfn-auto-reloader.conf&quot;]}
              }
            }
          }
        }
      },

      &quot;Properties&quot;: {
        &quot;ImageId&quot; : { &quot;Fn::FindInMap&quot; : [ &quot;AWSRegionArch2AMI&quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; },
                          { &quot;Fn::FindInMap&quot; : [ &quot;AWSInstanceType2Arch&quot;, { &quot;Ref&quot; : &quot;InstanceType&quot; }, &quot;Arch&quot; ] } ] },
        &quot;InstanceType&quot;   : { &quot;Ref&quot; : &quot;InstanceType&quot; },
        &quot;KeyName&quot;        : { &quot;Ref&quot; : &quot;KeyName&quot; },
        &quot;SecurityGroups&quot; : [ {&quot;Ref&quot; : &quot;WebServerSecurityGroup&quot;} ],
        &quot;UserData&quot;       : { &quot;Fn::Base64&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [
             &quot;#!/bin/bash -xe\n&quot;,
             &quot;yum install -y aws-cfn-bootstrap\n&quot;,

             &quot;# Install the files and packages from the metadata\n&quot;,
             &quot;/opt/aws/bin/cfn-init -v &quot;,
             &quot;         --stack &quot;, { &quot;Ref&quot; : &quot;AWS::StackName&quot; },
             &quot;         --resource LaunchConfig &quot;,
             &quot;         --region &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;,
             
             &quot;# Start up the cfn-hup daemon to listen for changes to the Web Server metadata\n&quot;,
             &quot;/opt/aws/bin/cfn-hup || error_exit &apos;Failed to start cfn-hup&apos;\n&quot;,  

             &quot;# Signal the status from cfn-init\n&quot;,
             &quot;/opt/aws/bin/cfn-signal -e $? &quot;,
             &quot;         --stack &quot;, { &quot;Ref&quot; : &quot;AWS::StackName&quot; },
             &quot;         --resource WebServerGroup &quot;,
             &quot;         --region &quot;, { &quot;Ref&quot; : &quot;AWS::Region&quot; }, &quot;\n&quot;
        ]]}}        
      }
    },

    &quot;WebServerSecurityGroup&quot; : {
      &quot;Type&quot; : &quot;AWS::EC2::SecurityGroup&quot;,
      &quot;Properties&quot; : {
        &quot;GroupDescription&quot; : &quot;Enable HTTP access via port 80 locked down to the ELB and SSH access&quot;,
        &quot;SecurityGroupIngress&quot; : [
          {&quot;IpProtocol&quot; : &quot;tcp&quot;, &quot;FromPort&quot; : &quot;80&quot;, &quot;ToPort&quot; : &quot;80&quot;, &quot;SourceSecurityGroupOwnerId&quot; : {&quot;Fn::GetAtt&quot; : [&quot;ElasticLoadBalancer&quot;, &quot;SourceSecurityGroup.OwnerAlias&quot;]},&quot;SourceSecurityGroupName&quot; : {&quot;Fn::GetAtt&quot; : [&quot;ElasticLoadBalancer&quot;, &quot;SourceSecurityGroup.GroupName&quot;]}},
          {&quot;IpProtocol&quot; : &quot;tcp&quot;, &quot;FromPort&quot; : &quot;22&quot;, &quot;ToPort&quot; : &quot;22&quot;, &quot;CidrIp&quot; : { &quot;Ref&quot; : &quot;SSHLocation&quot;}}
        ]
      }
    }          
  },
  
  &quot;Outputs&quot; : {
    &quot;WebsiteURL&quot; : {
      &quot;Description&quot; : &quot;Application URL&quot;,
      &quot;Value&quot; : { &quot;Fn::Join&quot; : [&quot;&quot;, [&quot;http://&quot;, { &quot;Fn::GetAtt&quot; : [ &quot;ElasticLoadBalancer&quot;, &quot;DNSName&quot; ]}]] }
    }
  }
}</code></pre>
                     <h2 id="update.walkthrough.impact">Availability and Impact Considerations</h2>
                     
                     
                     <p>Different properties have different impacts on the resources in the stack. You can
                        use AWS
                        CloudFormation to update any property; however, before you make any changes, you should
                        consider these questions:
                     </p>
                     
                     <div class="orderedlist">
                        
                        
                        
                        <ol>
                           <li>
                              
                              <p>How does the update affect the resource itself? For example, updating an alarm
                                 threshold will render the alarm inactive during the update. As we have seen, changing
                                 the
                                 instance type requires that the instance be stopped and restarted. AWS CloudFormation
                                 uses the Update
                                 or Modify actions for the underlying resources to make changes to resources. To understand
                                 the impact of updates, you should check the documentation for the specific
                                 resources.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>Is the change mutable or immutable? Some changes to resource properties, such as
                                 changing the AMI on an Amazon EC2 instance, are not supported by the underlying services.
                                 In the case of mutable changes, AWS CloudFormation will use the Update or Modify type
                                 APIs
                                 for the underlying resources. For immutable property changes, AWS CloudFormation will
                                 create new resources with the updated properties and then link them to the stack before
                                 deleting the old resources. Although AWS CloudFormation tries to reduce the down time
                                 of
                                 the stack resources, replacing a resource is a multistep process, and it will take
                                 time.
                                 During stack reconfiguration, your application will not be fully operational. For
                                 example,
                                 it may not be able to serve requests or access a database.
                              </p>
                              
                           </li>
                        </ol>
                     </div>
                     
                     <h2 id="update.walkthrough.related">Related Resources</h2>
                     
                     
                     <p>For more information about using AWS CloudFormation to start applications and on
                        integrating with other configuration and deployment services such as Puppet and Opscode
                        Chef,
                        see the following whitepapers:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>
                                 <a href="https://s3.amazonaws.com/cloudformation-examples/BoostrappingApplicationsWithAWSCloudFormation.pdf" target="_blank"> Bootstrapping Applications via AWS CloudFormation</a>
                                 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>
                                 <a href="https://s3.amazonaws.com/cloudformation-examples/IntegratingAWSCloudFormationWithOpscodeChef.pdf" target="_blank"> Integrating AWS CloudFormation with Opscode Chef</a>
                                 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>
                                 <a href="https://s3.amazonaws.com/cloudformation-examples/IntegratingAWSCloudFormationWithPuppet.pdf" target="_blank"> Integrating AWS CloudFormation with Puppet</a>
                                 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <p>The template used throughout this section is a &quot;Hello, World&quot; PHP application. The
                        template library also has an Amazon ElastiCache sample template that shows how to
                        integrate a
                        PHP application with ElasticCache using cfn-hup and cfn-init to respond to changes
                        in the
                        Amazon ElastiCache Cache Cluster configuration, all of which can be performed by Update
                        Stack.
                     </p>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="gettingstarted.templatebasics.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="best-practices.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="A Simple Application"><a class="pagetoc" href="#updating.simple.application">A Simple Application</a></li>
                        <li class="pagetoc" name="Create the Initial Stack"><a class="pagetoc" href="#updating.create.initial.stack">Create the Initial Stack</a></li>
                        <li class="pagetoc" name="Update the Application"><a class="pagetoc" href="#update.application">Update the Application</a></li>
                        <li class="pagetoc" name="Changing Resource
      Properties"><a class="pagetoc" href="#update.walkthrough.changing.resource.properties">Changing Resource
                              Properties</a></li>
                        <li class="pagetoc" name="Adding Resource Properties"><a class="pagetoc" href="#update.walkthrough.adding.properties">Adding Resource Properties</a></li>
                        <li class="pagetoc" name="Change the Stack&apos;s Resources"><a class="pagetoc" href="#update.walkthrough.change.resources">Change the Stack&apos;s Resources</a></li>
                        <li class="pagetoc" name="Availability and Impact Considerations"><a class="pagetoc" href="#update.walkthrough.impact">Availability and Impact Considerations</a></li>
                        <li class="pagetoc" name="Related Resources"><a class="pagetoc" href="#update.walkthrough.related">Related Resources</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='AWS CloudFormation';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='User Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>