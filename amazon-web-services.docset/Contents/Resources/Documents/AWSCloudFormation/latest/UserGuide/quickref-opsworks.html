<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>AWS OpsWorks Template Snippets - AWS CloudFormation</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="CHAP_TemplateQuickRef.html" title="Template Snippets">
      <link rel="prev" href="quickref-lambda.html" title="AWS Lambda Template">
      <link rel="next" href="quickref-redshift.html" title="Amazon Redshift Template Snippets">
      <meta name="description" content="Use AWS OpsWorks sample template snippets to help you describe AWS OpsWorks resources in your AWS CloudFormation templates.">
      <meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation Designer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="AWS CloudFormation">
      <meta name="guide" content="User Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/quickref-opsworks.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/cloudformation">AWS CloudFormation</a> &#xBB; <a href="index.html">User Guide</a> &#xBB; <a href="template-guide.html">Working with AWS CloudFormation Templates</a> &#xBB; <a href="CHAP_TemplateQuickRef.html">Template Snippets</a> &#xBB; <span class="breadcrumb">AWS OpsWorks Template Snippets</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <div id="language-filter" class="page-header" style="display:none">
                        <form> Filter View: 
                           <select name="filter-select" id="filter-select">
                              <option selected="1">All</option>
                              <option value="JSON" selected>JSON</option>
                              <option value="YAML" selected>YAML</option></select></form>
                     </div>
                     <h1 class="topictitle" id="quickref-opsworks">AWS OpsWorks Template Snippets</h1>
                     <p>AWS OpsWorks is an application management service that simplifies a wide range of
                        tasks such as
                        software configuration, application deployment, scaling, and monitoring. AWS CloudFormation
                        is a resource
                        management service that you can use to manage AWS OpsWorks resources, such as AWS
                        OpsWorks stacks, layers,
                        apps, and instances.
                     </p>
                     <h2 id="quickref-opsworks-sample-php-app">AWS OpsWorks Sample PHP App</h2>
                     
                     
                     <p>The following sample template deploys a sample AWS OpsWorks PHP web application that
                        is stored in
                        public Git repository. The AWS OpsWorks stack includes two application servers with
                        a load balancer
                        that distributes incoming traffic evenly across the servers. The AWS OpsWorks stack
                        also includes a
                        back-end MySQL database server to store data. For more information about the sample
                        AWS OpsWorks
                        application, see <a href="./opsworks/latest/userguide/gettingstarted.html" target="_blank">Walkthrough: Learn AWS AWS OpsWorks
                           Basics by Creating an Application Server Stack</a> in the
                        <em>AWS OpsWorks User Guide</em>.
                     </p>
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>The <code class="code">ServiceRoleArn</code> and <code class="code">DefaultInstanceProfileArn</code> properties
                           reference IAM roles that are created after you use AWS OpsWorks for the first time.
                        </p>
                     </div>
                     
                     <div id="JSON" name="JSON" class="section langfilter">
                        <h3 id="quickref-opsworks-example-1.json">JSON</h3>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">{
  &quot;AWSTemplateFormatVersion&quot;: &quot;2010-09-09&quot;,
  &quot;Parameters&quot;: {
    &quot;ServiceRole&quot;: {
      &quot;Default&quot;: &quot;aws-opsworks-service-role&quot;,
      &quot;Description&quot;: &quot;The OpsWorks service role&quot;,
      &quot;Type&quot;: &quot;String&quot;,
      &quot;MinLength&quot;: &quot;1&quot;,
      &quot;MaxLength&quot;: &quot;64&quot;,
      &quot;AllowedPattern&quot;: &quot;[a-zA-Z][a-zA-Z0-9-]*&quot;,
      &quot;ConstraintDescription&quot;: &quot;must begin with a letter and contain only alphanumeric characters.&quot;
    },
    &quot;InstanceRole&quot;: {
      &quot;Default&quot;: &quot;aws-opsworks-ec2-role&quot;,
      &quot;Description&quot;: &quot;The OpsWorks instance role&quot;,
      &quot;Type&quot;: &quot;String&quot;,
      &quot;MinLength&quot;: &quot;1&quot;,
      &quot;MaxLength&quot;: &quot;64&quot;,
      &quot;AllowedPattern&quot;: &quot;[a-zA-Z][a-zA-Z0-9-]*&quot;,
      &quot;ConstraintDescription&quot;: &quot;must begin with a letter and contain only alphanumeric characters.&quot;
    },
    &quot;AppName&quot;: {
      &quot;Default&quot;: &quot;myapp&quot;,
      &quot;Description&quot;: &quot;The app name&quot;,
      &quot;Type&quot;: &quot;String&quot;,
      &quot;MinLength&quot;: &quot;1&quot;,
      &quot;MaxLength&quot;: &quot;64&quot;,
      &quot;AllowedPattern&quot;: &quot;[a-zA-Z][a-zA-Z0-9]*&quot;,
      &quot;ConstraintDescription&quot;: &quot;must begin with a letter and contain only alphanumeric characters.&quot;
    },
    &quot;MysqlRootPassword&quot; : {
      &quot;Description&quot; : &quot;MysqlRootPassword&quot;,
      &quot;NoEcho&quot; : &quot;true&quot;,
      &quot;Type&quot; : &quot;String&quot;
    }
  },
  &quot;Resources&quot;: {
    &quot;myStack&quot;: {
      &quot;Type&quot;: &quot;AWS::OpsWorks::Stack&quot;,
      &quot;Properties&quot;: {
        &quot;Name&quot;: {
          &quot;Ref&quot;: &quot;AWS::StackName&quot;
        },
        &quot;ServiceRoleArn&quot;: {
          &quot;Fn::Join&quot;: [
            &quot;&quot;, [&quot;arn:aws:iam::&quot;, {&quot;Ref&quot;: &quot;AWS::AccountId&quot;},
                  &quot;:role/&quot;, {&quot;Ref&quot;: &quot;ServiceRole&quot;}]
          ]
        },
        &quot;DefaultInstanceProfileArn&quot;: {
          &quot;Fn::Join&quot;: [
            &quot;&quot;, [&quot;arn:aws:iam::&quot;, {&quot;Ref&quot;: &quot;AWS::AccountId&quot;},
              &quot;:instance-profile/&quot;, {&quot;Ref&quot;: &quot;InstanceRole&quot;}]
          ]
        },
        &quot;UseCustomCookbooks&quot;: &quot;true&quot;,
        &quot;CustomCookbooksSource&quot;: {
          &quot;Type&quot;: &quot;git&quot;,
          &quot;Url&quot;: &quot;git://github.com/amazonwebservices/opsworks-example-cookbooks.git&quot;
        }
      }
    },    
    &quot;myLayer&quot;: {
      &quot;Type&quot;: &quot;AWS::OpsWorks::Layer&quot;,
      &quot;DependsOn&quot;: &quot;myApp&quot;,
      &quot;Properties&quot;: {
        &quot;StackId&quot;: {&quot;Ref&quot;: &quot;myStack&quot;},
        &quot;Type&quot;: &quot;php-app&quot;,
	    &quot;Shortname&quot; : &quot;php-app&quot;,
        &quot;EnableAutoHealing&quot; : &quot;true&quot;,
        &quot;AutoAssignElasticIps&quot; : &quot;false&quot;,
        &quot;AutoAssignPublicIps&quot; : &quot;true&quot;,
        &quot;Name&quot;: &quot;MyPHPApp&quot;,
        &quot;CustomRecipes&quot; : {
          &quot;Configure&quot; : [&quot;phpapp::appsetup&quot;]
        }
      }
    },
    &quot;DBLayer&quot; : {
      &quot;Type&quot; : &quot;AWS::OpsWorks::Layer&quot;,
      &quot;DependsOn&quot;: &quot;myApp&quot;,
      &quot;Properties&quot; : {
        &quot;StackId&quot; : {&quot;Ref&quot;:&quot;myStack&quot;},
        &quot;Type&quot; : &quot;db-master&quot;,
	    &quot;Shortname&quot; : &quot;db-layer&quot;,
        &quot;EnableAutoHealing&quot; : &quot;true&quot;,
        &quot;AutoAssignElasticIps&quot; : &quot;false&quot;,
        &quot;AutoAssignPublicIps&quot; : &quot;true&quot;,
        &quot;Name&quot; : &quot;MyMySQL&quot;,
        &quot;CustomRecipes&quot; : {
          &quot;Setup&quot; : [&quot;phpapp::dbsetup&quot;]
        },
        &quot;Attributes&quot; : {
          &quot;MysqlRootPassword&quot; : {&quot;Ref&quot;:&quot;MysqlRootPassword&quot;},
          &quot;MysqlRootPasswordUbiquitous&quot;: &quot;true&quot;
        },
        &quot;VolumeConfigurations&quot;:[{&quot;MountPoint&quot;:&quot;/vol/mysql&quot;,&quot;NumberOfDisks&quot;:1,&quot;Size&quot;:10}]
      }
    },    
    &quot;ELBAttachment&quot; : {
      &quot;Type&quot; : &quot;AWS::OpsWorks::ElasticLoadBalancerAttachment&quot;,
      &quot;Properties&quot; : {
        &quot;ElasticLoadBalancerName&quot; : { &quot;Ref&quot; : &quot;ELB&quot; },
        &quot;LayerId&quot; : { &quot;Ref&quot; : &quot;myLayer&quot; }
      }
    },	
    &quot;ELB&quot; : {
      &quot;Type&quot;: &quot;AWS::ElasticLoadBalancing::LoadBalancer&quot;,
      &quot;Properties&quot;: {
        &quot;AvailabilityZones&quot;: { &quot;Fn::GetAZs&quot; : &quot;&quot; } ,
        &quot;Listeners&quot;: [{
          &quot;LoadBalancerPort&quot;: &quot;80&quot;,
          &quot;InstancePort&quot;: &quot;80&quot;,
          &quot;Protocol&quot;: &quot;HTTP&quot;,
          &quot;InstanceProtocol&quot;: &quot;HTTP&quot;
        }],
        &quot;HealthCheck&quot;: {
          &quot;Target&quot;: &quot;HTTP:80/&quot;,
          &quot;HealthyThreshold&quot;: &quot;2&quot;,
          &quot;UnhealthyThreshold&quot;: &quot;10&quot;,
          &quot;Interval&quot;: &quot;30&quot;,
          &quot;Timeout&quot;: &quot;5&quot;
        }
      }
    },
    &quot;myAppInstance1&quot;: {
      &quot;Type&quot;: &quot;AWS::OpsWorks::Instance&quot;,
      &quot;Properties&quot;: {
        &quot;StackId&quot;: {&quot;Ref&quot;: &quot;myStack&quot;},
        &quot;LayerIds&quot;: [{&quot;Ref&quot;: &quot;myLayer&quot;}],
        &quot;InstanceType&quot;: &quot;m1.small&quot;
      }
    },    
    &quot;myAppInstance2&quot;: {
      &quot;Type&quot;: &quot;AWS::OpsWorks::Instance&quot;,
      &quot;Properties&quot;: {
        &quot;StackId&quot;: {&quot;Ref&quot;: &quot;myStack&quot;},
        &quot;LayerIds&quot;: [{&quot;Ref&quot;: &quot;myLayer&quot;}],
        &quot;InstanceType&quot;: &quot;m1.small&quot;
      }
    },
    &quot;myDBInstance&quot;: {
      &quot;Type&quot;: &quot;AWS::OpsWorks::Instance&quot;,
      &quot;Properties&quot;: {
        &quot;StackId&quot;: {&quot;Ref&quot;: &quot;myStack&quot;},
        &quot;LayerIds&quot;: [{&quot;Ref&quot;: &quot;DBLayer&quot;}],
        &quot;InstanceType&quot;: &quot;m1.small&quot;
      }
    },
    &quot;myApp&quot; : {
      &quot;Type&quot; : &quot;AWS::OpsWorks::App&quot;,
      &quot;Properties&quot; : {
        &quot;StackId&quot; : {&quot;Ref&quot;:&quot;myStack&quot;},
        &quot;Type&quot; : &quot;php&quot;,
        &quot;Name&quot; : {&quot;Ref&quot;: &quot;AppName&quot;},
        &quot;AppSource&quot; : {
          &quot;Type&quot; : &quot;git&quot;,
          &quot;Url&quot; : &quot;git://github.com/amazonwebservices/opsworks-demo-php-simple-app.git&quot;,
          &quot;Revision&quot; : &quot;version2&quot;
        },
        &quot;Attributes&quot; : {
          &quot;DocumentRoot&quot; : &quot;web&quot;
        }
      }
    }
  }
}</code></pre>
                        </div>
                     
                     <div id="YAML" name="YAML" class="section langfilter">
                        <h3 id="quickref-opsworks-example-1.yaml">YAML</h3>
                        
                        <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">AWSTemplateFormatVersion: &apos;2010-09-09&apos;
Parameters:
  ServiceRole:
    Default: aws-opsworks-service-role
    Description: The OpsWorks service role
    Type: String
    MinLength: &apos;1&apos;
    MaxLength: &apos;64&apos;
    AllowedPattern: &quot;[a-zA-Z][a-zA-Z0-9-]*&quot;
    ConstraintDescription: must begin with a letter and contain only alphanumeric
      characters.
  InstanceRole:
    Default: aws-opsworks-ec2-role
    Description: The OpsWorks instance role
    Type: String
    MinLength: &apos;1&apos;
    MaxLength: &apos;64&apos;
    AllowedPattern: &quot;[a-zA-Z][a-zA-Z0-9-]*&quot;
    ConstraintDescription: must begin with a letter and contain only alphanumeric
      characters.
  AppName:
    Default: myapp
    Description: The app name
    Type: String
    MinLength: &apos;1&apos;
    MaxLength: &apos;64&apos;
    AllowedPattern: &quot;[a-zA-Z][a-zA-Z0-9]*&quot;
    ConstraintDescription: must begin with a letter and contain only alphanumeric
      characters.
  MysqlRootPassword:
    Description: MysqlRootPassword
    NoEcho: &apos;true&apos;
    Type: String
Resources:
  myStack:
    Type: AWS::OpsWorks::Stack
    Properties:
      Name:
        Ref: AWS::StackName
      ServiceRoleArn: !Sub &quot;arn:aws:iam::${AWS::AccountId}:role/${ServiceRole}&quot;
      DefaultInstanceProfileArn: !Sub &quot;arn:aws:iam::${AWS::AccountId}:instance-profile/${InstanceRole}&quot;
      UseCustomCookbooks: &apos;true&apos;
      CustomCookbooksSource:
        Type: git
        Url: git://github.com/amazonwebservices/opsworks-example-cookbooks.git
  myLayer:
    Type: AWS::OpsWorks::Layer
    DependsOn: myApp
    Properties:
      StackId:
        Ref: myStack
      Type: php-app
      Shortname: php-app
      EnableAutoHealing: &apos;true&apos;
      AutoAssignElasticIps: &apos;false&apos;
      AutoAssignPublicIps: &apos;true&apos;
      Name: MyPHPApp
      CustomRecipes:
        Configure:
        - phpapp::appsetup
  DBLayer:
    Type: AWS::OpsWorks::Layer
    DependsOn: myApp
    Properties:
      StackId:
        Ref: myStack
      Type: db-master
      Shortname: db-layer
      EnableAutoHealing: &apos;true&apos;
      AutoAssignElasticIps: &apos;false&apos;
      AutoAssignPublicIps: &apos;true&apos;
      Name: MyMySQL
      CustomRecipes:
        Setup:
        - phpapp::dbsetup
      Attributes:
        MysqlRootPassword:
          Ref: MysqlRootPassword
        MysqlRootPasswordUbiquitous: &apos;true&apos;
      VolumeConfigurations:
      - MountPoint: &quot;/vol/mysql&quot;
        NumberOfDisks: 1
        Size: 10
  ELBAttachment:
    Type: AWS::OpsWorks::ElasticLoadBalancerAttachment
    Properties:
      ElasticLoadBalancerName:
        Ref: ELB
      LayerId:
        Ref: myLayer
  ELB:
    Type: AWS::ElasticLoadBalancing::LoadBalancer
    Properties:
      AvailabilityZones:
        Fn::GetAZs: &apos;&apos;
      Listeners:
      - LoadBalancerPort: &apos;80&apos;
        InstancePort: &apos;80&apos;
        Protocol: HTTP
        InstanceProtocol: HTTP
      HealthCheck:
        Target: HTTP:80/
        HealthyThreshold: &apos;2&apos;
        UnhealthyThreshold: &apos;10&apos;
        Interval: &apos;30&apos;
        Timeout: &apos;5&apos;
  myAppInstance1:
    Type: AWS::OpsWorks::Instance
    Properties:
      StackId:
        Ref: myStack
      LayerIds:
      - Ref: myLayer
      InstanceType: m1.small
  myAppInstance2:
    Type: AWS::OpsWorks::Instance
    Properties:
      StackId:
        Ref: myStack
      LayerIds:
      - Ref: myLayer
      InstanceType: m1.small
  myDBInstance:
    Type: AWS::OpsWorks::Instance
    Properties:
      StackId:
        Ref: myStack
      LayerIds:
      - Ref: DBLayer
      InstanceType: m1.small
  myApp:
    Type: AWS::OpsWorks::App
    Properties:
      StackId:
        Ref: myStack
      Type: php
      Name:
        Ref: AppName
      AppSource:
        Type: git
        Url: git://github.com/amazonwebservices/opsworks-demo-php-simple-app.git
        Revision: version2
      Attributes:
        DocumentRoot: web</code></pre>
                        </div>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="quickref-lambda.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="quickref-redshift.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="AWS OpsWorks Sample PHP App"><a class="pagetoc" href="#quickref-opsworks-sample-php-app">AWS OpsWorks Sample PHP App</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='AWS CloudFormation';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='User Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>