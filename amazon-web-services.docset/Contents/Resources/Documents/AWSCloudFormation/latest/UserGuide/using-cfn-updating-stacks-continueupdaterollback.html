<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Continue Rolling Back an
         Update - AWS CloudFormation
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="using-cfn-updating-stacks.html" title="AWS CloudFormation Stacks Updates">
      <link rel="prev" href="protect-stack-resources.html" title="Prevent Updates to Stack
    Resources">
      <link rel="next" href="using-cfn-stack-exports.html" title="Exporting Stack Output Values">
      <meta name="description" content="For a stack in the UPDATE_ROLLBACK_FAILED state, fix the error that caused the failure and continue rolling back the update to return the stack to a working state (UPDATE_ROLLBACK_COMPLETE).">
      <meta name="keywords" content="CloudFormation,AWSCloudFormation,resource provisioning,resource configuration,infrastructure management,CloudFormer,CloudFormation Designer,CloudFormation stack,CloudFormation stackset,CloudFormation template,change set">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="AWS CloudFormation">
      <meta name="guide" content="User Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-updating-stacks-continueupdaterollback.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/cloudformation">AWS CloudFormation</a> &#xBB; <a href="index.html">User Guide</a> &#xBB; <a href="stacks.html">Working with Stacks</a> &#xBB; <a href="using-cfn-updating-stacks.html">AWS CloudFormation Stacks Updates</a> &#xBB; <span class="breadcrumb">Continue Rolling Back an
                                    Update</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="using-cfn-updating-stacks-continueupdaterollback">Continue Rolling Back an
                        Update
                     </h1>
                     <p>A stack goes into the <code class="code">UPDATE_ROLLBACK_FAILED</code> state when AWS CloudFormation cannot roll back
                        all changes during an update. For example, you might have a stack that begins to roll
                        back to an
                        old database instance that was deleted outside of AWS CloudFormation. Because AWS
                        CloudFormation doesn&apos;t know that the
                        database was deleted, it assumes that the database instance still exists and attempts
                        to roll
                        back to it, causing the update rollback to fail.
                     </p>
                     <p>When a stack is in the <code class="code">UPDATE_ROLLBACK_FAILED</code> state, you can continue to roll
                        it back to a working state (<code class="code">UPDATE_ROLLBACK_COMPLETE</code>). You can&apos;t update a stack
                        that is in the <code class="code">UPDATE_ROLLBACK_FAILED</code> state. However, if you can continue to roll
                        it back, you can return the stack to its original settings and then try to update
                        it
                        again.
                     </p>
                     <p>In most cases, you must <a href="./AWSCloudFormation/latest/UserGuide/troubleshooting.html#troubleshooting-errors-update-rollback-failed" target="_blank">fix the
                           error</a> that causes the update rollback to fail before you can continue to roll back
                        your stack. In other cases, you can continue to roll back the update without any changes,
                        for
                        example when a stack operation times out.
                     </p>
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>If you use nested stacks, rolling back the parent stack will attempt to roll back
                           all the
                           child stacks as well.
                        </p>
                     </div>
                     <p class="title"><b>To continue rolling back an update (console)</b></p>
                     <ol>
                        <li>
                           <p>Open the AWS CloudFormation console at
                              <a href="https://console.aws.amazon.com/cloudformation/" target="_blank">https://console.aws.amazon.com/cloudformation</a>.
                           </p>
                        </li>
                        <li>
                           
                           <p>Select the stack that you want to update, choose <b>Actions</b>, and then
                              choose <b>Continue Update Rollback</b>.
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/cfn-update-stack-continue-update-rollback.png" alt="
          The Continue Update Rollback option in the Actions menu.
        ">
                              
                              
                              
                           </div>
                           
                           <p>If none of the solutions in the <a href="./AWSCloudFormation/latest/UserGuide/troubleshooting.html#troubleshooting-errors-update-rollback-failed" target="_blank">troubleshooting guide</a> worked, you can use the advanced option to skip the
                              resources that AWS CloudFormation can&apos;t successfully roll back. You must <a href="cfn-console-view-stack-data-resources.html">look up</a> and type the logical IDs
                              of the resources that you want to skip. Specify only resources that went into the
                              <code class="code">UPDATE_FAILED</code>  
                              state during the UpdateRollback and not during the forward update.
                           </p>
                           
                           <div class="aws-note">
                              <p class="aws-note">Warning</p>
                              <p>AWS CloudFormation sets the status of the specified resources to <code class="code">UPDATE_COMPLETE</code> and
                                 continues to roll back the stack. After the rollback is complete, the state of the
                                 skipped
                                 resources will be inconsistent with the state of the resources in the stack template.
                                 Before performing another stack update, you must update the stack or resources to
                                 be
                                 consistent with each other. If you don&apos;t, subsequent stack updates might fail, and
                                 the
                                 stack will become unrecoverable.
                              </p>
                           </div>
                           
                           <p>Specify the minimum number of resources required to successfully roll back your stack.
                              For example, a failed resource update might cause dependent resources to fail. In
                              this case,
                              it might not be necessary to skip the dependent resources.
                           </p>
                           
                           <p>To skip resources that are part of nested stacks, use the following format: <code class="code"><em class="replaceable"><code>NestedStackName</code></em>.<em class="replaceable"><code>ResourceLogicalID</code></em></code>. 
                              If you want to specify the logical ID of a stack resource (<code class="code">Type: AWS::CloudFormation::Stack</code>) in the <code class="code">ResourcesToSkip</code> list, 
                              then its corresponding embedded stack must be in one of the following states: <code class="code">DELETE_IN_PROGRESS</code>, <code class="code">DELETE_COMPLETE</code>, or <code class="code">DELETE_FAILED</code>.
                           </p>
                           
                        </li>
                     </ol>
                     <p class="title"><b>To continue rolling back an update (AWS CLI)</b></p>
                     <ul>
                        <li>
                           <p>Use the <code class="code"><a href="./cli/latest/reference/cloudformation/continue-update-rollback.html" target="_blank">aws cloudformation continue-update-rollback</a></code> command with the
                              <code class="code">stack-name</code> option to specify the ID of the stack that you want to continue to
                              roll back.
                           </p>
                        </li>
                     </ul>
                     <h2 id="nested-stacks">Using <code class="code">ResourcesToSkip</code> to recover a nested stacks hierarchy
                     </h2>
                     
                     
                     <p>The following diagram shows a nested stacks hierarchy that is in the
                        <code class="code">UPDATE_ROLLBACK_FAILED</code> state. In this example, the <code class="code">WebInfra</code> root
                        stack has two nested stacks: <code class="code">WebInfra-Compute</code> and <code class="code">WebInfra-Storage</code>,
                        which in turn have one or more nested stacks.
                     </p>
                     
                     <div class="mediaobject">
                        
                        <img src="../../..//img/cfn-update-stack-continue-update-rollback_nested-stacks.png" alt="
        A diagram showing a three-level nested stack hierarchy.
      " style="max-width:100%">
                        
                        
                        
                     </div>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>The stack names in this example are truncated for simplicity. Child stack names are
                           typically generated by AWS CloudFormation and contain unique random strings, so actual
                           names might not be
                           user-friendly. 
                        </p>
                     </div>      
                     
                     <p>To successfully get the root stack into an operable state using
                        <code class="code">continue-update-rollback</code>, you must use the <code class="code">resources-to-skip</code>
                        parameter to skip resources that failed to rollback. In this example,
                        <code class="code">resources-to-skip</code> would include the following items:
                     </p>
                     
                     <div class="orderedlist">
                        
                        
                        
                        
                        
                        <ol>
                           <li>
                              <p>myCustom</p>
                           </li>
                           <li>
                              <p>WebInfra-Compute-Asg.myAsg</p>
                           </li>
                           <li>
                              <p>WebInfra-Compute-LB.myLoadBalancer</p>
                           </li>
                           <li>
                              <p>WebInfra-Storage.DB</p>
                           </li>
                        </ol>
                     </div>
                     
                     <p>The following example is the full CLI command:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">PROMPT&gt; aws cloudformation continue-update-rollback --stack-name WebInfra --resources-to-skip myCustom WebInfra-Compute-Asg.myAsg WebInfra-Compute-LB.myLoadBalancer WebInfra-Storage.DB</code></pre>
                     <p>Note that we specified resources from nested stacks by using the
                        <code class="code"><em class="replaceable"><code>NestedStackName</code></em>.<em class="replaceable"><code>ResourceLogicalID</code></em></code>
                        format, but for the resources of the root stack, such as <em>myCustom</em>, we
                        specified only the logical ID.
                     </p>
                     
                     <p><b>Finding the stack name of a nested stack</b></p>
                     
                     <p>You can find a child stack&apos;s name in its stack ID or Amazon Resource Name (ARN). In
                        the following example, the stack name is <em>WebInfra-Storage-Z2VKC706XKXT</em>:
                     </p>
                     
                     <p><code class="code">arn:aws:cloudformation:us-east-1:123456789012:stack/WebInfra-Storage-Z2VKC706XKXT/ea9e7f90-54f7-11e6-a032-028f3d2330bd</code></p>  
                     
                     <p><b>Finding the logical ID of a nested stack</b></p>
                     
                     <p>You can find a child stack&apos;s logical ID in the template definition of its parent.
                        In the diagram, the <code class="code">LogicalId</code> of the <code class="code">WebInfra-Storage-DB</code> child stack is <em>DB</em> in its parent <code class="code">WebInfra-Storage</code>.
                     </p>
                     
                     <p>In the AWS CloudFormation console, you can also find the logical ID in the <b>Logical ID</b> column for the stack resource on the <b>Resources</b> tab or the <b>Events</b> tab.
                     </p>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="protect-stack-resources.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="using-cfn-stack-exports.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Using ResourcesToSkip to recover a nested stacks hierarchy"><a class="pagetoc" href="#nested-stacks">Using ResourcesToSkip to recover a nested stacks hierarchy</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='AWS CloudFormation';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='User Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>