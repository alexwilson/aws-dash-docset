<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>IAM Roles for Amazon EC2 - Amazon Elastic Compute Cloud</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="UsingIAM.html" title="Controlling Access to Amazon EC2 Resources">
      <link rel="prev" href="iam-policies-ec2-console.html" title="Example Policies for Working in the Amazon EC2 Console">
      <link rel="next" href="authorizing-access-to-an-instance.html" title="Authorizing Inbound Traffic for Your Linux Instances">
      <meta name="description" content="Allow applications to make secure API requests by creating IAM roles and assigning them to your EC2 instances.">
      <meta name="keywords" content="EC2,Amazon EC2,EC2 instance,instance,VM,virtual machine">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon Elastic Compute Cloud">
      <meta name="guide" content="User Guide for Linux Instances">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/ec2">Amazon EC2</a> &#xBB; <a href="index.html">User Guide for Linux Instances</a> &#xBB; <a href="EC2_Network_and_Security.html">Network and Security</a> &#xBB; <a href="UsingIAM.html">Controlling Access to Amazon EC2 Resources</a> &#xBB; <span class="breadcrumb">IAM Roles for Amazon EC2</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="iam-roles-for-amazon-ec2">IAM Roles for Amazon EC2</h1>
                     <p>Applications must sign their API requests with AWS credentials. Therefore, if you
                        are
                        			an application developer, you need a strategy for managing credentials for your
                        			applications that run on EC2 instances. For example, you can securely distribute
                        your
                        			AWS credentials to the instances, enabling the applications on those instances
                        to use
                        			your credentials to sign requests, while protecting your credentials from other
                        users.
                        			However, it&apos;s challenging to securely distribute credentials to each instance,
                        			especially those that AWS creates on your behalf, such as Spot Instances or instances
                        in
                        			Auto Scaling groups. You must also be able to update the credentials on each instance
                        when you
                        			rotate your AWS credentials.
                     </p>
                     <p>We designed IAM roles so that your applications can securely make API requests from
                        			your instances, without requiring you to manage the security credentials that the
                        			applications use. Instead of creating and distributing your AWS credentials, you
                        can
                        			delegate permission to make API requests using IAM roles as follows:
                     </p>
                     <div class="orderedlist">
                        			
                        			
                        			
                        			
                        			
                        		
                        <ol>
                           <li>
                              				
                              <p>Create an IAM role.</p>
                              			
                           </li>
                           <li>
                              				
                              <p>Define which accounts or AWS services can assume the role.</p>
                              			
                           </li>
                           <li>
                              				
                              <p>Define which API actions and resources the application can use after assuming
                                 					the role.
                              </p>
                              			
                           </li>
                           <li>
                              				
                              <p>Specify the role when you launch your instance, or attach the role to a
                                 					running or stopped instance.
                              </p>
                              			
                           </li>
                           <li>
                              				
                              <p>Have the application retrieve a set of temporary credentials and use
                                 					them.
                              </p>
                              			
                           </li>
                        </ol>
                     </div>
                     <p>For example, you can use IAM roles to grant permissions to applications running on
                        your
                        			instances that need to use a bucket in Amazon S3. You can specify permissions for
                        IAM roles
                        			by creating a policy in JSON format. These are similar to the policies that you
                        create
                        			for IAM users. If you change a role, the change is propagated to all instances.
                     </p>
                     <p>You cannot attach multiple IAM roles to a single instance, but you can attach a
                        			single IAM role to multiple instances. For more information about creating and
                        using
                        			IAM roles, see <a href="./IAM/latest/UserGuide/WorkingWithRoles.html" target="_blank">Roles</a> in the
                        				<em>IAM User Guide</em>.
                     </p>
                     <p>You can apply resource-level permissions to your IAM policies to control the users&apos;
                        			ability to attach, replace, or detach IAM roles for an instance. For more information,
                        			see <a href="ec2-supported-iam-actions-resources.html">Supported Resource-Level Permissions for Amazon EC2 API Actions</a> and the following example:
                        				<a href="ExamplePolicies_EC2.html#iam-example-iam-roles">10: Working with IAM Roles</a>.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#ec2-instance-profile">Instance Profiles</a></li>
                           <li><a href="#instance-metadata-security-credentials">Retrieving Security Credentials from Instance Metadata</a></li>
                           <li><a href="#permission-to-pass-iam-roles">Granting an IAM User Permission to Pass
                                 				an IAM Role to an Instance</a></li>
                           <li><a href="#working-with-iam-roles">Working with IAM Roles</a></li>
                        </ul>
                     </div>
                     			
                     <h2 id="ec2-instance-profile">Instance Profiles</h2>
                     			
                     			
                     <p>Amazon EC2 uses an <em>instance profile</em> as a container for an IAM
                        				role. When you create an IAM role using the IAM console, the console creates an
                        				instance profile automatically and gives it the same name as the role to which
                        it
                        				corresponds. If you use the Amazon EC2 console to launch an instance with an IAM
                        role
                        				or to attach an IAM role to an instance, you choose the instance based on a list
                        				of instance profile names. 
                     </p>
                     			
                     <p>If you use the AWS CLI, API, or an AWS SDK to create a role, you create the role and
                        				instance profile as separate actions, with potentially different names. If you
                        then
                        				use the AWS CLI, API, or an AWS SDK to launch an instance with an IAM role or
                        to
                        				attach an IAM role to an instance, specify the instance profile name. 
                     </p>
                     			
                     <p>An instance profile can contain only one IAM role. This limit cannot be
                        				increased.
                     </p>
                     			
                     <p>For more information, see <a href="./IAM/latest/UserGuide/instance-profiles.html" target="_blank">Instance Profiles</a> in the <em>IAM User Guide</em>.
                     </p>
                     		
                     			
                     <h2 id="instance-metadata-security-credentials">Retrieving Security Credentials from Instance Metadata</h2>
                     			
                     			
                     <p>An application on the instance retrieves the security credentials provided by the
                        role from
                        				the instance metadata item
                        					<code class="code">iam/security-credentials/</code><em>role-name</em>. The
                        				application is granted the permissions for the actions and resources that you&apos;ve
                        				defined for the role through the security credentials associated with the role.
                        				These security credentials are temporary and we rotate them automatically. We
                        make
                        				new credentials available at least five minutes before the expiration of the old
                        				credentials.
                     </p>
                     			
                     <div class="aws-note">
                        <p class="aws-note">Warning</p>
                        <p>If you use services that use instance metadata with IAM roles, ensure that
                           					you don&apos;t expose your credentials when the services make HTTP calls on your
                           					behalf. The types of services that could expose your credentials include HTTP
                           					proxies, HTML/CSS validator services, and XML processors that support XML
                           					inclusion.
                        </p>
                     </div>
                     			
                     <p>The following command retrieves the security credentials for an IAM role named
                        					<code class="code">s3access</code>.
                     </p>
                     			<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code>curl http://169.254.169.254/latest/meta-data/iam/security-credentials/s3access</code></strong></code></pre>
                     			<p>The following is example output.</p>
                     			<pre class="programlisting"><div class="code-btn-container"><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  &quot;Code&quot; : &quot;Success&quot;,
  &quot;LastUpdated&quot; : &quot;2012-04-26T16:39:16Z&quot;,
  &quot;Type&quot; : &quot;AWS-HMAC&quot;,
  &quot;AccessKeyId&quot; : &quot;ASIAIOSFODNN7EXAMPLE&quot;,
  &quot;SecretAccessKey&quot; : &quot;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&quot;,
  &quot;Token&quot; : &quot;<em>token</em>&quot;,
  &quot;Expiration&quot; : &quot;2017-05-17T15:09:54Z&quot;
}</code></pre>
                     			<p>For applications, AWS CLI, and Tools for Windows PowerShell commands that run on the
                        instance, you do not
                        				have to explicitly get the temporary security credentials &#x2014; the AWS SDKs,
                        				AWS CLI, and Tools for Windows PowerShell automatically get the credentials from
                        the EC2 instance metadata
                        				service and use them. To make a call outside of the instance using temporary
                        				security credentials (for example, to test IAM policies), you must provide the
                        				access key, secret key, and the session token. For more information, see <a href="./IAM/latest/UserGuide/id_credentials_temp_use-resources.html" target="_blank">Using Temporary
                           					Security Credentials to Request Access to AWS Resources</a> in the
                        					<em>IAM User Guide</em>.
                     </p>
                     			
                     <p>For more information about instance metadata, see <a href="ec2-instance-metadata.html">Instance Metadata and User Data</a>. 
                     </p>
                     		
                     			
                     <h2 id="permission-to-pass-iam-roles">Granting an IAM User Permission to Pass
                        				an IAM Role to an Instance
                     </h2>
                     			
                     			
                     <p>To enable an IAM user to launch an instance with an IAM role or to attach or
                        				replace an IAM role for an existing instance, you must grant the user permission
                        				to pass the role to the instance.
                     </p>
                     			
                     <p>The following IAM policy grants users permission to launch instances
                        					(<code class="code">ec2:RunInstances</code>) with an IAM role, or to attach or replace an
                        				IAM role for an existing instance (<code class="code">ec2:AssociateIamInstanceProfile</code>
                        				and <code class="code">ec2:ReplaceIamInstanceProfileAssociation</code>).
                     </p>
                     			<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [
         &quot;ec2:RunInstances&quot;,
         &quot;ec2:AssociateIamInstanceProfile&quot;,
         &quot;ec2:ReplaceIamInstanceProfileAssociation&quot;
      ],
      &quot;Resource&quot;: &quot;*&quot;
    },
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: &quot;iam:PassRole&quot;,
      &quot;Resource&quot;: &quot;*&quot;
    }
  ]
}</code></pre>
                     			<p>This policy grants IAM users access to all your roles by specifying the resource as
                        &quot;*&quot;
                        				in the policy. However, consider whether users who launch instances with your
                        roles
                        				(ones that exist or that you create later on) might be granted permissions that
                        they
                        				don&apos;t need or shouldn&apos;t have.
                     </p>
                     		
                     			
                     <h2 id="working-with-iam-roles">Working with IAM Roles</h2>
                     			
                     			
                     <p>You can create an IAM role and attach it to an instance during or after launch.
                        				You can also replace or detach an IAM role for an instance.
                     </p>
                     			
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Contents</strong></p>
                        <ul>
                           <li><a href="#create-iam-role">Creating an IAM Role</a></li>
                           <li><a href="#launch-instance-with-role">Launching an Instance with an IAM Role</a></li>
                           <li><a href="#attach-iam-role">Attaching an IAM Role to an Instance</a></li>
                           <li><a href="#detach-iam-role">Detaching an IAM Role</a></li>
                           <li><a href="#replace-iam-role">Replacing an IAM Role</a></li>
                        </ul>
                     </div>
                     			
                     				
                     <h3 id="create-iam-role">Creating an IAM Role</h3>
                     				
                     				
                     <p>You must create an IAM role before you can launch an instance with that role
                        					or attach it to an instance.
                     </p>
                     				<a id="create-iam-role-console"></a><p class="title"><b>To create an IAM role using the
                           						IAM console</b></p>
                     <ol>
                        <li>
                           <p>Open the IAM console at
                              <a href="https://console.aws.amazon.com/iam/" target="_blank">https://console.aws.amazon.com/iam/</a>.
                           </p>
                        </li>
                        <li>
                           						
                           <p>In the navigation pane, choose <b>Roles</b>, <b>Create
                                 role</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>On the <b>Select role type</b> page, choose <b>EC2</b> and
                              the <b>EC2</b> use case. Choose <b>Next:
                                 Permissions</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>On the <b>Attach permissions policy</b> page, select an AWS managed
                              policy that grants your instances access to the resources that they
                              need.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>On the <b>Review</b> page, type a name for the role and choose
                              <b>Create role</b>.
                           </p>
                           					
                        </li>
                     </ol>
                     
                     				
                     <p>Alternatively, you can use the AWS CLI to create an IAM role.</p>
                     				<a id="create-iam-role-cli"></a><p class="title"><b>To create an IAM role and instance
                           						profile using the AWS CLI</b></p>
                     <ul>
                        <li>
                           						
                           <p>Create an IAM role with a policy that allows the role to use an Amazon S3
                              							bucket.
                           </p>
                           						
                           <ol>
                              <li>
                                 								
                                 <p>Create the following trust policy and save it in a text file
                                    									named <code>ec2-role-trust-policy.json</code>.
                                 </p>
                                 								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: { &quot;Service&quot;: &quot;ec2.amazonaws.com&quot;},
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    }
  ]
}</code></pre>
                                 							</li>
                              <li>
                                 								
                                 <p>Create the <code class="code">s3access</code> role and specify the trust
                                    									policy that you created.
                                 </p>
                                 								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws iam create-role</b> --role-name s3access --assume-role-policy-document file://ec2-role-trust-policy.json</code></strong>
<code class="computeroutput" copy="false">{
    &quot;Role&quot;: {
        &quot;AssumeRolePolicyDocument&quot;: {
            &quot;Version&quot;: &quot;2012-10-17&quot;,
            &quot;Statement&quot;: [
                {
                    &quot;Action&quot;: &quot;sts:AssumeRole&quot;,
                    &quot;Effect&quot;: &quot;Allow&quot;,
                    &quot;Principal&quot;: {
                        &quot;Service&quot;: &quot;ec2.amazonaws.com&quot;
                    }
                }
            ]
        },
        &quot;RoleId&quot;: &quot;AROAIIZKPBKS2LEXAMPLE&quot;,
        &quot;CreateDate&quot;: &quot;2013-12-12T23:46:37.247Z&quot;,
        &quot;RoleName&quot;: &quot;s3access&quot;,
        &quot;Path&quot;: &quot;/&quot;,
        &quot;Arn&quot;: &quot;arn:aws:iam::123456789012:role/s3access&quot;
    }
}</code></code></pre>
                                 							</li>
                              <li>
                                 								
                                 <p>Create an access policy and save it in a text file named
                                    										<code>ec2-role-access-policy.json</code>. For
                                    									example, this policy grants administrative permissions for Amazon S3
                                    									to applications running on the instance.
                                 </p>
                                 								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [&quot;s3:*&quot;],
      &quot;Resource&quot;: [&quot;*&quot;]
    }
  ]
}</code></pre>
                                 							</li>
                              <li>
                                 								
                                 <p>Attach the access policy to the role.</p>
                                 								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws iam put-role-policy</b> --role-name s3access --policy-name S3-Permissions --policy-document file://ec2-role-access-policy.json</code></strong></code></pre>
                                 							</li>
                              <li>
                                 								
                                 <p>Create an instance profile named
                                    									<code class="code">s3access-profile</code>.
                                 </p>
                                 								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws iam create-instance-profile</b> --instance-profile-name s3access-profile</code></strong><code class="computeroutput" copy="false">
{
    &quot;InstanceProfile&quot;: {
        &quot;InstanceProfileId&quot;: &quot;AIPAJTLBPJLEGREXAMPLE&quot;,
        &quot;Roles&quot;: [],
        &quot;CreateDate&quot;: &quot;2013-12-12T23:53:34.093Z&quot;,
        &quot;InstanceProfileName&quot;: &quot;s3access-profile&quot;,
        &quot;Path&quot;: &quot;/&quot;,
        &quot;Arn&quot;: &quot;arn:aws:iam::123456789012:instance-profile/s3access-profile&quot;
    }
}</code></code></pre>
                                 							</li>
                              <li>
                                 								
                                 <p>Add the <code class="code">s3access</code> role to the
                                    										<code class="code">s3access-profile</code> instance profile.
                                 </p>
                                 								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws iam add-role-to-instance-profile</b> --instance-profile-name s3access-profile --role-name s3access</code></strong></code></pre>
                                 							</li>
                           </ol>
                           						
                           <p>For more information about these commands, see <a href="./cli/latest/reference/iam/create-role.html" target="_blank">create-role</a>, <a href="./cli/latest/reference/iam/put-role-policy.html" target="_blank">put-role-policy</a>,
                              							and <a href="./cli/latest/reference/iam/create-instance-profile.html" target="_blank">create-instance-profile</a> in the
                              								<em>AWS CLI Command Reference</em>. 
                           </p>
                           						
                           <p>Alternatively, you can use the following AWS Tools for Windows PowerShell commands:</p>
                           						
                           <div class="itemizedlist">
                              							
                              							
                              							
                              						
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    								
                                    <p><a href="./powershell/latest/reference/items/New-IAMRole.html" target="_blank">New-IAMRole</a></p>
                                    							
                                 </li>
                                 <li class="listitem">
                                    								
                                    <p><a href="./powershell/latest/reference/items/Register-IAMRolePolicy.html" target="_blank">Register-IAMRolePolicy</a></p>
                                    							
                                 </li>
                                 <li class="listitem">
                                    								
                                    <p><a href="./powershell/latest/reference/items/New-IAMInstanceProfile.html" target="_blank">New-IAMInstanceProfile</a></p>
                                    							
                                 </li>
                              </ul>
                           </div>
                           					
                        </li>
                     </ul>
                     			
                     			
                     				
                     <h3 id="launch-instance-with-role">Launching an Instance with an IAM Role</h3>
                     				
                     				
                     <p>After you&apos;ve created an IAM role, you can launch an instance, and associate
                        					that role with the instance during launch.
                     </p>
                     				
                     <div class="aws-note">
                        <p class="aws-note">Important</p>
                        <p>After you create an IAM role, it may take several seconds for the
                           						permissions to propagate. If your first attempt to launch an instance with a
                           						role fails, wait a few seconds before trying again. For more information,
                           						see <a href="./IAM/latest/UserGuide/RolesTroubleshooting.html" target="_blank">Troubleshooting
                              							Working with Roles</a> in the
                           						<em>IAM User Guide</em>.
                        </p>
                     </div>
                     				<a id="launch-instance-with-role-console"></a><p class="title"><b>To launch an instance with
                           						an IAM role using the console</b></p>
                     <ol>
                        <li>
                           <p>Open the Amazon EC2 console at
                              <a href="https://console.aws.amazon.com/ec2/" target="_blank">https://console.aws.amazon.com/ec2/</a>.
                           </p>
                        </li>
                        <li>
                           						
                           <p>On the dashboard, choose <b>Launch Instance</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Select an AMI and instance type and then choose <b>Next:
                                 								Configure Instance Details</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>On the <b>Configure Instance Details</b> page, for
                              								<b>IAM role</b>, select the IAM role that you
                              							created. 
                           </p>
                           						
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>The <b>IAM role</b> list displays the name of the
                                 								instance profile that you created when you created your IAM role.
                                 								If you created your IAM role using the console, the instance
                                 								profile was created for you and given the same name as the role. If
                                 								you created your IAM role using the AWS CLI, API, or an AWS SDK,
                                 								you may have named your instance profile differently. 
                              </p>
                           </div>
                           					
                        </li>
                        <li>
                           						
                           <p>Configure any other details, then follow the instructions through the
                              							rest of the wizard, or choose <b>Review and Launch</b> to
                              							accept default settings and go directly to the <b>Review Instance
                                 								Launch</b> page.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Review your settings, then choose <b>Launch</b> to
                              							choose a key pair and launch your instance.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>If you are using the Amazon EC2 API actions in your application, retrieve the AWS
                              security
                              							credentials made available on the instance and use them to sign the
                              							requests. The AWS SDK does this for you.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code>curl http://169.254.169.254/latest/meta-data/iam/security-credentials/<em class="replaceable"><code>role_name</code></em></code></strong></code></pre>
                           					</li>
                     </ol>
                     				
                     <p>Alternatively, you can use the AWS CLI to associate a role with an instance
                        					during launch. You must specify the instance profile in the command.
                     </p>
                     				<a id="launch-instance-with-role-cli"></a><p class="title"><b>To launch an instance with an
                           						IAM role using the AWS CLI</b></p>
                     <ol>
                        <li>
                           						
                           <p>Use the <a href="./cli/latest/reference/ec2/run-instances.html" target="_blank">run-instances</a> command to launch an instance using the
                              							instance profile. The following example shows how to launch an instance
                              							with the instance profile. 
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws ec2 run-instances</b> --image-id ami-11aa22bb --iam-instance-profile Name=&quot;s3access-profile&quot; --key-name my-key-pair --security-groups my-security-group --subnet-id subnet-1a2b3c4d</code></strong></code></pre>
                           						<p>Alternatively, use the <a href="./powershell/latest/reference/items/New-EC2Instance.html" target="_blank">New-EC2Instance</a> Tools for Windows PowerShell command.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>If you are using the Amazon EC2 API actions in your application, retrieve the AWS
                              security
                              							credentials made available on the instance and use them to sign the
                              							requests. The AWS SDK does this for you.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code>curl http://169.254.169.254/latest/meta-data/iam/security-credentials/</code></strong><em class="replaceable"><code>role_name</code></em></code></pre>
                           					</li>
                     </ol>
                     			
                     			
                     				
                     <h3 id="attach-iam-role">Attaching an IAM Role to an Instance</h3>
                     				
                     				
                     <p>After you&apos;ve created an IAM role, you can attach it to a running or stopped
                        					instance.
                     </p>
                     				<a id="attach-iam-role-console"></a><p class="title"><b>To attach an IAM role to an instance
                           						using the console</b></p>
                     <ol>
                        <li>
                           <p>Open the Amazon EC2 console at
                              <a href="https://console.aws.amazon.com/ec2/" target="_blank">https://console.aws.amazon.com/ec2/</a>.
                           </p>
                        </li>
                        <li>
                           						
                           <p>In the navigation pane, choose <b>Instances</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Select the instance, choose <b>Actions</b>,
                              								<b>Instance Settings</b>, <b>Attach/Replace IAM
                                 								role</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Select the IAM role to attach to your instance, and choose
                              								<b>Apply</b>.
                           </p>
                           					
                        </li>
                     </ol>
                     				<a id="attach-iam-role-instance-cli"></a><p class="title"><b>To attach an IAM role to an
                           						instance using the AWS CLI</b></p>
                     <ol>
                        <li>
                           						
                           <p>If required, describe your instances to get the ID of the instance to
                              							which to attach the role.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws ec2 describe-instances</b></code></strong></code></pre>
                           					</li>
                        <li>
                           						
                           <p>Use the <a href="./cli/latest/reference/ec2/associate-iam-instance-profile.html" target="_blank">associate-iam-instance-profile</a> command to attach the IAM
                              							role to the instance by specifying the instance profile. You can use the
                              							Amazon Resource Name (ARN) of the instance profile, or you can use its
                              							name.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws ec2 associate-iam-instance-profile --instance-id <em class="replaceable"><code>i-1234567890abcdef0</code></em> --iam-instance-profile Name=&quot;<em class="replaceable"><code>TestRole-1</code></em></b>&quot;</code></strong><code class="computeroutput" copy="false">

{
    &quot;IamInstanceProfileAssociation&quot;: {
        &quot;InstanceId&quot;: &quot;i-1234567890abcdef0&quot;, 
        &quot;State&quot;: &quot;associating&quot;, 
        &quot;AssociationId&quot;: &quot;iip-assoc-0dbd8529a48294120&quot;, 
        &quot;IamInstanceProfile&quot;: {
            &quot;Id&quot;: &quot;AIPAJLNLDX3AMYZNWYYAY&quot;, 
            &quot;Arn&quot;: &quot;arn:aws:iam::123456789012:instance-profile/TestRole-1&quot;
        }
    }
}</code></code></pre>
                           					</li>
                     </ol>
                     				
                     <p>Alternatively, use the following Tools for Windows PowerShell commands:</p>
                     				
                     <div class="itemizedlist">
                        					
                        					
                        				
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              						
                              <p><a href="./powershell/latest/reference/items/Get-EC2Instance.html" target="_blank">Get-EC2Instance</a></p>
                              					
                           </li>
                           <li class="listitem">
                              						
                              <p><a href="./powershell/latest/reference/items/Register-EC2IamInstanceProfile.html" target="_blank">Register-EC2IamInstanceProfile</a></p>
                              					
                           </li>
                        </ul>
                     </div>
                     			
                     			
                     				
                     <h3 id="detach-iam-role">Detaching an IAM Role</h3>
                     				
                     				
                     <p>You can detach an IAM role from a running or stopped instance. </p>
                     				<a id="detach-iam-role-console"></a><p class="title"><b>To detach an IAM role from an
                           						instance using the console</b></p>
                     <ol>
                        <li>
                           <p>Open the Amazon EC2 console at
                              <a href="https://console.aws.amazon.com/ec2/" target="_blank">https://console.aws.amazon.com/ec2/</a>.
                           </p>
                        </li>
                        <li>
                           						
                           <p>In the navigation pane, choose <b>Instances</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Select the instance, choose <b>Actions</b>,
                              								<b>Instance Settings</b>, <b>Attach/Replace IAM
                                 								role</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>For <b>IAM role</b>, choose <b>No
                                 							Role</b>. Choose <b>Apply</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>In the confirmation dialog box, choose <b>Yes,
                                 								Detach</b>.
                           </p>
                           					
                        </li>
                     </ol>
                     				<a id="detach-iam-role-cli"></a><p class="title"><b>To detach an IAM role from an instance
                           						using the AWS CLI</b></p>
                     <ol>
                        <li>
                           						
                           <p>If required, use <a href="./cli/latest/reference/ec2/describe-iam-instance-profile-associations.html" target="_blank">describe-iam-instance-profile-associations</a> to describe your
                              							IAM instance profile associations and get the association ID for the
                              							IAM instance profile to detach.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws ec2 describe-iam-instance-profile-associations</b></code></strong><code class="computeroutput" copy="false">

{
    &quot;IamInstanceProfileAssociations&quot;: [
        {
            &quot;InstanceId&quot;: &quot;i-088ce778fbfeb4361&quot;, 
            &quot;State&quot;: &quot;associated&quot;, 
            &quot;AssociationId&quot;: &quot;iip-assoc-0044d817db6c0a4ba&quot;, 
            &quot;IamInstanceProfile&quot;: {
                &quot;Id&quot;: &quot;AIPAJEDNCAA64SSD265D6&quot;, 
                &quot;Arn&quot;: &quot;arn:aws:iam::123456789012:instance-profile/TestRole-2&quot;
            }
        }
    ]
}</code></code></pre>
                           					</li>
                        <li>
                           						
                           <p>Use the <a href="./cli/latest/reference/ec2/disassociate-iam-instance-profile.html" target="_blank">disassociate-iam-instance-profile</a> command to detach the
                              							IAM instance profile using its association ID.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws ec2 disassociate-iam-instance-profile --association-id <em class="replaceable"><code>iip-assoc-0044d817db6c0a4ba</code></em></b></code></strong><code class="computeroutput" copy="false">

{
    &quot;IamInstanceProfileAssociation&quot;: {
        &quot;InstanceId&quot;: &quot;i-087711ddaf98f9489&quot;, 
        &quot;State&quot;: &quot;disassociating&quot;, 
        &quot;AssociationId&quot;: &quot;iip-assoc-0044d817db6c0a4ba&quot;, 
        &quot;IamInstanceProfile&quot;: {
            &quot;Id&quot;: &quot;AIPAJEDNCAA64SSD265D6&quot;, 
            &quot;Arn&quot;: &quot;arn:aws:iam::123456789012:instance-profile/TestRole-2&quot;
        }
    }
}</code></code></pre>
                           					</li>
                     </ol>
                     				
                     <p>Alternatively, use the following Tools for Windows PowerShell commands:</p>
                     				
                     <div class="itemizedlist">
                        					
                        					
                        				
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              						
                              <p><a href="./powershell/latest/reference/items/Get-EC2IamInstanceProfileAssociation.html" target="_blank">Get-EC2IamInstanceProfileAssociation</a></p>
                              					
                           </li>
                           <li class="listitem">
                              						
                              <p><a href="./powershell/latest/reference/items/Unregister-EC2IamInstanceProfile.html" target="_blank">Unregister-EC2IamInstanceProfile</a></p>
                              					
                           </li>
                        </ul>
                     </div>
                     			
                     			
                     				
                     <h3 id="replace-iam-role">Replacing an IAM Role</h3>
                     				
                     				
                     <p>You can replace an IAM role for a running instance. You can do this if you
                        					want to change the IAM role for an instance without detaching the existing one
                        					first; for example, to ensure that API actions performed by applications running
                        					on the instance are not interrupted.
                     </p>
                     				<a id="replace-iam-role-console"></a><p class="title"><b>To replace an IAM role for an instance using the
                           console</b></p>
                     <ol>
                        <li>
                           <p>Open the Amazon EC2 console at
                              <a href="https://console.aws.amazon.com/ec2/" target="_blank">https://console.aws.amazon.com/ec2/</a>.
                           </p>
                        </li>
                        <li>
                           						
                           <p>In the navigation pane, choose <b>Instances</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Select the instance, choose <b>Actions</b>,
                              								<b>Instance Settings</b>, <b>Attach/Replace IAM
                                 								role</b>.
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Select the IAM role to attach to your instance, and choose
                              								<b>Apply</b>.
                           </p>
                           					
                        </li>
                     </ol>
                     				<a id="replace-iam-role-cli"></a><p class="title"><b>To replace an IAM role for an instance
                           						using the AWS CLI</b></p>
                     <ol>
                        <li>
                           						
                           <p>If required, describe your IAM instance profile associations to get
                              							the association ID for the IAM instance profile to replace.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws ec2 describe-iam-instance-profile-associations</b></code></strong></code></pre>
                           					</li>
                        <li>
                           						
                           <p>Use the <a href="./cli/latest/reference/ec2/replace-iam-instance-profile-association.html" target="_blank">replace-iam-instance-profile-association</a> command to replace
                              							the IAM instance profile by specifying the association ID for the
                              							existing instance profile and the ARN or name of the instance profile
                              							that should replace it.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><strong class="userinput"><code><b>aws ec2 replace-iam-instance-profile-association --association-id <em class="replaceable"><code>iip-assoc-0044d817db6c0a4ba</code></em> --iam-instance-profile Name=&quot;<em class="replaceable"><code>TestRole-2</code></em></b>&quot;</code></strong><code class="computeroutput" copy="false">

{
    &quot;IamInstanceProfileAssociation&quot;: {
        &quot;InstanceId&quot;: &quot;i-087711ddaf98f9489&quot;, 
        &quot;State&quot;: &quot;associating&quot;, 
        &quot;AssociationId&quot;: &quot;iip-assoc-09654be48e33b91e0&quot;, 
        &quot;IamInstanceProfile&quot;: {
            &quot;Id&quot;: &quot;AIPAJCJEDKX7QYHWYK7GS&quot;, 
            &quot;Arn&quot;: &quot;arn:aws:iam::123456789012:instance-profile/TestRole-2&quot;
        }
    }
}</code></code></pre>
                           					</li>
                     </ol>
                     				
                     <p>Alternatively, use the following Tools for Windows PowerShell commands:</p>
                     				
                     <div class="itemizedlist">
                        					
                        					
                        				
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              						
                              <p><a href="./powershell/latest/reference/items/Get-EC2IamInstanceProfileAssociation.html" target="_blank">Get-EC2IamInstanceProfileAssociation</a></p>
                              					
                           </li>
                           <li class="listitem">
                              						
                              <p><a href="./powershell/latest/reference/items/Set-EC2IamInstanceProfileAssociation.html" target="_blank">Set-EC2IamInstanceProfileAssociation</a></p>
                              					
                           </li>
                        </ul>
                     </div>
                     			
                     		
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="iam-policies-ec2-console.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="authorizing-access-to-an-instance.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Instance Profiles"><a class="pagetoc" href="#ec2-instance-profile">Instance Profiles</a></li>
                        <li class="pagetoc" name="Retrieving Security Credentials from Instance Metadata"><a class="pagetoc" href="#instance-metadata-security-credentials">Retrieving Security Credentials from Instance Metadata</a></li>
                        <li class="pagetoc" name="Granting an IAM User Permission to Pass
				an IAM Role to an Instance"><a class="pagetoc" href="#permission-to-pass-iam-roles">Granting an IAM User Permission to Pass
                              				an IAM Role to an Instance</a></li>
                        <li class="pagetoc" name="Working with IAM Roles"><a class="pagetoc" href="#working-with-iam-roles">Working with IAM Roles</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Elastic Compute Cloud';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='User Guide for Linux Instances';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>