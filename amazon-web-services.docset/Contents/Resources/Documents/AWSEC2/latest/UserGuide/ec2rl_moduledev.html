<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Developing EC2Rescue Modules - Amazon Elastic Compute Cloud</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="Linux-Server-EC2Rescue.html" title="Using EC2Rescue for Linux">
      <link rel="prev" href="ec2rl_working.html" title="Working with EC2Rescue for Linux">
      <link rel="next" href="ec2-instance-troubleshoot.html" title="Troubleshooting Instances">
      <meta name="description" content="Modules are written in YAML, a data serialization standard. A module&apos;s YAML file consists of a single document, representing the module and its attributes.">
      <meta name="keywords" content="EC2,Amazon EC2,EC2 instance,instance,VM,virtual machine">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon Elastic Compute Cloud">
      <meta name="guide" content="User Guide for Linux Instances">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2rl_moduledev.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/ec2">Amazon EC2</a> &#xBB; <a href="index.html">User Guide for Linux Instances</a> &#xBB; <a href="Linux-Server-EC2Rescue.html">Using EC2Rescue for Linux</a> &#xBB; <span class="breadcrumb">Developing EC2Rescue Modules</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="ec2rl_moduledev">Developing EC2Rescue Modules</h1>
                     <p>Modules are written in YAML, a data serialization standard. A module&apos;s YAML file consists
                        of a single document, representing the module and its attributes.
                     </p>
                     
                     <h2 id="ec2rl-adding-modules">Adding Module Attributes</h2>
                     
                     
                     <p>The following table lists the available module attributes.</p>
                     
                     <div class="table">
                        <p class="title"><b></b></p>
                        <div class="table-contents">
                           <table id="w185aac27c13b5b5">
                              
                              <tbody><tr>
                                 
                                 <th>
                                    <p>Attribute</p>
                                 </th>
                                 
                                 <th>
                                    <p>Description</p>
                                 </th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td>
                                    <p>name</p>
                                 </td>
                                 
                                 <td>
                                    <p>The name of the module. The name should be less than or equal to 18
                                       characters in length.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>version</p>
                                 </td>
                                 
                                 <td>
                                    <p>The version number of the module.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>title</p>
                                 </td>
                                 
                                 <td>
                                    <p>A short, descriptive title for the module. This value should be less than
                                       or equal to 50 characters in length.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>helptext</p>
                                 </td>
                                 
                                 <td>
                                    
                                    <p>The extended description of the module. Each line should be less than or equal
                                       to 75 characters in length. If the module consumes arguments, required or
                                       optional, include them in the helptext value.
                                    </p>
                                    
                                    <p>For
                                       example:
                                    </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">helptext: !!str |
  Collect output from ps for system analysis
  Consumes --times= for number of times to repeat
  Consumes --period= for time period between repetition</code></pre></td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>placement</p>
                                 </td>
                                 
                                 <td>
                                    <p>The stage in which the module should be run. Supported values:</p>
                                    <div class="itemizedlist">
                                       
                                       
                                       
                                       
                                       <ul class="itemizedlist" type="disc">
                                          <li class="listitem">
                                             
                                             <p>prediagnostic</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>run</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>postdiagnostic</p>
                                             
                                          </li>
                                       </ul>
                                    </div>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>language</p>
                                 </td>
                                 
                                 <td>
                                    <p>The language that the module code is written in. Supported values:</p>
                                    <div class="itemizedlist">
                                       
                                       
                                       
                                       <ul class="itemizedlist" type="disc">
                                          <li class="listitem">
                                             
                                             <p>bash</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>python</p>
                                             
                                          </li>
                                       </ul>
                                    </div>
                                    <div class="aws-note">
                                       <p class="aws-note">Note</p>
                                       <p>Python code must be compatible with both Python 2.7.9+ and Python
                                          3.2+.
                                       </p>
                                    </div>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>remediation</td>
                                 
                                 <td>
                                    
                                    <p>Indicates whether the module supports remediation. Supported values are
                                       <code class="code">True</code> or <code class="code">False</code>.
                                    </p>
                                    
                                    <p>The module will default to <code class="code">False</code> if this is absent, making it an
                                       optional attribute for those modules that do not support remediation.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>content</p>
                                 </td>
                                 
                                 <td>
                                    <p>The entirety of the script code.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>constraint</p>
                                 </td>
                                 
                                 <td>
                                    <p>The name of the object containing the constraint values.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>domain</p>
                                 </td>
                                 
                                 <td>
                                    <p>A descriptor of how the module is grouped or classified. The set of
                                       included modules uses the following domains: 
                                    </p>
                                    
                                    <div class="itemizedlist">
                                       
                                       
                                       
                                       
                                       
                                       <ul class="itemizedlist" type="disc">
                                          <li class="listitem">
                                             
                                             <p>application</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>net</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>os</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>performance</p>
                                             
                                          </li>
                                       </ul>
                                    </div>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>class</p>
                                 </td>
                                 
                                 <td>
                                    <p>A descriptor of the type of task performed by the module. The set of
                                       included modules uses the following classes:
                                    </p>
                                    
                                    <div class="itemizedlist">
                                       
                                       
                                       
                                       
                                       <ul class="itemizedlist" type="disc">
                                          <li class="listitem">
                                             
                                             <p>collect (collects output from programs)</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>diagnose (pass/fail based on a set of criteria)</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>gather (copies files and writes to specific file)</p>
                                             
                                          </li>
                                       </ul>
                                    </div>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>distro</p>
                                 </td>
                                 
                                 <td>
                                    <p>The list of Linux distributions that this module supports. The set of
                                       included modules use the following distributions:
                                    </p>
                                    
                                    <div class="itemizedlist">
                                       
                                       
                                       
                                       
                                       
                                       <ul class="itemizedlist" type="disc">
                                          <li class="listitem">
                                             
                                             <p><b>alami</b> (Amazon Linux)
                                             </p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p><b>rhel</b></p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p><b>ubuntu</b></p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p><b>suse</b></p>
                                             
                                          </li>
                                       </ul>
                                    </div>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>required</p>
                                 </td>
                                 
                                 <td>
                                    <p>The required arguments that the module is consuming from the CLI
                                       options.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>optional</p>
                                 </td>
                                 
                                 <td>
                                    <p>The optional arguments that the module can use.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>software</p>
                                 </td>
                                 
                                 <td>
                                    <p>The software executables used in the module. This attribute is intended
                                       to specify software that is not installed by default. The EC2Rescue for Linux
                                       logic ensures that these programs are present and executable before running the
                                       module.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>package</p>
                                 </td>
                                 
                                 <td>
                                    <p>The source software package for an executable. This attribute is intended
                                       to provide extended details on the package with the software, including a URL for
                                       downloading or getting further information.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>sudo</p>
                                 </td>
                                 
                                 <td>
                                    <p>Indicates whether root access is required to run the module. </p>
                                    
                                    <p>You do not need to implement sudo checks in the module script. If the value is
                                       true, then the EC2Rescue for Linux logic only runs the module when the executing
                                       user has root access.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>perfimpact</p>
                                 </td>
                                 
                                 <td>
                                    <p>Indicates whether the module can have significant performance impact upon
                                       the environment in which it is run. If the value is true and the
                                       <code class="code">--perfimpact=true</code> argument is not present, then the module is
                                       skipped.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    <p>parallelexclusive</p>
                                 </td>
                                 
                                 <td>
                                    <p>Specifies a program that requires mutual exclusivity. For example, all
                                       modules specifying &quot;bpf&quot; run in a serial manner.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                     
                     <h2 id="ec2rl_adding_envvars">Adding Environment Variables</h2>
                     
                     
                     <p>The following table lists the available environment variables.</p>
                     
                     <div class="table">
                        <p class="title"><b></b></p>
                        <div class="table-contents">
                           <table id="w185aac27c13b7b5">
                              
                              <tbody><tr>
                                 
                                 <th>Environment Variable</th>
                                 
                                 <th>Description</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_CALLPATH</p>
                                    
                                 </td>
                                 
                                 <td>The path to <code>ec2rl.py</code>. This path can be used to locate the
                                    lib directory and utilize vendored Python modules.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_WORKDIR</p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p>The main tmp directory for the diagnostic tool.</p>
                                    
                                    <p>Default value: <code>/var/tmp/ec2rl</code>.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_RUNDIR</p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p>The directory where all output is stored.</p>
                                    
                                    <p>Default value:
                                       <code>/var/tmp/ec2rl/&lt;date&amp;timestamp&gt;</code>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_GATHEREDDIR</p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p>The root directory for placing gathered module data.</p>
                                    
                                    <p>Default
                                       value:<code>/var/tmp/ec2rl/&lt;date&amp;timestamp&gt;/mod_out/gathered/</code>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_NET_DRIVER</p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p>The driver in use for the first, alphabetically ordered, non-virtual network
                                       interface on the instance.
                                    </p>
                                    
                                    <p>Examples:</p>
                                    
                                    <div class="itemizedlist">
                                       
                                       
                                       
                                       
                                       <ul class="itemizedlist" type="disc">
                                          <li class="listitem">
                                             
                                             <p>xen_netfront</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>ixgbevf</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>ena</p>
                                             
                                          </li>
                                       </ul>
                                    </div>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_SUDO</p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p>True if EC2Rescue for Linux is running as root; otherwise, false.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_VIRT_TYPE</p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p>The virtualization type as provided by the instance metadata.</p>
                                    
                                    <p>Examples:</p>
                                    
                                    <div class="itemizedlist">
                                       
                                       
                                       
                                       <ul class="itemizedlist" type="disc">
                                          <li class="listitem">
                                             
                                             <p>default-hvm</p>
                                             
                                          </li>
                                          <li class="listitem">
                                             
                                             <p>default-paravirtual</p>
                                             
                                          </li>
                                       </ul>
                                    </div>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td>
                                    
                                    <p>EC2RL_INTERFACES</p>
                                    
                                 </td>
                                 
                                 <td>
                                    
                                    <p>An enumerated list of interfaces on the system. The value is a string
                                       containing names, such as <code class="code">eth0</code>, <code class="code">eth1</code>, etc. This is
                                       generated via the <code class="code">functions.bash</code> and is only available for modules
                                       that have sourced it.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     
                     
                     
                     <h2 id="ec2rl_yamlsyntax">Using YAML Syntax</h2>
                     
                     
                     <p>The following should be noted when constructing your module YAML files:</p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>The triple hyphen (<code class="code">---</code>) denotes the explicit start of a
                                 document.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>The <code class="code">!ec2rlcore.module.Module</code> tag tells the YAML parser which
                                 constructor to call when creating the object from the data stream. You can find the
                                 constructor inside the <code>module.py</code> file.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>The <code class="code">!!str</code> tag tells the YAML parser to not attempt to determine the
                                 type of data, and instead interpret the content as a string literal.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>The pipe character (<code class="code">|</code>) tells the YAML parser that the value is a
                                 literal-style scalar. In this case, the parser includes all whitespace. This is
                                 important for modules because indentation and newline characters are kept.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>The YAML standard indent is two spaces, which can be seen in the following examples.
                                 Ensure that you maintain standard indentation (for example, four spaces for Python)
                                 for
                                 your script and then indent the entire content two spaces inside the module file.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     <h2 id="ec2rl_example">Example Modules</h2>
                     
                     
                     <p>Example one (<code>mod.d/ps.yaml</code>):
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="bash ">--- !ec2rlcore.module.Module
# Module document. Translates directly into an almost-complete Module object
name: !!str ps
path: !!str
version: !!str 1.0
title: !!str Collect output from ps for system analysis
helptext: !!str |
  Collect output from ps for system analysis
  Requires --times= for number of times to repeat
  Requires --period= for time period between repetition
placement: !!str run
package: 
  - !!str
language: !!str bash
content: !!str |
  #!/bin/bash
  error_trap()
  {
      printf &quot;%0.s=&quot; {1..80}
      echo -e &quot;\nERROR:	&quot;$BASH_COMMAND&quot; exited with an error on line ${BASH_LINENO[0]}&quot;
      exit 0
  }
  trap error_trap ERR

  # read-in shared function
  source functions.bash
  echo &quot;I will collect ps output from this $EC2RL_DISTRO box for $times times every $period seconds.&quot;
  for i in $(seq 1 $times); do
      ps auxww
      sleep $period
  done
constraint:
  requires_ec2: !!str False
  domain: !!str performance
  class: !!str collect
  distro: !!str alami ubuntu rhel suse
  required: !!str period times
  optional: !!str
  software: !!str
  sudo: !!str False
  perfimpact: !!str False
  parallelexclusive: !!str</code></pre>
                     </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="ec2rl_working.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="ec2-instance-troubleshoot.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Adding Module Attributes"><a class="pagetoc" href="#ec2rl-adding-modules">Adding Module Attributes</a></li>
                        <li class="pagetoc" name="Adding Environment Variables"><a class="pagetoc" href="#ec2rl_adding_envvars">Adding Environment Variables</a></li>
                        <li class="pagetoc" name="Using YAML Syntax"><a class="pagetoc" href="#ec2rl_yamlsyntax">Using YAML Syntax</a></li>
                        <li class="pagetoc" name="Example Modules"><a class="pagetoc" href="#ec2rl_example">Example Modules</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Elastic Compute Cloud';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='User Guide for Linux Instances';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>