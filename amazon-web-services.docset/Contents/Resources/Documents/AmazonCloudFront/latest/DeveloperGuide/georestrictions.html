<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Restricting the Geographic Distribution of Your 
         			Content - Amazon CloudFront
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="distribution-web.html" title="Working with Web Distributions">
      <link rel="prev" href="distribution-web-awswaf.html" title="Using AWS WAF to Control Access to Your 
			Content">
      <link rel="next" href="on-demand-streaming-video.html" title="Configuring On-Demand Streaming Web Distributions">
      <meta name="description" content="You can use geo restriction , also known as geoblocking , to prevent users in specific geographic locations from accessing content that you&apos;re distributing through a CloudFront web distribution. To use geo restriction, you have two options:">
      <meta name="keywords" content="Amazon CloudFront,CloudFront,cache,distribution,edge,geo,HTTP,HTTPS,media,origin,RTMP,streaming">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon CloudFront">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/georestrictions.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/cloudfront">Amazon CloudFront</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="distribution-web.html">Working with Web Distributions</a> &#xBB; <span class="breadcrumb">Restricting the Geographic Distribution of Your 
                                    			Content</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="georestrictions">Restricting the Geographic Distribution of Your 
                        			Content
                     </h1>
                     <p>You can use <em>geo restriction</em>, also known as 
                        				<em>geoblocking</em>, to prevent users in specific geographic locations from 
                        			accessing content that you&apos;re distributing through a CloudFront web distribution.
                        To use geo 
                        			restriction, you have two options:
                     </p>
                     <div class="itemizedlist"> 
                        			 
                        			 
                        		
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem"> 
                              				
                              <p>Use the CloudFront geo restriction feature. Use this option to restrict access to
                                 all of the 
                                 					files that are associated with a distribution and to restrict access at the country
                                 level. 
                                 				
                              </p> 
                              			
                           </li>
                           <li class="listitem"> 
                              				
                              <p>Use a third-party geolocation service. Use this option to restrict access to a subset
                                 
                                 					of the files that are associated with a distribution or to restrict access at
                                 a finer 
                                 					granularity than the country level.
                              </p> 
                              			
                           </li>
                        </ul>
                     </div>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#georestrictions-cloudfront">Using CloudFront Geo Restriction</a></li>
                           <li><a href="#georestrictions-geolocation-service">Using a Third-Party Geolocation 
                                 				Service</a></li>
                        </ul>
                     </div>
                     				
                     <h2 id="georestrictions-cloudfront">Using CloudFront Geo Restriction</h2> 
                     			 
                     			
                     <p>When a user requests your content, CloudFront typically serves the requested content
                        
                        				regardless of where the user is located. If you need to prevent users in specific
                        countries 
                        				from accessing your content, you can use the CloudFront geo restriction feature
                        to do one of the 
                        				following:
                     </p> 
                     			
                     <div class="itemizedlist"> 
                        				 
                        				 
                        			
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem"> 
                              					
                              <p>Allow your users to access your content only if they&apos;re in one of the countries on
                                 a 
                                 						whitelist of approved countries. 
                              </p> 
                              				
                           </li>
                           <li class="listitem"> 
                              					
                              <p>Prevent your users from accessing your content if they&apos;re in one of the countries
                                 on 
                                 						a blacklist of banned countries. 
                              </p> 
                              				
                           </li>
                        </ul>
                     </div> 
                     			
                     <p>For example, if a request comes from a country where, for copyright reasons, you are
                        not 
                        				authorized to distribute your content, you can use CloudFront geo restriction
                        to block the 
                        				request.
                     </p> 
                     			
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>CloudFront determines the location of your users by using a third-party GeoIP database.
                           The 
                           					accuracy of the mapping between IP addresses and countries varies by region.
                           Based on 
                           					recent tests, the overall accuracy is 99.8%. Be aware that if CloudFront can&apos;t
                           determine a user&apos;s 
                           					location, CloudFront will serve the content that the user has requested.
                        </p>
                     </div>
                     
                     			
                     <p>Here&apos;s how geo restriction works:</p> 
                     			
                     <div class="orderedlist"> 
                        				 
                        				 
                        				 
                        				 
                        			
                        <ol>
                           <li> 
                              					
                              <p>Suppose you have rights to distribute your content only in Liechtenstein. You update
                                 
                                 						your CloudFront web distribution and add a whitelist that contains only Liechtenstein.
                                 
                                 						(Alternatively, you could add a blacklist that contains every country except
                                 
                                 						Liechtenstein.)
                              </p> 
                              				
                           </li>
                           <li> 
                              					
                              <p>A user in Monaco requests your content, and DNS routes the request to the CloudFront
                                 edge 
                                 						location in Milan, Italy.
                              </p> 
                              				
                           </li>
                           <li> 
                              					
                              <p>The edge location in Milan looks up your distribution and determines that the user
                                 
                                 						in Monaco is not allowed to download your content.
                              </p> 
                              				
                           </li>
                           <li> 
                              					
                              <p>CloudFront returns an HTTP status code of 403 (Forbidden) to the user.</p> 
                              				
                           </li>
                        </ol>
                     </div> 
                     			
                     <p>You can optionally configure CloudFront to return a custom error message to the user,
                        and you 
                        				can specify how long you want CloudFront to cache the error response for the requested
                        object; the 
                        				default value is five minutes. For more information, see <a href="custom-error-pages.html">Customizing Error Responses</a>.
                     </p> 
                     			
                     <p>Geo restriction applies to an entire web distribution. If you need to apply one 
                        				restriction to part of your content and a different restriction (or no restriction)
                        to 
                        				another part of your content, you must either create separate CloudFront web distributions
                        or use 
                        				a third-party geolocation service.
                     </p> 
                     			
                     <p>If you enable CloudFront access logging, you can identify the requests that CloudFront
                        rejected by 
                        				searching for the log entries for which the value of <code class="code">sc-status</code> (the HTTP status 
                        				code) is <code class="code">403</code>. However, using only the access logs, you can&apos;t distinguish a 
                        				request that CloudFront rejected based on the location of the user from a request
                        that CloudFront 
                        				rejected because the user didn&apos;t have permission to access the object for another
                        reason. If 
                        				you have a third-party geolocation service such as Digital Element or MaxMind,
                        you can 
                        				identify the location of requests based on the IP address in the <code class="code">c-ip</code> (client 
                        				IP) column in the access logs. For more information about CloudFront access logs,
                        see <a href="AccessLogs.html">Access Logs</a>.
                     </p>
                     
                     			
                     <p>The following procedure explains how to use the CloudFront console to add geo restriction
                        to 
                        				an existing web distribution. For information about how to use the console to
                        create a web 
                        				distribution, see <a href="distribution-web.html">Working with Web Distributions</a>.
                     </p>
                     
                     			<a id="restrictions-geo-procedure"></a><p class="title"><b>To use the CloudFront console to add geo restriction 
                           					to your CloudFront web distribution</b></p>
                     <ol>
                        <li>
                           <p>Sign in to the AWS Management Console and open the CloudFront console at
                              <a href="https://console.aws.amazon.com/cloudfront/" target="_blank">https://console.aws.amazon.com/cloudfront/</a>.
                           </p>
                        </li>
                        <li> 
                           					
                           <p>Select the distribution that you want to update.</p> 
                           				
                        </li>
                        <li> 
                           					
                           <p>In the <b>Distribution Settings</b> pane, choose the 
                              							<b>Restrictions</b> tab.
                           </p> 
                           				
                        </li>
                        <li> 
                           					
                           <p>Choose <b>Edit</b>.
                           </p> 
                           				
                        </li>
                        <li> 
                           					
                           <p>Enter the applicable values. For more information, see <a href="distribution-web-values-specify.html#DownloadDistValuesRestrictions">Restrictions</a>.
                           </p> 
                           				
                        </li>
                        <li> 
                           					
                           <p>Choose <b>Yes, Edit</b>.
                           </p> 
                           				
                        </li>
                     </ol> 
                     		
                     				
                     <h2 id="georestrictions-geolocation-service">Using a Third-Party Geolocation 
                        				Service
                     </h2> 
                     			 
                     			
                     <p>The CloudFront geo restriction feature lets you control distribution of your content
                        at the 
                        				country level for all files that you&apos;re distributing with a given web distribution.
                        If you 
                        				have geographic restrictions on where your content can be distributed and the
                        restrictions 
                        				don&apos;t follow country boundaries, or if you want to limit access to only some of
                        the files 
                        				that you&apos;re distributing through CloudFront, you can combine CloudFront with a
                        third-party geolocation 
                        				service. This can allow you to control access to your content based not only on
                        country but 
                        				also based on city, zip or postal code, or even latitude and longitude.
                     </p>
                     
                     			
                     <p>When you&apos;re using a third-party geolocation service, we recommend that you use CloudFront
                        
                        				signed URLs, which let you specify an expiration date and time after which the
                        URL is no 
                        				longer valid. In addition, we recommend that you use an Amazon S3 bucket as your
                        origin because 
                        				you can then use a CloudFront origin access identity to prevent users from accessing
                        your content 
                        				directly from the origin. For more information about signed URLs and origin access
                        
                        				identities, see <a href="PrivateContent.html">Serving Private Content through CloudFront</a>.
                     </p>
                     
                     			
                     <p>The following task list explains how to control access to your files by using a 
                        				third-party geolocation service. 
                     </p>
                     
                     			
                     <p class="title"><b>Task list for restricting access to files in a CloudFront distribution based on geographic
                           
                           					location</b></p>
                     <ol>
                        <li> 
                           					
                           <p>Get an account with a geolocation service.</p> 
                           				
                        </li>
                        <li> 
                           					
                           <p>Upload your content to an Amazon Simple Storage Service (S3) bucket. For more information,
                              see the <a href="http://aws.amazon.com/documentation/s3/" target="_blank">Amazon S3 documentation</a>. 
                           </p> 
                           				
                        </li>
                        <li> 
                           					
                           <p>Configure Amazon CloudFront and Amazon S3 to serve private content. For more information,
                              see 
                              							<a href="PrivateContent.html">Serving Private Content through CloudFront</a>.
                           </p> 
                           				
                        </li>
                        <li> 
                           					
                           <p>Write your web application to do the following:</p> 
                           					
                           <ol>
                              <li> 
                                 							
                                 <p>Send the IP address for each user request to the geolocation service.</p> 
                                 						
                              </li>
                              <li> 
                                 							
                                 <p>Evaluate the return value from the geolocation service to determine whether the 
                                    								user is in a location to which you want CloudFront to distribute your content.
                                 </p> 
                                 						
                              </li>
                              <li> 
                                 							
                                 <p>Based on whether you want to distribute your content to the user&apos;s location, 
                                    								either generate a signed URL for your CloudFront content, or return HTTP status
                                    code 403 
                                    								(Forbidden) to the user. Alternatively, you can configure CloudFront to return
                                    a custom 
                                    								error message. For more information, see <a href="custom-error-pages.html">Customizing Error Responses</a>.
                                 </p> 
                                 						
                              </li>
                           </ol> 
                           					
                           <p>For more information, refer to the documentation for the geolocation service that
                              
                              						you&apos;re using.
                           </p> 
                           				
                        </li>
                     </ol>
                     
                     			
                     <p>You can use a web server variable to get the IP addresses of the users who are visiting
                        
                        				your website. Note the following caveats:
                     </p> 
                     			
                     <div class="itemizedlist"> 
                        				 
                        				 
                        			
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem"> 
                              					
                              <p>If your web server is not connected to the internet through a load balancer, you can
                                 
                                 						use a web server variable to get the remote IP address. However, this IP address
                                 isn&apos;t 
                                 						always the user&apos;s IP address&#x2014;it can also be the IP address of a proxy server,
                                 
                                 						depending on how the user is connected to the internet.
                              </p> 
                              				
                           </li>
                           <li class="listitem"> 
                              					
                              <p>If your web server is connected to the internet through a load balancer, a web 
                                 						server variable might contain the IP address of the load balancer, not the IP
                                 address of 
                                 						the user. In this configuration, we recommend that you use the last IP address
                                 in the 
                                 							<code class="code">X-Forwarded-For</code> http header. This header typically contains more than one 
                                 						IP address, most of which are for proxies or load balancers. The last IP address
                                 in the 
                                 						list is the one most likely to be associated with the user&apos;s geographic location.
                              </p> 
                              				
                           </li>
                        </ul>
                     </div> 
                     			
                     <p>If your web server is not connected to a load balancer, we recommend that you use
                        web 
                        				server variables instead of the <code class="code">X-Forwarded-For</code> header to avoid IP address 
                        				spoofing. 
                     </p>
                     
                     		
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="distribution-web-awswaf.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="on-demand-streaming-video.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Using CloudFront Geo Restriction"><a class="pagetoc" href="#georestrictions-cloudfront">Using CloudFront Geo Restriction</a></li>
                        <li class="pagetoc" name="Using a Third-Party Geolocation 
				Service"><a class="pagetoc" href="#georestrictions-geolocation-service">Using a Third-Party Geolocation 
                              				Service</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon CloudFront';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>