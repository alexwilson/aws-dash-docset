<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Setting Signed Cookies Using a Custom Policy - Amazon CloudFront</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="private-content-signed-cookies.html" title="Using Signed Cookies">
      <link rel="prev" href="private-content-setting-signed-cookie-canned-policy.html" title="Setting Signed Cookies Using a Canned Policy">
      <link rel="next" href="private-content-linux-openssl.html" title="Using a Linux Command and OpenSSL for Base64-Encoding and Encryption">
      <meta name="description" content="Set signed cookies using a custom policy to control end-user access to your objects.">
      <meta name="keywords" content="Amazon CloudFront,CloudFront,cache,distribution,edge,geo,HTTP,HTTPS,media,origin,RTMP,streaming">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon CloudFront">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-setting-signed-cookie-custom-policy.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/cloudfront">Amazon CloudFront</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="PrivateContent.html">Serving Private Content through CloudFront</a> &#xBB; <a href="private-content-signed-cookies.html">Using Signed Cookies</a> &#xBB; <span class="breadcrumb">Setting Signed Cookies Using a Custom Policy</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="private-content-setting-signed-cookie-custom-policy">Setting Signed Cookies Using a Custom Policy</h1>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#private-content-custom-policy-statement-cookies">Creating a Policy
                                 Statement for a Signed Cookie That Uses a Custom Policy</a></li>
                           <li><a href="#private-content-custom-policy-statement-signed-cookies-examples">Example
                                 Policy Statements for a Signed Cookie That Uses a Custom Policy</a></li>
                           <li><a href="#private-content-custom-policy-signature-cookies">Creating a Signature for a
                                 Signed Cookie That Uses a Custom Policy</a></li>
                        </ul>
                     </div>
                     <p>To set a signed cookie that uses a custom policy, perform the following
                        procedure.
                     </p><a id="private-content-setting-signed-cookie-custom-policy-procedure"></a><p class="title"><b>To set a
                           signed cookie using a custom policy</b></p>
                     <ol>
                        <li>
                           
                           <p>If you&apos;re using .NET or Java to create signed URLs, and if you haven&apos;t reformatted
                              the private key for your key pair from the default .pem format to a format compatible
                              with .NET or with Java, do so now. For more information, see <a href="private-content-trusted-signers.html#private-content-reformatting-private-key">Reformatting the CloudFront Private Key
                                 				(.NET and Java Only)</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Program your application to send three <code class="code">Set-Cookie</code> headers to approved
                              viewers. You need three <code class="code">Set-Cookie</code> headers because each
                              							<code class="code">Set-Cookie</code> header can contain only one name-value pair, and a CloudFront signed
                              cookie requires three name-value pairs. The name-value pairs are:
                              							<code class="code">CloudFront-Policy</code>, <code class="code">CloudFront-Signature</code>, and
                              							<code class="code">CloudFront-Key-Pair-Id</code>. The values must be present on the viewer before a
                              user makes the first request for an object that you want to control access to. 
                           </p>
                           
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>In general, we recommend that you exclude <code class="code">Expires</code> and
                                 								<code class="code">Max-Age</code> attributes. This causes the browser to delete the cookie when
                                 							the user closes the browser, which reduces the possibility of someone getting
                                 							unauthorized access to your content. For more information, see <a href="private-content-signed-cookies.html#private-content-signed-cookie-misuse">Preventing Misuse of Signed Cookies</a>.
                              </p>
                           </div>
                           
                           
                           <p><b>The names of cookie attributes are case sensitive</b>. 
                           </p>
                           
                           <p>Line breaks are included only to make the attributes more readable.</p>
                           
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">Set-Cookie: 
Domain=<em class="replaceable"><code>optional domain name</code></em>; 
Path=/<em class="replaceable"><code>optional directory path</code></em>; 
Secure; 
HttpOnly; 
CloudFront-Policy=<em class="replaceable"><code>base64 encoded version of the policy statement</code></em>

Set-Cookie: 
Domain=<em class="replaceable"><code>optional domain name</code></em>; 
Path=/<em class="replaceable"><code>optional directory path</code></em>; 
Secure; 
HttpOnly; 
CloudFront-Signature=<em class="replaceable"><code>hashed and signed version of the policy statement</code></em>

Set-Cookie: 
Domain=<em class="replaceable"><code>optional domain name</code></em>; 
Path=/<em class="replaceable"><code>optional directory path</code></em>; 
Secure; 
HttpOnly; 
CloudFront-Key-Pair-Id=<em class="replaceable"><code>active CloudFront key pair Id for the key pair that you are using to generate the signature</code></em></code></pre>
                           
                           <div class="variablelist">
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              
                              <dl>
                                 							
                                 <dt><b><span class="term">(Optional) <code class="code">Domain</code></span></b></dt>
                                 							
                                 <dd>
                                    								
                                    <p>The domain name for the requested object. If you don&apos;t specify a
                                       									  <code class="code">Domain</code> attribute, the default value is the domain name in the URL,
                                       									and it applies only to the specified domain name, not to subdomains. If you
                                       									specify a <code class="code">Domain</code> attribute, it also applies to subdomains. A leading
                                       									dot in the domain name (for example, <code class="code">Domain=.example.com</code>) is
                                       									optional. In addition, if you specify a <code class="code">Domain</code> attribute, the domain
                                       									name in the URL and the value of the <code class="code">Domain</code> attribute must
                                       									match.
                                    </p>
                                    								
                                    <p>You can specify the domain name that CloudFront assigned to your distribution, for
                                       									example, d111111abcdef8.cloudfront.net, but you can&apos;t specify *.cloudfront.net
                                       for
                                       									the domain name.
                                    </p>
                                    								
                                    <p>If you want to use an alternate domain name such as example.com in URLs, you
                                       									must add the alternate domain name to your distribution regardless of whether
                                       you
                                       									specify the <code class="code">Domain</code> attribute. For more information, see <a href="distribution-web-values-specify.html#DownloadDistValuesCNAME">Alternate Domain Names (CNAMEs)</a> in
                                       									the topic <a href="distribution-web-values-specify.html">Values That You Specify When You Create or Update a Web Distribution</a>.
                                    </p>
                                    							
                                 </dd>
                                 
                                 
                                 <dt><b><span class="term">(Optional) <code class="code">Path</code></span></b></dt>
                                 
                                 <dd>
                                    								
                                    <p>The path for the requested object. If you don&apos;t specify a <code class="code">Path</code>
                                       									attribute, the default value is the path in the URL.
                                    </p>
                                    
                                 </dd>
                                 
                                 
                                 <dt><b><span class="term"><code class="code">Secure</code></span></b></dt>
                                 
                                 <dd>
                                    								
                                    <p>Requires that the viewer encrypt cookies before sending a request. We
                                       									recommend that you send the <code class="code">Set-Cookie</code> header over an HTTPS
                                       									connection to ensure that the cookie attributes are protected from
                                       									man-in-the-middle attacks.
                                    </p>
                                    
                                 </dd>
                                 
                                 
                                 <dt><b><span class="term"><code class="code">HttpOnly</code></span></b></dt>
                                 
                                 <dd>
                                    								
                                    <p>Requires that the viewer send the cookie only in HTTP or HTTPS
                                       									requests.
                                    </p>
                                    
                                 </dd>
                                 
                                 
                                 <dt><b><span class="term"><code class="code">CloudFront-Policy</code></span></b></dt>
                                 
                                 <dd>
                                    								
                                    <p>Your policy statement in JSON format, with white space removed, then base64
                                       									encoded. For more information, see 
                                       									<a href="private-content-setting-signed-cookie-custom-policy.html#private-content-custom-policy-signature-cookies">Creating a Signature for a
                                          Signed Cookie That Uses a Custom Policy</a>.
                                    </p>
                                    								
                                    <p>The policy statement controls the access that a signed cookie grants to a
                                       									user: the objects that the user can access, an expiration date and time,
                                       an
                                       									optional date and time that the URL becomes valid, and an optional IP address
                                       or
                                       									range of IP addresses that are allowed to access the object.
                                    </p>
                                    
                                 </dd>
                                 
                                 
                                 <dt><b><span class="term"><code class="code">CloudFront-Signature</code></span></b></dt>
                                 
                                 <dd>
                                    								
                                    <p>A hashed, signed, and base64-encoded version of the JSON policy statement. For
                                       									more information, see 
                                       									<a href="private-content-setting-signed-cookie-custom-policy.html#private-content-custom-policy-signature-cookies">Creating a Signature for a
                                          Signed Cookie That Uses a Custom Policy</a>.
                                    </p>
                                    
                                 </dd>
                                 
                                 
                                 <dt><b><span class="term"><code class="code">CloudFront-Key-Pair-Id</code></span></b></dt>
                                 
                                 <dd>
                                    								
                                    <p>The ID for an active CloudFront key pair, for example, APKA9ONS7QCOWEXAMPLE. The
                                       									CloudFront key pair ID tells CloudFront which public key to use to validate
                                       the signed cookie.
                                       									CloudFront compares the information in the signature with the information
                                       in the policy
                                       									statement to verify that the URL has not been tampered with.
                                    </p>
                                    								
                                    <p>The key pair ID that you include in CloudFront signed cookies must be associated
                                       									with an AWS account that is one of the trusted signers for the applicable
                                       cache
                                       									behavior.
                                    </p>
                                    								
                                    <p>For more information, see <a href="private-content-trusted-signers.html">Specifying the AWS Accounts That Can Create Signed URLs and Signed Cookies (Trusted
                                          Signers)</a>.
                                    </p>
                                    								
                                    <p>If you make a key pair inactive while rotating CloudFront key pairs, you must update
                                       									your application to use a new active key pair for one of your trusted signers.
                                       For
                                       									more information about rotating key pairs, see <a href="private-content-trusted-signers.html#private-content-rotating-key-pairs">Rotating CloudFront Key Pairs</a>.
                                    </p>
                                    
                                 </dd>
                                 
                              </dl>
                           </div>
                           
                           
                        </li>
                     </ol>
                     <p>Example <code class="code">Set-Cookie</code> headers for one signed cookie when you&apos;re using the
                        domain name that is associated with your distribution in the URLs for your objects:
                     </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">Set-Cookie: Domain=d111111abcdef8.cloudfront.net; Path=/; Secure; HttpOnly; CloudFront-Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cDovL2QxMTExMTFhYmNkZWY4LmNsb3VkZnJvbnQubmV0L2dhbWVfZG93bmxvYWQuemlwIiwiQ29uZGl0aW9uIjp7IklwQWRkcmVzcyI6eyJBV1M6U291cmNlSXAiOiIxOTIuMC4yLjAvMjQifSwiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE0MjY1MDAwMDB9fX1dfQ__
Set-Cookie: Domain=d111111abcdef8.cloudfront.net; Path=/; Secure; HttpOnly; CloudFront-Signature=dtKhpJ3aUYxqDIwepczPiDb9NXQ_
Set-Cookie: Domain=d111111abcdef8.cloudfront.net; Path=/; Secure; HttpOnly; CloudFront-Key-Pair-Id=APKA9ONS7QCOWEXAMPLE</code></pre><p>Example <code class="code">Set-Cookie</code> headers for one signed cookie when you&apos;re using the
                        alternate domain name example.org in the URLs for your objects:
                     </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">Set-Cookie: Domain=example.org; Path=/; Secure; HttpOnly; CloudFront-Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cDovL2QxMTExMTFhYmNkZWY4LmNsb3VkZnJvbnQubmV0L2dhbWVfZG93bmxvYWQuemlwIiwiQ29uZGl0aW9uIjp7IklwQWRkcmVzcyI6eyJBV1M6U291cmNlSXAiOiIxOTIuMC4yLjAvMjQifSwiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE0MjY1MDAwMDB9fX1dfQ__
Set-Cookie: Domain=example.org; Path=/; Secure; HttpOnly; CloudFront-Signature=dtKhpJ3aUYxqDIwepczPiDb9NXQ_
Set-Cookie: Domain=example.org; Path=/; Secure; HttpOnly; CloudFront-Key-Pair-Id=APKA9ONS7QCOWEXAMPLE</code></pre><p>If you want to use an alternate domain name such as example.com in URLs, you must
                        add
                        the alternate domain name to your distribution regardless of whether you specify the
                        <code class="code">Domain</code> attribute. For more information, see <a href="distribution-web-values-specify.html#DownloadDistValuesCNAME">Alternate Domain Names (CNAMEs)</a> in the topic
                        <a href="distribution-web-values-specify.html">Values That You Specify When You Create or Update a Web Distribution</a>.
                     </p>
                     <h2 id="private-content-custom-policy-statement-cookies">Creating a Policy
                        Statement for a Signed Cookie That Uses a Custom Policy
                     </h2>
                     
                     
                     <p>To create a policy statement for a custom policy, perform the following procedure.
                        For
                        several example policy statements that control access to objects in a variety of ways,
                        see
                        <a href="private-content-setting-signed-cookie-custom-policy.html#private-content-custom-policy-statement-signed-cookies-examples">Example
                           Policy Statements for a Signed Cookie That Uses a Custom Policy</a>.
                     </p>
                     
                     <a id="private-content-custom-policy-statement-cookies-procedure"></a><p class="title"><b>To create the policy statement for a signed cookie that uses a custom policy</b></p>
                     <ol>
                        <li>
                           
                           <p>Construct the policy statement using the following JSON format.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;Statement&quot;: [
      {
         &quot;Resource&quot;:&quot;<em class="replaceable"><code>URL of the object</code></em>&quot;,
         &quot;Condition&quot;:{
            &quot;DateLessThan&quot;:{&quot;AWS:EpochTime&quot;:<em class="replaceable"><code>required ending date and time in Unix time format and UTC</code></em>},
            &quot;DateGreaterThan&quot;:{&quot;AWS:EpochTime&quot;:<em class="replaceable"><code>optional beginning date and time in Unix time format and UTC</code></em>},
            &quot;IpAddress&quot;:{&quot;AWS:SourceIp&quot;:&quot;<em class="replaceable"><code>optional IP address</code></em>&quot;}
         }
      }
   ]
}</code></pre>
                           
                           <p>Note the following:</p>
                           
                           <div class="itemizedlist">
                              	
                              	
                              	
                              
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    <p>You can include only one statement.</p>
                                 </li>
                                 <li class="listitem">
                                    								
                                    <p>Use UTF-8 character encoding.</p>
                                    
                                 </li>
                                 <li class="listitem">
                                    								
                                    <p>Include all punctuation and parameter names exactly as specified.
                                       									Abbreviations for parameter names are not accepted.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    								
                                    <p>The order of the parameters in the <code class="code">Condition</code> section doesn&apos;t
                                       									matter.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    								
                                    <p>For information about the values for <code class="code">Resource</code>,
                                       									  <code class="code">DateLessThan</code>, <code class="code">DateGreaterThan</code>, and
                                       									  <code class="code">IpAddress</code>, see <a href="private-content-setting-signed-cookie-custom-policy.html#private-content-custom-policy-statement-cookies-values">Values That You
                                          Specify in the Policy Statement for a Custom Policy for Signed Cookies</a>.
                                    </p>
                                    
                                 </li>
                              </ul>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Remove all whitespace (including tabs and newline characters) from the policy
                              statement. You might have to include escape characters in the string in application
                              code.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Base64-encode the policy statement using MIME base64 encoding. For more
                              information, see <a href="http://tools.ietf.org/html/rfc2045#section-6.8" target="_blank">Section
                                 								6.8, Base64 Content-Transfer-Encoding</a> in <em>RFC 2045, MIME
                                 								(Multipurpose Internet Mail Extensions) Part One: Format of Internet Message
                                 								Bodies</em>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Replace characters that are invalid in a URL query string with characters that are
                              valid. The following table lists invalid and valid characters.
                           </p>
                           
                           <div class="table">
                              <p class="title"><b></b></p>
                              <div class="table-contents">
                                 <table id="w313aac27c51c19c19b4b8b3">
                                    									
                                    <tbody><tr>
                                       									  
                                       <th>Replace these invalid characters</th>
                                       									  
                                       <th>With these valid characters</th>
                                       									
                                    </tr>
                                    								
                                    									
                                    <tr>
                                       									  
                                       <td>
                                          <p>+</p>
                                       </td>
                                       									  
                                       <td>
                                          <p>- (hyphen)</p>
                                       </td>
                                       									
                                    </tr>
                                    									
                                    <tr>
                                       									  
                                       <td>
                                          <p>=</p>
                                       </td>
                                       									  
                                       <td>
                                          <p>_ (underscore)</p>
                                       </td>
                                       									
                                    </tr>
                                    									
                                    <tr>
                                       									  
                                       <td>
                                          <p>/</p>
                                       </td>
                                       									  
                                       <td>
                                          <p>~ (tilde)</p>
                                       </td>
                                       									
                                    </tr>
                                    								
                                 </tbody></table>
                              </div>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Include the resulting value in your <code class="code">Set-Cookie</code> header after
                              								<code class="code">CloudFront-Policy=</code>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Create a signature for the <code class="code">Set-Cookie</code> header for
                              								<code class="code">CloudFront-Signature</code> by hashing, signing, and base64-encoding the
                              policy statement. For more information, see <a href="private-content-setting-signed-cookie-custom-policy.html#private-content-custom-policy-signature-cookies">Creating a Signature for a
                                 Signed Cookie That Uses a Custom Policy</a>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h3 id="private-content-custom-policy-statement-cookies-values">Values That You
                        Specify in the Policy Statement for a Custom Policy for Signed Cookies
                     </h3>
                     
                     
                     <p>When you create a policy statement for a custom policy, you specify the following
                        values.
                     </p>
                     
                     
                     <div class="variablelist">
                        
                        
                        
                        
                        
                        
                        
                        
                        <dl>
                           
                           <dt><b><span class="term">Resource</span></b></dt>
                           
                           <dd>
                              								
                              <p>The base URL including your query strings, if any:</p>
                              								
                              <p><code class="code">http://d111111abcdef8.cloudfront.net/images/horizon.jpg?size=large&amp;license=yes</code></p>
                              								
                              <div class="aws-note">
                                 <p class="aws-note">Important</p>
                                 <p>If you omit the <code class="code">Resource</code> parameter, users can access all of the
                                    									  objects associated with any distribution that is associated with the key
                                    pair
                                    									  that you use to create the signed URL.
                                 </p>
                              </div>
                              								
                              <p>You can specify only one value for <code class="code">Resource</code>.
                              </p>
                              								
                              <p>Note the following:</p>
                              								
                              <div class="itemizedlist">
                                 									
                                 									
                                 									
                                 									
                                 								
                                 <ul class="itemizedlist" type="disc">
                                    <li class="listitem">
                                       									  
                                       <p><b>Protocol</b> &#x2013; The value must begin
                                          									    with <code class="code">http://</code> or <code class="code">https://</code>.
                                       </p>
                                       									
                                    </li>
                                    <li class="listitem">
                                       									  
                                       <p><b>Query string parameters</b> &#x2013; If you
                                          									    have no query string parameters, omit the question mark.
                                       </p>
                                       									
                                    </li>
                                    <li class="listitem">
                                       									  
                                       <p><b>Wildcards</b> &#x2013; You can use the
                                          									    wildcard character that matches zero or more characters (*) or the wild-card
                                          									    character that matches exactly one character (?) anywhere in the string.
                                          For
                                          									    example, the value:
                                       </p>
                                       									  
                                       <p><code class="code">http://d111111abcdef8.cloudfront.net/*game_download.zip*</code></p>
                                       									  
                                       <p>would include (for example) the following objects:</p>
                                       									  
                                       <div class="itemizedlist">
                                          									  	
                                          									  	
                                          									    
                                          									  
                                          <ul class="itemizedlist" type="disc">
                                             <li class="listitem">
                                                									  		
                                                <p><code class="code">http://d111111abcdef8.cloudfront.net/game_download.zip</code></p>
                                                									  	
                                             </li>
                                             <li class="listitem">
                                                									      
                                                <p><code class="code">http://d111111abcdef8.cloudfront.net/example_game_download.zip?license=yes</code></p>
                                                									    
                                             </li>
                                             <li class="listitem">
                                                									      
                                                <p><code class="code">http://d111111abcdef8.cloudfront.net/test_game_download.zip?license=temp</code></p>
                                                									    
                                             </li>
                                          </ul>
                                       </div>
                                       									
                                    </li>
                                    <li class="listitem">
                                       									  
                                       <p><b>Alternate domain names</b> &#x2013; If you
                                          									    specify an alternate domain name (CNAME) in the URL, you must specify
                                          the
                                          									    alternate domain name when referencing the object in your web page or
                                          									    application. Do not specify the Amazon S3 URL for the object.
                                       </p>
                                       									
                                    </li>
                                 </ul>
                              </div>
                              
                           </dd>
                           
                           
                           <dt><b><span class="term">DateLessThan</span></b></dt>
                           
                           <dd>
                              								
                              <p>The expiration date and time for the URL in Unix time format (in seconds) and
                                 									Coordinated Universal Time (UTC). Do not enclose the value in quotation
                                 									marks.
                              </p>
                              								
                              <p>For example, March 16, 2015 10:00 am UTC converts to 1426500000 in Unix time
                                 									format.
                              </p>
                              								
                              <p>For more information, see <a href="private-content-signed-cookies.html#private-content-check-expiration-cookie">When Does CloudFront Check the Expiration
                                    Date and Time in a Signed Cookie?</a>.
                              </p>
                              
                           </dd>
                           
                           
                           <dt><b><span class="term">DateGreaterThan (Optional)</span></b></dt>
                           
                           <dd>
                              								
                              <p>An optional start date and time for the URL in Unix time format (in seconds)
                                 									and Coordinated Universal Time (UTC). Users are not allowed to access the
                                 object
                                 									before the specified date and time. Do not enclose the value in quotation
                                 marks.
                                 								
                              </p>
                              
                           </dd>
                           
                           
                           <dt><b><span class="term">IpAddress (Optional)</span></b></dt>
                           
                           <dd>
                              								
                              <p>The IP address of the client making the GET request. Note the
                                 									following:
                              </p>
                              								
                              <div class="itemizedlist">
                                 									
                                 									
                                 									
                                 									
                                 								
                                 <ul class="itemizedlist" type="disc">
                                    <li class="listitem">
                                       									  
                                       <p>To allow any IP address to access the object, omit the
                                          									      <code class="code">IpAddress</code> parameter.
                                       </p>
                                       									
                                    </li>
                                    <li class="listitem">
                                       									  
                                       <p>You can specify either one IP address or one IP address range. For
                                          									    example, you can&apos;t set the policy to allow access if the client&apos;s IP
                                          address
                                          									    is in one of two separate ranges.
                                       </p>
                                       									
                                    </li>
                                    <li class="listitem">
                                       									  
                                       <p>To allow access from a single IP address, you specify:</p>
                                       									  
                                       <p><code class="code">&quot;</code><em class="replaceable"><code>IPv4 IP
                                                									    address</code></em><code class="code">/32&quot;</code></p>
                                       									
                                    </li>
                                    <li class="listitem">
                                       									  
                                       <p>You must specify IP address ranges in standard IPv4 CIDR format (for
                                          									    example, <code class="code">192.0.2.0/24</code>). For more information, go to <em>RFC
                                             									      4632, Classless Inter-domain Routing (CIDR): The Internet Address Assignment
                                             									      and Aggregation Plan</em>, <a href="http://tools.ietf.org/html/rfc4632" target="_blank">http://tools.ietf.org/html/rfc4632</a>.
                                       </p>
                                       									  
                                       <div class="aws-note">
                                          <p class="aws-note">Important</p>
                                          <p>IP addresses in IPv6 format, such as
                                             									      2001:0db8:85a3:0000:0000:8a2e:0370:7334, are not supported. 
                                          </p>
                                       </div>
                                       									  
                                       <p>If you&apos;re using a custom policy that includes <code class="code">IpAddress</code>, do
                                          									    not enable IPv6 for the distribution. If you want to restrict access
                                          to some
                                          									    content by IP address and support IPv6 requests for other content, you
                                          can
                                          									    create two distributions. For more information, see <a href="distribution-web-values-specify.html#DownloadDistValuesEnableIPv6">Enable IPv6</a> in the topic <a href="distribution-web-values-specify.html">Values That You Specify When You Create or Update a Web Distribution</a>.
                                       </p>
                                       									
                                    </li>
                                 </ul>
                              </div>
                              
                           </dd>
                           
                        </dl>
                     </div>
                     
                     
                     
                     <h2 id="private-content-custom-policy-statement-signed-cookies-examples">Example
                        Policy Statements for a Signed Cookie That Uses a Custom Policy
                     </h2>
                     
                     
                     <p>The following example policy statements show how to control access to a specific
                        object, all of the objects in a directory, or all of the objects associated with a
                        key
                        pair ID. The examples also show how to control access from an individual IP address
                        or a
                        range of IP addresses, and how to prevent users from using the signed cookie after
                        a
                        specified date and time.
                     </p>
                     
                     <p>If you copy and paste any of these examples, remove any whitespace (including tabs
                        and
                        newline characters), replace the applicable values with your own values, and include
                        a
                        newline character after the closing brace (&#xA0;}&#xA0;).
                     </p>
                     
                     <p>For more information, see <a href="private-content-setting-signed-cookie-custom-policy.html#private-content-custom-policy-statement-cookies-values">Values That You
                           Specify in the Policy Statement for a Custom Policy for Signed Cookies</a>.
                     </p>
                     
                     
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#private-content-custom-policy-statement-signed-cookies-example-one-object">Example Policy Statement: Accessing One Object from a Range of IP Addresses</a></li>
                           <li><a href="#private-content-custom-policy-statement-signed-cookies-example-all-objects">Example Policy Statement: Accessing All Objects in a Directory from a Range of IP
                                 Addresses</a></li>
                           <li><a href="#private-content-custom-policy-statement-signed-cookies-example-one-ip">Example Policy Statement: Accessing All Objects Associated with a Key Pair ID from
                                 One
                                 IP Address</a></li>
                        </ul>
                     </div>
                     
                     
                     <h3 id="private-content-custom-policy-statement-signed-cookies-example-one-object">Example Policy Statement: Accessing One Object from a Range of IP Addresses</h3>
                     
                     
                     <p>The following example custom policy in a signed cookie specifies that a user can
                        access the object <code class="code">http://d111111abcdef8.cloudfront.net/game_download.zip</code> from IP
                        addresses in the range <code class="code">192.0.2.0/24</code> until January 1, 2013 10:00 am
                        UTC:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">{
   &quot;Statement&quot;: [
      {
         &quot;Resource&quot;:&quot;http://d111111abcdef8.cloudfront.net/game_download.zip&quot;,
         &quot;Condition&quot;:{
            &quot;IpAddress&quot;:{&quot;AWS:SourceIp&quot;:&quot;192.0.2.0/24&quot;},
            &quot;DateLessThan&quot;:{&quot;AWS:EpochTime&quot;:1357034400}
         }
      }
   ]
}</code></pre>
                     
                     
                     <h3 id="private-content-custom-policy-statement-signed-cookies-example-all-objects">Example Policy Statement: Accessing All Objects in a Directory from a Range of IP
                        Addresses
                     </h3>
                     
                     
                     <p>The following example custom policy allows you to create signed cookies for any
                        object in the <code class="code">training</code> directory, as indicated by the * wildcard character
                        in the <code class="code">Resource</code> parameter. Users can access the object from an IP address
                        in the range <code class="code">192.0.2.0/24</code> until January 1, 2013 10:00 am UTC:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">{ 
   &quot;Statement&quot;: [
      { 
         &quot;Resource&quot;:&quot;http://d111111abcdef8.cloudfront.net/training/*&quot;, 
         &quot;Condition&quot;:{ 
            &quot;IpAddress&quot;:{&quot;AWS:SourceIp&quot;:&quot;192.0.2.0/24&quot;}, 
            &quot;DateLessThan&quot;:{&quot;AWS:EpochTime&quot;:1357034400}
         }
      }
   ] 
}</code></pre>
                     <p>Each signed cookie in which you use this policy includes a base URL that identifies
                        a specific object, for example:
                     </p>
                     
                     <p><code class="code">http://d111111abcdef8.cloudfront.net/training/orientation.pdf</code></p>
                     
                     
                     
                     <h3 id="private-content-custom-policy-statement-signed-cookies-example-one-ip">Example Policy Statement: Accessing All Objects Associated with a Key Pair ID from
                        One
                        IP Address
                     </h3>
                     
                     
                     <p>The following sample custom policy allows you to set signed cookies for any object
                        associated with any distribution, as indicated by the * wildcard character in the
                        <code class="code">Resource</code> parameter. The user must use the IP address
                        <code class="code">192.0.2.10/32</code>. (The value <code class="code">192.0.2.10/32</code> in CIDR notation
                        refers to a single IP address, <code class="code">192.0.2.10</code>.) The objects are available only
                        from January 1, 2013 10:00 am UTC until January 2, 2013 10:00 am UTC:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight ">{ 
   &quot;Statement&quot;: [
      { 
         &quot;Resource&quot;:&quot;http://*&quot;,
         &quot;Condition&quot;:{ 
            &quot;IpAddress&quot;:{&quot;AWS:SourceIp&quot;:&quot;192.0.2.10/32&quot;},
            &quot;DateGreaterThan&quot;:{&quot;AWS:EpochTime&quot;:1357034400},
            &quot;DateLessThan&quot;:{&quot;AWS:EpochTime&quot;:1357120800}
         } 
      }
   ] 
}</code></pre>
                     <p>Each signed cookie in which you use this policy includes a base URL that identifies
                        a specific object in a specific CloudFront distribution, for example:
                     </p>
                     
                     <p><code class="code">http://d111111abcdef8.cloudfront.net/training/orientation.pdf</code></p>
                     
                     <p>The signed cookie also includes a key pair ID, which must be associated with a
                        trusted signer in the distribution (d111111abcdef8.cloudfront.net) that you specify
                        in the base
                        URL.
                     </p>
                     
                     
                     
                     <h2 id="private-content-custom-policy-signature-cookies">Creating a Signature for a
                        Signed Cookie That Uses a Custom Policy
                     </h2>
                     
                     
                     
                     <p>The signature for a signed cookie that uses a custom policy is a hashed, signed, and
                        base64-encoded version of the policy statement. 
                     </p>
                     
                     
                     <p>For additional information and examples of how to hash, sign, and encode the policy
                        statement, see:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><a href="private-content-linux-openssl.html">Using a Linux Command and OpenSSL for Base64-Encoding and Encryption</a></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><a href="PrivateCFSignatureCodeAndExamples.html">Code Examples for Creating a Signature for a Signed URL</a></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><a href="Resources.html#resources-distributing-private-content">Tools and Code Examples for Configuring
                                    Private Content</a></p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <a id="private-content-custom-policy-signature-cookies-procedure"></a><p class="title"><b>To create a
                           signature for a signed cookie by using a custom policy</b></p>
                     <ol>
                        <li>
                           
                           <p>Use the SHA-1 hash function and RSA to hash and sign the JSON policy statement
                              that you created in the procedure <a href="private-content-creating-signed-url-custom-policy.html#private-content-custom-policy-creating-policy-procedure">To create the
                                 						policy statement for a signed URL that uses a custom policy</a>. Use the
                              version of the policy statement that no longer includes whitespace but that has not
                              yet been base64-encoded.
                           </p>
                           
                           
                           <p>For the private key that is required by the hash function, use the private key
                              that is associated with the applicable active trusted signer.
                           </p>
                           
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>The method that you use to hash and sign the policy statement depends on your
                                 								programming language and platform. For sample code, see <a href="PrivateCFSignatureCodeAndExamples.html">Code Examples for Creating a Signature for a Signed URL</a>.
                              </p>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Remove whitespace (including tabs and newline characters) from the hashed and
                              signed string.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Base64-encode the string using MIME base64 encoding. For more information, see
                              								<a href="http://tools.ietf.org/html/rfc2045#section-6.8" target="_blank">Section 6.8, Base64
                                 								Content-Transfer-Encoding</a> in <em>RFC 2045, MIME (Multipurpose Internet
                                 								Mail Extensions) Part One: Format of Internet Message Bodies</em>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Replace characters that are invalid in a URL query string with characters that are
                              valid. The following table lists invalid and valid characters.
                           </p>
                           
                           <div class="table">
                              <p class="title"><b></b></p>
                              <div class="table-contents">
                                 <table id="w313aac27c51c19c23b8c16b3">
                                    									
                                    <tbody><tr>
                                       									  
                                       <th>Replace these invalid characters</th>
                                       									  
                                       <th>With these valid characters</th>
                                       									
                                    </tr>
                                    								
                                    									
                                    <tr>
                                       									  
                                       <td>
                                          <p>+</p>
                                       </td>
                                       									  
                                       <td>
                                          <p>- (hyphen)</p>
                                       </td>
                                       									
                                    </tr>
                                    									
                                    <tr>
                                       									  
                                       <td>
                                          <p>=</p>
                                       </td>
                                       									  
                                       <td>
                                          <p>_ (underscore)</p>
                                       </td>
                                       									
                                    </tr>
                                    									
                                    <tr>
                                       									  
                                       <td>
                                          <p>/</p>
                                       </td>
                                       									  
                                       <td>
                                          <p>~ (tilde)</p>
                                       </td>
                                       									
                                    </tr>
                                    								
                                 </tbody></table>
                              </div>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Include the resulting value in the <code class="code">Set-Cookie</code> header for the <code class="code">CloudFront-Signature=</code> name-value pair, 
                              	and return to 
                              	<a href="private-content-setting-signed-cookie-custom-policy.html#private-content-setting-signed-cookie-custom-policy-procedure">To set a
                                 signed cookie using a custom policy</a> 
                              	to add the <code class="code">Set-Cookie</code> header for <code class="code">CloudFront-Key-Pair-Id</code>.
                           </p>
                           
                        </li>
                     </ol>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="private-content-setting-signed-cookie-canned-policy.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="private-content-linux-openssl.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Creating a Policy
          Statement for a Signed Cookie That Uses a Custom Policy"><a class="pagetoc" href="#private-content-custom-policy-statement-cookies">Creating a Policy
                              Statement for a Signed Cookie That Uses a Custom Policy</a></li>
                        <li class="pagetoc" name="Example
          Policy Statements for a Signed Cookie That Uses a Custom Policy"><a class="pagetoc" href="#private-content-custom-policy-statement-signed-cookies-examples">Example
                              Policy Statements for a Signed Cookie That Uses a Custom Policy</a></li>
                        <li class="pagetoc" name="Creating a Signature for a
          Signed Cookie That Uses a Custom Policy"><a class="pagetoc" href="#private-content-custom-policy-signature-cookies">Creating a Signature for a
                              Signed Cookie That Uses a Custom Policy</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon CloudFront';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>