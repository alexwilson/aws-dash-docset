<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Examples of Lifecycle
         Configuration - Amazon Simple Storage Service
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="object-lifecycle-mgmt.html" title="Object Lifecycle Management">
      <link rel="prev" href="intro-lifecycle-rules.html" title="Lifecycle Configuration Elements">
      <link rel="next" href="how-to-set-lifecycle-configuration-intro.html" title="Setting Lifecycle Configuration on a
            Bucket">
      <meta name="description" content="This section provides examples of lifecycle configuration. Each example shows how you can specify the XML in each of the example scenarios.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon Simple Storage Service">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/lifecycle-configuration-examples.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/s3">Amazon Simple Storage Service (S3)</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="UsingObjects.html">Working with Amazon S3 Objects</a> &#xBB; <a href="object-lifecycle-mgmt.html">Object Lifecycle Management</a> &#xBB; <span class="breadcrumb">Examples of Lifecycle
                                    Configuration</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="lifecycle-configuration-examples">Examples of Lifecycle
                        Configuration
                     </h1>
                     <p>This section provides examples of lifecycle configuration. Each example shows how
                        you
                        can specify the XML in each of the example scenarios.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#lifecycle-config-ex1">Example 1: Specifying a Filter </a></li>
                           <li><a href="#lifecycle-config-conceptual-ex2">Example 2: Disabling a
                                 Lifecycle Rule</a></li>
                           <li><a href="#lifecycle-config-conceptual-ex3">Example 3: Tiering Down Storage Class over an
                                 Object&apos;s Lifetime </a></li>
                           <li><a href="#lifecycle-config-conceptual-ex4">Example 4: Specifying Multiple
                                 Rules</a></li>
                           <li><a href="#lifecycle-config-conceptual-ex5">Example 5: Overlapping Filters,
                                 Conflicting Lifecycle Actions, and What Amazon S3 Does </a></li>
                           <li><a href="#lifecycle-config-conceptual-ex6">Example 6: Specifying a
                                 Lifecycle Rule for a Versioning-Enabled Bucket </a></li>
                           <li><a href="#lifecycle-config-conceptual-ex7">Example 7: Removing Expired Object
                                 Delete Markers</a></li>
                           <li><a href="#lc-expire-mpu">Example 8: Lifecycle Configuration to Abort
                                 Multipart Uploads</a></li>
                        </ul>
                     </div>
                     <h2 id="lifecycle-config-ex1">Example 1: Specifying a Filter </h2>
                     
                     
                     <p>Each lifecycle rule includes a filter that you can use to identify a subset of
                        objects in your bucket to which the lifecycle rule applies. The following lifecycle
                        configurations show examples of how you can specify a filter.
                     </p>
                     
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>In this lifecycle configuration rule, the filter specifies a key
                                 prefix (<code class="code">tax/</code>). Therefore, the rule applies to objects with
                                 key name prefix <code class="code">tax/</code>, such as <code class="code">tax/doc1.txt</code> and
                                 <code class="code">tax/doc2.txt</code></p>
                              
                              <p>The rule specifies two actions that request Amazon S3 to do the following:</p>
                              
                              
                              <div class="itemizedlist">
                                 
                                 
                                 
                                 <ul class="itemizedlist" type="disc">
                                    <li class="listitem">
                                       
                                       <p>Transition objects to the GLACIER storage
                                          class 365 days (one year) after creation.
                                       </p>
                                       
                                    </li>
                                    <li class="listitem">
                                       
                                       <p>Delete objects (the <code class="code">Expiration</code> action)
                                          objects 3650 days (10 years) after creation.
                                       </p>
                                       
                                    </li>
                                 </ul>
                              </div>
                              
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Transition and Expiration Rule&lt;/ID&gt;
    &lt;Filter&gt;
       &lt;Prefix&gt;tax/&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;Days&gt;365&lt;/Days&gt;
      &lt;StorageClass&gt;GLACIER&lt;/StorageClass&gt;
    &lt;/Transition&gt;
    &lt;Expiration&gt;
      &lt;Days&gt;3650&lt;/Days&gt;
    &lt;/Expiration&gt;
  &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                              <p>Instead of specifying object age in terms of days after creation, you
                                 can specify a date for each action. However, you can&apos;t use both
                                 <code class="code">Date</code> and <code class="code">Days</code> in the same rule. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>If you want the lifecycle rule to apply to all objects in the bucket,
                                 specify an empty prefix. In the following configuration, the rule specifies
                                 a <code class="code">Transition</code> action directing Amazon S3 to transition objects to
                                 the GLACIER storage class 0 days after creation in which
                                 case objects are eligible for archival to Amazon Glacier at midnight UTC following
                                 creation.
                                 
                              </p>
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Archive all object same-day upon creation&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Prefix&gt;&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;Days&gt;0&lt;/Days&gt;
      &lt;StorageClass&gt;GLACIER&lt;/StorageClass&gt;
    &lt;/Transition&gt;
  &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                              </li>
                           <li class="listitem">
                              
                              <p>You can specify zero or one key name prefix and zero or more object
                                 tags in a filter. The following example code applies the lifecycle rule to a
                                 subset of objects with the <code class="code">tax/</code> key prefix and to objects that
                                 have two tags with specific key and value. Note that when you specify more
                                 than one filter, you must include the AND as shown (Amazon S3 applies a logical
                                 AND to combine the specified filter conditions).
                              </p>
                              
                              
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">...
&lt;Filter&gt;
   &lt;And&gt;
      &lt;Prefix&gt;tax/&lt;/Prefix&gt;
      &lt;Tag&gt;
         &lt;Key&gt;key1&lt;/Key&gt;
         &lt;Value&gt;value1&lt;/Value&gt;
      &lt;/Tag&gt;
      &lt;Tag&gt;
         &lt;Key&gt;key2&lt;/Key&gt;
         &lt;Value&gt;value2&lt;/Value&gt;
      &lt;/Tag&gt;
    &lt;/And&gt;
&lt;/Filter&gt;
...</code></pre>
                              
                              
                              </li>
                           <li class="listitem">
                              
                              <p>You can filter objects based only on tags. For example, the following
                                 lifecycle rule applies to objects that have the two specified tags (it does not
                                 specify any prefix):
                              </p>
                              
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">...
&lt;Filter&gt;
   &lt;And&gt;
      &lt;Tag&gt;
         &lt;Key&gt;key1&lt;/Key&gt;
         &lt;Value&gt;value1&lt;/Value&gt;
      &lt;/Tag&gt;
      &lt;Tag&gt;
         &lt;Key&gt;key2&lt;/Key&gt;
         &lt;Value&gt;value2&lt;/Value&gt;
      &lt;/Tag&gt;
    &lt;/And&gt;
&lt;/Filter&gt;
...</code></pre>
                              
                              
                              </li>
                        </ul>
                     </div>
                     
                     
                     
                     <div class="aws-note">
                        <p class="aws-note">Important</p>
                        <p>When you have multiple rules in a lifecycle configuration, an object can
                           become eligible for multiple lifecycle actions. The general rules that Amazon S3 follows
                           in such cases are:
                        </p>
                        <div class="itemizedlist">
                           
                           
                           
                           
                           <ul class="itemizedlist" type="disc">
                              <li class="listitem">
                                 
                                 <p>Permanent deletion takes precedence over transition.</p>
                                 
                              </li>
                              <li class="listitem">
                                 
                                 <p>Transition takes precedence over creation of delete
                                    markers.
                                 </p>
                                 
                              </li>
                              <li class="listitem">
                                 
                                 <p>When an object is eligible for both a GLACIER and STANDARD_IA
                                    (or ONEZONE_IA) transition, Amazon S3 chooses the GLACIER transition.
                                 </p>
                                 
                              </li>
                           </ul>
                        </div>
                        <p> For examples, see 
                           <a href="lifecycle-configuration-examples.html#lifecycle-config-conceptual-ex5">Example 5: Overlapping Filters,
                              Conflicting Lifecycle Actions, and What Amazon S3 Does </a>
                           
                        </p>
                     </div>
                     
                     
                     
                     <h2 id="lifecycle-config-conceptual-ex2">Example 2: Disabling a
                        Lifecycle Rule
                     </h2>
                     
                     
                     <p>You can temporarily disable a lifecycle rule. The following lifecycle
                        configuration specifies two rules:
                     </p>
                     
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>Rule 1 directs Amazon S3 to transition objects with the <code class="code">logs/</code>
                                 prefix to the GLACIER storage class soon after creation. 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Rule 2 directs Amazon S3 to transition objects with the
                                 <code class="code">documents/</code> prefix to the GLACIER storage class soon
                                 after creation. 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     <p>In the policy Rule 1 is enabled and Rule 2 is disable. Amazon S3 will not take any
                        action
                        on disabled rules.
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule1&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Prefix&gt;logs/&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;Days&gt;0&lt;/Days&gt;
      &lt;StorageClass&gt;GLACIER&lt;/StorageClass&gt;
    &lt;/Transition&gt;
  &lt;/Rule&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule2&lt;/ID&gt;
    &lt;Prefix&gt;documents/&lt;/Prefix&gt;
    &lt;Status&gt;Disabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;Days&gt;0&lt;/Days&gt;
      &lt;StorageClass&gt;GLACIER&lt;/StorageClass&gt;
    &lt;/Transition&gt;
  &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                     <h2 id="lifecycle-config-conceptual-ex3">Example 3: Tiering Down Storage Class over an
                        Object&apos;s Lifetime 
                     </h2>
                     
                     
                     <p>In this example, you leverage lifecycle configuration to tier down the storage
                        class of objects over their lifetime. Tiering down can help reduce storage costs.
                        For more information about pricing, see <a href="https://aws.amazon.com/s3/pricing/" target="_blank">Amazon S3 Pricing</a>.
                     </p>
                     
                     <p>The following lifecycle configuration specifies a rule that applies to objects
                        with key name prefix <code class="code">logs/</code>. The rule specifies the following
                        actions:
                     </p>
                     
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>Two transition actions:</p>
                              
                              <div class="itemizedlist">
                                 
                                 
                                 
                                 <ul class="itemizedlist" type="disc">
                                    <li class="listitem">
                                       
                                       <p>Transition objects to the STANDARD_IA storage
                                          class 30 days after creation.
                                       </p>
                                       
                                    </li>
                                    <li class="listitem">
                                       
                                       <p>Transition objects to the GLACIER storage class
                                          90 days after creation.
                                       </p>
                                       
                                    </li>
                                 </ul>
                              </div>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>One expiration action that directs Amazon S3 to delete objects a year after
                                 creation.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;example-id&lt;/ID&gt;
    &lt;Filter&gt;
       &lt;Prefix&gt;logs/&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;Days&gt;30&lt;/Days&gt;
      &lt;StorageClass&gt;STANDARD_IA&lt;/StorageClass&gt;
    &lt;/Transition&gt;
    &lt;Transition&gt;
      &lt;Days&gt;90&lt;/Days&gt;
      &lt;StorageClass&gt;GLACIER&lt;/StorageClass&gt;
    &lt;/Transition&gt;
    &lt;Expiration&gt;
      &lt;Days&gt;365&lt;/Days&gt;
    &lt;/Expiration&gt;
  &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>You can use one rule to describe all lifecycle actions if all actions apply to
                           the same set of objects (identified by the filter). Otherwise, you can add
                           multiple rules with each specifying a different filter.
                        </p>
                     </div>
                     
                     <h2 id="lifecycle-config-conceptual-ex4">Example 4: Specifying Multiple
                        Rules
                     </h2>
                     
                     
                     
                     <p>You can specify multiple rules if you want different lifecycle actions of
                        different objects. The following lifecycle configuration has two rules:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>Rule 1 applies to objects with the key name prefix <code class="code">classA/</code>. It
                                 directs Amazon S3 to transition objects to the GLACIER storage class
                                 one year after creation and expire these objects 10 years after
                                 creation.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Rule 2 applies to objects with key name prefix <code class="code">classB/</code>. It
                                 directs Amazon S3 to transition objects to the STANDARD_IA storage
                                 class 90 days after creation and delete them one year after creation.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
    &lt;Rule&gt;
        &lt;ID&gt;ClassADocRule&lt;/ID&gt;
        &lt;Filter&gt;
           &lt;Prefix&gt;classA/&lt;/Prefix&gt;        
        &lt;/Filter&gt;
        &lt;Status&gt;Enabled&lt;/Status&gt;
        &lt;Transition&gt;   &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
           &lt;Days&gt;365&lt;/Days&gt;   &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
           &lt;StorageClass&gt;GLACIER&lt;/StorageClass&gt;   &#xA0;&#xA0;&#xA0; 
        &lt;/Transition&gt;    
        &lt;Expiration&gt;
             &lt;Days&gt;3650&lt;/Days&gt;
        &lt;/Expiration&gt;
    &lt;/Rule&gt;
    &lt;Rule&gt;
        &lt;ID&gt;ClassBDocRule&lt;/ID&gt;
        &lt;Filter&gt;
            &lt;Prefix&gt;classB/&lt;/Prefix&gt;
        &lt;/Filter&gt;
        &lt;Status&gt;Enabled&lt;/Status&gt;
        &lt;Transition&gt;   &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
           &lt;Days&gt;90&lt;/Days&gt;   &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;
           &lt;StorageClass&gt;STANDARD_IA&lt;/StorageClass&gt;   &#xA0;&#xA0;&#xA0; 
        &lt;/Transition&gt;    
        &lt;Expiration&gt;
             &lt;Days&gt;365&lt;/Days&gt;
        &lt;/Expiration&gt;
    &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                     <h2 id="lifecycle-config-conceptual-ex5">Example 5: Overlapping Filters,
                        Conflicting Lifecycle Actions, and What Amazon S3 Does 
                     </h2>
                     
                     
                     <p>You might specify a lifecycle configuration in which you specify overlapping
                        prefixes, or actions. The following examples show how Amazon S3 chooses to resolve
                        potential conflicts. 
                     </p>
                     
                     
                     <div class="example">
                        <p class="title"><b>Example  1: Overlapping Prefixes (No Conflict)</b></p>
                        <div class="example-contents">
                           <p>The following example configuration has two rules that specify overlapping
                              prefixes as follows:
                           </p>
                           <div class="itemizedlist">
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>First rule specifies an empty filter, indicating all objects in
                                       the bucket. 
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Second rule specifies a key name prefix <code class="code">logs/</code>, indicating only
                                       a subset of objects.
                                    </p>
                                    
                                 </li>
                              </ul>
                           </div>
                           <p>Rule 1 requests Amazon S3 to delete all objects one year after creation, and Rule
                              2
                              requests Amazon S3 to transition a subset of objects to the STANDARD_IA
                              storage class 30 days after creation.
                           </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 1&lt;/ID&gt;
    &lt;Filter&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Expiration&gt;
      &lt;Days&gt;365&lt;/Days&gt;
    &lt;/Expiration&gt;
  &lt;/Rule&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 2&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Prefix&gt;logs/&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;StorageClass&gt;STANDARD_IA&lt;StorageClass&gt;
      &lt;Days&gt;30&lt;/Days&gt;
    &lt;/Transition&gt;
   &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre></div>
                     </div>
                     
                     <div class="example">
                        <p class="title"><b>Example  2: Conflicting Lifecycle Actions</b></p>
                        <div class="example-contents">
                           <p>In this example configuration, there are two rules that direct
                              Amazon S3 to perform two different actions on the same set of objects at the same
                              time
                              in object&apos;s lifetime:
                           </p>
                           <div class="itemizedlist">
                              
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>Both rules specify the same key name prefix, so both rules apply
                                       to the same set of objects.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Both rules specify the same 365 days after object creation when
                                       the rules apply.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>One rule directs Amazon S3 to transition objects to the
                                       STANDARD_IA storage class and another rule wants Amazon S3 to expire
                                       the objects at the same time.
                                    </p>
                                    
                                 </li>
                              </ul>
                           </div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 1&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Prefix&gt;logs/&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Expiration&gt;
      &lt;Days&gt;365&lt;/Days&gt;
    &lt;/Expiration&gt;        
  &lt;/Rule&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 2&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Prefix&gt;logs/&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;StorageClass&gt;STANDARD_IA&lt;StorageClass&gt;
      &lt;Days&gt;365&lt;/Days&gt;
    &lt;/Transition&gt;
   &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre><p>In this case, because you want objects to expire (removed), there is no
                              point in changing the storage class, and Amazon S3 simply chooses the expiration action
                              on these objects.
                           </p>
                        </div>
                     </div>
                     
                     <div class="example">
                        <p class="title"><b>Example  3: Overlapping Prefixes Resulting in Conflicting Lifecycle
                              Actions</b></p>
                        <div class="example-contents">
                           <p>In this example, the configuration has two rules which specify overlapping
                              prefixes as follows:
                           </p>
                           <div class="itemizedlist">
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>Rule 1 specifies an empty prefix (indicating all objects).</p>
                                    
                                 </li>
                                 <li class="listitem">
                                    <p>Rule 2 specifies a key name prefix (<code class="code">logs/</code>) that 
                                       identifies a subset of all objects.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <p>For the subset of objects with the <code class="code">logs/</code> key name prefix, lifecycle actions in
                              both rules apply. One rule directing Amazon S3 to transition objects 10 days after
                              creation and another rule directing Amazon S3 to transition objects 365 days after
                              creation. 
                           </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 1&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Prefix&gt;&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;StorageClass&gt;STANDARD_IA&lt;StorageClass&gt;
      &lt;Days&gt;10&lt;/Days&gt; 
    &lt;/Transition&gt;
  &lt;/Rule&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 2&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Prefix&gt;logs/&lt;/Prefix&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;StorageClass&gt;STANDARD_IA&lt;StorageClass&gt;
      &lt;Days&gt;365&lt;/Days&gt; 
    &lt;/Transition&gt;
   &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre><p>In this case, Amazon S3 chooses to transition them 10 days after creation. </p>
                        </div>
                     </div>
                     
                     <div class="example">
                        <p class="title"><b>Example  4: Tag-based Filtering and Resulting Conflicting Lifecycle Actions </b></p>
                        <div class="example-contents">
                           <p>Suppose you have the following lifecycle policy that has two rules, each
                              specifying a tag filter:
                           </p>
                           <div class="itemizedlist">
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>Rule 1 specifies a tag-based filter (<code class="code">tag1/value1</code>). This rule
                                       directs Amazon S3 to transition objects to the GLACIER storage class 365 days after
                                       creation.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Rule 2 specifies a tag-based filter (<code class="code">tag2/value2</code>). This rule
                                       directs Amazon S3 to expire objects 14 days after creation.
                                    </p>
                                    
                                 </li>
                              </ul>
                           </div>
                           <p>The lifecycle configuration is shown following:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 1&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Tag&gt;
         &lt;Key&gt;tag1&lt;/Key&gt;
         &lt;Value&gt;value1&lt;/Value&gt;
      &lt;/Tag&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Transition&gt;
      &lt;StorageClass&gt;GLACIER&lt;StorageClass&gt;
      &lt;Days&gt;365&lt;/Days&gt; 
    &lt;/Transition&gt;
  &lt;/Rule&gt;
  &lt;Rule&gt;
    &lt;ID&gt;Rule 2&lt;/ID&gt;
    &lt;Filter&gt;
      &lt;Tag&gt;
         &lt;Key&gt;tag2&lt;/Key&gt;
         &lt;Value&gt;value1&lt;/Value&gt;
      &lt;/Tag&gt;
    &lt;/Filter&gt;
    &lt;Status&gt;Enabled&lt;/Status&gt;
    &lt;Expiration&gt;
      &lt;Days&gt;14&lt;/Days&gt; 
    &lt;/Expiration&gt;
   &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre><p>The policy is fine, but if there is an object with both tags, then S3 has
                              to decide what to do. That is, both rules apply to an object and in effect
                              you are directing Amazon S3 to perform conflicting actions. In this case, Amazon S3
                              expires the object 14 days after creation. The object is removed, and
                              therefore the transition action does not come into play.
                           </p>
                        </div>
                     </div>
                     
                     
                     
                     
                     
                     <h2 id="lifecycle-config-conceptual-ex6">Example 6: Specifying a
                        Lifecycle Rule for a Versioning-Enabled Bucket 
                     </h2>
                     
                     
                     <p>Suppose you have a versioning-enabled bucket, which means that for each object you
                        have a current version and zero or more noncurrent versions. You want to maintain
                        one year&apos;s worth of history and then delete the noncurrent versions. For more
                        information about versioning, see <a href="ObjectVersioning.html">Object Versioning</a>. 
                     </p>
                     
                     <p>Also, you want to save storage costs by moving noncurrent versions to
                        GLACIER 30 days after they become noncurrent (assuming cold data
                        for which you don&apos;t need real-time access). In addition, you also expect
                        frequency of access of the current versions to diminish 90 days after creation so
                        you might choose to move these objects to the STANDARD_IA storage
                        class.
                     </p>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
    &lt;Rule&gt;
        &lt;ID&gt;sample-rule&lt;/ID&gt;
        &lt;Filter&gt;
           &lt;Prefix&gt;&lt;/Prefix&gt;
        &lt;/Filter&gt;
        &lt;Status&gt;Enabled&lt;/Status&gt;
        &lt;Transition&gt;
           &lt;Days&gt;90&lt;/Days&gt;
           &lt;StorageClass&gt;STANDARD_IA&lt;/StorageClass&gt;
        &lt;/Transition&gt;
        &lt;NoncurrentVersionTransition&gt;      
            &lt;NoncurrentDays&gt;30&lt;/NoncurrentDays&gt;      
            &lt;StorageClass&gt;GLACIER&lt;/StorageClass&gt;   
        &lt;/NoncurrentVersionTransition&gt;    
       &lt;NoncurrentVersionExpiration&gt;     
            &lt;NoncurrentDays&gt;365&lt;/NoncurrentDays&gt;    
       &lt;/NoncurrentVersionExpiration&gt; 
    &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                     <h2 id="lifecycle-config-conceptual-ex7">Example 7: Removing Expired Object
                        Delete Markers
                     </h2>
                     
                     
                     
                     <p>A versioning-enabled bucket has one current version and one or more noncurrent
                        versions for each object. When you delete an object, note the following:
                     </p>
                     
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>If you don&apos;t specify a version ID in your delete request, Amazon S3 adds a
                                 delete marker instead of deleting the object. The current object version
                                 becomes noncurrent, and then the delete marker becomes the current version.
                                 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>If you specify a version ID in your delete request, Amazon S3 deletes the
                                 object version permanently (a delete marker is not created).
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>A delete marker with zero noncurrent versions is referred to as the
                                 <em>expired object delete marker</em>. 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     <p>This example shows a scenario that can create expired object delete markers in
                        your bucket, and how you can use lifecycle configuration to direct Amazon S3 to
                        remove the expired object delete markers.
                     </p>
                     
                     <p>Suppose you write a lifecycle policy that specifies the
                        <code class="code">NoncurrentVersionExpiration</code> action to remove the noncurrent
                        versions 30 days after they become noncurrent as shown following: 
                     </p>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
    &lt;Rule&gt;
        ...
        &lt;NoncurrentVersionExpiration&gt;     
            &lt;NoncurrentDays&gt;30&lt;/NoncurrentDays&gt;    
        &lt;/NoncurrentVersionExpiration&gt;
    &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                     
                     <p>The <code class="code">NoncurrentVersionExpiration</code> action does not apply to the current
                        object versions, it only removes noncurrent versions.
                     </p>
                     
                     <p>For current object versions, you have the following options to manage their
                        lifetime depending on whether or not the current object versions follow a
                        well-defined lifecycle: 
                     </p>
                     
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><b>Current object versions follow a well-defined
                                    lifecycle.</b></p>
                              
                              <p>In this case you can use lifecycle policy with the
                                 <code class="code">Expiration</code> action to direct Amazon S3 to remove current
                                 versions as shown in the following example: 
                              </p>
                              
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
    &lt;Rule&gt;
        ...
        &lt;Expiration&gt;
           &lt;Days&gt;60&lt;/Days&gt;
        &lt;/Expiration&gt;
        &lt;NoncurrentVersionExpiration&gt;     
            &lt;NoncurrentDays&gt;30&lt;/NoncurrentDays&gt;    
        &lt;/NoncurrentVersionExpiration&gt;
    &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                              
                              <p>Amazon S3 removes current versions 60 days after they are created by adding
                                 a delete marker for each of the current object versions. This makes the
                                 current version noncurrent and the delete marker becomes the current
                                 version. For more information, see <a href="Versioning.html">Using Versioning</a>. 
                              </p>
                              
                              <p>The <code class="code">NoncurrentVersionExpiration</code> action in the same
                                 lifecycle configuration removes noncurrent objects 30 days after they
                                 become noncurrent. Thus, all object versions are removed and you have
                                 expired object delete markers, but Amazon S3 detects and removes the 
                                 expired object delete markers for you. 
                              </p>
                              
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Current object versions don&apos;t have a
                                    well-defined lifecycle.</b>
                                 
                              </p>
                              
                              <p>In this case you might remove the objects manually when you don&apos;t need
                                 them, creating a delete marker with one or more noncurrent versions. If
                                 lifecycle configuration with <code class="code">NoncurrentVersionExpiration</code> action removes
                                 all the noncurrent versions, you now have expired object delete
                                 markers.
                              </p>
                              
                              <p>Specifically for this scenario, Amazon S3 lifecycle configuration
                                 provides an <code class="code">Expiration</code> action where you can request Amazon S3 to
                                 remove the expired object delete markers: 
                              </p>
                              
                              
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">&lt;LifecycleConfiguration&gt;
    &lt;Rule&gt;
       &lt;ID&gt;Rule 1&lt;/ID&gt;
        &lt;Filter&gt;
          &lt;Prefix&gt;logs/&lt;/Prefix&gt;
        &lt;/Filter&gt;
        &lt;Status&gt;Enabled&lt;/Status&gt;
        &lt;Expiration&gt;
           &lt;ExpiredObjectDeleteMarker&gt;true&lt;/ExpiredObjectDeleteMarker&gt;
        &lt;/Expiration&gt;
        &lt;NoncurrentVersionExpiration&gt;     
            &lt;NoncurrentDays&gt;30&lt;/NoncurrentDays&gt;    
        &lt;/NoncurrentVersionExpiration&gt;
    &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                              
                              </li>
                        </ul>
                     </div>
                     
                     
                     <p>By setting the <code class="code">ExpiredObjectDeleteMarker</code> element to true in the
                        <code class="code">Expiration</code> action, you direct Amazon S3 to remove expired object delete
                        markers.
                     </p>
                     
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>When specifying the <code class="code">ExpiredObjectDeleteMarker</code> lifecycle
                           action, the rule cannot specify a tag-based filter.
                        </p>
                     </div>
                     
                     
                     <h2 id="lc-expire-mpu">Example 8: Lifecycle Configuration to Abort
                        Multipart Uploads
                     </h2>
                     
                     
                     <p>You can use the multipart upload API to upload large objects in parts. For more
                        information about multipart uploads, see <a href="mpuoverview.html">Multipart Upload Overview</a>. 
                     </p>
                     
                     <p>Using lifecycle configuration, you can direct Amazon S3 to abort incomplete multipart
                        uploads (identified by the key name prefix specified in the rule) if they don&apos;t
                        complete within a specified number of days after initiation. When Amazon S3 aborts
                        a
                        multipart upload, it deletes all parts associated with the multipart upload. This
                        ensures that you don&apos;t have incomplete multipart uploads with parts that are stored
                        in Amazon S3 and, therefore, you don&apos;t have to pay any storage costs for these parts.
                        
                     </p>               
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>When specifying the <code class="code">AbortIncompleteMultipartUpload</code> lifecycle
                           action, the rule cannot specify a tag-based filter.
                        </p>
                     </div>
                     
                     
                     <p>The following is an example lifecycle configuration that specifies a rule with the
                        <code class="code">AbortIncompleteMultipartUpload</code> action. This action requests Amazon S3 to
                        abort incomplete multipart uploads seven days after initiation.
                     </p>
                     
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">&lt;LifecycleConfiguration&gt;
    &lt;Rule&gt;
        &lt;ID&gt;sample-rule&lt;/ID&gt;
        &lt;Filter&gt;
           &lt;Prefix&gt;<em class="replaceable"><code>SomeKeyPrefix</code></em>/&lt;/Prefix&gt;
        &lt;/Filter&gt;
        &lt;Status&gt;<em class="replaceable"><code>rule-status</code></em>&lt;/Status&gt;
        &lt;AbortIncompleteMultipartUpload&gt;
          &lt;DaysAfterInitiation&gt;7&lt;/DaysAfterInitiation&gt;
        &lt;/AbortIncompleteMultipartUpload&gt;
    &lt;/Rule&gt;
&lt;/LifecycleConfiguration&gt;</code></pre>
                     
                     </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="intro-lifecycle-rules.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="how-to-set-lifecycle-configuration-intro.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Example 1: Specifying a Filter "><a class="pagetoc" href="#lifecycle-config-ex1">Example 1: Specifying a Filter </a></li>
                        <li class="pagetoc" name="Example 2: Disabling a
                Lifecycle Rule"><a class="pagetoc" href="#lifecycle-config-conceptual-ex2">Example 2: Disabling a
                              Lifecycle Rule</a></li>
                        <li class="pagetoc" name="Example 3: Tiering Down Storage Class over an
                    Object&apos;s Lifetime "><a class="pagetoc" href="#lifecycle-config-conceptual-ex3">Example 3: Tiering Down Storage Class over an
                              Object&apos;s Lifetime </a></li>
                        <li class="pagetoc" name="Example 4: Specifying Multiple
                Rules"><a class="pagetoc" href="#lifecycle-config-conceptual-ex4">Example 4: Specifying Multiple
                              Rules</a></li>
                        <li class="pagetoc" name="Example 5: Overlapping Filters,
                Conflicting Lifecycle Actions, and What Amazon S3 Does "><a class="pagetoc" href="#lifecycle-config-conceptual-ex5">Example 5: Overlapping Filters,
                              Conflicting Lifecycle Actions, and What Amazon S3 Does </a></li>
                        <li class="pagetoc" name="Example 6: Specifying a
                Lifecycle Rule for a Versioning-Enabled Bucket "><a class="pagetoc" href="#lifecycle-config-conceptual-ex6">Example 6: Specifying a
                              Lifecycle Rule for a Versioning-Enabled Bucket </a></li>
                        <li class="pagetoc" name="Example 7: Removing Expired Object
                Delete Markers"><a class="pagetoc" href="#lifecycle-config-conceptual-ex7">Example 7: Removing Expired Object
                              Delete Markers</a></li>
                        <li class="pagetoc" name="Example 8: Lifecycle Configuration to Abort
                Multipart Uploads"><a class="pagetoc" href="#lc-expire-mpu">Example 8: Lifecycle Configuration to Abort
                              Multipart Uploads</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Simple Storage Service';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>