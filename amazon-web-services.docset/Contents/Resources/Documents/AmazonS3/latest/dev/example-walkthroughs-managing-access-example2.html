<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Example 2: Bucket Owner Granting
         			Cross-Account Bucket Permissions   - Amazon Simple Storage Service
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="example-walkthroughs-managing-access.html" title="Example Walkthroughs:
			Managing Access to Your Amazon S3 Resources ">
      <link rel="prev" href="example-walkthroughs-managing-access-example1.html" title="Example 1: Bucket Owner Granting
			Its Users Bucket Permissions ">
      <link rel="next" href="example-walkthroughs-managing-access-example3.html" title="Example 3: Bucket Owner Granting
		Its Users Permissions to Objects It Does Not Own ">
      <meta name="description" content="The second Amazon S3 walkthrough example: How a bucket owner can grant users cross-account bucket permissions.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon Simple Storage Service">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/example-walkthroughs-managing-access-example2.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="http://aws.amazon.com/documentation">AWS Documentation</a> &#xBB; <a href="http://aws.amazon.com/documentation/s3">Amazon Simple Storage Service (S3)</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="s3-access-control.html">Managing Access Permissions to Your Amazon S3 Resources</a> &#xBB; <a href="intro-managing-access-s3-resources.html">Introduction to Managing Access Permissions to Your Amazon S3 Resources</a> &#xBB; <a href="example-walkthroughs-managing-access.html">Example Walkthroughs:
                                    			Managing Access to Your Amazon S3 Resources </a> &#xBB; <span class="breadcrumb">Example 2: Bucket Owner Granting
                                    			Cross-Account Bucket Permissions  </span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div></div>
                     <h1 class="topictitle" id="example-walkthroughs-managing-access-example2">Example 2: Bucket Owner Granting
                        			Cross-Account Bucket Permissions  
                     </h1>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#cross-acct-access-step0">Step 0: Preparing for the
                                 					Walkthrough</a></li>
                           <li><a href="#access-policies-walkthrough-cross-account-permissions-acctA-tasks">Step 1: Do
                                 					the Account A Tasks</a></li>
                           <li><a href="#access-policies-walkthrough-cross-account-permissions-acctB-tasks">Step 2: Do
                                 					the Account B Tasks</a></li>
                           <li><a href="#access-policies-walkthrough-example2-explicit-deny">Step 3: Extra Credit: Try Explicit Deny</a></li>
                           <li><a href="#access-policies-walkthrough-example2-cleanup-step">Step 4: Clean Up</a></li>
                        </ul>
                     </div>
                     <p>An AWS account&#x2014;for example, Account A&#x2014;can grant another AWS account, Account B,
                        			permission to access its resources such as buckets and objects. Account B can then
                        			delegate those permissions to users in its account. In this example scenario, a
                        bucket
                        			owner grants cross-account permission to another account to perform specific bucket
                        			operations.
                     </p>
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>Account A can also directly grant a user in Account B permissions using a bucket policy.
                           					But the user will still need permission from the parent account, Account B, to
                           					which the user belongs, even if Account B does not have permissions from Account
                           					A. As long as the user has permission from both the resource owner and the
                           					parent account, the user will be able to access the resource.
                        </p>
                     </div>
                     <p>The following is a summary of the walkthrough steps:</p>
                     <div class="mediaobject">
                        			
                        				<img src="../../..//img/access-policy-ex2.png">
                        			
                        		
                     </div>
                     <div class="orderedlist">
                        		
                        		
                        		
                        	
                        <ol>
                           <li>
                              			
                              <p>Account A administrator user attaches a bucket policy granting cross-account
                                 				permissions to Account B to perform specific bucket operations.
                              </p>
                              			
                              <p>Note that administrator user in Account B will automatically inherit the
                                 				permissions.
                              </p>
                              		
                           </li>
                           <li>
                              			
                              <p>Account B administrator user attaches user policy to the user delegating the
                                 				permissions it received from Account A.
                              </p>
                              		
                           </li>
                           <li>
                              			
                              <p>User in Account B then verifies permissions by accessing an object in the bucket owned
                                 by
                                 				Account A.
                              </p>
                              		
                           </li>
                        </ol>
                     </div>
                     <p>For this example, you need two accounts. The following table shows how we refer to
                        these
                        		accounts and the administrator users in them. Per IAM guidelines (see <a href="example-walkthroughs-managing-access.html#about-using-root-credentials">About Using an Administrator User to Create Resources
                           			and Grant Permissions</a>)
                        		we do not use the account root credentials in this walkthrough. Instead, you create
                        an
                        		administrator user in each account and use those credentials in creating resources
                        and
                        		granting them permissions.
                     </p>
                     <div class="table">
                        <div class="table-contents">
                           <table id="w70aac27c19c17c15c17">
                              				
                              <tbody><tr>
                                 					
                                 <th>AWS Account ID</th>
                                 					
                                 <th>Account Referred To As</th>
                                 					
                                 <th>Administrator User in the Account </th>
                                 				
                              </tr>
                              			
                              				
                              <tr>
                                 					
                                 <td>
                                    						
                                    <p><em class="replaceable"><code>1111-1111-1111</code></em></p>
                                    					
                                 </td>
                                 					
                                 <td>
                                    						
                                    <p>Account A</p>
                                    					
                                 </td>
                                 					
                                 <td>
                                    						
                                    <p>AccountAadmin</p>
                                    					
                                 </td>
                                 				
                              </tr>
                              				
                              <tr>
                                 					
                                 <td>
                                    						
                                    <p><em class="replaceable"><code>2222-2222-2222</code></em></p>
                                    					
                                 </td>
                                 					
                                 <td>
                                    						
                                    <p>Account B</p>
                                    					
                                 </td>
                                 					
                                 <td>
                                    						
                                    <p>AccountBadmin</p>
                                    					
                                 </td>
                                 				
                              </tr>
                              			
                           </tbody></table>
                        </div>
                     </div>
                     <p>All the tasks of creating users and granting permissions are done in the AWS Management
                        Console. To
                        		verify permissions, the walkthrough uses the command line tools, AWS Command Line
                        Interface
                        		(CLI) and AWS Tools for Windows PowerShell, so you don&apos;t need to write any code.
                     </p>
                     <h2 id="cross-acct-access-step0">Step 0: Preparing for the
                        					Walkthrough
                     </h2>
                     				
                     				
                     <ol>
                        <li>
                           						
                           <p>Make sure you have two AWS accounts and that each account has one administrator user
                              as shown
                              							in the table in the preceding section.
                           </p>
                           						
                           							
                           <ol>
                              <li>
                                 									
                                 <p>Sign up for an AWS account, if needed. </p>
                                 							
                                 <ol>
                                    <li>
                                       										
                                       <p> Go to <a href="https://aws.amazon.com/s3/" target="_blank">https://aws.amazon.com/s3/</a> and click <b>Create an AWS Account</b>.
                                          										
                                       </p>
                                       									
                                    </li>
                                    <li>
                                       										
                                       <p>Follow the on-screen instructions.</p>
                                       										
                                       <p>AWS will notify you by email when your account is
                                          											active and available for you to use.
                                       </p>
                                       									
                                    </li>
                                 </ol>
                                 								
                              </li>
                              <li>
                                 									
                                 <p>Using Account A credentials, sign in to the <a href="https://console.aws.amazon.com/iam/home?#home" target="_blank">IAM
                                       									console</a> to create the administrator user:
                                 </p>
                                 										
                                 <ol>
                                    <li>
                                       												
                                       <p>Create user AccountAadmin and note down the security credentials. For
                                          													instructions, see 
                                          													<a href="./IAM/latest/UserGuide/id_users_create.html" target="_blank">Creating an IAM User in Your AWS Account</a> in  the <em>IAM User Guide</em>. 
                                       </p>
                                       											
                                    </li>
                                    <li>
                                       												
                                       <p>Grant AccountAadmin administrator privileges by attaching a user policy giving
                                          													full access. For instructions, see <a href="./IAM/latest/UserGuide/access_policies_manage.html" target="_blank">Working with Policies</a> in the  <em>IAM User Guide</em>. 
                                       </p>
                                       											
                                    </li>
                                 </ol>
                                 								
                              </li>
                              <li>
                                 									
                                 <p>While you are in the IAM console, note down the  <b>IAM User Sign-In URL</b> on the
                                    									<b>Dashboard</b>. All users in the account must
                                    								use this URL when signing in to the AWS Management Console.
                                 </p>
                                 									
                                 <p>For more information, see <a href="./IAM/latest/UserGuide/getting-started_how-users-sign-in.html" target="_blank">How 
                                       										Users Sign in to Your Account</a> in
                                    										<em>IAM User Guide</em>. 
                                 </p>
                                 								
                              </li>
                              <li>
                                 									
                                 <p>Repeat the preceding step using Account B credentials and create administrator user
                                    									AccountBadmin.
                                 </p>
                                 								
                              </li>
                           </ol>
                           						
                           					
                        </li>
                        <li>
                           						
                           <p>Set up either the AWS Command Line Interface (CLI) or the AWS Tools for Windows PowerShell.
                              							Make sure you save administrator user credentials as follows:
                           </p>
                           						
                           							
                           <div class="itemizedlist">
                              								
                              								
                              							
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    									
                                    <p>If using the AWS CLI, create two profiles, AccountAadmin and AccountBadmin, in the
                                       config
                                       										file.
                                    </p>
                                    								
                                 </li>
                                 <li class="listitem">
                                    <p>If using the AWS Tools for Windows PowerShell, make sure you store credentials for
                                       									the session as AccountAadmin and AccountBadmin.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           						
                           						
                           <p>For instructions, see <a href="policy-eval-walkthrough-download-awscli.html">Setting Up the Tools for the Example Walkthroughs</a>. 
                           </p>
                           						
                           					
                        </li>
                        <li>
                           						
                           <p>Save the administrator user credentials, also referred to as profiles. You can use
                              the
                              					profile name instead of specifying credentials for each command you enter. For
                              					more information, see <a href="policy-eval-walkthrough-download-awscli.html">Setting Up the Tools for the Example Walkthroughs</a>. 
                           </p>
                           						
                           <ol>
                              <li>
                                 							
                                 <p>Add profiles in the AWS CLI config file for each of the administrator users in the
                                    two
                                    							accounts. 
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">[profile AccountAadmin]
aws_access_key_id = <em class="replaceable"><code>access-key-ID</code></em>
aws_secret_access_key = <em class="replaceable"><code>secret-access-key</code></em>
region = us-east-1

[profile AccountBadmin]
aws_access_key_id = <em class="replaceable"><code>access-key-ID</code></em>
aws_secret_access_key = <em class="replaceable"><code>secret-access-key</code></em>
region = us-east-1</code></pre></li>
                              <li>
                                 								
                                 <p>If you are using the AWS Tools for Windows PowerShell</p>
                                 								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">set-awscredentials &#x2013;AccessKey <em class="replaceable"><code>AcctA-access-key-ID</code></em> &#x2013;SecretKey <em class="replaceable"><code>AcctA-secret-access-key</code></em> &#x2013;storeas AccountAadmin
set-awscredentials &#x2013;AccessKey <em class="replaceable"><code>AcctB-access-key-ID</code></em> &#x2013;SecretKey <em class="replaceable"><code>AcctB-secret-access-key</code></em> &#x2013;storeas AccountBadmin</code></pre>						
                                 							</li>
                           </ol>
                           					
                        </li>
                     </ol>
                     			
                     <h2 id="access-policies-walkthrough-cross-account-permissions-acctA-tasks">Step 1: Do
                        					the Account A Tasks
                     </h2>
                     				
                     				
                     <h3 id="access-policies-walkthrough-cross-account-permissions-acctA-tasks-sign-in">Step 1.1: Sign In to the AWS Management Console</h3>
                     					
                     					
                     <p>Using the IAM user sign-in URL for Account A first sign in to the AWS Management Console
                        as
                        					AccountAadmin user. This user will create a bucket and attach a policy to it.
                        
                     </p>
                     				
                     				
                     			
                     			
                     <h3 id="access-policies-walkthrough-example2a-create-bucket">Step 1.2: Create a
                        					Bucket
                     </h3>
                     				
                     				
                     <ol>
                        <li>
                           						
                           <p>In the Amazon S3 console, create a bucket. This exercise assumes the bucket is created
                              in the
                              						US East (N. Virginia) region and is named <code class="code">examplebucket</code>.
                           </p>
                           						
                           <p>For instructions, see <a href="./AmazonS3/latest/user-guide/create-bucket.html" target="_blank">How Do I Create an S3 Bucket?</a> in the
                              							<em>Amazon Simple Storage Service Console User Guide</em>. 
                           </p>
                           					
                        </li>
                        <li>
                           						
                           <p>Upload a sample object to the bucket.</p>
                           						
                           <p>For instructions, go to <a href="./AmazonS3/latest/gsg/PuttingAnObjectInABucket.html" target="_blank">Add an Object to a Bucket</a> in the <em>Amazon Simple Storage Service Getting Started Guide</em>. 
                           </p>
                           					
                        </li>
                     </ol>
                     			
                     			
                     <h3 id="access-policies-walkthrough-example2a">Step 1.3: Attach a Bucket Policy to
                        					Grant Cross-Account Permissions to Account B 
                     </h3>
                     				
                     				
                     <p>The bucket policy grants the <code class="code">s3:GetBucketLocation</code> and
                        						<code class="code">s3:ListBucket</code> permissions to Account B. It is assumed you are
                        					still signed into the console using AccountAadmin user credentials.
                     </p>
                     				
                     <ol>
                        <li>
                           						
                           <p>Attach the following bucket policy to <code class="code">examplebucket</code>. The policy grants
                              						Account B permission for the <code class="code">s3:GetBucketLocation</code> and
                              							<code class="code">s3:ListBucket</code> actions.
                           </p>
                           							
                           <p>For instructions, see <a href="./AmazonS3/latest/user-guide/add-bucket-policy.html" target="_blank">How Do I Add an
                                 							S3 Bucket Policy?</a> in the <em>Amazon Simple Storage Service Console User Guide</em>. 
                           </p>
                           						
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;Version&quot;: &quot;2012-10-17&quot;,
   &quot;Statement&quot;: [
      {
         &quot;Sid&quot;: &quot;Example permissions&quot;,
         &quot;Effect&quot;: &quot;Allow&quot;,
         &quot;Principal&quot;: {
            &quot;AWS&quot;: &quot;arn:aws:iam::<em class="replaceable"><code>AccountB-ID</code></em>:root&quot;
         },
         &quot;Action&quot;: [
            &quot;s3:GetBucketLocation&quot;,
            &quot;s3:ListBucket&quot;
         ],
         &quot;Resource&quot;: [
            &quot;arn:aws:s3:::<em class="replaceable"><code>examplebucket</code></em>&quot;
         ]
      }
   ]
}</code></pre>						
                           					</li>
                        <li>
                           						
                           <p>Verify Account B (and thus its administrator user) can perform the operations.</p>
                           						
                           <div class="itemizedlist">
                              							
                              							
                              						
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    								
                                    <p>Using the AWS CLI</p>
                                    							
                                    									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3 ls s3://<em class="replaceable"><code>examplebucket</code></em> --profile AccountBadmin
aws s3api get-bucket-location --bucket <em class="replaceable"><code>examplebucket</code></em> --profile AccountBadmin</code></pre>
                                    								
                                    							</li>
                                 <li class="listitem">
                                    								
                                    <p>Using the AWS Tools for Windows PowerShell</p>
                                    									<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">get-s3object -BucketName example2bucket -StoredCredentials AccountBadmin 
get-s3bucketlocation -BucketName example2bucket -StoredCredentials AccountBadmin</code></pre>								
                                    							</li>
                              </ul>
                           </div>
                           					
                        </li>
                     </ol>
                     			
                     
                     			
                     <h2 id="access-policies-walkthrough-cross-account-permissions-acctB-tasks">Step 2: Do
                        					the Account B Tasks
                     </h2>
                     				
                     				
                     <p>Now the Account B administrator creates a user, Dave, and delegates the Dave permissions
                        			received from Account A. 
                     </p>				
                     	
                     				
                     <h3 id="access-policies-walkthrough-cross-account-permissions-acctB-tasks-sign-in">Step 2.1: Sign In to the AWS Management Console </h3>
                     					
                     					
                     <p>Using the IAM user sign-in URL for Account B, first sign in to the AWS Management
                        Console as
                        					AccountBadmin user.  
                     </p>
                     				
                     				
                     <h3 id="access-policies-walkthrough-example2b-create-user">Step 2.2: Create User Dave
                        					in Account B
                     </h3>
                     				
                     					
                     <ol>
                        <li>
                           							
                           <p>In the IAM console, create a user, Dave. </p>
                           							
                           <p>For instructions, see 
                              								<a href="./IAM/latest/UserGuide/id_users_create.html#id_users_create_console" target="_blank">Creating IAM Users (AWS Management Console)</a> in  the <em>IAM User Guide</em>. 
                           </p>
                           						
                        </li>
                        <li>
                           							
                           <p>Note down the UserDave credentials.</p>
                           						
                        </li>
                     </ol>
                     			
                     			
                     <h3 id="access-policies-walkthrough-example2-delegate-perm-userdave">Step 2.3: Delegate
                        					Permissions to User Dave 
                     </h3>
                     				
                     				
                     <ul>
                        <li>
                           							
                           <p>Create an inline policy for the user Dave by using the following policy. You will
                              need
                              						to update the policy by providing your bucket name.
                           </p>
                           							
                           <p>It is assumed you are signed in to the console using AccountBadmin user
                              								credentials.
                           </p>
                           							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;Version&quot;: &quot;2012-10-17&quot;,
   &quot;Statement&quot;: [
      {
         &quot;Sid&quot;: &quot;Example&quot;,
         &quot;Effect&quot;: &quot;Allow&quot;,
         &quot;Action&quot;: [
            &quot;s3:ListBucket&quot;
         ],
         &quot;Resource&quot;: [
            &quot;arn:aws:s3:::<em class="replaceable"><code>examplebucket</code></em>&quot;
         ]
      }
   ]
}</code></pre>					
                           							
                           							<p>For instructions, see <a href="./IAM/latest/UserGuide/access_policies_inline-using.html" target="_blank">Working with Inline Policies</a> in the 
                              								<em>IAM User Guide</em>.
                           </p>
                           						
                        </li>
                     </ul>
                     			
                     			
                     <h3 id="access-policies-walkthrough-example2b-user-dave-access">Step 2.4: Test
                        					Permissions
                     </h3>
                     				
                     				
                     <p>Now Dave in Account B can list the contents of <code class="code">examplebucket</code> owned by
                        				Account A. You can verify the permissions using either of the following procedures.
                        
                     </p>
                     				
                     <p class="title"><b>Test Using the AWS CLI</b></p>
                     <ol>
                        <li>
                           						
                           <p>Add the UserDave profile to the AWS CLI config file. For more information about the
                              							config file, see <a href="policy-eval-walkthrough-download-awscli.html">Setting Up the Tools for the Example Walkthroughs</a>.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">[profile UserDave]
aws_access_key_id = <em class="replaceable"><code>access-key</code></em>
aws_secret_access_key = <em class="replaceable"><code>secret-access-key</code></em>
region = <em class="replaceable"><code>us-east-1</code></em></code></pre>
                           					</li>
                        <li>
                           						
                           <p>At the command prompt, enter the following AWS CLI command to verify Dave can now
                              get an
                              							object list from the <code class="code">examplebucket</code> owned by Account A. Note
                              							the command specifies the UserDave profile.
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3 ls s3://<code class="code" copy="true"><em class="replaceable"><code>examplebucket</code></em></code> --profile UserDave</code></pre>
                           						<p>Dave does not have any other permissions. So if he tries any other operation&#x2014;for
                              						example, the following get bucket location&#x2014;Amazon S3 returns
                              						permission denied. 
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3api get-bucket-location --bucket <em class="replaceable"><code>examplebucket</code></em> --profile UserDave</code></pre>
                           					</li>
                     </ol>
                     				
                     <p class="title"><b>Test Using AWS Tools for Windows PowerShell</b></p>
                     <ol>
                        <li>
                           						
                           <p>Store Dave&apos;s credentials as AccountBDave.</p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">set-awscredentials -AccessKey <em>AccessKeyID</em> -SecretKey <em>SecretAccessKey</em> -storeas AccountBDave</code></pre>
                           					</li>
                        <li>
                           						
                           <p>Try the List Bucket command.</p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">get-s3object -BucketName example2bucket -StoredCredentials AccountBDave</code></pre>						
                           						<p>Dave does not have any other permissions. So if he tries any other operation&#x2014;for
                              						example, the following get bucket location&#x2014;Amazon S3 returns
                              						permission denied. 
                           </p>
                           						<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">get-s3bucketlocation -BucketName example2bucket -StoredCredentials AccountBDave</code></pre>
                           					</li>
                     </ol>
                     			
                     			
                     <h2 id="access-policies-walkthrough-example2-explicit-deny">Step 3: Extra Credit: Try Explicit Deny</h2>
                     				
                     				
                     <p>You can have permissions granted via an ACL, a bucket policy, and a user policy. But
                        if
                        			there is an explicit deny set via either a bucket policy or a user policy, the
                        explicit
                        			deny takes precedence over any other permissions. For testing, let&apos;s update the
                        bucket
                        			policy and explicitly deny Account B the <code class="code">s3:ListBucket</code> permission. The
                        			policy also grants <code class="code">s3:ListBucket</code> permission, but explicit deny takes
                        			precedence, and Account B or users in Account B will not be able to list objects
                        in
                        				<code class="code">examplebucket</code>.
                     </p>
                     						
                     <div class="orderedlist">
                        							
                        							
                        				
                        <ol>
                           <li>
                              								
                              <p>Using credentials of user AccountAadmin in Account A, replace the bucket policy by
                                 the
                                 							following. 
                              </p>
                              								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;Version&quot;: &quot;2012-10-17&quot;,
   &quot;Statement&quot;: [
      {
         &quot;Sid&quot;: &quot;Example permissions&quot;,
         &quot;Effect&quot;: &quot;Allow&quot;,
         &quot;Principal&quot;: {
            &quot;AWS&quot;: &quot;arn:aws:iam::<em class="replaceable"><code>AccountB-ID</code></em>:root&quot;
         },
         &quot;Action&quot;: [
            &quot;s3:GetBucketLocation&quot;,
            &quot;s3:ListBucket&quot;
         ],
         &quot;Resource&quot;: [
            &quot;arn:aws:s3:::<em class="replaceable"><code>examplebucket</code></em>&quot;
         ]
      },
      {
         &quot;Sid&quot;: &quot;Deny permission&quot;,
         &quot;Effect&quot;: &quot;Deny&quot;,
         &quot;Principal&quot;: {
            &quot;AWS&quot;: &quot;arn:aws:iam::<em class="replaceable"><code>AccountB-ID</code></em>:root&quot;
         },
         &quot;Action&quot;: [
            &quot;s3:ListBucket&quot;
         ],
         &quot;Resource&quot;: [
            &quot;arn:aws:s3:::<em class="replaceable"><code>examplebucket</code></em>&quot;
         ]
      }
   ]
}</code></pre>								
                              							</li>
                           <li>
                              								
                              <p>Now if you try to get a bucket list using AccountBadmin credentials, you will get
                                 access
                                 					denied.
                              </p>
                              						
                              <div class="itemizedlist">
                                 							
                                 							
                                 						
                                 <ul class="itemizedlist" type="disc">
                                    <li class="listitem">
                                       								
                                       <p>Using the AWS CLI:</p>
                                       								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3 ls s3://<em class="replaceable"><code>examplebucket</code></em> --profile AccountBadmin</code></pre>
                                       							</li>
                                    <li class="listitem">
                                       								
                                       <p>Using the AWS Tools for Windows PowerShell:</p>
                                       								<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="">get-s3object -BucketName example2bucket -StoredCredentials AccountBDave</code></pre>
                                       							</li>
                                 </ul>
                              </div>	
                              					
                           </li>
                        </ol>
                     </div>				
                     			
                     <h2 id="access-policies-walkthrough-example2-cleanup-step">Step 4: Clean Up</h2>
                     				
                     				
                     <ol>
                        <li>
                           						
                           <p>After you are done testing, you can do the following to clean up.</p>
                           						
                           <ol>
                              <li>
                                 								
                                 <p>Sign in to the AWS Management Console (<a href="https://console.aws.amazon.com/" target="_blank">AWS Management Console</a>) using
                                    									Account A credentials, and do the following:
                                 </p>
                                 									
                                 <div class="itemizedlist">
                                    										
                                    										
                                    										
                                    									
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          											
                                          <p>In the Amazon S3 console, remove the bucket policy
                                             												attached to
                                             												<em class="replaceable"><code>examplebucket</code></em>. In the
                                             												bucket <b>Properties</b>, delete the
                                             												policy in the <b>Permissions</b>
                                             												section. 
                                          </p>
                                          										
                                       </li>
                                       <li class="listitem">
                                          											
                                          <p>If the bucket is created for this exercise, in the
                                             												Amazon S3 console, delete the objects and then delete the
                                             												bucket. 
                                          </p>
                                          										
                                       </li>
                                       <li class="listitem">
                                          											
                                          <p>In the IAM console, remove the AccountAadmin user.</p>
                                          										
                                       </li>
                                    </ul>
                                 </div>								
                                 							
                              </li>
                           </ol>
                           					
                        </li>
                        <li>
                           						
                           <p>Sign in to the AWS Management Console (<a href="https://console.aws.amazon.com/" target="_blank">AWS Management Console</a>)
                              							using Account B credentials. In the IAM console, delete user
                              							AccountBadmin.
                           </p>
                           					
                        </li>
                     </ol>
                     			
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="example-walkthroughs-managing-access-example1.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="example-walkthroughs-managing-access-example3.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Step 0: Preparing for the
					Walkthrough"><a class="pagetoc" href="#cross-acct-access-step0">Step 0: Preparing for the
                              					Walkthrough</a></li>
                        <li class="pagetoc" name="Step 1: Do
					the Account A Tasks"><a class="pagetoc" href="#access-policies-walkthrough-cross-account-permissions-acctA-tasks">Step 1: Do
                              					the Account A Tasks</a></li>
                        <li class="pagetoc" name="Step 2: Do
					the Account B Tasks"><a class="pagetoc" href="#access-policies-walkthrough-cross-account-permissions-acctB-tasks">Step 2: Do
                              					the Account B Tasks</a></li>
                        <li class="pagetoc" name="Step 3: Extra Credit: Try Explicit Deny"><a class="pagetoc" href="#access-policies-walkthrough-example2-explicit-deny">Step 3: Extra Credit: Try Explicit Deny</a></li>
                        <li class="pagetoc" name="Step 4: Clean Up"><a class="pagetoc" href="#access-policies-walkthrough-example2-cleanup-step">Step 4: Clean Up</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Simple Storage Service';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>